<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Javaä¹‹äºŒå‰æ ‘</title>
      <link href="/posts/41107/"/>
      <url>/posts/41107/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°"><a href="#ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°" class="headerlink" title="ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°"></a>ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°</h2><h3 id="ç»Ÿä¸€å†™æ³•"><a href="#ç»Ÿä¸€å†™æ³•" class="headerlink" title="ç»Ÿä¸€å†™æ³•"></a>ç»Ÿä¸€å†™æ³•</h3><img src="D:\Blog\source\img\Sorted_binary_tree_ALL_RGB.svg.png" alt="Sorted_binary_tree_ALL_RGB.svg" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root; <span class="comment">// ä»£è¡¨å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// æœ€è¿‘ä¸€æ¬¡å¼¹æ ˆçš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        colorPrintln(<span class="string">&quot;å‰: &quot;</span> + curr.val, <span class="number">31</span>);</span><br><span class="line">        stack.push(curr); <span class="comment">// å‹å…¥æ ˆï¼Œä¸ºäº†è®°ä½å›æ¥çš„è·¯</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¯ä»¥ä¸å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¤„ç†å®Œæˆ, å¯¹ä¸­åºæ¥è¯´, æ— éœ€æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¾…å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">colorPrintln</span><span class="params">(String origin, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    System.out.printf(<span class="string">&quot;\033[%dm%s\033[0m%n&quot;</span>, color, origin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰åºéå†"><a href="#å‰åºéå†" class="headerlink" title="å‰åºéå†"></a>å‰åºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        System.out.println(curr); <span class="comment">// å‰åºåœ¨æ­¤å¤„ç†</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        System.out.println(pop); <span class="comment">// ä¸­åºåœ¨æ­¤å¤„ç†</span></span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            System.out.println(pop);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦"><a href="#ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦" class="headerlink" title="ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦"></a>ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. å¾—åˆ°å·¦å­æ ‘æ·±åº¦, å¾—åˆ°å³å­æ ‘æ·±åº¦, äºŒè€…æœ€å¤§è€…åŠ ä¸€, å°±æ˜¯æœ¬èŠ‚ç‚¹æ·±åº¦</span></span><br><span class="line"><span class="comment">    2. å› ä¸ºéœ€è¦å…ˆå¾—åˆ°å·¦å³å­æ ‘æ·±åº¦, å¾ˆæ˜¾ç„¶æ˜¯ååºéå†å…¸å‹åº”ç”¨</span></span><br><span class="line"><span class="comment">    3. å…³äºæ·±åº¦çš„å®šä¹‰ï¼šä»æ ¹å‡ºå‘, ç¦»æ ¹æœ€è¿œçš„èŠ‚ç‚¹æ€»è¾¹æ•°,</span></span><br><span class="line"><span class="comment">        æ³¨æ„: åŠ›æ‰£é‡Œçš„æ·±åº¦å®šä¹‰è¦å¤šä¸€</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ·±åº¦2         æ·±åº¦3         æ·±åº¦1</span></span><br><span class="line"><span class="comment">        1            1            1</span></span><br><span class="line"><span class="comment">       / \          / \</span></span><br><span class="line"><span class="comment">      2   3        2   3</span></span><br><span class="line"><span class="comment">                        \</span></span><br><span class="line"><span class="comment">                         4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// éåŠ›æ‰£é¢˜ç›®æ”¹ä¸ºè¿”å› -1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">d1</span> <span class="operator">=</span> maxDepth(node.left);</span><br><span class="line">    <span class="type">int</span> <span class="variable">d2</span> <span class="operator">=</span> maxDepth(node.right);</span><br><span class="line">    <span class="keyword">return</span> Integer.max(d1, d2) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. ä½¿ç”¨éé€’å½’ååºéå†, æ ˆçš„æœ€å¤§é«˜åº¦å³ä¸ºæœ€å¤§æ·±åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(curr);</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> stack.size();</span><br><span class="line">            <span class="keyword">if</span> (size &gt; max) &#123;</span><br><span class="line">                max = size;</span><br><span class="line">            &#125;</span><br><span class="line">            curr = curr.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="keyword">if</span>(peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">                pop = stack.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                curr = peek.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸäºŒå‰æœç´¢æ ‘"><a href="#ğŸäºŒå‰æœç´¢æ ‘" class="headerlink" title="ğŸäºŒå‰æœç´¢æ ‘"></a>ğŸäºŒå‰æœç´¢æ ‘</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>äºŒå‰æœç´¢æ ‘ï¼ˆä¹Ÿç§°äºŒå‰æ’åºæ ‘ï¼‰æ˜¯ç¬¦åˆä¸‹é¢ç‰¹å¾çš„äºŒå‰æ ‘ï¼š</p><ol><li>æ ‘èŠ‚ç‚¹å¢åŠ  key å±æ€§ï¼Œç”¨æ¥æ¯”è¾ƒè°å¤§è°å°ï¼Œkey ä¸å¯ä»¥é‡å¤</li><li>å¯¹äºä»»æ„ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œå®ƒçš„ key æ¯”å·¦å­æ ‘çš„ <strong>key éƒ½å¤§</strong>ï¼ŒåŒæ—¶ä¹Ÿæ¯”å³å­æ ‘çš„ <strong>key éƒ½å°</strong></li></ol></blockquote><img src="D:\Blog\source\img\BST1.png" alt="BST1" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BSTNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> key; <span class="comment">// è‹¥å¸Œæœ›ä»»æ„ç±»å‹ä½œä¸º key, åˆ™åç»­å¯ä»¥å°†å…¶è®¾è®¡ä¸º Comparable æ¥å£</span></span><br><span class="line">    Object value;</span><br><span class="line">    BSTNode left;</span><br><span class="line">    BSTNode right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key, Object value, BSTNode left, BSTNode right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doGet(root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object <span class="title function_">doGet</span><span class="params">(BSTNode node, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">        <span class="keyword">return</span> doGet(node.left, key); <span class="comment">// å‘å·¦æ‰¾</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">        <span class="keyword">return</span> doGet(node.right, key); <span class="comment">// å‘å³æ‰¾</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node.value; <span class="comment">// æ‰¾åˆ°äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> node.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰¾æœ€å°"><a href="#æ‰¾æœ€å°" class="headerlink" title="æ‰¾æœ€å°"></a>æ‰¾æœ€å°</h3><blockquote><p>æ ‘çš„æœ€å·¦ä¾§å³ä¸ºæœ€å°å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">min</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doMin(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doMin</span><span class="params">(BSTNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å·¦è¾¹å·²èµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="literal">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doMin(node.left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">min</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="comment">// å·¦è¾¹æœªèµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">while</span> (p.left != <span class="literal">null</span>) &#123;</span><br><span class="line">        p = p.left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰¾æœ€å¤§"><a href="#æ‰¾æœ€å¤§" class="headerlink" title="æ‰¾æœ€å¤§"></a>æ‰¾æœ€å¤§</h3><blockquote><p>æ ‘çš„æœ€å³ä¾§å³ä¸ºæœ€å¤§å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doMax(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doMax</span><span class="params">(BSTNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å³è¾¹å·²èµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="literal">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doMin(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="comment">// å³è¾¹æœªèµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">while</span> (p.right != <span class="literal">null</span>) &#123;</span><br><span class="line">        p = p.right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢èŠ‚ç‚¹"><a href="#æ–°å¢èŠ‚ç‚¹" class="headerlink" title="æ–°å¢èŠ‚ç‚¹"></a>æ–°å¢èŠ‚ç‚¹</h3><blockquote><ul><li>è‹¥æ‰¾åˆ° keyï¼Œæ›´æ–°æ‰¾åˆ°èŠ‚ç‚¹çš„å€¼</li><li>è‹¥æ²¡æ‰¾åˆ° keyï¼Œåˆ›å»ºå¹¶è¿”å›æ–°èŠ‚ç‚¹</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    root = doPut(root, key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> BSTNode <span class="title function_">doPut</span><span class="params">(BSTNode node, <span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">        node.left = doPut(node.left, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">        node.right = doPut(node.right, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿”å›çš„æ–°èŠ‚ç‚¹ï¼Œä½œä¸ºä¸Šæ¬¡é€’å½’æ—¶ node çš„å·¦å­©å­æˆ–å³å­©å­</span></span><br><span class="line"><span class="comment">// ç¼ºç‚¹æ˜¯ï¼Œä¼šæœ‰å¾ˆå¤šä¸å¿…è¦çš„èµ‹å€¼æ“ä½œ</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// è®°ä½çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        parent = node;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 1. key å­˜åœ¨åˆ™æ›´æ–°</span></span><br><span class="line">            node.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. key ä¸å­˜åœ¨åˆ™æ–°å¢</span></span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="literal">null</span>) &#123;</span><br><span class="line">        root = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key &lt; parent.key) &#123;</span><br><span class="line">        parent.left = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        parent.right = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸš©å‰é©±åç»§"><a href="#ğŸš©å‰é©±åç»§" class="headerlink" title="ğŸš©å‰é©±åç»§"></a>ğŸš©å‰é©±åç»§</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><blockquote><p>ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±ï¼ˆå‰ä»»ï¼‰èŠ‚ç‚¹æ˜¯æŒ‡æ¯”å®ƒå°çš„èŠ‚ç‚¹ä¸­ï¼Œ<strong>æœ€å¤§çš„</strong>é‚£ä¸ª</p><p>ä¸€ä¸ªèŠ‚ç‚¹çš„åç»§ï¼ˆåä»»ï¼‰èŠ‚ç‚¹æ˜¯æŒ‡æ¯”å®ƒå¤§çš„èŠ‚ç‚¹ä¸­ï¼Œ<strong>æœ€å°çš„</strong>é‚£ä¸ª</p></blockquote><img src="D:\Blog\source\img\BST2.png" alt="BST2" style="zoom:80%;" /><p>ä¾‹å¦‚ï¼š</p><p>1 æ²¡æœ‰å‰é©±ï¼Œåç»§æ˜¯ 2</p><p>2 å‰é©±æ˜¯ 1ï¼Œåç»§æ˜¯ 3</p><p>3 å‰é©±æ˜¯ 2ï¼Œåç»§æ˜¯ 4</p><hr><p>é«˜æ•ˆ<strong>æ‰¾å‰é©±</strong>åˆ†æˆ 2 ç§æƒ…å†µï¼š</p><p>èŠ‚ç‚¹æœ‰å·¦å­æ ‘ï¼Œæ­¤æ—¶å‰é©±èŠ‚ç‚¹å°±æ˜¯å·¦å­æ ‘çš„æœ€å¤§å€¼ï¼Œå›¾ä¸­å±äºè¿™ç§æƒ…å†µçš„æœ‰</p><ul><li>2 çš„å‰é©±æ˜¯1</li><li>4 çš„å‰é©±æ˜¯ 3</li><li>6 çš„å‰é©±æ˜¯ 5</li><li>7 çš„å‰é©±æ˜¯ 6</li></ul><p>èŠ‚ç‚¹æ²¡æœ‰å·¦å­æ ‘ï¼Œè‹¥ç¦»å®ƒæœ€è¿‘çš„ç¥–å…ˆ<strong>è‡ªä»å·¦è€Œæ¥</strong>ï¼Œæ­¤ç¥–å…ˆå³ä¸ºå‰é©±ï¼Œå¦‚</p><ul><li>3 çš„ç¥–å…ˆ 2 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 2</li><li>5 çš„ç¥–å…ˆ 4 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 4</li><li>8 çš„ç¥–å…ˆ 7 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 7</li><li>1 æ²¡æœ‰è¿™æ ·çš„ç¥–å…ˆï¼Œå‰é©± null</li></ul><p>é«˜æ•ˆ<strong>æ‰¾åç»§</strong>åˆ†æˆ 2 ç§æƒ…å†µï¼š</p><p>èŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œæ­¤æ—¶åç»§èŠ‚ç‚¹å³ä¸ºå³å­æ ‘çš„æœ€å°å€¼ï¼Œå¦‚</p><ul><li>2 çš„åç»§ 3</li><li>3 çš„åç»§ 4</li><li>5 çš„åç»§ 6</li><li>7 çš„åç»§ 8</li></ul><p>èŠ‚ç‚¹æ²¡æœ‰å³å­æ ‘ï¼Œè‹¥ç¦»å®ƒæœ€è¿‘çš„ç¥–å…ˆè‡ªä»å³è€Œæ¥ï¼Œæ­¤ç¥–å…ˆå³ä¸ºåç»§ï¼Œå¦‚</p><ul><li>1 çš„ç¥–å…ˆ 2 è‡ªå³è€Œæ¥ï¼Œåç»§ 2</li><li>4 çš„ç¥–å…ˆ 5 è‡ªå³è€Œæ¥ï¼Œåç»§ 5</li><li>6 çš„ç¥–å…ˆ 7 è‡ªå³è€Œæ¥ï¼Œåç»§ 7</li><li>8 æ²¡æœ‰è¿™æ ·çš„ç¥–å…ˆï¼Œåç»§ null</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">predecessor</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">ancestorFromLeft</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; p.key) &#123;</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.key &lt; key) &#123;</span><br><span class="line">            ancestorFromLeft = p; <span class="comment">// è®°å½•è‡ªä»å·¦è€Œæ¥çš„ç¥–å…ˆ</span></span><br><span class="line">            p = p.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ1 - æœ‰å·¦å­©å­</span></span><br><span class="line">    <span class="keyword">if</span> (p.left != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> max(p.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ2 - æœ‰ç¥–å…ˆè‡ªå·¦è€Œæ¥</span></span><br><span class="line">    <span class="keyword">return</span> ancestorFromLeft != <span class="literal">null</span> ? ancestorFromLeft.value : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">successor</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">ancestorFromRight</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; p.key) &#123;</span><br><span class="line">            ancestorFromRight = p;</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.key &lt; key) &#123;</span><br><span class="line">            p = p.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ1 - æœ‰å³å­©å­</span></span><br><span class="line">    <span class="keyword">if</span> (p.right != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> min(p.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ2 - æœ‰ç¥–å…ˆè‡ªå³è€Œæ¥</span></span><br><span class="line">    <span class="keyword">return</span> ancestorFromRight != <span class="literal">null</span> ? ancestorFromRight.value : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸­åºéå†çš„åŸºæœ¬æ¡†æ¶</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">less</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &lt; key) &#123; <span class="comment">// æ»¡è¶³æ¡ä»¶åŠ å…¥</span></span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// ä¸æ»¡è¶³å¯ä»¥ç›´æ¥é€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·Ÿå°äºåä¹‹</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">greater</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt; key) &#123;</span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æŸ¥æ‰¾è¾ƒå¤§å€¼éœ€è¦å…ˆéå†å®Œè¾ƒå°å€¼ï¼Œå¯æ”¹é€ æˆ<strong>åå‘ä¸­åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">greater</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.right; <span class="comment">// è®°å½•å³è¾¹è·¯çº¿</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt; key) &#123;</span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.left;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å’Œæ‰¾å°äºç±»ä¼¼</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">between</span><span class="params">(<span class="type">int</span> key1, <span class="type">int</span> key2)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt;= key1 &amp;&amp; pop.key &lt;= key2) &#123; <span class="comment">// å¤šåŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pop.key &gt; key2) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¼˜ç‚¹ï¼š</p><ol><li>å¦‚æœæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„å¤§å°å·®è·ä¸è¶…è¿‡1ï¼Œå¯ä»¥ä¿è¯æœç´¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ **O(log n)**ï¼Œæ•ˆç‡é«˜ã€‚</li><li>æ’å…¥ã€åˆ é™¤ç»“ç‚¹ç­‰æ“ä½œä¹Ÿæ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚</li><li>å¯¹äº<strong>æœ‰åºæ•°æ®</strong>çš„æŸ¥è¯¢å’Œå¤„ç†ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘éå¸¸é€‚ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸­åºéå†å¾—åˆ°æœ‰åºåºåˆ—ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¦‚æœè¾“å…¥çš„æ•°æ®æ˜¯æœ‰åºæˆ–è€…è¿‘ä¼¼æœ‰åºçš„ï¼Œå°±ä¼šå‡ºç°æåº¦ä¸å¹³è¡¡çš„æƒ…å†µï¼Œå¯èƒ½å¯¼è‡´æœç´¢æ•ˆç‡ä¸‹é™ï¼Œæ—¶é—´å¤æ‚åº¦é€€åŒ–æˆO(n)ã€‚</li><li>å¯¹äºé¢‘ç¹åœ°æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦ç»´æŠ¤å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¾‹å¦‚çº¢é»‘æ ‘ã€AVL æ ‘ç­‰ï¼Œå¦åˆ™æœç´¢æ•ˆç‡ä¹Ÿä¼šä¸‹é™ã€‚</li><li>å¯¹äºå­˜åœ¨å¤§é‡é‡å¤æ•°æ®çš„æƒ…å†µï¼Œéœ€è¦åšç›¸åº”çš„å¤„ç†ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ ‘çš„æ·±åº¦å¢åŠ ï¼Œæœç´¢æ•ˆç‡ä¸‹é™ã€‚</li><li>å¯¹äºç»“ç‚¹è¿‡å¤šçš„æƒ…å†µï¼Œç”±äºæ ‘çš„ç©ºé—´å¼€é”€è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ¶ˆè€—è¿‡å¤§ï¼Œä¸é€‚åˆå¯¹å†…å­˜è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¹‹HashMap</title>
      <link href="/posts/23369/"/>
      <url>/posts/23369/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸPUTä¸æ‰©å®¹æœºåˆ¶"><a href="#ğŸPUTä¸æ‰©å®¹æœºåˆ¶" class="headerlink" title="ğŸPUTä¸æ‰©å®¹æœºåˆ¶"></a>ğŸPUTä¸æ‰©å®¹æœºåˆ¶</h2><img src="/img/23369/hashmap1.png" alt="hashmap1" style="zoom:80%;" /><h3 id="put-æµç¨‹"><a href="#put-æµç¨‹" class="headerlink" title="put æµç¨‹"></a>put æµç¨‹</h3><ol><li><p>HashMap æ˜¯æ‡’æƒ°åˆ›å»ºæ•°ç»„çš„ï¼Œ<strong>é¦–æ¬¡ä½¿ç”¨æ‰åˆ›å»ºæ•°ç»„</strong></p></li><li><p>è®¡ç®—ç´¢å¼•ï¼ˆæ¡¶ä¸‹æ ‡ï¼‰</p></li><li><p>å¦‚æœæ¡¶ä¸‹æ ‡è¿˜æ²¡äººå ç”¨ï¼Œåˆ›å»ºNodeå ä½è¿”å›</p></li><li><p>å¦‚æœæ¡¶ä¸‹æ ‡å·²ç»æœ‰äººå ç”¨ </p></li><li><p>å·²ç»æ˜¯ TreeNodeï¼Œèµ°çº¢é»‘æ ‘çš„æ·»åŠ æˆ–æ›´æ–°é€»è¾‘</p></li><li><p>æ˜¯æ™®é€š Nodeï¼Œèµ°é“¾è¡¨çš„æ·»åŠ æˆ–æ›´æ–°é€»è¾‘ï¼›å¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡æ ‘åŒ–é˜ˆå€¼ï¼ˆæ•°ç»„æ€»å®¹é‡64ï¼Œ<strong>é“¾è¡¨é•¿åº¦8</strong>ï¼‰ï¼Œèµ°æ ‘åŒ–é€»è¾‘</p></li></ol><p>â€‹5.è¿”å›å‰æ£€æŸ¥å®¹é‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼ˆ<strong>æ€»é•¿åº¦*æ‰©å®¹å› å­0.75</strong>ï¼‰ï¼Œä¸€æ—¦è¶…è¿‡è¿›è¡Œæ‰©å®¹ï¼ˆ<strong>æ•°ç»„*2</strong>ï¼‰</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬å››ä¸ªå‚æ•° onlyIfAbsent å¦‚æœæ˜¯ trueï¼Œé‚£ä¹ˆåªæœ‰åœ¨ä¸å­˜åœ¨è¯¥ key æ—¶æ‰ä¼šè¿›è¡Œ put æ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬äº”ä¸ªå‚æ•° evict è¿™é‡Œä¸å…³å¿ƒ</span></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ put å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘ä¸‹é¢çš„ resize()ï¼Œç±»ä¼¼ java7 çš„ç¬¬ä¸€æ¬¡ put ä¹Ÿè¦åˆå§‹åŒ–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ resize å’Œåç»­çš„æ‰©å®¹æœ‰äº›ä¸ä¸€æ ·ï¼Œå› ä¸ºè¿™æ¬¡æ˜¯æ•°ç»„ä» null åˆå§‹åŒ–åˆ°é»˜è®¤çš„ 16 æˆ–è‡ªå®šä¹‰çš„åˆå§‹å®¹é‡</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°å…·ä½“çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¦‚æœæ­¤ä½ç½®æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆç›´æ¥åˆå§‹åŒ–ä¸€ä¸‹ Node å¹¶æ”¾ç½®åœ¨è¿™ä¸ªä½ç½®å°±å¯ä»¥äº†</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// æ•°ç»„è¯¥ä½ç½®æœ‰æ•°æ®</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// é¦–å…ˆï¼Œåˆ¤æ–­è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªæ•°æ®å’Œæˆ‘ä»¬è¦æ’å…¥çš„æ•°æ®ï¼Œkey æ˜¯ä¸æ˜¯&quot;ç›¸ç­‰&quot;ï¼Œå¦‚æœæ˜¯ï¼Œå–å‡ºè¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ä»£è¡¨çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å€¼æ–¹æ³•ï¼Œä¸å±•å¼€</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜æ•°ç»„è¯¥ä½ç½®ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">// æ’å…¥åˆ°é“¾è¡¨çš„æœ€åé¢(Java7 æ˜¯æ’å…¥åˆ°é“¾è¡¨çš„æœ€å‰é¢)</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// TREEIFY_THRESHOLD ä¸º 8ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ–°æ’å…¥çš„å€¼æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ 8 ä¸ª</span></span><br><span class="line">                    <span class="comment">// ä¼šè§¦å‘ä¸‹é¢çš„ treeifyBinï¼Œä¹Ÿå°±æ˜¯å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœåœ¨è¯¥é“¾è¡¨ä¸­æ‰¾åˆ°äº†&quot;ç›¸ç­‰&quot;çš„ key(== æˆ– equals)</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="comment">// æ­¤æ—¶ breakï¼Œé‚£ä¹ˆ e ä¸ºé“¾è¡¨ä¸­[ä¸è¦æ’å…¥çš„æ–°å€¼çš„ key &quot;ç›¸ç­‰&quot;]çš„ node</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// e!=null è¯´æ˜å­˜åœ¨æ—§å€¼çš„keyä¸è¦æ’å…¥çš„key&quot;ç›¸ç­‰&quot;</span></span><br><span class="line">        <span class="comment">// å¯¹äºæˆ‘ä»¬åˆ†æçš„putæ“ä½œï¼Œä¸‹é¢è¿™ä¸ª if å…¶å®å°±æ˜¯è¿›è¡Œ &quot;å€¼è¦†ç›–&quot;ï¼Œç„¶åè¿”å›æ—§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// å¦‚æœ HashMap ç”±äºæ–°æ’å…¥è¿™ä¸ªå€¼å¯¼è‡´ size å·²ç»è¶…è¿‡äº†é˜ˆå€¼ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-7-ä¸-1-8-çš„åŒºåˆ«"><a href="#1-7-ä¸-1-8-çš„åŒºåˆ«" class="headerlink" title="1.7 ä¸ 1.8 çš„åŒºåˆ«"></a><strong>1.7 ä¸ 1.8 çš„åŒºåˆ«</strong></h3><ol><li>é“¾è¡¨æ’å…¥èŠ‚ç‚¹æ—¶ï¼Œ1.7 æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œ1.8 æ˜¯<strong>å°¾æ’æ³•</strong> </li><li>1.7 æ˜¯å¤§äºç­‰äºé˜ˆå€¼<strong>ä¸”æ²¡æœ‰ç©ºä½</strong>æ—¶æ‰æ‰©å®¹ï¼Œè€Œ 1.8 æ˜¯å¤§äºé˜ˆå€¼å°±æ‰©å®¹ </li><li>1.8 åœ¨æ‰©å®¹è®¡ç®— Node ç´¢å¼•æ—¶ï¼Œä¼šä¼˜åŒ–</li></ol><h3 id="æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯-0-75f"><a href="#æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯-0-75f" class="headerlink" title="æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯ 0.75f"></a><strong>æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯ 0.75f</strong></h3><ol><li><strong>åœ¨ç©ºé—´å ç”¨ä¸æŸ¥è¯¢æ—¶é—´ä¹‹é—´å–å¾—è¾ƒå¥½çš„æƒè¡¡</strong></li><li>å¤§äºè¿™ä¸ªå€¼ï¼Œç©ºé—´èŠ‚çœäº†ï¼Œä½†é“¾è¡¨å°±ä¼šæ¯”è¾ƒé•¿å½±å“æ€§èƒ½</li><li>å°äºè¿™ä¸ªå€¼ï¼Œå†²çªå‡å°‘äº†ï¼Œä½†æ‰©å®¹å°±ä¼šæ›´é¢‘ç¹ï¼Œç©ºé—´å ç”¨ä¹Ÿæ›´å¤š</li></ol><h2 id="ğŸæ ‘åŒ–ä¸é€€åŒ–"><a href="#ğŸæ ‘åŒ–ä¸é€€åŒ–" class="headerlink" title="ğŸæ ‘åŒ–ä¸é€€åŒ–"></a>ğŸæ ‘åŒ–ä¸é€€åŒ–</h2><h3 id="æ ‘åŒ–æ„ä¹‰"><a href="#æ ‘åŒ–æ„ä¹‰" class="headerlink" title="æ ‘åŒ–æ„ä¹‰"></a><strong>æ ‘åŒ–æ„ä¹‰</strong></h3><ul><li>çº¢é»‘æ ‘ç”¨ä»¥é¿å…Dosæ”»å‡»ï¼Œé˜²æ­¢é“¾è¡¨è¿‡é•¿å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œ<strong>æ ‘åŒ–åº”å½“æ˜¯å¶ç„¶æƒ…å†µ</strong>ï¼Œæ˜¯ä¿åº•ç­–ç•¥</li><li>hash è¡¨çš„æŸ¥æ‰¾ã€æ›´æ–°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ **O(1)**ï¼Œè€Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾ï¼Œæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <strong>O(log2â¡n )<strong>ï¼ŒTreeNode ï¼ˆçº¢é»‘æ ‘çš„æƒ…å†µï¼‰</strong>å ç”¨ç©ºé—´ä¹Ÿæ¯”æ™®é€š Node çš„å¤§</strong>ï¼Œå¦‚éå¿…è¦ï¼Œå°½é‡è¿˜æ˜¯ä½¿ç”¨é“¾è¡¨</li><li>hash å€¼å¦‚æœè¶³å¤Ÿéšæœºï¼Œåˆ™åœ¨ hash è¡¨å†…æŒ‰æ³Šæ¾åˆ†å¸ƒï¼Œåœ¨<strong>è´Ÿè½½å› å­ 0.75</strong> çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å‡ºç°æ¦‚ç‡æ˜¯ 0.00000006ï¼Œ<strong>æ ‘åŒ–é˜ˆå€¼é€‰æ‹© 8</strong> å°±æ˜¯ä¸ºäº†è®©æ ‘åŒ–å‡ ç‡è¶³å¤Ÿå°ï¼ˆè´Ÿè½½å› å­ï¼šå½“å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ•°é‡è¶…è¿‡ <strong>æ€»é•¿åº¦*è´Ÿè½½å› å­</strong> è¿›è¡Œæ‰©å®¹ï¼Œ<strong>æ‰©å®¹æ•°ç»„é•¿åº¦ä¸ºåŸæ¥çš„2å€</strong>ï¼‰</li></ul><h3 id="æ ‘åŒ–è§„åˆ™"><a href="#æ ‘åŒ–è§„åˆ™" class="headerlink" title="æ ‘åŒ–è§„åˆ™"></a><strong>æ ‘åŒ–è§„åˆ™</strong></h3><ul><li>å½“é“¾è¡¨é•¿åº¦è¶…è¿‡<strong>æ ‘åŒ–é˜ˆå€¼ 8</strong> æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹æ¥å‡å°‘é“¾è¡¨é•¿åº¦ï¼Œå¦‚æœæ•°ç»„å®¹é‡å·²ç»**&gt;&#x3D;64**ï¼Œæ‰ä¼šè¿›è¡Œæ ‘åŒ–</li></ul><h3 id="é€€åŒ–è§„åˆ™"><a href="#é€€åŒ–è§„åˆ™" class="headerlink" title="é€€åŒ–è§„åˆ™"></a><strong>é€€åŒ–è§„åˆ™</strong></h3><ul><li>æƒ…å†µ1ï¼šåœ¨æ‰©å®¹æ—¶æˆ–è€…æ‹†åˆ†æ ‘æ—¶ï¼Œæ ‘å…ƒç´ ä¸ªæ•° <strong>&lt;&#x3D; 6</strong> åˆ™ä¼šé€€åŒ–é“¾è¡¨</li><li>æƒ…å†µ2ï¼šremove æ ‘èŠ‚ç‚¹æ—¶ï¼Œè‹¥ rootã€root.leftã€root.rightã€root.left.left æœ‰ä¸€ä¸ªä¸º null ï¼Œä¹Ÿä¼šé€€åŒ–ä¸ºé“¾è¡¨</li></ul><h2 id="ğŸç´¢å¼•è®¡ç®—"><a href="#ğŸç´¢å¼•è®¡ç®—" class="headerlink" title="ğŸç´¢å¼•è®¡ç®—"></a>ğŸç´¢å¼•è®¡ç®—</h2><h3 id="ç´¢å¼•è®¡ç®—æ–¹æ³•"><a href="#ç´¢å¼•è®¡ç®—æ–¹æ³•" class="headerlink" title="ç´¢å¼•è®¡ç®—æ–¹æ³•"></a><strong>ç´¢å¼•è®¡ç®—æ–¹æ³•</strong></h3><ol><li>é¦–å…ˆï¼Œè®¡ç®—å¯¹è±¡çš„ hashCode</li><li>å†è¿›è¡Œè°ƒç”¨ HashMap çš„ hash() æ–¹æ³•è¿›è¡Œ<strong>äºŒæ¬¡å“ˆå¸Œ</strong></li></ol><ul><li><ul><li>äºŒæ¬¡ hash() æ˜¯ä¸ºäº†ç»¼åˆé«˜ä½æ•°æ®ï¼Œè®©å“ˆå¸Œåˆ†å¸ƒæ›´ä¸ºå‡åŒ€</li></ul></li></ul><p>â€‹3.æœ€å <strong>&amp; (capacity â€“ 1)</strong> å¾—åˆ°ç´¢å¼•</p><h3 id="hashCode"><a href="#hashCode" class="headerlink" title="hashCode()"></a>hashCode()</h3><h4 id="Object-hashCode"><a href="#Object-hashCode" class="headerlink" title="Object.hashCode()"></a>Object.hashCode()</h4><ul><li>Object çš„ hashCode æ–¹æ³•é»˜è®¤æ˜¯ç”Ÿæˆéšæœºæ•°ä½œä¸º hash å€¼ï¼ˆä¼šç¼“å­˜åœ¨å¯¹è±¡å¤´å½“ä¸­ï¼‰</li><li>ç¼ºç‚¹æ˜¯åŒ…å«ç›¸åŒ<strong>å€¼</strong>çš„ä¸åŒå¯¹è±¡ï¼Œä»–ä»¬çš„ hashCode ä¸ä¸€æ ·ï¼Œä¸èƒ½å¤Ÿç”¨ hash å€¼æ¥åæ˜ å¯¹è±¡çš„<strong>å€¼</strong>ç‰¹å¾ï¼Œå› æ­¤è¯¸å¤šå­ç±»éƒ½ä¼šé‡å†™ hashCode æ–¹æ³•</li></ul><h4 id="String-hashCode"><a href="#String-hashCode" class="headerlink" title="String.hashCode()"></a>String.hashCode()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;bac&quot;</span>;                     </span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);         </span><br><span class="line"></span><br><span class="line">    System.out.println(s1.hashCode());</span><br><span class="line">    System.out.println(s2.hashCode());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸåˆ™ï¼šå€¼ç›¸åŒçš„å­—ç¬¦ä¸²ç”Ÿæˆç›¸åŒçš„ hash ç , å°½é‡è®©å€¼ä¸åŒçš„å­—ç¬¦ä¸²ç”Ÿæˆä¸åŒçš„ hash ç </span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹äº abc  a * 100 + b * 10 + c</span></span><br><span class="line"><span class="comment">    å¯¹äº bac  b * 100 + a * 10 + c</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s1.charAt(i);</span><br><span class="line">        System.out.println((<span class="type">int</span>) c);</span><br><span class="line">        <span class="comment">// (a*10 + b)*10 + c  ==&gt;  a*100 + b*10 + c  2^5</span></span><br><span class="line">        hash = (hash &lt;&lt; <span class="number">5</span>) - hash + c;</span><br><span class="line">        <span class="comment">// ç»éªŒè¡¨æ˜å¦‚æœæ¯æ¬¡ä¹˜çš„æ˜¯è¾ƒå¤§è´¨æ•°ï¼Œå¯ä»¥æœ‰æ›´å¥½åœ°é™ä½ hash å†²çªï¼Œå› æ­¤æ”¹ã€ä¹˜ 10ã€‘ä¸ºã€ä¹˜ 31ã€‘</span></span><br><span class="line"><span class="comment">// ã€ä¹˜ 31ã€‘å¯ä»¥ç­‰ä»·ä¸ºã€ä¹˜ 32 - hashã€‘ï¼Œè¿›ä¸€æ­¥å¯ä»¥è½¬ä¸ºæ›´é«˜æ•ˆåœ°ã€å·¦ç§»5ä½ - hashã€‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(hash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯-2-çš„-n-æ¬¡å¹‚"><a href="#æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯-2-çš„-n-æ¬¡å¹‚" class="headerlink" title="æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯ 2 çš„ n æ¬¡å¹‚"></a><strong>æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯ 2 çš„ n æ¬¡å¹‚</strong></h3><ol><li>è®¡ç®—ç´¢å¼•æ—¶æ•ˆç‡æ›´é«˜ï¼šå¦‚æœæ˜¯ 2 çš„ n æ¬¡å¹‚å¯ä»¥<strong>ä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿å–æ¨¡</strong></li><li>æ‰©å®¹æ—¶é‡æ–°è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼š hash &amp; oldCap &#x3D;&#x3D; 0 çš„å…ƒç´ ç•™åœ¨åŸæ¥ä½ç½® ï¼Œå¦åˆ™æ–°ä½ç½® &#x3D; æ—§ä½ç½® + oldCap</li></ol><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a><strong>æ³¨æ„</strong></h3><ul><li>äºŒæ¬¡ hash æ˜¯ä¸ºäº†é…åˆ <strong>å®¹é‡æ˜¯ 2 çš„ n æ¬¡å¹‚</strong> è¿™ä¸€è®¾è®¡å‰æï¼Œå¦‚æœ hash è¡¨çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡å¹‚ï¼Œåˆ™ä¸å¿…äºŒæ¬¡ hash</li><li><strong>å®¹é‡æ˜¯ 2 çš„ n æ¬¡å¹‚</strong> è¿™ä¸€è®¾è®¡è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´å¥½ï¼Œä½† hash çš„åˆ†æ•£æ€§å°±ä¸å¥½ï¼Œéœ€è¦äºŒæ¬¡ hash æ¥ä½œä¸ºè¡¥å¿ï¼Œæ²¡æœ‰é‡‡ç”¨è¿™ä¸€è®¾è®¡çš„å…¸å‹ä¾‹å­æ˜¯ HashTable</li></ul><h2 id="ğŸkeyçš„è®¾è®¡è¦æ±‚"><a href="#ğŸkeyçš„è®¾è®¡è¦æ±‚" class="headerlink" title="ğŸkeyçš„è®¾è®¡è¦æ±‚"></a>ğŸkeyçš„è®¾è®¡è¦æ±‚</h2><ol><li>HashMap çš„ key <strong>å¯ä»¥ä¸º null</strong>ï¼Œä½† Map çš„å…¶ä»–å®ç°åˆ™ä¸ç„¶</li><li>ä½œä¸º key çš„å¯¹è±¡ï¼Œå¿…é¡»å®ç° hashCode å’Œ equalsï¼Œå¹¶ä¸” key çš„å†…å®¹<strong>ä¸èƒ½ä¿®æ”¹</strong>ï¼ˆä¸å¯å˜ï¼‰ï¼›å¦‚æœ key å¯å˜ï¼Œä¾‹å¦‚ä¿®æ”¹äº† å¯¹è±¡çš„ageå±æ€§ï¼Œä¼šå¯¼è‡´å†æ¬¡æŸ¥è¯¢æ—¶æŸ¥è¯¢ä¸åˆ°</li><li>key çš„ hashCode åº”è¯¥æœ‰è‰¯å¥½çš„æ•£åˆ—æ€§</li></ol><h2 id="ğŸHashMapå®ç°ç¤ºä¾‹"><a href="#ğŸHashMapå®ç°ç¤ºä¾‹" class="headerlink" title="ğŸHashMapå®ç°ç¤ºä¾‹"></a>ğŸHashMapå®ç°ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashTable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line">        <span class="type">int</span> hash; <span class="comment">// å“ˆå¸Œç </span></span><br><span class="line">        Object key; <span class="comment">// é”®</span></span><br><span class="line">        Object value; <span class="comment">// å€¼</span></span><br><span class="line">        Entry next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(<span class="type">int</span> hash, Object key, Object value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hash = hash;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Entry[] table = <span class="keyword">new</span> <span class="title class_">Entry</span>[<span class="number">16</span>]; <span class="comment">// åˆå§‹å®¹é‡16(2çš„næ¬¡å¹‚)</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="type">float</span> <span class="variable">loadFactor</span> <span class="operator">=</span> <span class="number">0.75f</span>; <span class="comment">// 12 é˜ˆå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">threshold</span> <span class="operator">=</span> (<span class="type">int</span>) (loadFactor * table.length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ±‚æ¨¡è¿ç®—æ›¿æ¢ä¸ºä½è¿ç®—</span></span><br><span class="line"><span class="comment">        - å‰æï¼šæ•°ç»„é•¿åº¦æ˜¯ 2 çš„ n æ¬¡æ–¹</span></span><br><span class="line"><span class="comment">        - hash % æ•°ç»„é•¿åº¦ ç­‰ä»·äº hash &amp; (æ•°ç»„é•¿åº¦-1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® hash ç è·å– value</span></span><br><span class="line">    Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123; <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> p.value;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘ hash è¡¨å­˜å…¥æ–° key valueï¼Œå¦‚æœ key é‡å¤ï¼Œåˆ™æ›´æ–° value</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> hash, Object key, Object value)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 1. idx å¤„æœ‰ç©ºä½, ç›´æ¥æ–°å¢</span></span><br><span class="line">            table[idx] = <span class="keyword">new</span> <span class="title class_">Entry</span>(hash, key, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2. idx å¤„æ— ç©ºä½, æ²¿é“¾è¡¨æŸ¥æ‰¾ æœ‰é‡å¤keyæ›´æ–°ï¼Œå¦åˆ™æ–°å¢</span></span><br><span class="line">            <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                    p.value = value; <span class="comment">// æ›´æ–°</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                p = p.next;</span><br><span class="line">            &#125;</span><br><span class="line">            p.next = <span class="keyword">new</span> <span class="title class_">Entry</span>(hash, key, value); <span class="comment">// æ–°å¢</span></span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; threshold) &#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ•°ç»„æ‰©å®¹2å€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resize</span><span class="params">()</span> &#123;</span><br><span class="line">        Entry[] newTable = <span class="keyword">new</span> <span class="title class_">Entry</span>[table.length &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; table.length; i++) &#123;</span><br><span class="line">            <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[i]; <span class="comment">// æ‹¿åˆ°æ¯ä¸ªé“¾è¡¨å¤´</span></span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                æ‹†åˆ†é“¾è¡¨ï¼Œç§»åŠ¨åˆ°æ–°æ•°ç»„ï¼Œæ‹†åˆ†è§„å¾‹ï¼ˆå‰æï¼šæ•°ç»„é•¿åº¦ä¸º2çš„næ¬¡å¹‚ï¼‰</span></span><br><span class="line"><span class="comment">                * ä¸€ä¸ªé“¾è¡¨æœ€å¤šæ‹†æˆä¸¤ä¸ª</span></span><br><span class="line"><span class="comment">                * hash &amp; table.length == 0 çš„ä¸€ç»„</span></span><br><span class="line"><span class="comment">                * hash &amp; table.length != 0 çš„ä¸€ç»„</span></span><br><span class="line"><span class="comment">                                          p</span></span><br><span class="line"><span class="comment">                0-&gt;8-&gt;16-&gt;24-&gt;32-&gt;40-&gt;48-&gt;null</span></span><br><span class="line"><span class="comment">                            a</span></span><br><span class="line"><span class="comment">                0-&gt;16-&gt;32-&gt;48-&gt;null</span></span><br><span class="line"><span class="comment">                        b</span></span><br><span class="line"><span class="comment">                8-&gt;24-&gt;40-&gt;null</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">                <span class="type">Entry</span> <span class="variable">a</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">b</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">aHead</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">bHead</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((p.hash &amp; table.length) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (a != <span class="literal">null</span>) &#123;</span><br><span class="line">                            a.next = p;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            aHead = p;</span><br><span class="line">                        &#125;</span><br><span class="line">                        a = p; <span class="comment">// åˆ†é…åˆ°a</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">                            b.next = p;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            bHead = p;</span><br><span class="line">                        &#125;</span><br><span class="line">                        b = p; <span class="comment">// åˆ†é…åˆ°b</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    p = p.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§„å¾‹ï¼š a é“¾è¡¨ä¿æŒç´¢å¼•ä½ç½®ä¸å˜ï¼Œb é“¾è¡¨ç´¢å¼•ä½ç½®+table.length</span></span><br><span class="line">                <span class="keyword">if</span> (a != <span class="literal">null</span>) &#123;</span><br><span class="line">                    a.next = <span class="literal">null</span>;</span><br><span class="line">                    newTable[i] = aHead;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">                    b.next = <span class="literal">null</span>;</span><br><span class="line">                    newTable[i + table.length] = bHead;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        table = newTable;</span><br><span class="line">        threshold = (<span class="type">int</span>) (loadFactor * table.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® hash ç åˆ é™¤ï¼Œè¿”å›åˆ é™¤çš„ value</span></span><br><span class="line">    Object <span class="title function_">remove</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                <span class="comment">// æ‰¾åˆ°äº†, åˆ é™¤</span></span><br><span class="line">                <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123; <span class="comment">// é“¾è¡¨å¤´</span></span><br><span class="line">                    table[idx] = p.next;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// éé“¾è¡¨å¤´</span></span><br><span class="line">                    prev.next = p.next;</span><br><span class="line">                &#125;</span><br><span class="line">                size--;</span><br><span class="line">                <span class="keyword">return</span> p.value;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = p;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå…³é”®æ•°"><a href="#ğŸå…³é”®æ•°" class="headerlink" title="ğŸå…³é”®æ•°"></a>ğŸå…³é”®æ•°</h2><p>æ‰©å®¹å› å­ï¼š<strong>0.75</strong></p><p>æ ‘åŒ–é˜ˆå€¼ï¼šæ•°ç»„&gt;&#x3D;<strong>64</strong>,é“¾è¡¨&gt;&#x3D;<strong>8</strong></p><p>æ•°ç»„æ‰©å®¹å€æ•°ï¼š<strong>2</strong></p><p>æ•°ç»„é•¿åº¦æœ€ä½³ï¼š<strong>2çš„næ¬¡å¹‚</strong></p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¹‹List</title>
      <link href="/posts/51030/"/>
      <url>/posts/51030/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸArrayList"><a href="#ğŸArrayList" class="headerlink" title="ğŸArrayList"></a>ğŸArrayList</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ArrayListæ˜¯åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œå¯ä»¥<strong>éšæœº</strong>è®¿é—®</p><h3 id="æ˜“æ··æ–¹æ³•"><a href="#æ˜“æ··æ–¹æ³•" class="headerlink" title="æ˜“æ··æ–¹æ³•"></a>æ˜“æ··æ–¹æ³•</h3><h4 id="size"><a href="#size" class="headerlink" title="size()"></a>size()</h4><blockquote><p>è¿”å›æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œæ³¨æ„åŒºåˆ«æ•°ç»„çš„lengthå’ŒStringçš„length()</p></blockquote><p>å¸¸ç”¨äºè¿­ä»£å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; sites = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">sites.add(<span class="string">&quot;Google&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Runoob&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Weibo&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sites.size(); i++) &#123;</span><br><span class="line">System.out.println(sites.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><p>Collections ç±»æä¾›çš„ sort() æ–¹æ³•å¯ä»¥å¯¹å­—ç¬¦æˆ–æ•°å­—åˆ—è¡¨è¿›è¡Œæ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; sites = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">sites.add(<span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Wiki&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Runoob&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Weibo&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Google&quot;</span>);</span><br><span class="line">Collections.sort(sites);  <span class="comment">// å­—æ¯æ’åº</span></span><br><span class="line"><span class="keyword">for</span> (String i : sites) &#123;</span><br><span class="line">System.out.println(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line">Google</span><br><span class="line">Runoob</span><br><span class="line">Taobao</span><br><span class="line">Weibo</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure><h3 id="ğŸš©æ‰©å®¹æœºåˆ¶"><a href="#ğŸš©æ‰©å®¹æœºåˆ¶" class="headerlink" title="ğŸš©æ‰©å®¹æœºåˆ¶"></a>ğŸš©æ‰©å®¹æœºåˆ¶</h3><ol><li>ArrayList() ä¼šä½¿ç”¨<strong>é•¿åº¦ä¸ºé›¶</strong>çš„æ•°ç»„ </li><li>ArrayList(int initialCapacity) ä¼šä½¿ç”¨æŒ‡å®šå®¹é‡çš„æ•°ç»„ </li><li>public ArrayList(Collection&lt;? extends E&gt; c) ä¼šä½¿ç”¨ c çš„å¤§å°ä½œä¸ºæ•°ç»„å®¹é‡ </li><li><strong>add(Object o)é¦–æ¬¡æ‰©å®¹ä¸º10ï¼Œå†æ¬¡æ‰©å®¹ä¸ºä¸Šæ¬¡å®¹é‡çš„1.5å€</strong></li><li>addAll(Collection c)æ²¡æœ‰å…ƒç´ æ—¶ï¼Œæ‰©å®¹ä¸ºMath.max(10,å®é™…å…ƒç´ ä¸ªæ•°)ï¼Œæœ‰å…ƒç´ æ—¶ä¸ºMath.max(åŸå®¹é‡1.5å€,å®é™…å…ƒç´ ä¸ªæ•°)</li></ol><h2 id="ğŸLinkedList"><a href="#ğŸLinkedList" class="headerlink" title="ğŸLinkedList"></a>ğŸLinkedList</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>åŸºäº<strong>åŒå‘é“¾è¡¨</strong>å®ç°ï¼Œåªèƒ½<strong>é¡ºåºè®¿é—®</strong>ï¼Œå¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚LinkedList è¿˜å¯ä»¥ç”¨ä½œ<strong>æ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—</strong>.</p><h3 id="æ˜“æ··æ–¹æ³•-1"><a href="#æ˜“æ··æ–¹æ³•-1" class="headerlink" title="æ˜“æ··æ–¹æ³•"></a>æ˜“æ··æ–¹æ³•</h3><h4 id="getFirst-getLast"><a href="#getFirst-getLast" class="headerlink" title="getFirst(), getLast()"></a>getFirst(), getLast()</h4><p>è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å’Œè·å–æœ€åä¸€ä¸ªå…ƒç´ </p><h4 id="removeFirst-removeLast-remove-e-remove-index"><a href="#removeFirst-removeLast-remove-e-remove-index" class="headerlink" title="removeFirst(), removeLast(), remove(e), remove(index)"></a>removeFirst(), removeLast(), remove(e), remove(index)</h4><p>åˆ é™¤ç³»åˆ—æ–¹æ³•</p><h3 id="ğŸš©åŒºåˆ«ArrayList"><a href="#ğŸš©åŒºåˆ«ArrayList" class="headerlink" title="ğŸš©åŒºåˆ«ArrayList"></a>ğŸš©åŒºåˆ«ArrayList</h3><table><thead><tr><th></th><th align="center">ArrayList</th><th align="center">LinkedList</th></tr></thead><tbody><tr><td>ç»“æ„</td><td align="center">åŠ¨æ€æ•°ç»„</td><td align="center">åŒå‘é“¾è¡¨</td></tr><tr><td>è®¿é—®</td><td align="center">éšæœºè®¿é—®</td><td align="center">é¡ºåºè®¿é—®</td></tr><tr><td>æ’å…¥åˆ é™¤</td><td align="center">ä¸€èˆ¬æ€§èƒ½ä½</td><td align="center">ä¸€èˆ¬æ€§èƒ½é«˜</td></tr><tr><td>å†…å­˜å ç”¨</td><td align="center">ä½</td><td align="center">é«˜</td></tr><tr><td>é€‚ç”¨æƒ…å†µ</td><td align="center">é¢‘ç¹è®¿é—®åˆ—è¡¨ä¸­çš„æŸä¸€ä¸ªå…ƒç´ ï¼Œåªéœ€è¦åœ¨åˆ—è¡¨æœ«å°¾è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œ</td><td align="center">éœ€è¦é€šè¿‡å¾ªç¯è¿­ä»£æ¥è®¿é—®åˆ—è¡¨ä¸­çš„æŸäº›å…ƒç´ ï¼Œéœ€è¦é¢‘ç¹çš„åœ¨åˆ—è¡¨å¼€å¤´ã€ä¸­é—´ã€æœ«å°¾ç­‰ä½ç½®è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œ</td></tr></tbody></table><h2 id="ğŸé“¾è¡¨æ‰©å±•"><a href="#ğŸé“¾è¡¨æ‰©å±•" class="headerlink" title="ğŸé“¾è¡¨æ‰©å±•"></a>ğŸé“¾è¡¨æ‰©å±•</h2><h3 id="å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"><a href="#å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°" class="headerlink" title="å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"></a>å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedListSentinel</span> &#123;</span><br><span class="line">    <span class="comment">// å“¨å…µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.MIN_VALUE, <span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ®ç´¢å¼•è·å–èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head; curr != <span class="literal">null</span>; curr = curr.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> curr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findLast</span><span class="params">()</span> &#123;</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">for</span> (curr = <span class="built_in">this</span>.head; curr.next != <span class="literal">null</span>; ) &#123;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ å…¥åˆ°æœ€å</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> findLast();</span><br><span class="line">        last.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="literal">null</span>); <span class="comment">// æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ’å…¥åˆ°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, prev.next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®ç´¢å¼•åˆ é™¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span> &amp;&amp; (curr = prev.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = curr.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ å…¥åˆ°å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.head.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="built_in">this</span>.head.next);</span><br><span class="line">        <span class="comment">// ä¹Ÿå¯ä»¥è§†ä¸º insert çš„ç‰¹ä¾‹, å³ insert(0, value);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"><a href="#åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°" class="headerlink" title="åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"></a>åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoublyLinkedListSentinel</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line"><span class="comment">// é»˜è®¤å¸¦æœ‰ä¸€ä¸ªå¤´èŠ‚ç‚¹å’Œä¸€ä¸ªå°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node tail;</span><br><span class="line"><span class="comment">// æ„é€ æ–¹æ³•ï¼šå¤´å°¾äº’ç›¸æŒ‡å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoublyLinkedListSentinel</span><span class="params">()</span> &#123;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">666</span>, <span class="literal">null</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">888</span>, <span class="literal">null</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ ¹æ®ç´¢å¼•æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head; p != tail; p = p.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ åˆ°å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        insert(<span class="number">0</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        remove(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ åˆ°å°¾éƒ¨ï¼ˆå°¾èŠ‚ç‚¹ä¹‹å‰ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, tail);</span><br><span class="line">        prev.next = added;</span><br><span class="line">        tail.prev = added;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å°¾éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="keyword">if</span> (removed == head) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> removed.prev;</span><br><span class="line">        prev.next = tail;</span><br><span class="line">        tail.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ’å…¥åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>); <span class="comment">// æŸ¥æ‰¾åˆ°å‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">inserted</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, next);</span><br><span class="line">        prev.next = inserted;</span><br><span class="line">        next.prev = inserted;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤æŒ‡å®šç´¢å¼•èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="keyword">if</span> (removed == tail) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> removed.next;</span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IllegalArgumentException <span class="title function_">illegalIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                String.format(<span class="string">&quot;index [%d] ä¸åˆæ³•%n&quot;</span>, index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™è¿­ä»£å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head.next;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node prev; <span class="comment">// å‰æŒ‡é’ˆ</span></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next; <span class="comment">// åæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node prev, <span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—"><a href="#å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—" class="headerlink" title="å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—"></a>å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—</h3><p>åˆå§‹æ—¶ï¼š</p><img src="/img/51030/listByLink1.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—1" style="zoom:80%;" /><p>æ’å…¥ç¤ºä¾‹ï¼š</p><img src="/img/51030/listByLink2.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—2" style="zoom:80%;" /><img src="/img/51030/listByLink3.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—3" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListQueue</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// å¤´æŒ‡é’ˆæŒ‡å‘å“¨å…µ</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; tail = head; <span class="comment">// å°¾æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> Integer.MAX_VALUE; <span class="comment">// å®¹é‡</span></span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        tail.next = head; <span class="comment">// åˆå§‹å°¾å¾ªç¯æŒ‡å‘å¤´</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å°¾éƒ¨åŠ å…¥èŠ‚ç‚¹ï¼ˆå…¥é˜Ÿï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; added = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head);</span><br><span class="line">        tail.next = added;</span><br><span class="line">        tail = added; <span class="comment">// å°¾æŒ‡é’ˆå§‹ç»ˆæŒ‡å‘æœ€åä¸€ä¸ª</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤èŠ‚ç‚¹ï¼ˆå‡ºé˜Ÿï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        <span class="keyword">if</span> (first == tail) &#123;</span><br><span class="line">            tail = head;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¿”å›é˜Ÿå¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ¤ç©º</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ¤æ»¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é‡å†™è¿­ä»£</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next; <span class="comment">// åˆå§‹åœ¨çœŸå®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != head;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ"><a href="#é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ" class="headerlink" title="é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ"></a>é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListStack</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Stack</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// å‡ºå…¥æ ˆä»…åœ¨é“¾è¡¨å¤´æ“ä½œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// å“¨å…µ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListStack</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å…¥æ ˆï¼Œæ’å…¥é“¾è¡¨å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head.next);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å‡ºæ ˆï¼Œåˆ é™¤é“¾è¡¨å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›é“¾è¡¨å¤´çš„å€¼</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head.next == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—"><a href="#ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—" class="headerlink" title="ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—"></a>ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…³é”®ç‚¹ï¼šæ‰¾åˆ°å¾…æ“ä½œèŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­çš„å‰åèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListDeque</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Deque</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// åŠ å…¥å¤´éƒ¨ï¼ˆå“¨å…µçš„åä¸€ä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerFirst</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel.next; <span class="comment">// å</span></span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ å…¥å°¾éƒ¨ï¼ˆå“¨å…µçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerLast</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel.prev; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel; <span class="comment">// å</span></span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; a = sentinel; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; polled = sentinel.next;</span><br><span class="line">        Node&lt;E&gt; b = polled.next; <span class="comment">// å</span></span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å°¾</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; polled = sentinel.prev;</span><br><span class="line">        Node&lt;E&gt; a = polled.prev; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel; <span class="comment">// å</span></span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›å¤´ï¼ˆå“¨å…µçš„åä¸€ä¸ªï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›å°¾ï¼ˆå“¨å…µçš„å‰ä¸€ä¸ªï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.prev.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = sentinel.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != sentinel;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node&lt;E&gt; prev, E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; sentinel = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListDeque</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        sentinel.next = sentinel;</span><br><span class="line">        sentinel.prev = sentinel;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCå›æ”¶ç­–ç•¥ä¸GCå™¨</title>
      <link href="/posts/46450/"/>
      <url>/posts/46450/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå›æ”¶ç­–ç•¥"><a href="#ğŸå›æ”¶ç­–ç•¥" class="headerlink" title="ğŸå›æ”¶ç­–ç•¥"></a>ğŸå›æ”¶ç­–ç•¥</h2><p>æ ¹æ® GC çš„è§„æ¨¡å¯ä»¥åˆ†æˆ <strong>Minor GC</strong>ï¼Œ<strong>Major GC</strong>ï¼Œ<strong>Mixed GC</strong>ï¼Œ<strong>Full GC</strong></p><p>Minor GCï¼ˆYoung GCï¼‰:åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ï¼Œæš‚åœæ—¶é—´çŸ­</p><p>Major GCï¼ˆOld GCï¼‰:åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œåªæœ‰ CMSæ”¶é›†å™¨ ä¼šæœ‰</p><p>Mixed GCï¼šæ–°ç”Ÿä»£ + è€å¹´ä»£éƒ¨åˆ†åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼Œ<strong>G1æ”¶é›†å™¨</strong>ç‰¹æœ‰</p><p>Full GCï¼šæ–°ç”Ÿä»£ + è€å¹´ä»£<strong>å®Œæ•´</strong>åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œ<strong>åº”å°½åŠ›é¿å…</strong></p><h2 id="ğŸåƒåœ¾æ”¶é›†å™¨"><a href="#ğŸåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ğŸåƒåœ¾æ”¶é›†å™¨"></a>ğŸåƒåœ¾æ”¶é›†å™¨</h2><h3 id="Parallel-GC"><a href="#Parallel-GC" class="headerlink" title="Parallel GC"></a>Parallel GC</h3><ul><li>eden å†…å­˜ä¸è¶³å‘ç”Ÿ Minor GCï¼Œé‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ </li><li>old å†…å­˜ä¸è¶³å‘ç”Ÿ Full GCï¼Œé‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ </li><li><strong>æ³¨é‡ååé‡</strong></li></ul><h3 id="ConcurrentMarkSweep-GC"><a href="#ConcurrentMarkSweep-GC" class="headerlink" title="ConcurrentMarkSweep GC"></a>ConcurrentMarkSweep GC</h3><ul><li><p>å®ƒæ˜¯å·¥ä½œåœ¨ old è€å¹´ä»£ï¼Œæ”¯æŒ<strong>å¹¶å‘æ ‡è®°</strong>çš„ä¸€æ¬¾å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>å¹¶å‘æ¸…é™¤</strong>ç®—æ³• </p></li><li><ul><li>å¹¶å‘æ ‡è®°æ—¶ä¸éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</li><li>é‡æ–°æ ‡è®°æ—¶ä»éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</li></ul></li><li><p>å¦‚æœå¹¶å‘å¤±è´¥ï¼ˆå³å›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GC </p></li><li><p><strong>æ³¨é‡å“åº”æ—¶é—´</strong></p></li></ul><h3 id="ğŸš©G1-GC"><a href="#ğŸš©G1-GC" class="headerlink" title="ğŸš©G1 GC"></a>ğŸš©G1 GC</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ul><li><strong>å“åº”æ—¶é—´ä¸ååé‡å…¼é¡¾</strong></li><li>åˆ’åˆ†æˆå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“ edenï¼Œsurvivorï¼Œoldï¼Œ humongousï¼Œå…¶ä¸­ humongous ä¸“ä¸ºå¤§å¯¹è±¡å‡†å¤‡</li><li>åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</li><li>å¦‚æœå¹¶å‘å¤±è´¥ï¼ˆå³å›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GC</li></ul><h4 id="å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶"><a href="#å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶" class="headerlink" title="å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶"></a>å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶</h4><p>1.åˆå§‹æ—¶ï¼Œæ‰€æœ‰åŒºåŸŸéƒ½å¤„äºç©ºé—²çŠ¶æ€</p><img src="/img/46450/G1-1.png" alt="G1-1" style="zoom: 67%;" /><p>2.åˆ›å»ºäº†ä¸€äº›å¯¹è±¡ï¼ŒæŒ‘å‡ºä¸€äº›ç©ºé—²åŒºåŸŸä½œä¸ºä¼Šç”¸å›­åŒºå­˜å‚¨è¿™äº›å¯¹è±¡</p><img src="/img/46450/G1-2.png" alt="G1-2" style="zoom: 67%;" /><p>3.å½“ä¼Šç”¸å›­éœ€è¦åƒåœ¾å›æ”¶æ—¶ï¼ŒæŒ‘å‡ºä¸€ä¸ªç©ºé—²åŒºåŸŸä½œä¸ºå¹¸å­˜åŒºï¼Œç”¨<strong>å¤åˆ¶ç®—æ³•</strong>å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œéœ€è¦<strong>æš‚åœç”¨æˆ·çº¿ç¨‹</strong></p><img src="/img/46450/G1-3.png" alt="G1-3" style="zoom:67%;" /><p>4.å¤åˆ¶å®Œæˆï¼Œå°†ä¹‹å‰çš„ä¼Šç”¸å›­å†…å­˜é‡Šæ”¾</p><img src="/img/46450/G1-4.png" alt="G1-4" style="zoom:67%;" /><p>5.éšç€æ—¶é—´æµé€ï¼Œä¼Šç”¸å›­çš„å†…å­˜åˆæœ‰ä¸è¶³</p><img src="/img/46450/G1-5.png" alt="G1-5" style="zoom:67%;" /><p>6.å°†ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œå¤åˆ¶åˆ°æ–°çš„å¹¸å­˜åŒºï¼Œå…¶ä¸­è¾ƒè€å¯¹è±¡æ™‹å‡è‡³<strong>è€å¹´ä»£</strong></p><img src="/img/46450/G1-6.png" alt="G1-6" style="zoom:67%;" /><p>7.é‡Šæ”¾ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºçš„å†…å­˜</p><img src="/img/46450/G1-7.png" alt="G1-7" style="zoom:67%;" /><h4 id="å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†"><a href="#å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†" class="headerlink" title="å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†"></a>å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†</h4><p>1.å½“è€å¹´ä»£å ç”¨å†…å­˜è¶…è¿‡é˜ˆå€¼åï¼Œè§¦å‘å¹¶å‘æ ‡è®°ï¼Œè¿™æ—¶<strong>æ— éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</strong></p><img src="/img/46450/G1-8.png" alt="G1-8" style="zoom:67%;" /><p>2.å¹¶å‘æ ‡è®°ä¹‹åï¼Œä¼šæœ‰é‡æ–°æ ‡è®°é˜¶æ®µè§£å†³æ¼æ ‡é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦<strong>æš‚åœç”¨æˆ·çº¿ç¨‹</strong>ã€‚è¿™äº›éƒ½å®Œæˆåå°±çŸ¥é“è€å¹´ä»£æœ‰å“ªäº›å­˜æ´»å¯¹è±¡ï¼Œéšåè¿›å…¥æ··åˆæ”¶é›†é˜¶æ®µã€‚æ­¤æ—¶ä¸ä¼šå¯¹æ‰€æœ‰è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè€Œæ˜¯æ ¹æ®<strong>æš‚åœæ—¶é—´ç›®æ ‡ä¼˜å…ˆå›æ”¶ä»·å€¼é«˜</strong>ï¼ˆå­˜æ´»å¯¹è±¡å°‘ï¼‰çš„åŒºåŸŸï¼ˆè¿™ä¹Ÿæ˜¯ Gabage First åç§°çš„ç”±æ¥ï¼‰ã€‚</p><img src="/img/46450/G1-9.png" alt="G1-9" style="zoom:67%;" /><p>3.æ··åˆæ”¶é›†é˜¶æ®µä¸­ï¼Œå‚ä¸å¤åˆ¶çš„æœ‰ edenã€survivorã€oldï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶</p><img src="/img/46450/G1-10.png" alt="G1-10" style="zoom:67%;" /><p>4.è€å¹´ä»£å’Œå¹¸å­˜åŒºæ™‹å‡çš„å­˜æ´»å¯¹è±¡çš„å¤åˆ¶</p><img src="/img/46450/G1-11.png" alt="G1-11" style="zoom:67%;" /><p>5.å¤åˆ¶å®Œæˆï¼Œå†…å­˜å¾—åˆ°é‡Šæ”¾ã€‚è¿›å…¥ä¸‹ä¸€è½®çš„æ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</p><img src="/img/46450/G1-12.png" alt="G1-12" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCå›æ”¶ç®—æ³•</title>
      <link href="/posts/64310/"/>
      <url>/posts/64310/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ ‡è®°æ¸…é™¤æ³•"><a href="#ğŸæ ‡è®°æ¸…é™¤æ³•" class="headerlink" title="ğŸæ ‡è®°æ¸…é™¤æ³•"></a>ğŸæ ‡è®°æ¸…é™¤æ³•</h2><h4 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>æ‰¾åˆ° GC Root å¯¹è±¡ï¼Œå³é‚£äº›<strong>ä¸€å®šä¸ä¼šè¢«å›æ”¶çš„å¯¹è±¡</strong>ï¼Œå¦‚æ­£æ‰§è¡Œæ–¹æ³•å†…å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡ã€é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ ‡è®°é˜¶æ®µï¼šæ²¿ç€ GC Root å¯¹è±¡çš„å¼•ç”¨é“¾æ‰¾ï¼Œç›´æ¥æˆ–é—´æ¥å¼•ç”¨åˆ°çš„å¯¹è±¡åŠ ä¸Šæ ‡è®°</li><li>æ¸…é™¤é˜¶æ®µï¼šé‡Šæ”¾<strong>æœªåŠ æ ‡è®°</strong>çš„å¯¹è±¡å ç”¨çš„å†…å­˜</li></ol><img src="/img/64310/GC1.png" alt="GC1" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³»</li><li>æ¸…é™¤é€Ÿåº¦ä¸å†…å­˜å¤§å°æˆçº¿æ€§å…³ç³»</li><li>ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿ<strong>å†…å­˜ç¢ç‰‡</strong></li></ul><h2 id="ğŸæ ‡è®°æ•´ç†æ³•"><a href="#ğŸæ ‡è®°æ•´ç†æ³•" class="headerlink" title="ğŸæ ‡è®°æ•´ç†æ³•"></a>ğŸæ ‡è®°æ•´ç†æ³•</h2><h4 id="æ­¥éª¤ï¼š-1"><a href="#æ­¥éª¤ï¼š-1" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>å‰é¢çš„æ ‡è®°é˜¶æ®µã€æ¸…ç†é˜¶æ®µä¸æ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼</li><li>å¤šäº†ä¸€æ­¥<strong>æ•´ç†</strong>çš„åŠ¨ä½œï¼Œå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œå¯ä»¥<strong>é¿å…å†…å­˜ç¢ç‰‡</strong>äº§ç”Ÿ</li></ol><img src="/img/64310/GC2.png" alt="GC2" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³» </li><li>æ¸…é™¤ä¸æ•´ç†é€Ÿåº¦ä¸å†…å­˜å¤§å°æˆçº¿æ€§å…³ç³» </li><li>ç¼ºç‚¹æ˜¯æ€§èƒ½ä¸Š<strong>è¾ƒæ…¢</strong></li></ul><h2 id="ğŸæ ‡è®°å¤åˆ¶æ³•"><a href="#ğŸæ ‡è®°å¤åˆ¶æ³•" class="headerlink" title="ğŸæ ‡è®°å¤åˆ¶æ³•"></a>ğŸæ ‡è®°å¤åˆ¶æ³•</h2><h4 id="æ­¥éª¤ï¼š-2"><a href="#æ­¥éª¤ï¼š-2" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>å°†æ•´ä¸ªå†…å­˜åˆ†æˆä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼Œfrom å’Œ toï¼Œå…¶ä¸­ <strong>to æ€»æ˜¯å¤„äºç©ºé—²</strong>ï¼Œ<strong>from å­˜å‚¨æ–°åˆ›å»ºçš„å¯¹è±¡</strong></li><li>æ ‡è®°é˜¶æ®µä¸å‰é¢çš„ç®—æ³•ç±»ä¼¼</li><li>åœ¨æ‰¾å‡ºå­˜æ´»å¯¹è±¡åï¼Œä¼šå°†å®ƒä»¬ä» from å¤åˆ¶åˆ° to åŒºåŸŸï¼Œå¤åˆ¶çš„è¿‡ç¨‹ä¸­è‡ªç„¶å®Œæˆäº†ç¢ç‰‡æ•´ç†</li><li>å¤åˆ¶å®Œæˆåï¼Œ<strong>äº¤æ¢</strong> from å’Œ to çš„ä½ç½®å³å¯</li></ol><img src="/img/64310/GC3.png" alt="GC3" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°ä¸å¤åˆ¶é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³»</li><li>ç¼ºç‚¹æ˜¯ä¼šå ç”¨æˆå€çš„ç©ºé—´</li></ul><h2 id="ğŸåˆ†ä»£å›æ”¶æ€æƒ³"><a href="#ğŸåˆ†ä»£å›æ”¶æ€æƒ³" class="headerlink" title="ğŸåˆ†ä»£å›æ”¶æ€æƒ³"></a>ğŸåˆ†ä»£å›æ”¶æ€æƒ³</h2><blockquote><p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•</p><ul><li>æ–°ç”Ÿä»£ä½¿ç”¨: æ ‡è®°å¤åˆ¶æ³•</li><li>è€å¹´ä»£ä½¿ç”¨: æ ‡è®°æ¸…é™¤æ³• æˆ–è€… æ ‡è®°æ•´ç†æ³•</li></ul></blockquote><p>1.ä¼Šç”¸å›­edenï¼Œæœ€åˆå¯¹è±¡éƒ½åˆ†é…åˆ°è¿™é‡Œï¼Œä¸å¹¸å­˜åŒº survivorï¼ˆåˆ†æˆ from å’Œ toï¼‰åˆç§°æ–°ç”Ÿä»£</p><img src="/img/64310/åˆ†ä»£1.png" alt="åˆ†ä»£1" style="zoom:80%;" /><p>2.å½“ä¼Šç”¸å›­å†…å­˜ä¸è¶³ï¼Œæ ‡è®°ä¼Šç”¸å›­ä¸ fromï¼ˆç°é˜¶æ®µæ²¡æœ‰ï¼‰çš„å­˜æ´»å¯¹è±¡ï¼ˆè¿™é‡Œä¸º6ï¼‰</p><img src="/img/64310/åˆ†ä»£2.png" alt="åˆ†ä»£2" style="zoom:80%;" /><p>3.å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ° to ä¸­ï¼Œå¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ from å†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</p><img src="/img/64310/åˆ†ä»£3.png" alt="åˆ†ä»£3" style="zoom:80%;" /><p>4.å°† from å’Œ to äº¤æ¢ä½ç½®</p><img src="/img/64310/åˆ†ä»£4.png" alt="åˆ†ä»£4" style="zoom:80%;" /><p>5.ç»è¿‡ä¸€æ®µæ—¶é—´åä¼Šç”¸å›­çš„å†…å­˜åˆå‡ºç°ä¸è¶³</p><img src="/img/64310/åˆ†ä»£5.png" alt="åˆ†ä»£5" style="zoom:80%;" /><p>6.æ ‡è®°ä¼Šç”¸å›­ä¸ fromä¸­çš„å­˜æ´»å¯¹è±¡</p><img src="/img/64310/åˆ†ä»£6.png" alt="åˆ†ä»£6" style="zoom:80%;" /><p>7.å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ° to ä¸­</p><img src="/img/64310/åˆ†ä»£7.png" alt="åˆ†ä»£7" style="zoom:80%;" /><p>8.å¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ from å†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</p><img src="/img/64310/åˆ†ä»£8.png" alt="åˆ†ä»£8" style="zoom:80%;" /><p>9.å°† from å’Œ to äº¤æ¢ä½ç½®ï¼ˆä¿è¯toåŒºä¸ºç©ºï¼‰</p><img src="/img/64310/åˆ†ä»£9.png" alt="åˆ†ä»£9" style="zoom:80%;" /><p>10.è€å¹´ä»£ oldï¼Œå½“å¹¸å­˜åŒºå¯¹è±¡ç†¬è¿‡å‡ æ¬¡å›æ”¶ï¼ˆæœ€å¤š<strong>15</strong>æ¬¡ï¼‰ï¼Œæ™‹å‡åˆ°è€å¹´ä»£ï¼ˆå¹¸å­˜åŒºå†…å­˜ä¸è¶³æˆ–å¤§å¯¹è±¡ä¼šå¯¼è‡´æå‰æ™‹å‡ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¼•ç”¨ç±»å‹</title>
      <link href="/posts/40363/"/>
      <url>/posts/40363/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå¼ºå¼•ç”¨"><a href="#ğŸå¼ºå¼•ç”¨" class="headerlink" title="ğŸå¼ºå¼•ç”¨"></a>ğŸå¼ºå¼•ç”¨</h2><blockquote><p>æ™®é€šå˜é‡èµ‹å€¼å³ä¸ºå¼ºå¼•ç”¨ï¼Œå¦‚ A a &#x3D; new A();</p></blockquote><p>é€šè¿‡ GC Root çš„å¼•ç”¨é“¾ï¼Œå¦‚æœå¼ºå¼•ç”¨ä¸åˆ°è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«å›æ”¶</p><img src="/img/40363/GCå¼•ç”¨1.png" alt="GCå¼•ç”¨1" style="zoom: 80%;" /><p>ğŸˆ<strong>GC Root</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><h2 id="ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"><a href="#ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰" class="headerlink" title="ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"></a>ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</h2><blockquote><p>ä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ï¼ŒSoftReference a &#x3D; new SoftReference(new A());</p></blockquote><ul><li>å¦‚æœä»…æœ‰è½¯å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œ<strong>é¦–æ¬¡</strong>åƒåœ¾å›æ”¶ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>å†…å­˜ä»ä¸è¶³</strong>ï¼Œå†æ¬¡å›æ”¶æ—¶æ‰ä¼šé‡Šæ”¾å¯¹è±¡ </li><li>è½¯å¼•ç”¨è‡ªèº«éœ€è¦é…åˆ<strong>å¼•ç”¨é˜Ÿåˆ—</strong>æ¥é‡Šæ”¾ </li><li>å…¸å‹ä¾‹å­æ˜¯åå°„æ•°æ®</li></ul><img src="/img/40363/GCå¼•ç”¨2.png" alt="GCå¼•ç”¨2" style="zoom:80%;" /><h2 id="ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰"><a href="#ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰" class="headerlink" title="ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰"></a>ğŸå¼±å¼•ç”¨ï¼ˆ<strong>WeakReference</strong>ï¼‰</h2><blockquote><p>ä½¿ç”¨ WeakReference ç±»æ¥å®ç°å¼±å¼•ç”¨ï¼ŒWeakReference a &#x3D; new WeakReference(new A());</p></blockquote><ul><li>å¦‚æœä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œ<strong>åªè¦å‘ç”Ÿ</strong>åƒåœ¾å›æ”¶ï¼Œ<strong>å°±ä¼šé‡Šæ”¾</strong>è¯¥å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰</li><li>å¼±å¼•ç”¨è‡ªèº«éœ€è¦é…åˆ<strong>å¼•ç”¨é˜Ÿåˆ—</strong>æ¥é‡Šæ”¾</li><li>å…¸å‹ä¾‹å­æ˜¯ ThreadLocalMap ä¸­çš„ <strong>Entry</strong> å¯¹è±¡</li></ul><img src="/img/40363/GCå¼•ç”¨3.png" alt="GCå¼•ç”¨3" style="zoom:80%;" /><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestWeakReference</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyWeakMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyWeakMap</span>();</span><br><span class="line">        map.put(<span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>), <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="number">1</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>), <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        map.put(<span class="number">3</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;d&quot;</span>), <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(map);<span class="comment">// è¾“å‡º:[a:1,b:2,c:3,d:4]</span></span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;d&quot;</span>));</span><br><span class="line">        System.out.println(map);<span class="comment">// è¾“å‡º:[null:1,null:2,null:3,null:4]</span></span><br><span class="line">        map.clean();</span><br><span class="line">        System.out.println(map); <span class="comment">// è¾“å‡º:[b:2]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿ ThreadLocalMap çš„å†…å­˜æ³„æ¼é—®é¢˜ä»¥åŠä¸€ç§è§£å†³æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyWeakMap</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;String&gt; &#123;</span><br><span class="line">            String value;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>(key, queue); <span class="comment">// keyä¸ºå¼±å¼•ç”¨</span></span><br><span class="line">                <span class="built_in">this</span>.value = value; <span class="comment">// valueä¸ºå¼ºå¼•ç”¨</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">            Object ref;</span><br><span class="line">            <span class="keyword">while</span> ((ref = queue.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(ref);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; table.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(table[i] == ref) &#123;</span><br><span class="line">                        table[i] = <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Entry[] table = <span class="keyword">new</span> <span class="title class_">Entry</span>[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> index, String key, String value)</span> &#123;</span><br><span class="line">            table[index] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Entry entry : table) &#123;</span><br><span class="line">                <span class="keyword">if</span> (entry != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> entry.get();</span><br><span class="line">                    <span class="keyword">if</span> (k != <span class="literal">null</span> &amp;&amp; k.equals(key)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> entry.value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            sb.append(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Entry entry : table) &#123;</span><br><span class="line">                <span class="keyword">if</span> (entry != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> entry.get();</span><br><span class="line">                    sb.append(k).append(<span class="string">&quot;:&quot;</span>).append(entry.value).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sb.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"><a href="#ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰" class="headerlink" title="ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"></a>ğŸè™šå¼•ç”¨ï¼ˆ<strong>PhantomReference</strong>ï¼‰</h2><blockquote><p>ä½¿ç”¨PhantomReferenceç±»å®ç°è™šå¼•ç”¨ï¼ŒPhantomReference a &#x3D; new PhantomReference(new A(), referenceQueue);</p></blockquote><ul><li>å¿…é¡»<strong>é…åˆå¼•ç”¨é˜Ÿåˆ—</strong>ä¸€èµ·ä½¿ç”¨ï¼Œå½“è™šå¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œç”± Reference Handler çº¿ç¨‹å°†è™šå¼•ç”¨å¯¹è±¡å…¥é˜Ÿï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“å“ªäº›å¯¹è±¡è¢«å›æ”¶ï¼Œä»è€Œå¯¹å®ƒä»¬å…³è”çš„èµ„æºåšè¿›ä¸€æ­¥å¤„ç†</li><li>æ— æ³•é€šè¿‡è™šå¼•ç”¨å–å¾—ä¸€ä¸ªå¯¹è±¡</li><li>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«<strong>å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</strong></li><li>å…¸å‹ä¾‹å­æ˜¯ Cleaner é‡Šæ”¾ DirectByteBuffer å…³è”çš„ç›´æ¥å†…å­˜</li></ul><img src="/img/40363/GCå¼•ç”¨4.png" alt="GCå¼•ç”¨4" style="zoom:80%;" /><hr><p> <strong>æ€»ç»“</strong>ï¼šå¼º-æ— æ³•æ”¶ï¼Œå¼±-ç¢°å°±æ”¶ï¼Œè½¯-äºŒæ¬¡æ”¶ï¼Œè™š-é€šçŸ¥æ”¶</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
            <tag> JavaåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCåˆ¤æ–­æ— ç”¨å¯¹è±¡</title>
      <link href="/posts/26437/"/>
      <url>/posts/26437/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ï¼Œç›®çš„åœ¨äºå®ç°æ— ç”¨å¯¹è±¡å†…å­˜è‡ªåŠ¨é‡Šæ”¾ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€åŠ å¿«åˆ†é…é€Ÿåº¦</p></blockquote><ul><li>å›æ”¶åŒºåŸŸæ˜¯<strong>å †å†…å­˜</strong>ï¼Œä¸åŒ…æ‹¬è™šæ‹Ÿæœºæ ˆ</li><li>åˆ¤æ–­æ— ç”¨å¯¹è±¡ï¼Œä½¿ç”¨<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼Œ<strong>ä¸‰è‰²æ ‡è®°æ³•</strong>æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå›æ”¶æœªæ ‡è®°å¯¹è±¡</li><li>GC å…·ä½“çš„å®ç°ç§°ä¸º<strong>åƒåœ¾å›æ”¶å™¨</strong></li><li>GC å¤§éƒ½é‡‡ç”¨äº†<strong>åˆ†ä»£å›æ”¶æ€æƒ³</strong></li></ul><h2 id="ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡"><a href="#ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡" class="headerlink" title="ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡"></a>ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡</h2><h3 id="1-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#1-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="1.å¯è¾¾æ€§åˆ†æç®—æ³•"></a>1.å¯è¾¾æ€§åˆ†æç®—æ³•</h3><blockquote><p>é€šè¿‡ <strong>GC Roots</strong> ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œèƒ½å¤Ÿåˆ°è¾¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶</p></blockquote><p>GC Roots ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><img src="/img/26437/GC1.png" alt="GC1"  /><h3 id="2-å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰"><a href="#2-å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰" class="headerlink" title="2.å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰"></a>2.å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰</h3><h4 id="åŸºç¡€æè¿°"><a href="#åŸºç¡€æè¿°" class="headerlink" title="åŸºç¡€æè¿°"></a>åŸºç¡€æè¿°</h4><p>ç”¨ä¸‰ç§é¢œè‰²è®°å½•å¯¹è±¡çš„æ ‡è®°çŠ¶æ€</p><ul><li>é»‘è‰² â€“ å·²æ ‡è®°</li><li>ç°è‰² â€“ æ ‡è®°ä¸­</li><li>ç™½è‰² â€“ è¿˜æœªæ ‡è®°</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>1.èµ·å§‹çš„ä¸‰ä¸ªå¯¹è±¡è¿˜æœªå¤„ç†å®Œæˆï¼Œç”¨ç°è‰²è¡¨ç¤º</p><img src="/img/26437/GC2.png" alt="GC2" style="zoom:67%;" /><p>2.è¯¥å¯¹è±¡çš„å¼•ç”¨å·²ç»å¤„ç†å®Œæˆï¼Œç”¨é»‘è‰²è¡¨ç¤ºï¼Œé»‘è‰²å¼•ç”¨çš„å¯¹è±¡å˜ä¸ºç°è‰²</p><img src="/img/26437/GC3.png" alt="GC3" style="zoom:67%;" /><p>3.æ²¿ç€å¼•ç”¨é“¾éƒ½æ ‡è®°ä¸€é</p><img src="/img/26437/GC4.png" alt="GC4" style="zoom:67%;" /><p>4.æœ€åæœªæ ‡è®°çš„ç™½è‰²å¯¹è±¡ï¼Œå³ä¸º<strong>åƒåœ¾</strong></p><img src="/img/26437/GC5.png" alt="GC5" style="zoom:67%;" /><h4 id="å¹¶å‘æ¼æ ‡é—®é¢˜"><a href="#å¹¶å‘æ¼æ ‡é—®é¢˜" class="headerlink" title="å¹¶å‘æ¼æ ‡é—®é¢˜"></a>å¹¶å‘æ¼æ ‡é—®é¢˜</h4><p>æ¯”è¾ƒå…ˆè¿›çš„åƒåœ¾å›æ”¶å™¨éƒ½æ”¯æŒ<strong>å¹¶å‘</strong>æ ‡è®°ï¼Œå³åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹ä»ç„¶èƒ½å·¥ä½œã€‚ä½†è¿™æ ·å¸¦æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹ä¿®æ”¹äº†å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å­˜åœ¨<strong>æ¼æ ‡é—®é¢˜</strong>ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>1.å¦‚å›¾æ‰€ç¤ºæ ‡è®°å·¥ä½œå°šæœªå®Œæˆ</p><img src="/img/26437/GC6.png" alt="GC6" style="zoom:67%;" /><p>2.ç”¨æˆ·çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œæ–­å¼€äº†ç¬¬ä¸€å±‚ 3ã€4 ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨ï¼Œè¿™æ—¶å¯¹äºæ­£åœ¨å¤„ç† 3 å·å¯¹è±¡çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ¥è®²ï¼Œå®ƒä¼šå°† 4 å·å¯¹è±¡å½“åšæ˜¯ç™½è‰²åƒåœ¾</p><img src="/img/26437/GC7.png" alt="GC7" style="zoom:67%;" /><p>3.ä½†å¦‚æœå…¶ä»–ç”¨æˆ·çº¿ç¨‹åˆå»ºç«‹äº† 2ã€4 ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å› ä¸º 2 å·å¯¹è±¡æ˜¯é»‘è‰²å·²å¤„ç†å¯¹è±¡äº†ï¼Œå› æ­¤åƒåœ¾å›æ”¶çº¿ç¨‹ä¸ä¼šå¯Ÿè§‰åˆ°è¿™ä¸ªå¼•ç”¨å…³ç³»çš„å˜åŒ–ï¼Œä»è€Œäº§ç”Ÿäº†æ¼æ ‡</p><img src="/img/26437/GC8.png" alt="GC8" style="zoom:67%;" /><p>4.å¦‚æœç”¨æˆ·çº¿ç¨‹è®©é»‘è‰²å¯¹è±¡å¼•ç”¨äº†ä¸€ä¸ªæ–°å¢å¯¹è±¡ï¼Œä¸€æ ·ä¼šå­˜åœ¨æ¼æ ‡é—®é¢˜</p><img src="/img/26437/GC9.png" alt="GC9" style="zoom:67%;" /><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>1.Incremental Updateï¼ˆå¢é‡æ›´æ–°æ³•ï¼ŒCMS åƒåœ¾å›æ”¶å™¨é‡‡ç”¨ï¼‰</p><p>â€‹æ€è·¯æ˜¯æ‹¦æˆªæ¯æ¬¡èµ‹å€¼åŠ¨ä½œï¼Œåªè¦èµ‹å€¼å‘ç”Ÿï¼Œè¢«èµ‹å€¼çš„å¯¹è±¡å°±ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œåœ¨é‡æ–°æ ‡è®°é˜¶æ®µå†ç¡®è®¤ä¸€é</p><p>2.Snapshot At The Beginningï¼ˆSATB åŸå§‹å¿«ç…§æ³•ï¼ŒG1 åƒåœ¾å›æ”¶å™¨é‡‡ç”¨ï¼‰</p><p>â€‹æ€è·¯ä¹Ÿæ˜¯æ‹¦æˆªæ¯æ¬¡èµ‹å€¼åŠ¨ä½œï¼Œä¸è¿‡è®°å½•çš„å¯¹è±¡ä¸åŒï¼Œä¹Ÿéœ€è¦åœ¨é‡æ–°æ ‡è®°é˜¶æ®µå¯¹è¿™äº›å¯¹è±¡äºŒæ¬¡å¤„ç†</p><p>â€‹æ–°åŠ å¯¹è±¡ä¼šè¢«è®°å½•ï¼Œè¢«åˆ é™¤å¼•ç”¨å…³ç³»çš„å¯¹è±¡ä¹Ÿè¢«è®°å½•</p><h3 id="3-æ–¹æ³•åŒºå›æ”¶"><a href="#3-æ–¹æ³•åŒºå›æ”¶" class="headerlink" title="3.æ–¹æ³•åŒºå›æ”¶"></a>3.æ–¹æ³•åŒºå›æ”¶</h3><blockquote><p>æ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œè€Œæ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡æ¯”æ–°ç”Ÿä»£ä½å¾ˆå¤šï¼Œå› æ­¤åœ¨æ–¹æ³•åŒºä¸Šè¿›è¡Œå›æ”¶æ€§ä»·æ¯”ä¸é«˜</p></blockquote><p>ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚</p><p>ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼ˆä¸ä¸€å®šå›æ”¶ï¼‰ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹</li><li>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶</li><li>è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•</li></ul><h3 id="4-finalize"><a href="#4-finalize" class="headerlink" title="4.finalize()"></a>4.finalize()</h3><blockquote><p>finalize() ç”¨æ¥åšå…³é—­å¤–éƒ¨èµ„æºç­‰å·¥ä½œã€‚è¯¥æ–¹æ³•è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤æœ€å¥½ä¸è¦ä½¿ç”¨ã€‚</p></blockquote><p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€šè¿‡åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šè°ƒç”¨ finalize() æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå†…å­˜ç»“æ„</title>
      <link href="/posts/27692/"/>
      <url>/posts/27692/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>JVM å†…å­˜å¸ƒå±€è§„å®šäº† Java åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº† JVM çš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚</p></blockquote><p>æ•´ä½“å¸ƒå±€å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/img/27692/JVM1.png" alt="JVM1" style="zoom:67%;" /><p>JVMå†…å­˜ç»“æ„ä¸­æœ‰5ä¸ªæ¯”è¾ƒé‡è¦çš„åŒºåŸŸï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †å’Œæ–¹æ³•åŒº</p><h2 id="ğŸç¨‹åºè®¡æ•°å™¨"><a href="#ğŸç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ğŸç¨‹åºè®¡æ•°å™¨"></a>ğŸç¨‹åºè®¡æ•°å™¨</h2><blockquote><p>ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆ<strong>Program Counter Register</strong>ï¼‰ï¼Œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚æ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ã€‚</p></blockquote><p>ç¨‹åºè®¡æ•°å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³<strong>å°†è¦æ‰§è¡Œ</strong>çš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><img src="/img/27692/JVM2.jpg" alt="JVM2" style="zoom:67%;" /><h2 id="ğŸè™šæ‹Ÿæœºæ ˆ"><a href="#ğŸè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="ğŸè™šæ‹Ÿæœºæ ˆ"></a>ğŸè™šæ‹Ÿæœºæ ˆ</h2><blockquote><p>ä¸»ç®¡ Java <strong>ç¨‹åº</strong>çš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„<strong>å±€éƒ¨å˜é‡</strong>ã€<strong>éƒ¨åˆ†ç»“æœ</strong>ï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›</p></blockquote><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h3><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a><strong>ç‰¹ç‚¹ï¼š</strong></h4><ul><li>JVM ç›´æ¥å¯¹è™šæ‹Ÿæœºæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€<strong>å…¥æ ˆ</strong>ï¼ˆè¿›æ ˆ&#x2F;å‹æ ˆï¼‰ï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸ<strong>å‡ºæ ˆ</strong></li><li><strong>æ ˆä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</strong></li></ul><h4 id="å¼‚å¸¸ï¼š"><a href="#å¼‚å¸¸ï¼š" class="headerlink" title="å¼‚å¸¸ï¼š"></a><strong>å¼‚å¸¸ï¼š</strong></h4><p><strong>Javaè™šæ‹Ÿæœºæ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„</strong></p><p>é‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Java è™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <strong>StackOverflowError</strong> å¼‚å¸¸</p><p>é‡‡ç”¨åŠ¨æ€æ‰©å±•çš„Java è™šæ‹Ÿæœºæ ˆï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<strong>OutOfMemoryError</strong>å¼‚å¸¸</p><h4 id="è°ƒä¼˜ï¼š"><a href="#è°ƒä¼˜ï¼š" class="headerlink" title="è°ƒä¼˜ï¼š"></a>è°ƒä¼˜ï¼š</h4><p>é€šè¿‡å‚æ•°<code>-Xss</code>æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦</p><h3 id="2-æ ˆå¸§"><a href="#2-æ ˆå¸§" class="headerlink" title="2.æ ˆå¸§"></a>2.æ ˆå¸§</h3><blockquote><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong>çš„æ ¼å¼å­˜åœ¨</p></blockquote><ul><li>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªæœ‰å¯¹åº”çš„ä¸€ä¸ªæ ˆå¸§</li><li>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯</li></ul><h3 id="3-è¿è¡ŒåŸç†"><a href="#3-è¿è¡ŒåŸç†" class="headerlink" title="3.è¿è¡ŒåŸç†"></a>3.è¿è¡ŒåŸç†</h3><p>JVM ç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå¯¹æ ˆå¸§çš„<strong>å‹æ ˆ</strong>å’Œ<strong>å‡ºæ ˆ</strong>ï¼Œéµå¾ªâ€œå…ˆè¿›åå‡ºâ€åŸåˆ™</p><p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆ<strong>æ ˆé¡¶æ ˆå¸§</strong>ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸º<strong>å½“å‰æ ˆå¸§</strong>ï¼ˆCurrent Frameï¼‰ï¼Œä¸å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•å°±æ˜¯<strong>å½“å‰æ–¹æ³•</strong>ï¼ˆCurrent Methodï¼‰ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯<strong>å½“å‰ç±»</strong>ï¼ˆCurrent Classï¼‰</p><p>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œ</p><p>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„<strong>æ–°çš„æ ˆå¸§</strong>ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œç§°ä¸ºæ–°çš„å½“å‰æ ˆå¸§</p><p>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„<strong>æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨</strong>çš„ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§</p><p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§</p><p>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨ return æŒ‡ä»¤ï¼Œå¦ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ç®¡ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡º</p><img src="/img/27692/JVM3.jpg" alt="JVM3" style="zoom:67%;" /><h3 id="4-æ ˆå¸§å†…éƒ¨ç»“æ„"><a href="#4-æ ˆå¸§å†…éƒ¨ç»“æ„" class="headerlink" title="4.æ ˆå¸§å†…éƒ¨ç»“æ„"></a>4.æ ˆå¸§å†…éƒ¨ç»“æ„</h3><p><strong>æ ˆå¸§</strong>ï¼ˆStack Frameï¼‰ä¸­å­˜å‚¨ç€å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰ã€æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰(æˆ–è¡¨è¾¾å¼æ ˆ)ã€åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ã€æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ã€é™„åŠ ä¿¡æ¯ã€‚</p><img src="/img/27692/JVM4.jpg" alt="JVM4" style="zoom:67%;" /><h4 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h4><p>ä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</p><h4 id="æ“ä½œæ•°æ ˆ"><a href="#æ“ä½œæ•°æ ˆ" class="headerlink" title="æ“ä½œæ•°æ ˆ"></a>æ“ä½œæ•°æ ˆ</h4><p>ä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´</p><h4 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h4><p>æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨</p><h4 id="æ–¹æ³•è¿”å›åœ°å€"><a href="#æ–¹æ³•è¿”å›åœ°å€" class="headerlink" title="æ–¹æ³•è¿”å›åœ°å€"></a>æ–¹æ³•è¿”å›åœ°å€</h4><p>ç”¨æ¥å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„ PC å¯„å­˜å™¨çš„å€¼ã€‚</p><p>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li><li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li></ul><h2 id="ğŸæœ¬åœ°æ–¹æ³•æ ˆ"><a href="#ğŸæœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="ğŸæœ¬åœ°æ–¹æ³•æ ˆ"></a>ğŸæœ¬åœ°æ–¹æ³•æ ˆ</h2><h3 id="1-æœ¬åœ°æ–¹æ³•"><a href="#1-æœ¬åœ°æ–¹æ³•" class="headerlink" title="1.æœ¬åœ°æ–¹æ³•"></a>1.æœ¬åœ°æ–¹æ³•</h3><blockquote><p>ä¸€ä¸ª Native Method å°±æ˜¯ä¸€ä¸ª Java è°ƒç”¨é Java ä»£ç çš„æ¥å£</p></blockquote><p>æ¯”å¦‚Javaåº”ç”¨ä¸Javaç¯å¢ƒå¤–äº¤äº’ã€ä¸æ“ä½œç³»ç»Ÿäº¤äº’</p><h3 id="2-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#2-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="2.æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>2.æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h3><blockquote><p>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†<strong>æœ¬åœ°æ–¹æ³•</strong>çš„è°ƒç”¨ï¼Œä¹Ÿæ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„</p></blockquote><h2 id="ğŸå †"><a href="#ğŸå †" class="headerlink" title="ğŸå †"></a>ğŸå †</h2><blockquote><p><strong>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½</strong>ã€‚</p><p>æ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ã€æ”¾åœ¨å“ªã€‚</p></blockquote><h3 id="1-å†…å­˜åˆ’åˆ†"><a href="#1-å†…å­˜åˆ’åˆ†" class="headerlink" title="1.å†…å­˜åˆ’åˆ†"></a>1.å†…å­˜åˆ’åˆ†</h3><blockquote><p>Java å †æ˜¯ Java è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°æ®éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜</p></blockquote><h4 id="å¹´è½»ä»£-Young-Generation"><a href="#å¹´è½»ä»£-Young-Generation" class="headerlink" title="å¹´è½»ä»£ (Young Generation)"></a><strong>å¹´è½»ä»£ (Young Generation)</strong></h4><p>å¹´è½»ä»£æ˜¯æ‰€æœ‰æ–°å¯¹è±¡åˆ›å»ºçš„åœ°æ–¹ã€‚å½“å¡«å……å¹´è½»ä»£æ—¶ï¼Œæ‰§è¡Œåƒåœ¾æ”¶é›†ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç§°ä¸º <strong>Minor GC</strong>ã€‚å¹´è½»ä¸€ä»£è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†â€”â€”ä¼Šç”¸å›­ï¼ˆ<strong>Eden Memory</strong>ï¼‰å’Œä¸¤ä¸ªå¹¸å­˜åŒºï¼ˆ<strong>Survivor Memory</strong>ï¼Œè¢«ç§°ä¸ºfrom&#x2F;toæˆ–s0&#x2F;s1ï¼‰ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯<code>8:1:1</code></p><ul><li>å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä½äº Eden å†…å­˜ç©ºé—´ä¸­</li><li>å½“ Eden ç©ºé—´è¢«å¯¹è±¡å¡«å……æ—¶ï¼Œæ‰§è¡Œ<strong>Minor GC</strong>ï¼Œå¹¶å°†æ‰€æœ‰å¹¸å­˜è€…å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ä¸­</li><li>Minor GC æ£€æŸ¥å¹¸å­˜è€…å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ã€‚æ‰€ä»¥æ¯æ¬¡ï¼Œ<strong>ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´æ€»æ˜¯ç©ºçš„</strong></li><li>ç»è¿‡å¤šæ¬¡ GC å¾ªç¯åå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®å¹´è½»ä¸€ä»£å¯¹è±¡çš„å¹´é¾„é˜ˆå€¼æ¥å®ç°çš„ï¼Œç„¶åä»–ä»¬æ‰æœ‰èµ„æ ¼æå‡åˆ°è€ä¸€ä»£</li></ul><h4 id="è€å¹´ä»£-Old-Generation"><a href="#è€å¹´ä»£-Old-Generation" class="headerlink" title="è€å¹´ä»£(Old Generation)"></a><strong>è€å¹´ä»£(Old Generation)</strong></h4><p>æ—§çš„ä¸€ä»£å†…å­˜åŒ…å«é‚£äº›ç»è¿‡è®¸å¤šè½®å°å‹ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚é€šå¸¸ï¼Œåƒåœ¾æ”¶é›†æ˜¯åœ¨è€å¹´ä»£å†…å­˜æ»¡æ—¶æ‰§è¡Œçš„ã€‚è€å¹´ä»£åƒåœ¾æ”¶é›†ç§°ä¸ºä¸»GCï¼ˆ<strong>Major GC</strong>ï¼‰ï¼Œé€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</p><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼ˆå¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ªSurvivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´</p><h3 id="2-å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"></a>2.å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨ JVM å†…å­˜æ¨¡å‹çš„å †ä¸­ï¼Œå †è¢«åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ </p><ul><li>æ–°ç”Ÿä»£åˆè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸º <strong>EdenåŒº</strong> å’Œ <strong>SurvivoråŒº</strong>ï¼ŒSurvivor åŒºç”± <strong>From Survivor</strong> å’Œ <strong>To Survivor</strong> ç»„æˆ</li></ul><p>å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯¹è±¡ä¼šè¢«ä¼˜å…ˆåˆ†é…åˆ°æ–°ç”Ÿä»£çš„ Eden åŒº </p><ul><li>æ­¤æ—¶ JVM ä¼šç»™å¯¹è±¡å®šä¹‰ä¸€ä¸ª<strong>å¯¹è±¡å¹´è½»è®¡æ•°å™¨</strong>ï¼ˆ<code>-XX:MaxTenuringThreshold</code>ï¼‰</li></ul><p>å½“ Eden ç©ºé—´ä¸è¶³æ—¶ï¼ŒJVM å°†æ‰§è¡Œæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ </p><ul><li>JVM ä¼šæŠŠå­˜æ´»çš„å¯¹è±¡è½¬ç§»åˆ° Survivor ä¸­ï¼Œå¹¶ä¸”å¯¹è±¡å¹´é¾„ +1</li><li>å¯¹è±¡åœ¨ Survivor ä¸­åŒæ ·ä¹Ÿä¼šç»å† Minor GCï¼Œæ¯ç»å†ä¸€æ¬¡ Minor GCï¼Œå¯¹è±¡å¹´é¾„éƒ½ä¼š+1</li></ul><p>å¦‚æœåˆ†é…çš„å¯¹è±¡è¶…è¿‡äº†<code>-XX:PetenureSizeThreshold</code>ï¼Œå¯¹è±¡ä¼šç›´æ¥è¢«åˆ†é…åˆ°è€å¹´ä»£</p><h3 id="3-å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"><a href="#3-å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹" class="headerlink" title="3.å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"></a>3.å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹</h3><ol><li>new çš„å¯¹è±¡(å¹´è½»ä»£)å…ˆæ”¾åœ¨ä¼Šç”¸å›­åŒºï¼Œæ­¤åŒºæœ‰å¤§å°é™åˆ¶</li><li>å½“ä¼Šç”¸å›­çš„ç©ºé—´<strong>å¡«æ»¡</strong>æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVM çš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„<strong>ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡</strong>è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒº</li><li>ç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€… 0 åŒº</li><li>å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€… 0 åŒºï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€… 1 åŒº</li><li>å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€… 0 åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€… 1 åŒº</li><li>é»˜è®¤ <strong>15</strong> æ¬¡å›æ”¶æ ‡è®°æ‰ä¼šå»è€å¹´ä»£</li><li>å½“è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘ Major GCï¼Œè¿›è¡Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†</li><li>è‹¥è€å¹´ä»£æ‰§è¡Œäº† Major GC ä¹‹åå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM å¼‚å¸¸</li></ol><h2 id="ğŸæ–¹æ³•åŒº"><a href="#ğŸæ–¹æ³•åŒº" class="headerlink" title="ğŸæ–¹æ³•åŒº"></a>ğŸæ–¹æ³•åŒº</h2><blockquote><p>æ–¹æ³•åŒºç”¨äºå­˜å‚¨<strong>ç±»</strong>ä¿¡æ¯ã€<strong>å¸¸é‡æ± </strong>ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰</p></blockquote><h3 id="1-æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´"><a href="#1-æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´" class="headerlink" title="1.æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´"></a>1.æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´</h3><p><strong>æ°¸ä¹…ä»£</strong>ï¼ˆPermGenï¼‰æ˜¯ Hotspot è™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œ Java8 çš„æ—¶å€™åˆè¢«<strong>å…ƒç©ºé—´</strong>å–ä»£äº†ï¼Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´éƒ½å¯ä»¥ç†è§£ä¸ºæ–¹æ³•åŒºçš„<strong>è½åœ°å®ç°</strong></p><ul><li>æ°¸ä¹…ä»£æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å®ç°ï¼ˆ1.8 ä¹‹å‰ï¼‰</li><li>å…ƒç©ºé—´æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å¦ä¸€ç§å®ç°ï¼ˆ1.8 ä»¥åï¼‰ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ä½œä¸ºè¿™äº›ä¿¡æ¯çš„å­˜å‚¨ç©ºé—´</li></ul><h3 id="2-æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’"><a href="#2-æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’" class="headerlink" title="2.æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’"></a>2.æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’</h3><img src="/img/27692/JVM5.png" alt="JVM5" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springäº‹åŠ¡å¤±æ•ˆ</title>
      <link href="/posts/6750/"/>
      <url>/posts/6750/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°"><a href="#ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°" class="headerlink" title="ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°"></a>ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°</h2><p>åœ¨Springä¸­è¦å¼€å¯äº‹åŠ¡ç®¡ç†ï¼Œä¸€èˆ¬åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨<code>@EnableTransactionManagement</code>æ³¨è§£ï¼Œåœ¨éœ€è¦äº‹åŠ¡ç®¡ç†çš„æ–¹æ³•ä¸ŠåŠ <code>@Transactional</code>æ³¨è§£ï¼Œä½†æœ‰æ—¶æ³¨è§£ä¹Ÿä¼šå¤±æ•ˆã€‚ä»¥ä¸‹å°±æ˜¯å¸¸è§çš„Springäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯</p><p>å‰ç½®è¯´æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰ç½®é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;day04.tx.app.service&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;day04.tx.app.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;jdbc&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceInitializer <span class="title function_">dataSourceInitializer</span><span class="params">(DataSource dataSource, DatabasePopulator populator)</span> &#123;</span><br><span class="line">        <span class="type">DataSourceInitializer</span> <span class="variable">dataSourceInitializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceInitializer</span>();</span><br><span class="line">        dataSourceInitializer.setDataSource(dataSource);</span><br><span class="line">        dataSourceInitializer.setDatabasePopulator(populator);</span><br><span class="line">        <span class="keyword">return</span> dataSourceInitializer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DatabasePopulator <span class="title function_">databasePopulator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResourceDatabasePopulator</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;account.sql&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factoryBean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @Bean</span></span><br><span class="line">    <span class="comment">// //åªè¦ beanFactory çš„ allowBeanDefinitionOverriding==true, å³ä½¿ç³»ç»Ÿçš„ @Bean å®šä¹‰æ²¡æœ‰ @ConditionalOnMissingBean æ¡ä»¶ï¼Œä¹Ÿä¼šè¢«æˆ‘ä»¬çš„åŒå @Bean è¦†ç›–æ‰</span></span><br><span class="line">    <span class="comment">// public TransactionAttributeSource transactionAttributeSource() &#123;</span></span><br><span class="line">    <span class="comment">//     return new AnnotationTransactionAttributeSource(false);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(AppConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Service1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service1.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ1-æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸"><a href="#ğŸ1-æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸" class="headerlink" title="ğŸ1.æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸"></a>ğŸ1.æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span> <span class="comment">// è§£æ³•ï¼šåŠ å…¥rollbackForé…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>); <span class="comment">//è¯»å–æ–‡ä»¶å¼‚å¸¸</span></span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šSpring é»˜è®¤åªä¼š<strong>å›æ»šéæ£€æŸ¥å¼‚å¸¸</strong><br>è§£æ³•ï¼šé…ç½® rollbackFor å±æ€§<br>    @Transactional(rollbackFor &#x3D; Exception.class)</p><h2 id="ğŸ2-ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸"><a href="#ğŸ2-ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸" class="headerlink" title="ğŸ2.ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸"></a>ğŸ2.ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ–¹æ³•è‡ªå·±å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service2</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">            <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">                accountMapper.update(to, amount);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// throw new RuntimeException(e); // è§£æ³•ä¸€</span></span><br><span class="line">            <span class="comment">// TransactionInterceptor.currentTransactionStatus().setRollbackOnly(); //è§£æ³•äºŒ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šäº‹åŠ¡é€šçŸ¥åªæœ‰æ‰åˆ°äº†ç›®æ ‡æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ‰èƒ½è¿›è¡Œåç»­çš„å›æ»šå¤„ç†ï¼Œå¦‚æœç›®æ ‡<strong>è‡ªå·±å¤„ç†æ‰å¼‚å¸¸ï¼Œäº‹åŠ¡é€šçŸ¥æ— æ³•çŸ¥æ‚‰</strong><br>è§£æ³•1ï¼šå¼‚å¸¸åŸæ ·æŠ›å‡º<br>    åœ¨ catch å—æ·»åŠ  throw new RuntimeException(e);<br>è§£æ³•2ï¼šæ‰‹åŠ¨è®¾ç½® TransactionStatus.setRollbackOnly()<br>    åœ¨ catch å—æ·»åŠ  TransactionInterceptor.currentTransactionStatus().setRollbackOnly();</p><h2 id="ğŸ3-AOPåˆ‡é¢é¡ºåº"><a href="#ğŸ3-AOPåˆ‡é¢é¡ºåº" class="headerlink" title="ğŸ3.AOPåˆ‡é¢é¡ºåº"></a>ğŸ3.AOPåˆ‡é¢é¡ºåº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å‡½æ•°+åˆ‡é¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(MyAspect.class);</span><br><span class="line">        context.registerBean(AppConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Service3</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service3.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Aspect</span></span><br><span class="line">    <span class="meta">@Order(Ordered.LOWEST_PRECEDENCE - 1)</span> <span class="comment">// è§£æ³•ä¸‰ï¼šè°ƒæ•´åˆ‡é¢é¡ºåº</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">        <span class="meta">@Around(&quot;execution(* transfer(..))&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;log:&#123;&#125;&quot;</span>, pjp.getTarget());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service3</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§æœ€ä½ï¼Œä½†å¦‚æœè‡ªå®šä¹‰çš„åˆ‡é¢ä¼˜å…ˆçº§å’Œå…¶ä¸€æ ·ï¼Œåˆ™è¿˜æ˜¯è‡ªå®šä¹‰åˆ‡é¢åœ¨å†…å±‚ï¼Œè¿™æ—¶è‹¥è‡ªå®šä¹‰åˆ‡é¢æ²¡æœ‰æ­£ç¡®æŠ›å‡ºå¼‚å¸¸ï¼ˆå¼‚å¸¸å‘ä¸ŠæŠ›å‡ºï¼Œäº‹åŠ¡éœ€è¦æ•è·ï¼‰<br>è§£æ³•1ã€2ï¼šåŒæƒ…å†µ2 ä¸­çš„è§£æ³•:1ã€2<br>è§£æ³•3ï¼š</p><p>â€‹è°ƒæ•´åˆ‡é¢é¡ºåºï¼Œåœ¨ MyAspect ä¸Šæ·»åŠ  @Order(Ordered.LOWEST_PRECEDENCE - 1) ï¼ˆä¸æ¨èï¼‰</p><h2 id="ğŸ4-é-public-æ–¹æ³•"><a href="#ğŸ4-é-public-æ–¹æ³•" class="headerlink" title="ğŸ4.é public æ–¹æ³•"></a>ğŸ4.é public æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service4</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">// æ¼”ç¤ºï¼šè¿™é‡Œépublicæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šSpring ä¸ºæ–¹æ³•åˆ›å»ºä»£ç†ã€æ·»åŠ äº‹åŠ¡é€šçŸ¥ã€å‰ææ¡ä»¶éƒ½æ˜¯<strong>è¯¥æ–¹æ³•æ˜¯ public</strong> çš„<br>è§£æ³•1ï¼šæ”¹ä¸º public æ–¹æ³•<br>è§£æ³•2ï¼šæ·»åŠ  bean é…ç½®åˆ°é…ç½®ç±»å¦‚ä¸‹ï¼ˆä¸æ¨èï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TransactionAttributeSource <span class="title function_">transactionAttributeSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationTransactionAttributeSource</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ5-çˆ¶å­å®¹å™¨å¯¼è‡´"><a href="#ğŸ5-çˆ¶å­å®¹å™¨å¯¼è‡´" class="headerlink" title="ğŸ5.çˆ¶å­å®¹å™¨å¯¼è‡´"></a>ğŸ5.çˆ¶å­å®¹å™¨å¯¼è‡´</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Serviceç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service5</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Controllerç±»</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> Service5 service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        service.transfer(from, to, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°-çˆ¶å­å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(parent.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(parent.getDefaultListableBeanFactory());</span><br><span class="line">        parent.registerBean(AppConfig.class);</span><br><span class="line">        parent.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">child</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(child.getDefaultListableBeanFactory());</span><br><span class="line">        child.setParent(parent);</span><br><span class="line">        child.registerBean(WebConfig.class);</span><br><span class="line">        child.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">AccountController</span> <span class="variable">bean</span> <span class="operator">=</span> child.getBean(AccountController.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Webé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;day04.tx.app.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨é…ç½®äº†çˆ¶å­å®¹å™¨ï¼ŒWebConfig å¯¹åº”å­å®¹å™¨ï¼ŒAppConfig å¯¹åº”çˆ¶å®¹å™¨ï¼Œå‘ç°äº‹åŠ¡å¤±æ•ˆ</p><p>åŸå› ï¼šå­å®¹å™¨æ‰«æèŒƒå›´è¿‡å¤§ï¼ŒæŠŠæœªåŠ äº‹åŠ¡é…ç½®çš„ service æ‰«æè¿›æ¥<br>è§£æ³•1ï¼šå„æ‰«æå„çš„<br>è§£æ³•2ï¼šä¸è¦ç”¨çˆ¶å­å®¹å™¨ï¼Œæ‰€æœ‰ bean æ”¾åœ¨åŒä¸€å®¹å™¨ï¼ˆæ¯”è¾ƒä¼ ç»Ÿçš„åšæ³•ï¼‰</p><h2 id="ğŸ6-è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"><a href="#ğŸ6-è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ" class="headerlink" title="ğŸ6.è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"></a>ğŸ6.è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        bar(); <span class="comment">// è°ƒç”¨æœ¬ç±»æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼š<strong>æœ¬ç±»æ–¹æ³•è°ƒç”¨ä¸ç»è¿‡ä»£ç†</strong>ï¼Œå› æ­¤æ— æ³•å¢å¼º<br>è§£æ³•1ï¼šä¾èµ–æ³¨å…¥è‡ªå·±ï¼ˆä»£ç†ï¼‰æ¥è°ƒç”¨<br>è§£æ³•2ï¼šé€šè¿‡ AopContext æ‹¿åˆ°ä»£ç†å¯¹è±¡ï¼Œæ¥è°ƒç”¨<br>è§£æ³•3ï¼šé€šè¿‡ CTWï¼ŒLTW å®ç°åŠŸèƒ½å¢å¼º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Service6 proxy; <span class="comment">// è§£æ³•1ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¾ªç¯ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">System.out.println(proxy.getClass());</span><br><span class="line">proxy.bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦åœ¨ AppConfig ä¸Šæ·»åŠ  @EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        ((Service6) AopContext.currentProxy()).bar(); <span class="comment">// è§£æ³•2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ7-Transactional-æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º"><a href="#ğŸ7-Transactional-æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º" class="headerlink" title="ğŸ7.@Transactional æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º"></a>ğŸ7.@Transactional æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service7</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Service7.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        logger.debug(<span class="string">&quot;æ›´æ–°å‰æŸ¥è¯¢ä½™é¢ä¸º: &#123;&#125;&quot;</span>, fromBalance);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBalance</span><span class="params">(<span class="type">int</span> accountNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountMapper.findBalanceBy(accountNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç é—®é¢˜ï¼šå‡è®¾ from ä½™é¢ä¸º 1000ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ¥è½¬è´¦ 1000ï¼Œå¯èƒ½ä¼šå‡ºç°æ‰£å‡ä¸º<strong>è´Ÿæ•°</strong>çš„æƒ…å†µ</p><p>åŸå› ï¼šäº‹åŠ¡çš„åŸå­æ€§ä»…æ¶µç›– insertã€updateã€deleteã€select â€¦ for update è¯­å¥ï¼Œ<strong>select æ–¹æ³•</strong>å¹¶ä¸é˜»å¡</p><img src="/img/6750/transactional1.png" alt="transactional1" style="zoom:67%;" /><p>å¦‚ä¸Šï¼šçº¢è‰²çº¿ç¨‹å’Œè“è‰²çº¿ç¨‹çš„æŸ¥è¯¢éƒ½å‘ç”Ÿåœ¨æ‰£å‡ä¹‹å‰ï¼Œéƒ½ä»¥ä¸ºè‡ªå·±æœ‰è¶³å¤Ÿçš„ä½™é¢åšæ‰£å‡</p><p>ä¸€ç§è§£æ³•ï¼ˆæ— æ•ˆï¼‰ï¼šå°è¯•åŠ synchronizedé”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service7</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Service7.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        logger.debug(<span class="string">&quot;æ›´æ–°å‰æŸ¥è¯¢ä½™é¢ä¸º: &#123;&#125;&quot;</span>, fromBalance);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBalance</span><span class="params">(<span class="type">int</span> accountNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountMapper.findBalanceBy(accountNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— æ•ˆåŸå› ï¼šsynchronized ä¿è¯çš„ä»…æ˜¯<strong>ç›®æ ‡æ–¹æ³•çš„åŸå­æ€§</strong>ï¼Œç¯ç»•ç›®æ ‡æ–¹æ³•çš„è¿˜æœ‰ <strong>commit</strong> ç­‰æ“ä½œï¼Œå®ƒä»¬å¹¶æœªå¤„äº sync å—å†…</p><img src="/img/6750/transactional2.png" alt="transactional2" style="zoom:67%;" /><p>å¦‚ä¸Šå›¾ï¼šè“è‰²çº¿ç¨‹çš„æŸ¥è¯¢åªè¦åœ¨çº¢è‰²çº¿ç¨‹æäº¤ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆä¾ç„¶ä¼šæŸ¥è¯¢åˆ°æœ‰ 1000 è¶³å¤Ÿä½™é¢æ¥è½¬è´¦</p><hr><p>è§£æ³•1ï¼šsynchronized èŒƒå›´æ‰©å¤§è‡³ä»£ç†æ–¹æ³•è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">    AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">    ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">    context.registerBean(AppConfig.class);</span><br><span class="line">    context.refresh();</span><br><span class="line"></span><br><span class="line">    <span class="type">Service7</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service7.class);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyThread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123; <span class="comment">//synchronized èŒƒå›´æ‰©å¤§</span></span><br><span class="line">            bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>, <span class="string">&quot;boldMagenta&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyThread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>, <span class="string">&quot;boldBlue&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    latch.await();</span><br><span class="line">    System.out.println(bean.findBalance(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•2ï¼šä½¿ç”¨ select â€¦ for update æ›¿æ¢ selectï¼ˆæ•°æ®åº“å±‚é¢ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select balance from account where accountNo=#&#123;accountNo&#125; for update&quot;)</span> <span class="comment">// æ›¿æ¢</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">findBalanceBy</span><span class="params">(<span class="type">int</span> accountNo)</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springè®¾è®¡æ¨¡å¼</title>
      <link href="/posts/52990/"/>
      <url>/posts/52990/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSingleton"><a href="#ğŸSingleton" class="headerlink" title="ğŸSingleton"></a>ğŸSingleton</h2><blockquote><p><em>Ensure a class only has one instance, and provide a global point of access to it</em></p></blockquote><p>Spring ä¸­çš„ singleton bean å¹¶éå®ç°äº†å•ä¾‹æ¨¡å¼ï¼Œsingleton bean åªèƒ½ä¿è¯<strong>æ¯ä¸ªå®¹å™¨å†…ï¼Œç›¸åŒ id çš„ bean å•å®ä¾‹</strong></p><p>Springä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.transaction.TransactionDefinition#withDefaults</li><li>org.springframework.aop.TruePointcut#INSTANCE</li><li>org.springframework.aop.interceptor.ExposeInvocationInterceptor#ADVISOR</li><li>org.springframework.core.annotation.AnnotationAwareOrderComparator#INSTANCE</li><li>org.springframework.core.OrderComparator#INSTANCE</li></ul><h2 id="ğŸBuilder"><a href="#ğŸBuilder" class="headerlink" title="ğŸBuilder"></a>ğŸBuilder</h2><blockquote><p><em>Separate the construction of a complex object from its representation so that the same construction process can create different representations</em></p></blockquote><p>ä¸»è¦äº®ç‚¹æœ‰ä¸‰å¤„ï¼š</p><ul><li>è¾ƒä¸ºçµæ´»çš„æ„å»ºäº§å“å¯¹è±¡ </li><li>åœ¨ä¸æ‰§è¡Œæœ€å build æ–¹æ³•å‰ï¼Œäº§å“å¯¹è±¡éƒ½ä¸å¯ç”¨ </li><li>æ„å»ºè¿‡ç¨‹é‡‡ç”¨é“¾å¼è°ƒç”¨</li></ul><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.beans.factory.support.BeanDefinitionBuilder </li><li>org.springframework.web.util.UriComponentsBuilder </li><li>org.springframework.http.ResponseEntity.HeadersBuilder </li><li>org.springframework.http.ResponseEntity.BodyBuilder</li></ul><h2 id="ğŸFactory-Method"><a href="#ğŸFactory-Method" class="headerlink" title="ğŸFactory Method"></a>ğŸFactory Method</h2><blockquote><p><em>Define an interface for creating an object, but let subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>Spring ä¸­çš„ ApplicationContext ä¸ BeanFactory ä¸­çš„ getBean éƒ½å¯ä»¥è§†ä¸ºå·¥å‚æ–¹æ³•ï¼ˆéšè—äº† bean ï¼ˆäº§å“ï¼‰çš„åˆ›å»ºè¿‡ç¨‹å’Œå…·ä½“å®ç°ï¼‰</li><li>org.springframework.beans.factory.FactoryBean </li><li>@Bean æ ‡æ³¨çš„é™æ€æ–¹æ³•åŠå®ä¾‹æ–¹æ³•  </li><li>ObjectFactory åŠ ObjectProviderï¼Œæ¨è¿Ÿ bean åˆ›å»ºï¼Œè§£å†³å¾ªç¯ä¾èµ–åŠå•ä¾‹æ³¨å…¥å¤šä¾‹ç­‰é—®é¢˜</li></ul><h2 id="ğŸAdapter"><a href="#ğŸAdapter" class="headerlink" title="ğŸAdapter"></a>ğŸAdapter</h2><blockquote><p><em>Convert the interface of a class into another interface clients expect. Adapter lets classes work together that couldnâ€™t otherwise because of incompatible interfaces</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li><p>org.springframework.web.servlet.HandlerAdapter â€“ å› ä¸ºæ§åˆ¶å™¨å®ç°æœ‰å„ç§å„æ ·ï¼Œæ¯”å¦‚æœ‰</p></li><li><ul><li><p><strong>@RequestMapping</strong> æ ‡æ³¨çš„æ§åˆ¶å™¨å®ç°</p></li><li><p>ä¼ ç»Ÿçš„åŸºäº Controller æ¥å£ï¼ˆé @Controlleræ³¨è§£ï¼‰çš„å®ç°</p></li><li><p>è¾ƒæ–°çš„åŸºäº RouterFunction æ¥å£çš„å®ç°</p><p>å®ƒä»¬çš„å¤„ç†æ–¹æ³•éƒ½ä¸ä¸€æ ·ï¼Œä¸ºäº†ç»Ÿä¸€è°ƒç”¨ï¼Œå¿…é¡»é€‚é…ä¸º HandlerAdapter æ¥å£</p></li></ul></li><li><p>org.springframework.beans.factory.support.DisposableBeanAdapter â€“ å› ä¸ºé”€æ¯æ–¹æ³•å¤šç§å¤šæ ·ï¼Œå› æ­¤éƒ½è¦é€‚é…ä¸º DisposableBean æ¥ç»Ÿä¸€è°ƒç”¨é”€æ¯æ–¹æ³•</p></li></ul><h2 id="ğŸComposite"><a href="#ğŸComposite" class="headerlink" title="ğŸComposite"></a>ğŸComposite</h2><blockquote><p><em>Compose objects into tree structures to represent part-whole hierarchies. Composite lets clients treat individual objects and compositions of objects uniformly</em></p></blockquote><p>composite å¯¹è±¡çš„ä½œç”¨æ˜¯ï¼Œå°†<strong>åˆ†æ•£çš„è°ƒç”¨é›†ä¸­èµ·æ¥ï¼Œç»Ÿä¸€è°ƒç”¨å…¥å£</strong>ï¼Œå®ƒçš„ç‰¹å¾æ˜¯ï¼Œä¸å…·ä½“å¹²æ´»çš„å®ç°å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œå½“è°ƒç”¨ composite å¯¹è±¡çš„æ¥å£æ–¹æ³•æ—¶ï¼Œå…¶å®æ˜¯<strong>å§”æ‰˜å…·ä½“å¹²æ´»çš„å®ç°</strong>æ¥å®Œæˆ</p><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.web.method.support.HandlerMethodArgumentResolverComposite</li><li>org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite</li><li>org.springframework.web.servlet.handler.HandlerExceptionResolverComposite</li><li>org.springframework.web.servlet.view.ViewResolverComposite</li></ul><h2 id="ğŸDecorator"><a href="#ğŸDecorator" class="headerlink" title="ğŸDecorator"></a>ğŸDecorator</h2><blockquote><p><em>Attach additional responsibilities to an object dynamically. Decorators provide a flexible alternative to subclassing for extending functionality</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š<br>    org.springframework.web.util.ContentCachingRequestWrapper</p><h2 id="ğŸProxy"><a href="#ğŸProxy" class="headerlink" title="ğŸProxy"></a>ğŸProxy</h2><blockquote><p><em>Provide a surrogate or placeholder for another object to control access to it</em></p></blockquote><p>è£…é¥°å™¨æ¨¡å¼æ³¨é‡çš„æ˜¯<strong>åŠŸèƒ½å¢å¼º</strong>ï¼Œé¿å…å­ç±»ç»§æ‰¿æ–¹å¼è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œè€Œä»£ç†æ¨¡å¼<strong>æ›´æ³¨é‡æ§åˆ¶ç›®æ ‡çš„è®¿é—®ï¼ˆç¯ç»•é€šçŸ¥ç­‰ï¼‰</strong></p><p>Spring ä¸­çš„ä½“ç°ï¼ˆAOPï¼‰ï¼š</p><ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li><li>org.springframework.aop.framework.ObjenesisCglibAopProxy</li></ul><h2 id="ğŸChain-of-Responsibility"><a href="#ğŸChain-of-Responsibility" class="headerlink" title="ğŸChain of Responsibility"></a>ğŸChain of Responsibility</h2><blockquote><p><em>Avoid coupling the sender of a request to its receiver by giving more than one object a chance to handle the request. Chain the receiving objects and pass the request along the chain until an object handles it</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼š<br>    org.springframework.web.servlet.<strong>HandlerInterceptor</strong></p><h2 id="ğŸObserver"><a href="#ğŸObserver" class="headerlink" title="ğŸObserver"></a>ğŸObserver</h2><blockquote><p><em>Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.context.<strong>ApplicationListener</strong></li><li>org.springframework.context.event.ApplicationEventMulticaster</li><li>org.springframework.context.ApplicationEvent</li></ul><h2 id="ğŸStrategy"><a href="#ğŸStrategy" class="headerlink" title="ğŸStrategy"></a>ğŸStrategy</h2><blockquote><p><em>Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.beans.factory.support.InstantiationStrategy</li><li>org.springframework.core.annotation.MergedAnnotations.SearchStrategy</li><li>org.springframework.boot.autoconfigure.condition.SearchStrategy</li></ul><h2 id="ğŸTemplate-Method"><a href="#ğŸTemplate-Method" class="headerlink" title="ğŸTemplate Method"></a>ğŸTemplate Method</h2><blockquote><p><em>Define the skeleton of an algorithm in an operation, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithmâ€™s structure</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>å¤§éƒ¨åˆ†ä»¥ Template å‘½åçš„ç±»ï¼Œå¦‚ JdbcTemplateï¼ŒTransactionTemplate</li><li>å¾ˆå¤šä»¥ Abstract å‘½åçš„ç±»ï¼Œå¦‚ AbstractApplicationContext</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ³¨è§£</title>
      <link href="/posts/5399/"/>
      <url>/posts/5399/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSpringå¸¸è§æ³¨è§£"><a href="#ğŸSpringå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringå¸¸è§æ³¨è§£"></a>ğŸSpringå¸¸è§æ³¨è§£</h2><h3 id="ç»„ä»¶æ‰«æä¸é…ç½®ç±»"><a href="#ç»„ä»¶æ‰«æä¸é…ç½®ç±»" class="headerlink" title="ç»„ä»¶æ‰«æä¸é…ç½®ç±»"></a>ç»„ä»¶æ‰«æä¸é…ç½®ç±»</h3><p>@Component : æ ‡è¯†ç»„ä»¶,æ²¡æœ‰æ˜ç¡®çš„è§’è‰²</p><p>@Service : åœ¨ä¸šåŠ¡é€»è¾‘å±‚(serviceå±‚)ä½¿ç”¨</p><p>@Repository : åœ¨æ•°æ®è®¿é—®å±‚(daoå±‚)ä½¿ç”¨</p><p>@Controller : åœ¨æ§åˆ¶å±‚(controller)ä½¿ç”¨</p><hr><p>@ComponentScan : è‡ªåŠ¨æ‰«æåŒ…åä¸‹æ‰€æœ‰ä½¿ç”¨ @Component @Service  @Repository @Controller çš„ç±»,å¹¶æ³¨å†Œä¸ºBean</p><p>@Conditional : ç»„ä»¶æ‰«ææ—¶è¿›è¡Œ<strong>æ¡ä»¶è£…é…</strong></p><hr><p>@Configuration : å£°æ˜å½“å‰ç±»æ˜¯ä¸ª<strong>é…ç½®ç±»</strong>ï¼Œç›¸å½“äºä¸€ä¸ªSpringé…ç½®çš„xmlæ–‡ä»¶</p><ul><li>é…ç½®ç±»å…¶å®ç›¸å½“äºä¸€ä¸ªå·¥å‚, æ ‡æ³¨ @Bean æ³¨è§£çš„æ–¹æ³•ç›¸å½“äº<strong>å·¥å‚æ–¹æ³•</strong> </li><li>@Bean  ä¸æ”¯æŒ<strong>æ–¹æ³•é‡è½½</strong>, å¦‚æœæœ‰å¤šä¸ªé‡è½½æ–¹æ³•, ä»…æœ‰ä¸€ä¸ªèƒ½å…¥é€‰ä¸ºå·¥å‚æ–¹æ³• </li><li>@Configuration  é»˜è®¤ä¼šä¸ºæ ‡æ³¨çš„ç±»ç”Ÿæˆä»£ç†, å…¶ç›®çš„æ˜¯ä¿è¯ @Bean  æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶, ä»ç„¶èƒ½ä¿è¯å…¶å•ä¾‹ç‰¹æ€§ </li><li>@Configuration  ä¸­å¦‚æœå«æœ‰ BeanFactory åå¤„ç†å™¨, åˆ™å®ä¾‹å·¥å‚æ–¹æ³•ä¼šå¯¼è‡´ MyConfig æå‰åˆ›å»º, é€ æˆå…¶ä¾èµ–æ³¨å…¥å¤±è´¥ï¼Œè§£å†³æ–¹æ³•æ˜¯æ”¹ç”¨é™æ€å·¥å‚æ–¹æ³•æˆ–ç›´æ¥ä¸º @Bean  çš„æ–¹æ³•å‚æ•°ä¾èµ–æ³¨å…¥, é’ˆå¯¹ Mapper æ‰«æå¯ä»¥æ”¹ç”¨æ³¨è§£æ–¹å¼</li></ul><p>@Bean : æ³¨è§£åœ¨æ–¹æ³•ä¸Š,å£°æ˜å½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ªBean</p><p>@Import</p><p><strong>å››ç§ç”¨æ³•</strong></p><ul><li>å¼•å…¥å•ä¸ª bean</li><li>å¼•å…¥ä¸€ä¸ªé…ç½®ç±»</li><li>é€šè¿‡ Selector å¼•å…¥å¤šä¸ªç±»</li><li>é€šè¿‡ beanDefinition æ³¨å†Œå™¨</li></ul><p><strong>è§£æè§„åˆ™</strong> </p><ul><li>åŒä¸€é…ç½®ç±»ä¸­, @Import  å…ˆè§£æ  @Bean  åè§£æ<br>åŒåå®šä¹‰, é»˜è®¤åé¢è§£æçš„ä¼šè¦†ç›–å‰é¢è§£æçš„</li><li>ä¸å…è®¸è¦†ç›–çš„æƒ…å†µä¸‹, è®© MyConfig(ä¸»é…ç½®ç±») çš„é…ç½®ä¼˜å…ˆ:é‡‡ç”¨ DeferredImportSelectorï¼Œå› ä¸ºå®ƒæœ€åå·¥ä½œ, å¯ä»¥ç®€å•è®¤ä¸ºå…ˆè§£æ @Bean, å† @Import</li></ul><hr><p>@Lazy</p><ul><li>åŠ åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºæ­¤ç±»å»¶è¿Ÿå®ä¾‹åŒ–ã€åˆå§‹åŒ–</li><li>åŠ åœ¨æ–¹æ³•å‚æ•°ä¸Šï¼Œæ­¤å‚æ•°ä¼šä»¥ä»£ç†æ–¹å¼æ³¨å…¥</li></ul><p>@PropertySource : è¯»å–Propertiesæ–‡ä»¶ï¼Œå°†é”®å€¼ä¿¡æ¯åŠ å…¥åˆ°Environment</p><h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a><strong>ä¾èµ–æ³¨å…¥</strong></h3><p>@Autowired : åŠ åœ¨æˆå‘˜å˜é‡æˆ–æ–¹æ³•ä¸Šå®Œæˆä¾èµ–æ³¨å…¥</p><p>@Qualifier : å¤šä¸ªBeançš„ç±»å‹ç›¸åŒï¼Œæ ¹æ®<strong>åå­—</strong>è¿›ä¸€æ­¥åŒºåˆ†</p><p>@Value : å€¼æ³¨å…¥</p><h3 id="äº‹åŠ¡æ³¨è§£"><a href="#äº‹åŠ¡æ³¨è§£" class="headerlink" title="äº‹åŠ¡æ³¨è§£"></a><strong>äº‹åŠ¡æ³¨è§£</strong></h3><p>@EnableTransactionManagementï¼Œä¼šé¢å¤–åŠ è½½ 4 ä¸ª bean</p><ul><li>BeanFactoryTransactionAttributeSourceAdvisor äº‹åŠ¡åˆ‡é¢ç±»</li><li>TransactionAttributeSource ç”¨æ¥è§£æäº‹åŠ¡å±æ€§</li><li>TransactionInterceptor äº‹åŠ¡æ‹¦æˆªå™¨</li><li>TransactionalEventListenerFactory äº‹åŠ¡ç›‘å¬å™¨å·¥å‚</li></ul><p>@Transactional : æ–¹æ³•æˆ–ç±»ä¸Šå¼€å¯äº‹åŠ¡ç®¡ç†</p><h3 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a><strong>æ ¸å¿ƒ</strong></h3><p>@Order : æ§åˆ¶Beançš„æ‰§è¡Œé¡ºåº</p><h3 id="åˆ‡é¢"><a href="#åˆ‡é¢" class="headerlink" title="åˆ‡é¢"></a><strong>åˆ‡é¢</strong></h3><p>@EnableAspectJAutoProxy : å¼€å¯Spring å¯¹è¿™ä¸ªåˆ‡é¢(Aspect)çš„æ”¯æŒ</p><ul><li>ä¼šåŠ è½½ AnnotationAwareAspectJAutoProxyCreatorï¼Œå®ƒæ˜¯ä¸€ä¸ª bean åå¤„ç†å™¨ï¼Œç”¨æ¥åˆ›å»ºä»£ç†</li><li>å¦‚æœæ²¡æœ‰é…ç½® @EnableAspectJAutoProxyï¼Œåˆéœ€è¦ç”¨åˆ°ä»£ç†ï¼ˆå¦‚äº‹åŠ¡ï¼‰åˆ™ä¼šä½¿ç”¨ InfrastructureAdvisorAutoProxyCreator è¿™ä¸ª bean åå¤„ç†å™¨</li></ul><h2 id="ğŸSpringMVCå¸¸è§æ³¨è§£"><a href="#ğŸSpringMVCå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringMVCå¸¸è§æ³¨è§£"></a>ğŸSpringMVCå¸¸è§æ³¨è§£</h2><h3 id="mvc-mapping"><a href="#mvc-mapping" class="headerlink" title="mvc mapping"></a><strong>mvc mapping</strong></h3><p>@RequestMapping : <strong>åŒ¹é…è¯·æ±‚</strong>ï¼ŒåŠ è½½ç±»ä¸Šç»Ÿä¸€è¯·æ±‚çš„å‰ç¼€ï¼Œå¯ä»¥æ´¾ç”Ÿå¤šä¸ªæ³¨è§£å¦‚ @GetMapping ç­‰</p><h3 id="mvc-rest"><a href="#mvc-rest" class="headerlink" title="mvc rest"></a><strong>mvc rest</strong></h3><p>@RequestBody : å¤„ç†è¯·æ±‚ä½“ä¸­çš„<strong>JSONæ•°æ®</strong>ï¼Œå°†JSONæ•°æ®è½¬ä¸ºJavaå¯¹è±¡</p><p>@ResponseBody : ä¸RequestBodyç›¸åï¼ŒJavaå¯¹è±¡è½¬ä¸ºJSONæ•°æ®ï¼Œå¤„ç†å“åº”ä½“ï¼Œç»„åˆ @Controller &#x3D;&gt; @RestController</p><p>@ResponseStatus : æ§åˆ¶å“åº”çš„çŠ¶æ€ç </p><h3 id="mvc-ç»Ÿä¸€å¤„ç†"><a href="#mvc-ç»Ÿä¸€å¤„ç†" class="headerlink" title="mvc ç»Ÿä¸€å¤„ç†"></a><strong>mvc ç»Ÿä¸€å¤„ç†</strong></h3><p>@ControllerAdvice : ç»„åˆ @ResponseBody &#x3D;&gt; @RestControllerAdvice</p><p>@ExceptionHandler : å¤„ç†å¼‚å¸¸</p><h3 id="mvc-å‚æ•°"><a href="#mvc-å‚æ•°" class="headerlink" title="mvc å‚æ•°"></a><strong>mvc å‚æ•°</strong></h3><p>@PathVariable : è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å‚æ•°å€¼</p><h2 id="ğŸSpringBootå¸¸è§æ³¨è§£"><a href="#ğŸSpringBootå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringBootå¸¸è§æ³¨è§£"></a>ğŸSpringBootå¸¸è§æ³¨è§£</h2><h3 id="boot-auto"><a href="#boot-auto" class="headerlink" title="boot auto"></a>boot auto</h3><p>@SpringBootApplication : å¼€å¯<strong>è‡ªåŠ¨é…ç½®</strong>ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ³¨è§£+@ComponentScan</p><ul><li>@EnableAutoConfiguration</li><li>@SpringBootConfiguration</li></ul><h3 id="boot-condition"><a href="#boot-condition" class="headerlink" title="boot condition"></a>boot condition</h3><p>@ConditionalOnClass : classpath ä¸‹å­˜åœ¨æŸä¸ª class æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><p>@ConditionalOnMissingBean : beanFactory å†…ä¸å­˜åœ¨æŸä¸ª bean æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><p>@ConditionalOnProperty : é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŸä¸ª propertyï¼ˆé”®ã€å€¼ï¼‰æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><h3 id="boot-properties"><a href="#boot-properties" class="headerlink" title="boot properties"></a>boot properties</h3><p>@ConfigurationProperties : ä¼šå°†å½“å‰ bean çš„å±æ€§ä¸é…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼è¿›è¡Œç»‘å®š<br>@EnableConfigurationProperties : ä¼šæ·»åŠ ä¸¤ä¸ªè¾ƒä¸ºé‡è¦çš„ bean </p><ul><li>ConfigurationPropertiesBindingPostProcessorï¼Œbean åå¤„ç†å™¨ï¼Œåœ¨ bean åˆå§‹åŒ–å‰è°ƒç”¨ä¸‹é¢çš„ binder</li><li>ConfigurationPropertiesBinderï¼ŒçœŸæ­£æ‰§è¡Œç»‘å®šæ“ä½œ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootè‡ªåŠ¨é…ç½®</title>
      <link href="/posts/3992/"/>
      <url>/posts/3992/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>SpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œä»å¯åŠ¨ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£å¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoconfigurationApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(AutoconfigurationApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@SpringBootApplication</code> æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œä¸»è¦ç”±<code>@SpringBootConfiguration</code> ã€ <code>@ComponentScan</code>å’Œ<code>@EnableAutoConfiguration</code> ç»„æˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-SpringBootConfiguration"><a href="#ğŸ-SpringBootConfiguration" class="headerlink" title="ğŸ@SpringBootConfiguration"></a>ğŸ@SpringBootConfiguration</h2><blockquote><p>è¿™ä¸ªæ³¨è§£å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª@Configuration</p></blockquote><p><code>@SpringBootConfiguration</code> ä¸æ™®é€š <code>@Configuration</code>  ç›¸æ¯”ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å‰è€…è¦æ±‚æ•´ä¸ª app ä¸­<strong>åªå‡ºç°ä¸€æ¬¡</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// ä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Configuration.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-ComponentScan"><a href="#ğŸ-ComponentScan" class="headerlink" title="ğŸ@ComponentScan"></a>ğŸ@ComponentScan</h2><blockquote><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯æ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…</p></blockquote><p>æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®æ˜¯<strong>excludeFilters</strong>ï¼Œç”¨æ¥åœ¨ç»„ä»¶æ‰«ææ—¶è¿›è¡Œæ’é™¤ï¼Œä¹Ÿä¼šæ’é™¤è‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestExcludeFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(MyConfig.class);</span><br><span class="line">        context.registerBean(MyFilter.class); </span><br><span class="line">        context.refresh();</span><br><span class="line">        <span class="keyword">for</span> (String name : context.getBeanDefinitionNames()) &#123;</span><br><span class="line">            System.out.println(name); <span class="comment">//åªæœ‰bean2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@ComponentScan(basePackages = &#123;&quot;day04.boot.sub&quot;&#125;,</span></span><br><span class="line"><span class="meta">            excludeFilters = &#123; @ComponentScan.Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class)&#125;)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…åˆ @ComponentScan ä½¿ç”¨, å¯¹æ‰«æåˆ°çš„å…ƒæ•°æ®è¿›è¡Œè¿‡æ»¤, è¿”å› true è¡¨ç¤ºè¿‡æ»¤æ‰, false è¡¨ç¤ºä¿ç•™</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">extends</span> <span class="title class_">TypeExcludeFilter</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> metadataReader.getClassMetadata().getClassName();</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, className);</span><br><span class="line">            <span class="keyword">if</span> (className.equals(Bean1.class.getName())) &#123; <span class="comment">// Bean1è¿›è¡Œè¿‡æ»¤</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-EnableAutoConfiguration"><a href="#ğŸ-EnableAutoConfiguration" class="headerlink" title="ğŸ@EnableAutoConfiguration"></a>ğŸ@EnableAutoConfiguration</h2><blockquote><p>è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ³¨è§£</p></blockquote><p>ä¹Ÿä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ³¨è§£</p><p>@AutoConfigurationPackage â€“ ç”¨æ¥è®°ä½æ‰«æçš„èµ·å§‹åŒ…<br>@Import(AutoConfigurationImportSelector.class) ç”¨æ¥åŠ è½½ META-INF&#x2F;spring.factories ä¸­çš„è‡ªåŠ¨é…ç½®ç±»</p><p>æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line"><span class="comment">//        context.getEnvironment().getPropertySources().addLast(new ResourcePropertySource(&quot;application.properties&quot;));</span></span><br><span class="line">        context.registerBean(MyConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(AutoConfigurationPackages.get(context.getDefaultListableBeanFactory()));</span></span><br><span class="line"><span class="comment">// æ‰“å°å½“å‰åŒ…</span></span><br><span class="line">        <span class="keyword">for</span> (String name : context.getBeanDefinitionNames()) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class, EnableAutoConfiguration.class.getClassLoader()).stream()</span></span><br><span class="line"><span class="comment">//                .filter(name -&gt; !name.equals(OtherConfig.class.getName())).map(name -&gt; &quot;\&quot;&quot; + name + &quot;\&quot;&quot;).collect(Collectors.joining(&quot;,&quot;,&quot;&#123;&quot;,&quot;&#125;&quot;)));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//    @AutoConfigurationPackage  //ç”¨æ¥è®°ä½æ‰«æçš„èµ·å§‹åŒ…</span></span><br><span class="line">    <span class="meta">@EnableAutoConfiguration(excludeName = &#123;&quot;org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.aop.AopAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.neo4j.Neo4jAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.netty.NettyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.r2dbc.R2dbcTransactionManagerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.session.SessionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration&quot;, &quot;org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration&quot;, &quot;org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration&quot;&#125;)</span></span><br><span class="line"><span class="comment">//    @Import(OtherConfig.class) // ä¸ä½¿ç”¨ @Import  ç›´æ¥å¼•å…¥è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123; <span class="comment">// ä¸»é…ç½®</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean1 <span class="title function_">bean1</span><span class="params">()</span> &#123; <span class="comment">// åŠ è½½ä¸»é…ç½®ä¸­çš„bean1è€Œä¸åŠ è½½ä»å±é…ç½®ä¸­çš„</span></span><br><span class="line">            System.out.println(<span class="string">&quot;MyConfig bean1()&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OtherConfig</span> &#123; <span class="comment">// ä»å±é…ç½®(è‡ªåŠ¨é…ç½®ã€é»˜è®¤é…ç½®)</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">        <span class="keyword">public</span> Bean1 <span class="title function_">bean1</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;OtherConfig bean1()&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean2 <span class="title function_">bean2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean2</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨ @Import  ç›´æ¥å¼•å…¥è‡ªåŠ¨é…ç½®ç±»çš„åŸå› </p><ul><li>è¿™è®©ä¸»é…ç½®ç±»å’Œè‡ªåŠ¨é…ç½®ç±»å˜æˆäº†<strong>å¼ºè€¦åˆ</strong>ï¼Œä¸»é…ç½®ç±»ä¸åº”è¯¥çŸ¥é“æœ‰å“ªäº›ä»å±é…ç½®</li><li>ç›´æ¥ç”¨ @Import(è‡ªåŠ¨é…ç½®ç±».class)ï¼Œå¼•å…¥çš„é…ç½®è§£æä¼˜å…ˆçº§è¾ƒé«˜ï¼Œè‡ªåŠ¨é…ç½®ç±»çš„è§£æåº”è¯¥åœ¨ä¸»é…ç½®æ²¡æä¾›æ—¶ä½œä¸º<strong>é»˜è®¤é…ç½®</strong></li></ul><p>è€Œé‡‡ç”¨äº† @Import(AutoConfigurationImportSelector.class)</p><ul><li>ç”± AutoConfigurationImportSelector.class å»è¯»å– META-INF&#x2F;spring.factories ä¸­çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå®ç°äº†å¼±è€¦åˆ</li><li>å¦å¤– AutoConfigurationImportSelector.class å®ç°äº† DeferredImportSelector æ¥å£ï¼Œè®©è‡ªåŠ¨é…ç½®çš„è§£ææ™šäºä¸»é…ç½®çš„è§£æ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVCæ‰§è¡Œæµç¨‹</title>
      <link href="/posts/20834/"/>
      <url>/posts/20834/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>Spring MVCæ˜¯Springåœ¨Spring Container Coreå’ŒAOPç­‰æŠ€æœ¯åŸºç¡€ä¸Šï¼Œéµå¾ªWeb MVCçš„è§„èŒƒæ¨å‡ºçš„webå¼€å‘æ¡†æ¶ï¼Œä¸ºäº†ç®€åŒ–Javaæ ˆçš„webå¼€å‘</p></blockquote><p>SpringMVCçš„æ ¸å¿ƒæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="/img/20834/spring-mvc-1.png" alt="spring-mvc-1" style="zoom:67%;" /><ol><li><strong>ã€å‘é€è¯·æ±‚ã€‘è¯·æ±‚â€”â€”&gt;DispatcherServlet</strong>ï¼Œå‰ç«¯æ§åˆ¶å™¨æ”¶åˆ°è¯·æ±‚åè‡ªå·±ä¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯å§”æ‰˜ç»™å…¶ä»–çš„è§£æå™¨è¿›è¡Œå¤„ç†ï¼Œä½œä¸ºç»Ÿä¸€è®¿é—®ç‚¹ï¼Œè¿›è¡Œå…¨å±€çš„æµç¨‹æ§åˆ¶ï¼›</li><li><strong>ã€æ˜ å°„å¤„ç†å™¨ã€‘DispatcherServletâ€”â€”&gt;HandlerMapping</strong>ï¼Œ HandlerMapping å°†ä¼šæŠŠè¯·æ±‚æ˜ å°„ä¸º <strong>HandlerExecutionChain</strong> å¯¹è±¡ï¼ˆåŒ…å«ä¸€ä¸ªHandler å¤„ç†å™¨ï¼ˆé¡µé¢æ§åˆ¶å™¨ï¼‰å¯¹è±¡ã€å¤šä¸ªHandlerInterceptor æ‹¦æˆªå™¨ï¼‰å¯¹è±¡ï¼Œé€šè¿‡è¿™ç§<strong>ç­–ç•¥æ¨¡å¼</strong>ï¼Œå¾ˆå®¹æ˜“æ·»åŠ æ–°çš„æ˜ å°„ç­–ç•¥ï¼›</li><li><strong>ã€å¤„ç†å™¨é€‚é…ã€‘DispatcherServletâ€”â€”&gt;HandlerAdapter</strong>ï¼ŒHandlerAdapter å°†ä¼šæŠŠå¤„ç†å™¨åŒ…è£…ä¸ºé€‚é…å™¨ï¼Œä»è€Œæ”¯æŒå¤šç§ç±»å‹çš„å¤„ç†å™¨ï¼Œ å³é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„åº”ç”¨ï¼Œä»è€Œå¾ˆå®¹æ˜“æ”¯æŒå¾ˆå¤šç±»å‹çš„å¤„ç†å™¨ï¼›</li><li><strong>ã€è°ƒç”¨å¤„ç†å™¨ã€‘HandlerAdapterâ€”â€”&gt;å¤„ç†å™¨åŠŸèƒ½å¤„ç†æ–¹æ³•çš„è°ƒç”¨</strong>ï¼ŒHandlerAdapter å°†ä¼šæ ¹æ®é€‚é…çš„ç»“æœè°ƒç”¨çœŸæ­£çš„å¤„ç†å™¨çš„åŠŸèƒ½å¤„ç†æ–¹æ³•ï¼Œå®ŒæˆåŠŸèƒ½å¤„ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªModelAndView å¯¹è±¡ï¼ˆåŒ…å«æ¨¡å‹æ•°æ®ã€é€»è¾‘è§†å›¾åï¼‰ï¼›</li><li><strong>ã€è§†å›¾è§£æã€‘ModelAndView çš„é€»è¾‘è§†å›¾åâ€”â€”&gt; ViewResolver</strong>ï¼ŒViewResolver å°†æŠŠé€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“çš„Viewï¼Œé€šè¿‡è¿™ç§ç­–ç•¥æ¨¡å¼ï¼Œå¾ˆå®¹æ˜“æ›´æ¢å…¶ä»–è§†å›¾æŠ€æœ¯ï¼›</li><li><strong>ã€è§†å›¾æ¸²æŸ“ã€‘Viewâ€”â€”&gt;æ¸²æŸ“</strong>ï¼ŒViewä¼šæ ¹æ®ä¼ è¿›æ¥çš„Modelæ¨¡å‹æ•°æ®è¿›è¡Œæ¸²æŸ“ï¼Œæ­¤å¤„çš„Modelå®é™…æ˜¯ä¸€ä¸ªMapæ•°æ®ç»“æ„ï¼Œå› æ­¤å¾ˆå®¹æ˜“æ”¯æŒå…¶ä»–è§†å›¾æŠ€æœ¯ï¼›</li><li><strong>ã€è¿”å›å“åº”ã€‘è¿”å›æ§åˆ¶æƒç»™DispatcherServlet</strong>ï¼Œç”±DispatcherServlet è¿”å›å“åº”ç»™ç”¨æˆ·ï¼Œåˆ°æ­¤ä¸€ä¸ªæµç¨‹ç»“æŸã€‚</li></ol><p>å…¶å®æ•´ä¸ªçš„æ‰§è¡Œæµç¨‹ä¹Ÿå¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œ<strong>åˆå§‹åŒ–ã€åŒ¹é…å’Œè°ƒç”¨</strong>ä¸‰ä¸ªé˜¶æ®µï¼Œä¸‹é¢åˆ†åˆ«è¯´æ˜</p><h2 id="ğŸåˆå§‹åŒ–é˜¶æ®µ"><a href="#ğŸåˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="ğŸåˆå§‹åŒ–é˜¶æ®µ"></a>ğŸåˆå§‹åŒ–é˜¶æ®µ</h2><ol><li>åœ¨ Web å®¹å™¨ç¬¬ä¸€æ¬¡ç”¨åˆ° <strong>DispatcherServlet</strong> çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå…¶å¯¹è±¡å¹¶æ‰§è¡Œ init æ–¹æ³• </li><li><strong>init</strong> æ–¹æ³•å†…ä¼šåˆ›å»º Spring Web å®¹å™¨ï¼Œå¹¶è°ƒç”¨å®¹å™¨ <strong>refresh</strong> æ–¹æ³• </li><li>refresh è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºå¹¶åˆå§‹åŒ– SpringMVC ä¸­çš„é‡è¦ç»„ä»¶ï¼Œ ä¾‹å¦‚ MultipartResolverï¼ŒHandlerMappingï¼ŒHandlerAdapterï¼ŒHandlerExceptionResolverã€ViewResolver ç­‰ </li><li>å®¹å™¨åˆå§‹åŒ–åï¼Œä¼šå°†ä¸Šä¸€æ­¥åˆå§‹åŒ–å¥½çš„é‡è¦ç»„ä»¶ï¼Œèµ‹å€¼ç»™ DispatcherServlet çš„æˆå‘˜å˜é‡ï¼Œç•™å¾…åç”¨</li></ol><img src="/img/20834/spring-mvc-2.png" alt="spring-mvc-2" style="zoom:67%;" /><h2 id="ğŸåŒ¹é…é˜¶æ®µ"><a href="#ğŸåŒ¹é…é˜¶æ®µ" class="headerlink" title="ğŸåŒ¹é…é˜¶æ®µ"></a>ğŸåŒ¹é…é˜¶æ®µ</h2><ol><li>ç”¨æˆ·å‘é€çš„è¯·æ±‚ç»Ÿä¸€åˆ°è¾¾å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet </li><li>DispatcherServlet éå†æ‰€æœ‰ HandlerMapping ï¼Œæ‰¾åˆ°ä¸è·¯å¾„åŒ¹é…çš„å¤„ç†å™¨<br>   â‘  HandlerMapping æœ‰å¤šä¸ªï¼Œæ¯ä¸ª HandlerMapping ä¼šè¿”å›ä¸åŒçš„å¤„ç†å™¨å¯¹è±¡ï¼Œè°å…ˆåŒ¹é…ï¼Œè¿”å›è°çš„å¤„ç†å™¨ã€‚å…¶ä¸­èƒ½è¯†åˆ« <strong>@RequestMapping  çš„ä¼˜å…ˆçº§æœ€é«˜</strong><br>   â‘¡ å¯¹åº” @RequestMapping  çš„å¤„ç†å™¨æ˜¯ HandlerMethodï¼Œå®ƒåŒ…å«äº†æ§åˆ¶å™¨å¯¹è±¡å’Œæ§åˆ¶å™¨æ–¹æ³•ä¿¡æ¯<br>   â‘¢ å…¶ä¸­è·¯å¾„ä¸å¤„ç†å™¨çš„æ˜ å°„å…³ç³»åœ¨ HandlerMapping åˆå§‹åŒ–æ—¶å°±ä¼šå»ºç«‹å¥½</li></ol><img src="/img/20834/spring-mvc-3.png" alt="spring-mvc-3" style="zoom:67%;" /><ol start="3"><li>å°†HandlerMethodè¿åŒåŒ¹é…åˆ°çš„<strong>æ‹¦æˆªå™¨</strong>ï¼Œç”Ÿæˆ<strong>è°ƒç”¨é“¾å¯¹è±¡</strong>HandlerExecutionChainè¿”å›</li></ol><img src="/img/20834/spring-mvc-4.png" alt="img" style="zoom:67%;" /><ol start="4"><li>éå†HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰¾åˆ°èƒ½å¤„ç†HandlerMethodçš„<strong>é€‚é…å™¨å¯¹è±¡</strong>ï¼Œå¼€å§‹è°ƒç”¨</li></ol><img src="/img/20834/spring-mvc-5.png" alt="img" style="zoom:67%;" /><h2 id="ğŸè°ƒç”¨é˜¶æ®µ"><a href="#ğŸè°ƒç”¨é˜¶æ®µ" class="headerlink" title="ğŸè°ƒç”¨é˜¶æ®µ"></a>ğŸè°ƒç”¨é˜¶æ®µ</h2><ol><li>æ‰§è¡Œæ‹¦æˆªå™¨ <strong>preHandle</strong>(æŒ‰ç…§æ‹¦æˆªå™¨çš„<strong>æ­£å‘</strong>é¡ºåº)</li></ol><img src="/img/20834/spring-mvc-6.png" alt="img" style="zoom:67%;" /><ol start="2"><li>ç”± HandlerAdapter è°ƒç”¨ HandlerMethod</li></ol><p>â€‹â‘  è°ƒç”¨å‰å¤„ç†ä¸åŒç±»å‹çš„å‚æ•°</p><p>â€‹â‘¡ è°ƒç”¨åå¤„ç†ä¸åŒç±»å‹çš„è¿”å›å€¼</p><img src="/img/20834/spring-mvc-7.png" alt="img" style="zoom:67%;" /><ol start="3"><li>ç¬¬ 2 æ­¥æ²¡æœ‰å¼‚å¸¸</li></ol><p>â€‹â‘  è¿”å› ModelAndView</p><p>â€‹â‘¡ æ‰§è¡Œæ‹¦æˆªå™¨ <strong>postHandle</strong> æ–¹æ³•(æŒ‰ç…§æ‹¦æˆªå™¨çš„<strong>åå‘</strong>é¡ºåº)</p><p>â€‹â‘¢ è§£æè§†å›¾ï¼Œå¾—åˆ° View å¯¹è±¡ï¼Œè¿›è¡Œè§†å›¾æ¸²æŸ“</p><img src="/img/20834/spring-mvc-8.png" alt="img" style="zoom:67%;" /><ol start="4"><li>ç¬¬ 2 æ­¥æœ‰å¼‚å¸¸ï¼Œè¿›å…¥ HandlerExceptionResolver å¼‚å¸¸å¤„ç†æµç¨‹</li></ol><img src="/img/20834/spring-mvc-9.png" alt="img" style="zoom:67%;" /><ol start="5"><li><p>æœ€åéƒ½ä¼šæ‰§è¡Œæ‹¦æˆªå™¨çš„ <strong>afterCompletion</strong> æ–¹æ³• </p></li><li><p>å¦‚æœæ§åˆ¶å™¨æ–¹æ³•æ ‡æ³¨äº† <strong>@ResponseBody</strong>  æ³¨è§£ï¼Œåˆ™åœ¨ç¬¬ 2 æ­¥ï¼Œå°±ä¼šç”Ÿæˆ <strong>json ç»“æœ</strong>ï¼Œå¹¶æ ‡è®° ModelAndView å·²å¤„ç†ï¼Œè¿™æ ·å°±ä¸ä¼šæ‰§è¡Œç¬¬ 3 æ­¥çš„è§†å›¾æ¸²æŸ“</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beançš„ç”Ÿå‘½å‘¨æœŸ</title>
      <link href="/posts/22025/"/>
      <url>/posts/22025/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>Bean çš„ç”Ÿå‘½å‘¨æœŸä»è°ƒç”¨ beanFactory çš„ getBean å¼€å§‹ï¼Œåˆ°è¿™ä¸ª bean è¢«é”€æ¯ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ä¸ƒä¸ªé˜¶æ®µï¼š</p><ol><li>å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜</li><li>å¤„ç†çˆ¶å­å®¹å™¨</li><li>å¤„ç† dependsOn</li><li>é€‰æ‹© scope ç­–ç•¥</li><li><strong>åˆ›å»º bean</strong></li><li>ç±»å‹è½¬æ¢å¤„ç†</li><li><strong>é”€æ¯ bean</strong></li></ol><p>å¯¹åº”çš„æºä»£ç å¦‚ä¸‹(ä¸»è¦çœ‹æ³¨é‡Š)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°typeCheckOnlyï¼šbeanå®ä¾‹æ˜¯å¦åŒ…å«ä¸€ä¸ªç±»å‹æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(</span></span><br><span class="line"><span class="params">String name, <span class="meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="meta">@Nullable</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span></span><br><span class="line"><span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (1.å¤„ç†åç§°)è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &amp;ï¼Œéœ€è¦å»æ‰</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">  Object beanInstance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Eagerly check singleton cache for manually registered singletons.</span></span><br><span class="line">  <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">  <span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// (1.æ£€æŸ¥ç¼“å­˜)æ— å‚å•ä¾‹ä»ç¼“å­˜ä¸­è·å–</span></span><br><span class="line">    beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (2.å¤„ç†çˆ¶å­å®¹å™¨)å¦‚æœ bean definition å­˜åœ¨äºçˆ¶çš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å–</span></span><br><span class="line">    <span class="type">BeanFactory</span> <span class="variable">parentBeanFactory</span> <span class="operator">=</span> getParentBeanFactory();</span><br><span class="line">    <span class="keyword">if</span> (parentBeanFactory != <span class="literal">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;</span><br><span class="line">      <span class="comment">// Not found -&gt; check parent.</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">nameToLookup</span> <span class="operator">=</span> originalBeanName(name);</span><br><span class="line">      <span class="keyword">if</span> (parentBeanFactory <span class="keyword">instanceof</span> AbstractBeanFactory) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((AbstractBeanFactory) parentBeanFactory).doGetBean(</span><br><span class="line">            nameToLookup, requiredType, args, typeCheckOnly);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Delegation to parent with explicit args.</span></span><br><span class="line">        <span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No args -&gt; delegate to standard getBean method.</span></span><br><span class="line">        <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!typeCheckOnly) &#123;</span><br><span class="line">      <span class="comment">// å°†å½“å‰beanå®ä¾‹æ”¾å…¥alreadyCreatedé›†åˆé‡Œï¼Œæ ‡è¯†è¿™ä¸ªbeanå‡†å¤‡åˆ›å»ºäº†</span></span><br><span class="line">      markBeanAsCreated(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">StartupStep</span> <span class="variable">beanCreation</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.beans.instantiate&quot;</span>)</span><br><span class="line">        .tag(<span class="string">&quot;beanName&quot;</span>, name);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">        beanCreation.tag(<span class="string">&quot;beanType&quot;</span>, requiredType::toString);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">      checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// (3.å¤„ç†dependsOn)ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–äº†.</span></span><br><span class="line">      String[] dependsOn = mbd.getDependsOn();</span><br><span class="line">      <span class="keyword">if</span> (dependsOn != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                <span class="string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          registerDependentBean(dep, beanName);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            getBean(dep); <span class="comment">// åˆå§‹åŒ–å®ƒä¾èµ–çš„Bean</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                <span class="string">&quot;&#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºBeanå®ä¾‹ï¼šå•ä¾‹</span></span><br><span class="line">      <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">        sharedInstance = getSingleton(beanName, () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// çœŸæ­£åˆ›å»ºbeançš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="comment">// Explicitly remove instance from singleton cache: It might have been put there</span></span><br><span class="line">            <span class="comment">// eagerly by the creation process, to allow for circular reference resolution.</span></span><br><span class="line">            <span class="comment">// Also remove any beans that received a temporary reference to the bean.</span></span><br><span class="line">            destroySingleton(beanName);</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// (5.åˆ›å»ºBean)åˆ›å»ºBeanå®ä¾‹ï¼šåŸå‹</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">        <span class="comment">// It&#x27;s a prototype -&gt; create a new instance.</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">prototypeInstance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          beforePrototypeCreation(beanName);</span><br><span class="line">          prototypeInstance = createBean(beanName, mbd, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">          afterPrototypeCreation(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">        beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// (4.é€‰æ‹©scopeç­–ç•¥)åˆ›å»ºBeanå®ä¾‹ï¼šæ ¹æ®beançš„scopeåˆ›å»º</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">scopeName</span> <span class="operator">=</span> mbd.getScope();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasLength(scopeName)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No scope name defined for bean Â´&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="built_in">this</span>.scopes.get(scopeName);</span><br><span class="line">        <span class="keyword">if</span> (scope == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">Object</span> <span class="variable">scopedInstance</span> <span class="operator">=</span> scope.get(beanName, () -&gt; &#123;</span><br><span class="line">            beforePrototypeCreation(beanName);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">              afterPrototypeCreation(beanName);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IllegalStateException ex) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ScopeNotActiveException</span>(beanName, scopeName, ex);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">      beanCreation.tag(<span class="string">&quot;exception&quot;</span>, ex.getClass().toString());</span><br><span class="line">      beanCreation.tag(<span class="string">&quot;message&quot;</span>, String.valueOf(ex.getMessage()));</span><br><span class="line">      cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">      beanCreation.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> adaptBeanInstance(name, beanInstance, requiredType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé˜¶æ®µ1-å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜"><a href="#ğŸé˜¶æ®µ1-å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜" class="headerlink" title="ğŸé˜¶æ®µ1  å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜"></a>ğŸé˜¶æ®µ1  å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜</h2><p>è¿™ä¸€æ­¥ä¼šå¤„ç†åˆ«åï¼Œå°†<strong>åˆ«åè§£æä¸ºå®é™…åç§°</strong></p><p>å¯¹ FactoryBean ä¹Ÿä¼šç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœä»¥ <strong>&amp;</strong> å¼€å¤´è¡¨ç¤ºè¦è·å– FactoryBean æœ¬èº«ï¼Œå¦åˆ™è¡¨ç¤ºè¦è·å–å…¶äº§å“</p><p>è¿™é‡Œé’ˆå¯¹å•ä¾‹å¯¹è±¡ä¼šæ£€æŸ¥<strong>ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§</strong>ç¼“å­˜</p><ul><li>singletonFactories ä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹å·¥å‚</strong>å¯¹è±¡</li><li>earlySingletonObjects äºŒçº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹å·¥å‚çš„äº§å“</strong>å¯¹è±¡ï¼Œå¦‚æœå‘ç”Ÿå¾ªç¯ä¾èµ–ï¼Œäº§å“æ˜¯<strong>ä»£ç†</strong>ï¼›æ— å¾ªç¯ä¾èµ–ï¼Œäº§å“æ˜¯<strong>åŸå§‹å¯¹è±¡</strong></li><li>singletonObjects ä¸€çº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹æˆå“</strong>å¯¹è±¡</li></ul><h2 id="ğŸé˜¶æ®µ2-å¤„ç†çˆ¶å­å®¹å™¨"><a href="#ğŸé˜¶æ®µ2-å¤„ç†çˆ¶å­å®¹å™¨" class="headerlink" title="ğŸé˜¶æ®µ2  å¤„ç†çˆ¶å­å®¹å™¨"></a>ğŸé˜¶æ®µ2  å¤„ç†çˆ¶å­å®¹å™¨</h2><p>å¦‚æœå½“å‰å®¹å™¨æ ¹æ®åå­—æ‰¾ä¸åˆ°è¿™ä¸ª beanï¼Œæ­¤æ—¶è‹¥çˆ¶å®¹å™¨å­˜åœ¨ï¼Œåˆ™<strong>æ‰§è¡Œçˆ¶å®¹å™¨</strong>çš„ getBean æµç¨‹</p><p>çˆ¶å­å®¹å™¨çš„ bean åç§°å¯ä»¥é‡å¤</p><h2 id="ğŸé˜¶æ®µ3-å¤„ç†-dependsOn"><a href="#ğŸé˜¶æ®µ3-å¤„ç†-dependsOn" class="headerlink" title="ğŸé˜¶æ®µ3  å¤„ç† dependsOn"></a>ğŸé˜¶æ®µ3  å¤„ç† dependsOn</h2><p>å¦‚æœå½“å‰ bean æœ‰é€šè¿‡ dependsOn æŒ‡å®šäº†<strong>éæ˜¾å¼ä¾èµ–</strong>çš„ beanï¼Œè¿™ä¸€æ­¥ä¼šæå‰åˆ›å»ºè¿™äº›dependsOn çš„ bean</p><blockquote><p>æ‰€è°“éæ˜¾å¼ä¾èµ–ï¼Œå°±æ˜¯æŒ‡ä¸¤ä¸ª bean ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥ä¾èµ–å…³ç³»ï¼Œä½†éœ€è¦æ§åˆ¶å®ƒä»¬çš„<strong>åˆ›å»ºå…ˆåé¡ºåº</strong></p></blockquote><h2 id="ğŸé˜¶æ®µ4-é€‰æ‹©-scope-ç­–ç•¥"><a href="#ğŸé˜¶æ®µ4-é€‰æ‹©-scope-ç­–ç•¥" class="headerlink" title="ğŸé˜¶æ®µ4  é€‰æ‹© scope ç­–ç•¥"></a>ğŸé˜¶æ®µ4  é€‰æ‹© scope ç­–ç•¥</h2><p>scopeç†è§£ä¸ºä»xxxèŒƒå›´æ‰¾åˆ°è¿™ä¸ªbean</p><ul><li>singleton scopeè¡¨ç¤ºä»å•ä¾‹æ± èŒƒå›´å†…è·å–beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå¹¶æ”¾å…¥å•ä¾‹æ± </li><li>propotype scopeè¡¨ç¤ºä»ä¸ç¼“å­˜beanï¼Œæ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„bean</li><li>request scopeè¡¨ç¤ºä»requestå¯¹è±¡èŒƒå›´å†…è·å–beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå¹¶æ”¾å…¥request</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestScope</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testRequestScope();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å•ä¾‹ bean ä» refresh è¢«åˆ›å»º, åˆ° close è¢«é”€æ¯, BeanFactory ä¼šè®°å½•å“ªäº› bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testSingletonScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class);</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh(); <span class="comment">// getBean</span></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾“å‡ºï¼šinit destroy</span></span><br><span class="line">    <span class="comment">// å¤šä¾‹ bean ä»é¦–æ¬¡ getBean è¢«åˆ›å»º, åˆ°è°ƒç”¨ BeanFactory çš„ destroyBean è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPrototypeScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setScope(<span class="string">&quot;prototype&quot;</span>));</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Bean1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Bean1.class);</span><br><span class="line">        <span class="comment">// æ²¡è°è®°å½•è¯¥ bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•, éœ€è¦æˆ‘ä»¬è‡ªè¡Œè°ƒç”¨</span></span><br><span class="line">        context.getDefaultListableBeanFactory().destroyBean(bean);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾“å‡ºï¼šinit destroy</span></span><br><span class="line">    <span class="comment">// request bean ä»é¦–æ¬¡ getBean è¢«åˆ›å»º, åˆ° request ç»“æŸå‰è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testRequestScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.getDefaultListableBeanFactory().registerScope(<span class="string">&quot;request&quot;</span>, <span class="keyword">new</span> <span class="title class_">RequestScope</span>());</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setScope(<span class="string">&quot;request&quot;</span>));</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">MockHttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MockHttpServletRequest</span>();</span><br><span class="line">                <span class="comment">// æ¯ä¸ª webRequest å¯¹è±¡ä¼šè®°å½•å“ªäº› bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•</span></span><br><span class="line">                <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request);</span><br><span class="line">                RequestContextHolder.setRequestAttributes(webRequest);</span><br><span class="line"></span><br><span class="line">                <span class="type">Bean1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Bean1.class);</span><br><span class="line">                LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, bean);</span><br><span class="line">                LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, request.getAttribute(<span class="string">&quot;bean1&quot;</span>));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// request è¯·æ±‚ç»“æŸå‰è°ƒç”¨è¿™äº›é”€æ¯æ–¹æ³•</span></span><br><span class="line">                webRequest.requestCompleted();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šä¸¤ä¸ªçº¿ç¨‹çš„init destroy</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125; - init&quot;</span>, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PreDestroy</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125; - destroy&quot;</span>, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé˜¶æ®µ5-åˆ›å»ºbean"><a href="#ğŸé˜¶æ®µ5-åˆ›å»ºbean" class="headerlink" title="ğŸé˜¶æ®µ5  åˆ›å»ºbean"></a>ğŸé˜¶æ®µ5  åˆ›å»ºbean</h2><img src="/img/22025/bean1.png" alt="img" style="zoom:67%;" /><h3 id="5-1-åˆ›å»º-bean-å®ä¾‹"><a href="#5-1-åˆ›å»º-bean-å®ä¾‹" class="headerlink" title="5.1 åˆ›å»º bean å®ä¾‹"></a>5.1 åˆ›å»º bean å®ä¾‹</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td>æœ‰è‡ªå®šä¹‰ TargetSource çš„æƒ…å†µ</td><td>ç”± AnnotationAwareAspectJAutoProxyCreator åˆ›å»ºä»£ç†è¿”å›</td></tr><tr><td>Supplier æ–¹å¼åˆ›å»º bean å®ä¾‹</td><td>ä¸º Spring 5.0 æ–°å¢åŠŸèƒ½ï¼Œæ–¹ä¾¿ç¼–ç¨‹æ–¹å¼åˆ›å»º  bean  å®ä¾‹</td></tr><tr><td>FactoryMethod æ–¹å¼  åˆ›å»º bean  å®ä¾‹</td><td>â‘  åˆ†æˆé™æ€å·¥å‚ä¸å®ä¾‹å·¥å‚ï¼›â‘¡ å·¥å‚æ–¹æ³•è‹¥æœ‰å‚æ•°ï¼Œéœ€è¦å¯¹å·¥å‚æ–¹æ³•å‚æ•°è¿›è¡Œè§£æï¼Œåˆ©ç”¨  resolveDependencyï¼›â‘¢ å¦‚æœæœ‰å¤šä¸ªå·¥å‚æ–¹æ³•å€™é€‰è€…ï¼Œè¿˜è¦è¿›ä¸€æ­¥æŒ‰æƒé‡ç­›é€‰</td></tr><tr><td><strong>AutowiredAnnotationBeanPostProcessor</strong></td><td>â‘  ä¼˜å…ˆé€‰æ‹©å¸¦ <strong>@Autowired</strong> æ³¨è§£çš„æ„é€ ï¼›â‘¡ è‹¥æœ‰å”¯ä¸€çš„å¸¦å‚æ„é€ ï¼Œä¹Ÿä¼šå…¥é€‰</td></tr><tr><td>mbd.getPreferredConstructors</td><td>é€‰æ‹©æ‰€æœ‰å…¬å…±æ„é€ ï¼Œè¿™äº›æ„é€ ä¹‹é—´æŒ‰æƒé‡ç­›é€‰</td></tr><tr><td><strong>é‡‡ç”¨é»˜è®¤æ„é€ </strong></td><td>å¦‚æœä¸Šé¢çš„åå¤„ç†å™¨å’Œ BeanDefiniation éƒ½æ²¡æ‰¾åˆ°æ„é€ ï¼Œé‡‡ç”¨é»˜è®¤æ„é€ ï¼Œå³ä½¿æ˜¯ç§æœ‰çš„</td></tr></tbody></table><h3 id="5-2-ä¾èµ–æ³¨å…¥"><a href="#5-2-ä¾èµ–æ³¨å…¥" class="headerlink" title="5.2 ä¾èµ–æ³¨å…¥"></a>5.2 ä¾èµ–æ³¨å…¥</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td><strong>AutowiredAnnotationBeanPostProcessor</strong>ï¼ˆæ³¨è§£åŒ¹é…ï¼‰</td><td>è¯†åˆ«  <strong>@Autowired</strong> åŠ <strong>@Value</strong> æ ‡æ³¨çš„æˆå‘˜ï¼Œå°è£…ä¸º  InjectionMetadata è¿›è¡Œä¾èµ–æ³¨å…¥</td></tr><tr><td><strong>CommonAnnotationBeanPostProcessor</strong>ï¼ˆæ³¨è§£åŒ¹é…ï¼‰</td><td>è¯†åˆ«  <strong>@Resource</strong> æ ‡æ³¨çš„æˆå‘˜ï¼Œå°è£…ä¸º  InjectionMetadata è¿›è¡Œä¾èµ–æ³¨å…¥</td></tr><tr><td>resolveDependency</td><td>ç”¨æ¥æŸ¥æ‰¾è¦è£…é…çš„å€¼ï¼Œå¯ä»¥è¯†åˆ«ï¼šâ‘  Optionalï¼›â‘¡ ObjectFactory åŠ ObjectProviderï¼›â‘¢ @Lazy æ³¨è§£ï¼›â‘£ @Value æ³¨è§£ï¼ˆ${  }, #{ }, ç±»å‹è½¬æ¢ï¼‰ï¼›â‘¤ é›†åˆç±»å‹ï¼ˆCollectionï¼ŒMapï¼Œæ•°ç»„ç­‰ï¼‰ï¼›â‘¥ æ³›å‹å’Œ  @Qualifierï¼ˆç”¨æ¥åŒºåˆ†ç±»å‹æ­§ä¹‰ï¼‰ï¼›â‘¦ primary  åŠåå­—åŒ¹é…ï¼ˆç”¨æ¥åŒºåˆ†ç±»å‹æ­§ä¹‰ï¼‰</td></tr><tr><td><strong>AUTOWIRE_BY_NAME</strong>ï¼ˆæ ¹æ®åå­—åŒ¹é…ï¼‰</td><td>æ ¹æ®æˆå‘˜åå­—æ‰¾ bean å¯¹è±¡ï¼Œä¿®æ”¹ mbd çš„ propertyValuesï¼Œä¸ä¼šè€ƒè™‘ç®€å•ç±»å‹çš„æˆå‘˜</td></tr><tr><td><strong>AUTOWIRE_BY_TYPE</strong>ï¼ˆæ ¹æ®ç±»å‹åŒ¹é…ï¼‰</td><td>æ ¹æ®æˆå‘˜ç±»å‹æ‰§è¡Œ resolveDependency æ‰¾åˆ°ä¾èµ–æ³¨å…¥çš„å€¼ï¼Œä¿®æ”¹  mbd çš„ propertyValues</td></tr><tr><td><strong>applyPropertyValuesï¼ˆå³xmlä¸­çš„&lt;property name ref|value&#x2F;&gt;,ç²¾ç¡®æŒ‡å®šï¼‰</strong></td><td>æ ¹æ® mbd çš„ propertyValues è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆå³xmlä¸­ &#96;&lt;property name ref</td></tr></tbody></table><p>ä¼˜å…ˆçº§ï¼šä¼˜å…ˆçº§æœ€ä½ï¼š@AutowiredåŒ¹é…ï¼›ä¼˜å…ˆçº§æ¬¡ä¹‹ï¼šAUTOWIRE_BY_NAMEï¼›ä¼˜å…ˆçº§æœ€é«˜ï¼šç²¾ç¡®æŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å¦‚æœå¯¹åŒä¸€å±æ€§è¿›è¡Œçš„ @Autowired æ³¨å…¥ã€AUTOWIRE_BY_NAMEã€ç²¾ç¡®æŒ‡å®šæ³¨å…¥åç§°, ä¼˜å…ˆçº§æ˜¯æ€æ ·çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInjection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¼˜å…ˆçº§æœ€é«˜çš„ï¼šç²¾ç¡®æŒ‡å®šæ³¨å…¥ bean çš„åç§° &lt;property name=&quot;bean3&quot; ref=&quot;bean2&quot;/&gt;</span></span><br><span class="line">            bd.getPropertyValues().add(<span class="string">&quot;bean3&quot;</span>, <span class="keyword">new</span> <span class="title class_">RuntimeBeanReference</span>(<span class="string">&quot;bean2&quot;</span>));</span><br><span class="line">            <span class="comment">// ä¼˜å…ˆçº§æ¬¡ä¹‹çš„ï¼šé€šè¿‡ AUTOWIRE_BY_NAME åŒ¹é…</span></span><br><span class="line">            ((RootBeanDefinition) bd).setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_NAME);</span><br><span class="line">        &#125;);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean2&quot;</span>, Bean2.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean3&quot;</span>, Bean3.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean4&quot;</span>, Bean4.class);</span><br><span class="line"></span><br><span class="line">        context.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        MyInterface bean;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¼˜å…ˆçº§æœ€ä½çš„ï¼š@Autowired åŒ¹é…</span></span><br><span class="line">        <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;bean4&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean3</span><span class="params">(MyInterface bean)</span> &#123;</span><br><span class="line">            System.out.println(bean);</span><br><span class="line">            <span class="built_in">this</span>.bean = bean;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean3</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean4</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-åˆå§‹åŒ–"><a href="#5-3-åˆå§‹åŒ–" class="headerlink" title="5.3 åˆå§‹åŒ–"></a>5.3 åˆå§‹åŒ–</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td><strong>å†…ç½® Aware æ¥å£çš„è£…é…</strong></td><td>åŒ…æ‹¬ BeanNameAwareï¼ŒBeanFactoryAware ç­‰</td></tr><tr><td><strong>æ‰©å±• Aware æ¥å£çš„è£…é…</strong></td><td>ç”± ApplicationContextAwareProcessor è§£æï¼Œæ‰§è¡Œæ—¶æœºåœ¨  postProcessBeforeInitialization</td></tr><tr><td><strong>@PostConstruct</strong></td><td>ç”± CommonAnnotationBeanPostProcessor è§£æï¼Œæ‰§è¡Œæ—¶æœºåœ¨ postProcessBeforeInitialization</td></tr><tr><td><strong>InitializingBean</strong></td><td>é€šè¿‡æ¥å£å›è°ƒæ‰§è¡Œåˆå§‹åŒ–</td></tr><tr><td><strong>initMethod</strong></td><td>æ ¹æ® BeanDefinition å¾—åˆ°çš„åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œåˆå§‹åŒ–ï¼Œå³ <code>&lt;bean init-method&gt;</code>æˆ–@Bean(initMethod)</td></tr><tr><td><strong>åˆ›å»º aop ä»£ç†</strong></td><td>ç”± AnnotationAwareAspectJAutoProxyCreator åˆ›å»ºï¼Œæ‰§è¡Œæ—¶æœºåœ¨postProcessAfterInitialization</td></tr></tbody></table><p>ä¼˜å…ˆçº§ï¼š4-&gt;2-&gt;1-&gt;3</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInitialization</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        <span class="comment">// &lt;bean init-method=&quot;initMethod&quot;&gt;</span></span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setInitMethodName(<span class="string">&quot;initMethod&quot;</span>));</span><br><span class="line">        context.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span>, BeanFactoryAware &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            System.out.println(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMethod</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">            System.out.println(<span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-4-æ³¨å†Œå¯é”€æ¯bean"><a href="#5-4-æ³¨å†Œå¯é”€æ¯bean" class="headerlink" title="5.4 æ³¨å†Œå¯é”€æ¯bean"></a>5.4 æ³¨å†Œå¯é”€æ¯bean</h3><p>åœ¨è¿™ä¸€æ­¥åˆ¤æ–­å¹¶ç™»è®°å¯é”€æ¯ bean</p><ul><li><p>åˆ¤æ–­ä¾æ® </p></li><li><ul><li>å¦‚æœå®ç°äº† DisposableBean æˆ– AutoCloseable æ¥å£ï¼Œåˆ™ä¸ºå¯é”€æ¯ bean</li><li>å¦‚æœè‡ªå®šä¹‰äº† destroyMethodï¼Œåˆ™ä¸ºå¯é”€æ¯ bean</li><li>å¦‚æœé‡‡ç”¨ @Bean  æ²¡æœ‰æŒ‡å®š destroyMethodï¼Œåˆ™é‡‡ç”¨è‡ªåŠ¨æ¨æ–­æ–¹å¼è·å–é”€æ¯æ–¹æ³•åï¼ˆcloseï¼Œshutdownï¼‰ </li><li>å¦‚æœæœ‰ @PreDestroy  æ ‡æ³¨çš„æ–¹æ³•</li></ul></li><li><p>å­˜å‚¨ä½ç½® </p></li><li><ul><li>singleton scope çš„å¯é”€æ¯ bean ä¼šå­˜å‚¨äº beanFactory çš„æˆå‘˜å½“ä¸­</li><li>è‡ªå®šä¹‰ scope çš„å¯é”€æ¯ bean ä¼šå­˜å‚¨äºå¯¹åº”çš„åŸŸå¯¹è±¡å½“ä¸­</li><li>prototype scope ä¸ä¼šå­˜å‚¨ï¼Œéœ€è¦è‡ªå·±æ‰¾åˆ°æ­¤å¯¹è±¡é”€æ¯</li></ul></li><li><p>å­˜å‚¨æ—¶éƒ½ä¼šå°è£…ä¸º DisposableBeanAdapter ç±»å‹å¯¹é”€æ¯æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé€‚é…</p></li></ul><h2 id="ğŸé˜¶æ®µ6-ç±»å‹è½¬æ¢"><a href="#ğŸé˜¶æ®µ6-ç±»å‹è½¬æ¢" class="headerlink" title="ğŸé˜¶æ®µ6  ç±»å‹è½¬æ¢"></a>ğŸé˜¶æ®µ6  ç±»å‹è½¬æ¢</h2><p>å¦‚æœ getBean çš„ requiredType å‚æ•°ä¸å®é™…å¾—åˆ°çš„å¯¹è±¡ç±»å‹ä¸åŒï¼Œä¼šå°è¯•è¿›è¡Œ<strong>ç±»å‹è½¬æ¢</strong></p><h2 id="ğŸé˜¶æ®µ7-é”€æ¯-bean"><a href="#ğŸé˜¶æ®µ7-é”€æ¯-bean" class="headerlink" title="ğŸé˜¶æ®µ7  é”€æ¯ bean"></a>ğŸé˜¶æ®µ7  é”€æ¯ bean</h2><ul><li><p>é”€æ¯æ—¶æœº</p></li><li><ul><li>singleton bean çš„é”€æ¯åœ¨ ApplicationContext.close æ—¶ï¼Œæ­¤æ—¶ä¼šæ‰¾åˆ°æ‰€æœ‰ DisposableBean çš„åå­—ï¼Œé€ä¸€é”€æ¯</li><li>è‡ªå®šä¹‰ scope bean çš„é”€æ¯åœ¨ä½œç”¨åŸŸå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶</li><li>prototype bean çš„é”€æ¯å¯ä»¥é€šè¿‡è‡ªå·±æ‰‹åŠ¨è°ƒç”¨ AutowireCapableBeanFactory.destroyBean æ–¹æ³•æ‰§è¡Œé”€æ¯</li></ul></li><li><p>åŒä¸€ bean ä¸­ä¸åŒå½¢å¼é”€æ¯æ–¹æ³•çš„è°ƒç”¨æ¬¡åº </p></li><li><ul><li>ä¼˜å…ˆåå¤„ç†å™¨é”€æ¯ï¼Œå³ @PreDestroy  </li><li>å…¶æ¬¡ DisposableBean æ¥å£é”€æ¯</li><li>æœ€å destroyMethod é”€æ¯ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰åç§°ï¼Œæ¨æ–­åç§°ï¼ŒAutoCloseable æ¥å£ å¤šé€‰ä¸€ï¼‰</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOCåˆå§‹åŒ–æµç¨‹</title>
      <link href="/posts/57880/"/>
      <url>/posts/57880/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸIOCåˆå§‹åŒ–"><a href="#ğŸIOCåˆå§‹åŒ–" class="headerlink" title="ğŸIOCåˆå§‹åŒ–"></a>ğŸIOCåˆå§‹åŒ–</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Springä¸­ï¼ŒIOCçš„æœ¬è´¨æ˜¯å®¹å™¨å¯¹beançš„ç®¡ç†ï¼ŒIoCå®¹å™¨çš„æ¥å£ç±»æ˜¯ApplicationContextï¼Œå®¹å™¨å¿…é¡»è°ƒç”¨ refresh æ‰èƒ½æ­£å¸¸å·¥ä½œ</p><h3 id="refreshæºç "><a href="#refreshæºç " class="headerlink" title="refreshæºç "></a>refreshæºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="type">StartupStep</span> <span class="variable">contextRefresh</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">beanPostProcess</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class="line">            <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line">            beanPostProcess.end();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">            initMessageSource();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">            onRefresh();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">            registerListeners();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">            destroyBeans();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">            cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">            <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">            resetCommonCaches();</span><br><span class="line">            contextRefresh.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•æ€»ç»“"><a href="#æ–¹æ³•æ€»ç»“" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p>refreshä¸­ä¸»è¦ä¼šè°ƒ12ä¸ªæ–¹æ³•</p><ol><li>prepareRefreshâ€”â€”åšå¥½å‡†å¤‡å·¥ä½œ</li><li>obtainFreshBeanFactoryâ€”â€”åˆ›å»ºæˆ–è·å–BeanFactory</li><li>prepareBeanFactoryâ€”â€”å‡†å¤‡BeanFactory</li><li>postProcessBeanFactoryâ€”â€”å­ç±»æ‰©å±•BeanFactory</li><li>invokeBeanFactoryPostProcessors â€”â€”åå¤„ç†æ‰©å±•BeanFactory</li><li>registerBeanPostProcessorsâ€”â€”å‡†å¤‡Beanåå¤„ç†å™¨</li><li>initMessageSourceâ€”â€”ä¸ºApplicationContextæä¾›å›½é™…åŒ–åŠŸèƒ½</li><li>initApplicationEventMulticasterâ€”â€”ä¸ºApplicationContextæä¾›äº‹ä»¶å‘å¸ƒå™¨</li><li>onRefreshâ€”â€”ç•™ç»™å­ç±»æ‰©å±•</li><li>registerListenersâ€”â€”ä¸ºApplicationContextå‡†å¤‡ç›‘å¬å™¨</li><li>finishBeanFactoryInitializationâ€”â€”åˆå§‹åŒ–å•ä¾‹Beanï¼Œæ‰§è¡ŒBeanåå¤„ç†å™¨æ‰©å±•</li><li>finishRefreshâ€”â€”å‡†å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshedäº‹ä»¶</li></ol><p><strong>åŠŸèƒ½åˆ†ç±»</strong></p><p> ã€1ã€‘ ä¸ºå‡†å¤‡ç¯å¢ƒ </p><p> <strong>ã€2 3 4 5 6ã€‘ ä¸ºå‡†å¤‡ BeanFactoryï¼ˆé‡ç‚¹ï¼‰</strong> </p><p> ã€7 8 9 10 12ã€‘ ä¸ºå‡†å¤‡ ApplicationContext </p><p> ã€11ã€‘ ä¸ºåˆå§‹åŒ– BeanFactory ä¸­éå»¶è¿Ÿå•ä¾‹ bean</p><h2 id="ğŸ1-prepareRefresh"><a href="#ğŸ1-prepareRefresh" class="headerlink" title="ğŸ1. prepareRefresh"></a>ğŸ1. prepareRefresh</h2><blockquote><p>è¿™ä¸€æ­¥åˆ›å»ºå’Œå‡†å¤‡äº† Environment å¯¹è±¡ï¼Œå®ƒä½œä¸º ApplicationContext çš„ä¸€ä¸ªæˆå‘˜å˜é‡</p></blockquote><p>Environment å¯¹è±¡çš„ä½œç”¨ä¹‹ä¸€æ˜¯ä¸ºåç»­ <strong>@Value</strong>ï¼Œå€¼æ³¨å…¥æ—¶æä¾›<strong>é”®å€¼</strong> </p><p>Environment åˆ†æˆä¸‰ä¸ªä¸»è¦éƒ¨åˆ†</p><ul><li><ul><li>systemProperties - ä¿å­˜ java ç¯å¢ƒé”®å€¼</li><li>systemEnvironment - ä¿å­˜ç³»ç»Ÿç¯å¢ƒé”®å€¼</li><li>è‡ªå®šä¹‰ PropertySource - ä¿å­˜è‡ªå®šä¹‰é”®å€¼ï¼Œä¾‹å¦‚æ¥è‡ªäº *.properties æ–‡ä»¶çš„é”®å€¼</li></ul></li></ul><img src="/img/57880/refresh.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚ä½•è·å¾—å’Œè§£æ @Value å†…å®¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEnvironment</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1) è·å¾— @Value çš„å€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; ä»…è·å– @Value å€¼&quot;</span>);</span><br><span class="line">        <span class="type">QualifierAnnotationAutowireCandidateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QualifierAnnotationAutowireCandidateResolver</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;name&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2) è§£æ @Value çš„å€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; è·å– @Value å€¼, å¹¶è§£æ$&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">javaHome</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;javaHome&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(javaHome);</span><br><span class="line">        System.out.println(getEnvironment().resolvePlaceholders(javaHome.toString()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3) è§£æ SpEL è¡¨è¾¾å¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; è·å– @Value å€¼, å¹¶è§£æ#&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">expression</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;expression&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(expression);</span><br><span class="line">        <span class="type">String</span> <span class="variable">v1</span> <span class="operator">=</span> getEnvironment().resolvePlaceholders(expression.toString());</span><br><span class="line">        System.out.println(v1);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">StandardBeanExpressionResolver</span>().evaluate(v1, <span class="keyword">new</span> <span class="title class_">BeanExpressionContext</span>(<span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>(),<span class="literal">null</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Environment <span class="title function_">getEnvironment</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StandardEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEnvironment</span>();</span><br><span class="line">        env.getPropertySources().addLast(<span class="keyword">new</span> <span class="title class_">ResourcePropertySource</span>(<span class="string">&quot;jdbc&quot;</span>, <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;jdbc.properties&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> env;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        <span class="meta">@Value(&quot;hello&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String javaHome;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;#&#123;&#x27;class version:&#x27; + &#x27;$&#123;java.class.version&#125;&#x27;&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String expression;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ2-obtainFreshBeanFactory"><a href="#ğŸ2-obtainFreshBeanFactory" class="headerlink" title="ğŸ2. obtainFreshBeanFactory"></a>ğŸ2. obtainFreshBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥è·å–ï¼ˆæˆ–åˆ›å»ºï¼‰ BeanFactoryï¼Œå®ƒä¹Ÿæ˜¯ä½œä¸º ApplicationContext çš„ä¸€ä¸ªæˆå‘˜å˜é‡</p></blockquote><p><strong>BeanFactory çš„ä½œç”¨æ˜¯è´Ÿè´£ bean çš„åˆ›å»ºã€ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ï¼Œbean çš„å„é¡¹ç‰¹å¾ç”± BeanDefinition å®šä¹‰</strong> </p><ul><li><ul><li>BeanDefinition ä½œä¸º bean çš„è®¾è®¡è“å›¾ï¼Œè§„å®šäº† bean çš„ç‰¹å¾ï¼Œå¦‚å•ä¾‹å¤šä¾‹ã€ä¾èµ–å…³ç³»ã€åˆå§‹é”€æ¯æ–¹æ³•ç­‰</li><li>BeanDefinition çš„æ¥æºæœ‰å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯é€šè¿‡ xml è·å¾—ã€é…ç½®ç±»è·å¾—ã€ç»„ä»¶æ‰«æè·å¾—ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¼–ç¨‹æ·»åŠ </li></ul></li></ul><p>æ‰€æœ‰çš„ BeanDefinition ä¼šå­˜å…¥ BeanFactory ä¸­çš„ <strong>beanDefinitionMap</strong> é›†åˆ</p><img src="/img/57880/refresh2.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¼”ç¤ºå„ç§ BeanDefinition çš„æ¥æº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanDefinition</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; ä¸€å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 1) ä» xml è·å– &quot;</span>);</span><br><span class="line">        <span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">        reader1.loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;bd.xml&quot;</span>));</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames())); </span><br><span class="line">        <span class="comment">//[bean1]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 2) ä»é…ç½®ç±»è·å– &quot;</span>);</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;config1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Config1.class).getBeanDefinition());</span><br><span class="line">    <span class="comment">// è¯†åˆ«å¤„ç†bean</span></span><br><span class="line">        <span class="type">ConfigurationClassPostProcessor</span> <span class="variable">postProcessor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassPostProcessor</span>();</span><br><span class="line">        postProcessor.postProcessBeanDefinitionRegistry(beanFactory);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">    <span class="comment">//[bean1,config1,bean2]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 3) æ‰«æè·å– &quot;</span>);</span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(beanFactory);</span><br><span class="line">        scanner.scan(<span class="string">&quot;day04.refresh.sub&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">        <span class="comment">//[bean1,config1,bean2,bean3,å…¶ä»–å’ŒåŒ…æ‰«æç›¸å…³çš„bean]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config1</span> &#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean2 <span class="title function_">bean2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean2</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ3-prepareBeanFactory"><a href="#ğŸ3-prepareBeanFactory" class="headerlink" title="ğŸ3. prepareBeanFactory"></a>ğŸ3. prepareBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šè¿›ä¸€æ­¥<strong>å®Œå–„ BeanFactory</strong>ï¼Œä¸ºå®ƒçš„å„é¡¹æˆå‘˜å˜é‡èµ‹å€¼</p></blockquote><p>beanExpressionResolver ç”¨æ¥è§£æ SpELï¼Œå¸¸è§å®ç°ä¸º StandardBeanExpressionResolver</p><p>propertyEditorRegistrars ä¼šæ³¨å†Œç±»å‹è½¬æ¢å™¨ </p><ul><li><ul><li>å®ƒåœ¨è¿™é‡Œä½¿ç”¨äº† ResourceEditorRegistrar å®ç°ç±»</li><li>å¹¶åº”ç”¨ ApplicationContext æä¾›çš„ Environment å®Œæˆ ${ } è§£æ</li></ul></li></ul><p>registerResolvableDependency æ¥æ³¨å†Œ beanFactory ä»¥åŠ ApplicationContextï¼Œè®©å®ƒä»¬ä¹Ÿèƒ½ç”¨äºä¾èµ–æ³¨å…¥</p><p>beanPostProcessors æ˜¯ bean åå¤„ç†å™¨é›†åˆï¼Œä¼šå·¥ä½œåœ¨ bean çš„ç”Ÿå‘½å‘¨æœŸå„ä¸ªé˜¶æ®µï¼Œæ­¤å¤„ä¼šæ·»åŠ ä¸¤ä¸ªï¼š </p><ul><li><ul><li>ApplicationContextAwareProcessor ç”¨æ¥è§£æ Aware æ¥å£</li><li>ApplicationListenerDetector ç”¨æ¥è¯†åˆ«å®¹å™¨ä¸­ ApplicationListener ç±»å‹çš„ bean</li></ul></li></ul><img src="/img/57880/refresh3.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ4-postProcessBeanFactory"><a href="#ğŸ4-postProcessBeanFactory" class="headerlink" title="ğŸ4. postProcessBeanFactory"></a>ğŸ4. postProcessBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç©ºå®ç°ï¼Œç•™ç»™å­ç±»æ‰©å±•</p></blockquote><p>ä¸€èˆ¬ Web ç¯å¢ƒçš„ ApplicationContext éƒ½è¦åˆ©ç”¨å®ƒæ³¨å†Œæ–°çš„ Scopeï¼Œå®Œå–„ Web ä¸‹çš„ BeanFactory</p><p>è¿™é‡Œä½“ç°çš„æ˜¯<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼</p><h2 id="ğŸ5-invokeBeanFactoryPostProcessors"><a href="#ğŸ5-invokeBeanFactoryPostProcessors" class="headerlink" title="ğŸ5. invokeBeanFactoryPostProcessors"></a>ğŸ5. invokeBeanFactoryPostProcessors</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šè°ƒç”¨ beanFactory åå¤„ç†å™¨</p></blockquote><p>beanFactory åå¤„ç†å™¨ï¼Œå……å½“ beanFactory çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥ç”¨æ¥<strong>è¡¥å……æˆ–ä¿®æ”¹</strong> BeanDefinition</p><p>å¸¸è§çš„ beanFactory åå¤„ç†å™¨æœ‰ </p><ul><li><ul><li><strong>ConfigurationClassPostProcessor</strong> â€“ è§£æ @Configurationã€@Beanã€@Importã€@PropertySource  ç­‰ </li><li>PropertySourcesPlaceHolderConfigurer â€“ æ›¿æ¢ BeanDefinition ä¸­çš„ ${ }</li><li>MapperScannerConfigurer â€“ è¡¥å…… Mapper æ¥å£å¯¹åº”çš„ BeanDefinition</li></ul></li></ul><img src="/img/57880/refresh4.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ6-registerBeanPostProcessors"><a href="#ğŸ6-registerBeanPostProcessors" class="headerlink" title="ğŸ6. registerBeanPostProcessors"></a>ğŸ6. registerBeanPostProcessors</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç»§ç»­ä» beanFactory ä¸­æ‰¾å‡º bean åå¤„ç†å™¨ï¼Œæ·»åŠ è‡³ beanPostProcessors é›†åˆä¸­</p></blockquote><p>bean åå¤„ç†å™¨ï¼Œå……å½“ bean çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥å·¥ä½œåœ¨ bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ã€åˆå§‹åŒ–é˜¶æ®µï¼Œå¸¸è§çš„æœ‰ï¼š </p><ul><li><ul><li><strong>Autowired</strong>AnnotationBeanPostProcessor åŠŸèƒ½æœ‰ï¼šè§£æ <strong>@Autowiredï¼Œ@Value</strong>  æ³¨è§£ </li><li>CommonAnnotationBeanPostProcessor åŠŸèƒ½æœ‰ï¼šè§£æ @Resourceï¼Œ@PostConstructï¼Œ@PreDestroy  </li><li>AnnotationAwareAspectJAutoProxyCreator åŠŸèƒ½æœ‰ï¼šä¸ºç¬¦åˆ<strong>åˆ‡ç‚¹çš„ç›®æ ‡</strong> bean è‡ªåŠ¨åˆ›å»ºä»£ç†</li></ul></li></ul><img src="/img/57880/refresh5.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getDefaultListableBeanFactory();</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean1.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean2&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean2.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean3&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean3.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;aspect1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Aspect1.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼šfoo(ä»…è°ƒç”¨fooæ–¹æ³•)</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor1&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AutowiredAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// å¤šè¾“å‡ºï¼š&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot; + bean2</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor2&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(CommonAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// å¤šè¾“å‡ºï¼š&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot; + bean3</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor3&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AnnotationAwareAspectJAutoProxyCreator.class).getBeanDefinition());</span><br><span class="line">    <span class="comment">// åœ¨fooå‰å¤šè¾“å‡ºï¼šbefore...</span></span><br><span class="line">        context.refresh();</span><br><span class="line">        beanFactory.getBean(Bean1.class).foo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        Bean2 bean2;</span><br><span class="line">        Bean3 bean3;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean2</span><span class="params">(Bean2 bean2)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot;</span> + bean2);</span><br><span class="line">            <span class="built_in">this</span>.bean2 = bean2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean3</span><span class="params">(Bean3 bean3)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot;</span> + bean3);</span><br><span class="line">            <span class="built_in">this</span>.bean3 = bean3;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean3</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Aspect</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Aspect1</span> &#123;</span><br><span class="line">            <span class="meta">@Before(&quot;execution(* foo())&quot;)</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;before...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ7-initMessageSource"><a href="#ğŸ7-initMessageSource" class="headerlink" title="ğŸ7. initMessageSource"></a>ğŸ7. initMessageSource</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ä¸º ApplicationContext æ·»åŠ  messageSource æˆå‘˜ï¼Œå®ç°<strong>å›½é™…åŒ–</strong>åŠŸèƒ½</p></blockquote><p>å» beanFactory å†…æ‰¾åä¸º messageSource çš„ beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æä¾›ç©ºçš„ MessageSource å®ç°</p><img src="/img/57880/refresh6.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ8-initApplicationContextEventMulticaster"><a href="#ğŸ8-initApplicationContextEventMulticaster" class="headerlink" title="ğŸ8. initApplicationContextEventMulticaster"></a>ğŸ8. initApplicationContextEventMulticaster</h2><blockquote><p>è¿™ä¸€æ­¥ä¸º ApplicationContext æ·»åŠ <strong>äº‹ä»¶å¹¿æ’­å™¨</strong>æˆå‘˜ï¼Œå³ applicationContextEventMulticasterï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘å¸ƒäº‹ä»¶ç»™ç›‘å¬å™¨</p></blockquote><p>å» beanFactory æ‰¾åä¸º applicationEventMulticaster çš„ bean ä½œä¸ºäº‹ä»¶å¹¿æ’­å™¨ï¼Œè‹¥æ²¡æœ‰ï¼Œä¼šåˆ›å»ºé»˜è®¤çš„äº‹ä»¶å¹¿æ’­å™¨</p><p>ä¹‹åå°±å¯ä»¥è°ƒç”¨ ApplicationContext.publishEvent(äº‹ä»¶å¯¹è±¡) æ¥å‘å¸ƒäº‹ä»¶</p><img src="/img/57880/refresh7.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ9-onRefresh"><a href="#ğŸ9-onRefresh" class="headerlink" title="ğŸ9. onRefresh"></a>ğŸ9. onRefresh</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç©ºå®ç°ï¼Œç•™ç»™å­ç±»æ‰©å±•</p></blockquote><p>SpringBoot ä¸­çš„å­ç±»åœ¨è¿™é‡Œå‡†å¤‡äº† WebServerï¼Œå³å†…åµŒ web å®¹å™¨(Tomcat)</p><p>ä½“ç°çš„æ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</p><h2 id="ğŸ10-registerListeners"><a href="#ğŸ10-registerListeners" class="headerlink" title="ğŸ10. registerListeners"></a>ğŸ10. registerListeners</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šä»å¤šç§é€”å¾„æ‰¾åˆ°äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶æ·»åŠ è‡³ applicationEventMulticaster</p></blockquote><p>äº‹ä»¶ç›‘å¬å™¨é¡¾åæ€ä¹‰ï¼Œç”¨æ¥æ¥æ”¶äº‹ä»¶å¹¿æ’­å™¨å‘å¸ƒçš„äº‹ä»¶ï¼Œæœ‰å¦‚ä¸‹æ¥æº </p><ul><li><ul><li>äº‹å…ˆç¼–ç¨‹æ·»åŠ çš„</li><li>æ¥è‡ªå®¹å™¨ä¸­çš„ bean</li><li>æ¥è‡ªäº @EventListener  çš„è§£æ</li></ul></li></ul><p>è¦å®ç°äº‹ä»¶ç›‘å¬å™¨ï¼Œåªéœ€è¦å®ç° ApplicationListener æ¥å£ï¼Œé‡å†™å…¶ä¸­ onApplicationEvent(E e) æ–¹æ³•å³å¯</p><img src="/img/57880/refresh8.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ11-finishBeanFactoryInitialization"><a href="#ğŸ11-finishBeanFactoryInitialization" class="headerlink" title="ğŸ11. finishBeanFactoryInitialization"></a>ğŸ11. finishBeanFactoryInitialization</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šå°† beanFactory çš„æˆå‘˜è¡¥å……å®Œæ¯•ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰éå»¶è¿Ÿå•ä¾‹ bean</p></blockquote><p>conversionService ä¹Ÿæ˜¯ä¸€å¥—è½¬æ¢æœºåˆ¶ï¼Œä½œä¸ºå¯¹ PropertyEditor çš„è¡¥å……</p><p>embeddedValueResolvers å³<strong>å†…åµŒå€¼</strong>è§£æå™¨ï¼Œç”¨æ¥è§£æ @Value  ä¸­çš„ ${ }ï¼Œå€Ÿç”¨çš„æ˜¯ Environment çš„åŠŸèƒ½ </p><p>singletonObjects å³å•ä¾‹æ± ï¼Œç¼“å­˜æ‰€æœ‰å•ä¾‹å¯¹è±¡ </p><ul><li><ul><li>å¯¹è±¡çš„åˆ›å»ºéƒ½åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œæ¯ä¸€é˜¶æ®µéƒ½æœ‰ä¸åŒçš„ bean åå¤„ç†å™¨å‚ä¸è¿›æ¥ï¼Œæ‰©å±•åŠŸèƒ½</li></ul></li></ul><img src="/img/57880/refresh9.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ12-finishRefresh"><a href="#ğŸ12-finishRefresh" class="headerlink" title="ğŸ12. finishRefresh"></a>ğŸ12. finishRefresh</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šä¸º ApplicationContext æ·»åŠ  lifecycleProcessor æˆå‘˜ï¼Œç”¨æ¥æ§åˆ¶å®¹å™¨å†…<strong>éœ€è¦ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>çš„ bean</p></blockquote><p>å¦‚æœå®¹å™¨ä¸­æœ‰åç§°ä¸º lifecycleProcessor çš„ bean å°±ç”¨å®ƒï¼Œå¦åˆ™åˆ›å»ºé»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨</p><p>å‡†å¤‡å¥½ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼Œå°±å¯ä»¥å®ç° </p><ul><li><ul><li>è°ƒç”¨ context çš„ startï¼Œå³å¯è§¦å‘æ‰€æœ‰å®ç° LifeCycle æ¥å£ bean çš„ start</li><li>è°ƒç”¨ context çš„ stopï¼Œå³å¯è§¦å‘æ‰€æœ‰å®ç° LifeCycle æ¥å£ bean çš„ stop</li></ul></li></ul><p>å‘å¸ƒ ContextRefreshed äº‹ä»¶ï¼Œæ•´ä¸ª refresh æ‰§è¡Œå®Œæˆ</p><img src="/img/57880/refresh10.png" alt="img" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springå¾ªç¯ä¾èµ–</title>
      <link href="/posts/40377/"/>
      <url>/posts/40377/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ"><a href="#ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ" class="headerlink" title="ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ"></a>ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ</h2><p>bean çš„åˆ›å»ºè¦éµå¾ªä¸€å®šçš„æ­¥éª¤ï¼Œå¿…é¡»æ˜¯<strong>åˆ›å»ºã€æ³¨å…¥ã€åˆå§‹åŒ–</strong>ä¸‰æ­¥ï¼Œé¡ºåºä¸èƒ½ä¹±ï¼š</p><img src="/img/40377/ReDI1.png" alt="image-20210903085238916.png" style="zoom: 67%;" /><h3 id="set-æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰"><a href="#set-æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰" class="headerlink" title="set æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰"></a>set æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰</h3><p>å¦‚Aä¸­éœ€è¦setBï¼ŒBä¸­éœ€è¦setAï¼Œè¯´æ˜ï¼š</p><img src="/img/40377/ReDI2.png" alt="image-20210903085454603.png" style="zoom: 50%;" /><p>å¯ä»¥åœ¨ã€a åˆ›å»ºã€‘å’Œã€a set æ³¨å…¥ bã€‘ä¹‹é—´åŠ å…¥ b çš„æ•´ä¸ªæµç¨‹æ¥è§£å†³ ï¼Œã€b set æ³¨å…¥ aã€‘ æ—¶å¯ä»¥æˆåŠŸï¼Œå› ä¸ºä¹‹å‰ a çš„å®ä¾‹å·²ç»åˆ›å»ºå®Œæ¯• ï¼Œè¿™æ · a çš„é¡ºåºï¼ŒåŠ b çš„é¡ºåºéƒ½èƒ½å¾—åˆ°ä¿éšœ</p><h3 id="æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–"><a href="#æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–" class="headerlink" title="æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–"></a>æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–</h3><p>Açš„æ„é€ å‡½æ•°ä¼ å…¥Bï¼ŒBçš„æ„é€ å‡½æ•°ä¼ å…¥Aï¼Œè¯´æ˜ï¼š</p><img src="/img/40377/ReDI3.png" alt="image-20210903085906315.png" style="zoom:50%;" /><h2 id="ğŸè§£å†³setå¾ªç¯ä¾èµ–"><a href="#ğŸè§£å†³setå¾ªç¯ä¾èµ–" class="headerlink" title="ğŸè§£å†³setå¾ªç¯ä¾èµ–"></a>ğŸè§£å†³setå¾ªç¯ä¾èµ–</h2><p>Springæä¾›äº†ä¸‰çº§ç¼“å­˜è§£å†³è¿™ç±»å¾ªç¯ä¾èµ–é—®é¢˜</p><p>ğŸš©æ³¨æ„ï¼šè¿™é‡Œçš„ä¸€çº§äºŒçº§ä¸‰çº§æ¦‚å¿µä¸ä¸€å®šä¸Springç›¸åŒï¼Œé‡è¦çš„æ˜¯ç†è§£æµç¨‹</p><h3 id="ä¸€çº§ç¼“å­˜â€”â€”singletonObjects"><a href="#ä¸€çº§ç¼“å­˜â€”â€”singletonObjects" class="headerlink" title="ä¸€çº§ç¼“å­˜â€”â€”singletonObjects"></a>ä¸€çº§ç¼“å­˜â€”â€”singletonObjects</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Object&gt;(<span class="number">256</span>);</span><br></pre></td></tr></table></figure><p>å·²ç»å®ä¾‹åŒ–å¹¶ä¸”å±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>æˆç†Ÿå¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI4.png" alt="img" style="zoom:67%;" /><p>ä½œç”¨æ˜¯ä¿è¯å•ä¾‹å¯¹è±¡<strong>ä»…è¢«åˆ›å»ºä¸€æ¬¡</strong></p><ul><li>ç¬¬ä¸€æ¬¡èµ° <code>getBean(&quot;a&quot;)</code> æµç¨‹åï¼Œæœ€åä¼šå°†<strong>æˆå“</strong> a æ”¾å…¥ <strong>singletonObjects</strong> ä¸€çº§ç¼“å­˜</li><li>åç»­å†èµ° <code>getBean(&quot;a&quot;)</code> æµç¨‹æ—¶ï¼Œ<strong>å…ˆä»ä¸€çº§ç¼“å­˜ä¸­æ‰¾</strong>ï¼Œè¿™æ—¶å·²ç»æœ‰æˆå“ aï¼Œå°±æ— éœ€å†æ¬¡åˆ›å»º</li></ul><p><strong>ä¸èƒ½è§£å†³setå¾ªç¯ä¾èµ–çš„åŸå› </strong></p><img src="/img/40377/ReDI5.png" alt="img" style="zoom:67%;" /><ul><li>æ— è®ºæ˜¯è·å– bean a è¿˜æ˜¯è·å– bean bï¼Œèµ°çš„æ–¹æ³•éƒ½æ˜¯åŒä¸€ä¸ª getBean æ–¹æ³•ï¼Œå‡è®¾å…ˆèµ° <code>getBean(&quot;a&quot;)</code></li><li>å½“ a çš„å®ä¾‹å¯¹è±¡åˆ›å»ºï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ <code>a.setB()</code> æ—¶ï¼Œéœ€è¦èµ° <code>getBean(&quot;b&quot;)</code> æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 1</li><li>å½“ b çš„å®ä¾‹å¯¹è±¡åˆ›å»ºï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ <code>b.setA()</code> æ—¶ï¼Œåˆå›åˆ°äº† <code>getBean(&quot;a&quot;)</code> çš„æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 2</li><li>ä½†æ­¤æ—¶ singletonObjects ä¸€çº§ç¼“å­˜å†…<strong>æ²¡æœ‰æˆå“</strong>çš„ aï¼Œé™·å…¥äº†æ­»å¾ªç¯</li></ul><h3 id="äºŒçº§ç¼“å­˜â€”â€”singletonFactories"><a href="#äºŒçº§ç¼“å­˜â€”â€”singletonFactories" class="headerlink" title="äºŒçº§ç¼“å­˜â€”â€”singletonFactories"></a>äºŒçº§ç¼“å­˜â€”â€”singletonFactories</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton factories: bean name --&gt; ObjectFactory */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ObjectFactory&lt;?&gt;&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>å•ä¾‹å·¥å‚çš„ç¼“å­˜ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>åŠæˆå“å¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI6.png" alt="img" style="zoom:67%;" /><ul><li>ä¸€çº§ç¼“å­˜ä¸èƒ½è§£å†³setå¾ªç¯ä¾èµ–ï¼Œåˆ™å†å¢åŠ ä¸€ä¸ª <strong>singletonFactories</strong> ç¼“å­˜</li><li>åœ¨ä¾èµ–æ³¨å…¥å‰ï¼Œå³ <code>a.setB()</code> ä»¥åŠ <code>b.setA()</code> å°† a åŠ b çš„<strong>åŠæˆå“å¯¹è±¡</strong>ï¼ˆæœªå®Œæˆä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ï¼‰æ”¾å…¥æ­¤ç¼“å­˜</li><li>æ‰§è¡Œä¾èµ–æ³¨å…¥æ—¶ï¼Œå…ˆçœ‹çœ‹ singletonFactories ç¼“å­˜ä¸­æ˜¯å¦æœ‰<strong>åŠæˆå“çš„å¯¹è±¡</strong>ï¼Œå¦‚æœæœ‰æ‹¿æ¥æ³¨å…¥ï¼Œé¡ºåˆ©èµ°å®Œæµç¨‹</li></ul><p><strong>å¦‚ä½•è§£å†³setå¾ªç¯ä¾èµ–</strong></p><ul><li><code>a = new A()</code> æ‰§è¡Œä¹‹åå°±ä¼šæŠŠè¿™ä¸ªåŠæˆå“çš„ a æ”¾å…¥ <strong>singletonFactories ç¼“å­˜</strong>ï¼Œå³ <code>factories.put(a)</code></li><li>æ¥ä¸‹æ¥æ‰§è¡Œ <code>a.setB()</code>ï¼Œèµ°å…¥ <code>getBean(&quot;b&quot;)</code> æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 3</li><li>è¿™å›å†æ‰§è¡Œåˆ° <code>b.setA()</code> æ—¶ï¼Œéœ€è¦ä¸€ä¸ª a å¯¹è±¡ï¼Œæ­¤æ—¶singletonFactoriesä¸­æœ‰aå¯¹è±¡</li><li><code>factories.get()</code> åœ¨ <strong>singletonFactories  ç¼“å­˜</strong>ä¸­å°±å¯ä»¥æ‰¾åˆ°ï¼Œçº¢è‰²ç®­å¤´ 4 å’Œ 5</li><li>b çš„æµç¨‹èƒ½å¤Ÿé¡ºåˆ©èµ°å®Œï¼Œå°† b æˆå“æ”¾å…¥ singletonObject ä¸€çº§ç¼“å­˜ï¼Œè¿”å›åˆ° a çš„ä¾èµ–æ³¨å…¥æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 6</li></ul><p><strong>äºŒçº§ç¼“å­˜æ— æ³•æ­£ç¡®å¤„ç†setå¾ªç¯ä¾èµ–å¹¶ä¸”åŒ…å«æœ‰ä»£ç†åˆ›å»ºçš„åœºæ™¯</strong></p><img src="/img/40377/ReDI7.png" alt="img" style="zoom:67%;" /><ul><li>spring é»˜è®¤è¦æ±‚ï¼Œåœ¨ <code>a.init</code> å®Œæˆä¹‹åæ‰èƒ½åˆ›å»ºä»£ç† <code>pa = proxy(a)</code></li><li>ç”±äº a çš„ä»£ç†åˆ›å»ºæ—¶æœºé åï¼Œåœ¨æ‰§è¡Œ <code>factories.put(a)</code> å‘ singletonFactories ä¸­æ”¾å…¥çš„è¿˜æ˜¯<strong>åŸå§‹å¯¹è±¡</strong></li><li>æ¥ä¸‹æ¥ç®­å¤´ 3ã€4ã€5 è¿™å‡ æ­¥ b å¯¹è±¡æ‹¿åˆ°å’Œæ³¨å…¥çš„éƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡</li></ul><h3 id="ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects"><a href="#ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects" class="headerlink" title="ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects"></a>ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of early singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>å·²ç»å®ä¾‹åŒ–ä½†å°šæœªå±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>åŠæˆå“å¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI8.png" alt="img" style="zoom:67%;" /><p>æ­£å¸¸åˆ†æçš„è¯ï¼Œåªéœ€è¦å°†ä»£ç†çš„åˆ›å»ºæ—¶æœºæ”¾åœ¨ä¾èµ–æ³¨å…¥ä¹‹å‰å³å¯ï¼Œä½† spring ä»ç„¶å¸Œæœ›<strong>ä»£ç†çš„åˆ›å»ºæ—¶æœºåœ¨ init ä¹‹å</strong>ï¼Œåªæœ‰å‡ºç°å¾ªç¯ä¾èµ–æ—¶ï¼Œæ‰ä¼šå°†ä»£ç†çš„åˆ›å»ºæ—¶æœºæå‰ã€‚æ‰€ä»¥è§£å†³æ€è·¯ç¨æ˜¾å¤æ‚ï¼š</p><ul><li>å›¾ä¸­ <code>factories.put(fa)</code> æ”¾å…¥çš„æ—¢ä¸æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯ä»£ç†å¯¹è±¡è€Œæ˜¯<strong>å·¥å‚å¯¹è±¡ fa</strong></li><li>å½“æ£€æŸ¥å‡ºå‘ç”Ÿ<strong>å¾ªç¯ä¾èµ–æ—¶ï¼Œfa çš„äº§å“å°±æ˜¯ä»£ç† pa</strong>ï¼Œ<strong>æ²¡æœ‰å‘ç”Ÿå¾ªç¯ä¾èµ–ï¼Œfa çš„äº§å“æ˜¯åŸå§‹å¯¹è±¡ a</strong></li><li>å‡è®¾å‡ºç°äº†å¾ªç¯ä¾èµ–ï¼Œæ‹¿åˆ°äº† singletonFactories ä¸­çš„å·¥å‚å¯¹è±¡ï¼Œé€šè¿‡åœ¨ä¾èµ–æ³¨å…¥å‰è·å¾—äº† paï¼Œçº¢è‰²ç®­å¤´ 5</li><li>è¿™å› <code>b.setA()</code> æ³¨å…¥çš„å°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¿è¯äº†æ­£ç¡®æ€§ï¼Œçº¢è‰²ç®­å¤´ 7</li><li>è¿˜éœ€è¦æŠŠ pa å­˜å…¥æ–°åŠ çš„ <strong>earlySingletonObjects ç¼“å­˜</strong>ï¼Œçº¢è‰²ç®­å¤´ 6</li><li><code>a.init</code> å®Œæˆåï¼Œ<strong>æ— éœ€äºŒæ¬¡åˆ›å»ºä»£ç†</strong>ï¼ŒearlySingletonObjects å·²ç»ç¼“å­˜paï¼Œè“è‰²ç®­å¤´ 9</li></ul><p>å½“æˆå“å¯¹è±¡äº§ç”Ÿï¼Œæ”¾å…¥ singletonObject åï¼ŒsingletonFactories å’Œ earlySingletonObjects å°±ä¸­çš„å¯¹è±¡å°±æ²¡æœ‰ç”¨å¤„ï¼Œ<strong>æ¸…é™¤å³å¯</strong></p><p>ğŸš©<strong>æ€»ç»“ï¼šä¸€çº§å•ä¾‹ï¼ŒäºŒçº§setï¼Œä¸‰çº§ä»£ç†</strong></p><h2 id="ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–"><a href="#ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–" class="headerlink" title="ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–"></a>ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–</h2><blockquote><p>å‰é¢çš„ä¸‰çº§ç¼“å­˜æ–¹æ¡ˆå¹¶ä¸èƒ½è§£å†³æ„é€ å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰åˆ«çš„æ–¹æ¡ˆ</p></blockquote><h3 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h3><p>æ€è·¯1</p><ul><li>a æ³¨å…¥ <strong>b çš„ä»£ç†å¯¹è±¡</strong>ï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ a çš„æµç¨‹èµ°é€š</li><li>åç»­éœ€è¦ç”¨åˆ° b çš„çœŸå®å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»£ç†é—´æ¥è®¿é—®</li></ul><img src="/img/40377/ReDI9.png" alt="img" style="zoom:67%;" /><p>æ€è·¯2</p><ul><li>a æ³¨å…¥ <strong>b çš„å·¥å‚å¯¹è±¡</strong>ï¼Œè®© b çš„å®ä¾‹åˆ›å»ºè¢«æ¨è¿Ÿï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ a çš„æµç¨‹å…ˆèµ°é€š</li><li>åç»­éœ€è¦ç”¨åˆ° b çš„çœŸå®å¯¹è±¡æ—¶ï¼Œå†é€šè¿‡ ObjectFactory å·¥å‚é—´æ¥è®¿é—®</li></ul><img src="/img/40377/ReDI10.png" alt="img" style="zoom:67%;" /><h3 id="æ–¹æ¡ˆ1"><a href="#æ–¹æ¡ˆ1" class="headerlink" title="æ–¹æ¡ˆ1"></a>æ–¹æ¡ˆ1</h3><p><strong>ç”¨ @Lazy ä¸ºæ„é€ æ–¹æ³•å‚æ•°ç”Ÿæˆä»£ç†ï¼ˆæ€è·¯1ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> B b;</span><br><span class="line">    <span class="comment">// åˆ›å»ºBçš„ä»£ç†</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(<span class="meta">@Lazy</span> B b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(B b) &#123;&#125;&quot;</span>, b.getClass());</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ2"><a href="#æ–¹æ¡ˆ2" class="headerlink" title="æ–¹æ¡ˆ2"></a>æ–¹æ¡ˆ2</h3><p><strong>ç”¨ ObjectProviderå»¶è¿Ÿä¾èµ–å¯¹è±¡çš„åˆ›å»ºï¼ˆæ€è·¯2ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> ObjectProvider&lt;B&gt; b;</span><br><span class="line">    <span class="comment">// ObjectProvideræ˜¯ObjectFactoryçš„å­ç±»å‹</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(ObjectProvider&lt;B&gt; b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(&#123;&#125;)&quot;</span>, b);</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">    <span class="comment">// b.getObject()è·å¾—çœŸæ­£çš„b</span></span><br><span class="line">        System.out.println(context.getBean(A.class).b.getObject());</span><br><span class="line">        System.out.println(context.getBean(B.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ3"><a href="#æ–¹æ¡ˆ3" class="headerlink" title="æ–¹æ¡ˆ3"></a>æ–¹æ¡ˆ3</h3><p><strong>ç”¨ Provider æ¥å£è§£å†³ï¼ŒåŸç†ä¸Šä¸ ObjectProvider ä¸€æ ·ï¼ŒProvider æ¥å£æ˜¯ç‹¬ç«‹çš„ jar åŒ…ï¼Œéœ€è¦åŠ å…¥ä¾èµ–ï¼ˆæ€è·¯2ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.inject&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.inject&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_4</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> Provider&lt;B&gt; b;</span><br><span class="line">    <span class="comment">// å’ŒObjectProviderä¸€æ ·çš„è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(Provider&lt;B&gt; b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(&#123;&#125;&#125;)&quot;</span>, b);</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">    <span class="comment">// b.get()è·å¾—çœŸæ­£çš„b</span></span><br><span class="line">        System.out.println(context.getBean(A.class).b.get());</span><br><span class="line">        System.out.println(context.getBean(B.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ4"><a href="#æ–¹æ¡ˆ4" class="headerlink" title="æ–¹æ¡ˆ4"></a>æ–¹æ¡ˆ4</h3><p><strong>ç”¨ @Scope äº§ç”Ÿä»£ç†ï¼ˆæ€è·¯1ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        <span class="comment">// æ‰«æBeanå·¥å‚</span></span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(context.getDefaultListableBeanFactory());</span><br><span class="line">        scanner.scan(<span class="string">&quot;com.itheima.app60.sub&quot;</span>);</span><br><span class="line">        context.refresh();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// é…åˆç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> B b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(B b)</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;A(B b) &#123;&#125;&quot;</span>, b.getClass());</span><br><span class="line">        <span class="built_in">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Scope(proxyMode = ScopedProxyMode.TARGET_CLASS)</span> <span class="comment">// äº§ç”ŸBçš„ä»£ç†</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AOPé€šçŸ¥ç±»å‹</title>
      <link href="/posts/39227/"/>
      <url>/posts/39227/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸAOPé€šçŸ¥"><a href="#ğŸAOPé€šçŸ¥" class="headerlink" title="ğŸAOPé€šçŸ¥"></a>ğŸAOPé€šçŸ¥</h2><blockquote><p>AOPé€šçŸ¥<strong>æè¿°äº†æŠ½å–çš„å…±æ€§åŠŸèƒ½</strong>ï¼Œæ ¹æ®å…±æ€§åŠŸèƒ½æŠ½å–çš„ä½ç½®ä¸åŒï¼Œæœ€ç»ˆè¿è¡Œä»£ç æ—¶è¦å°†å…¶åŠ å…¥åˆ°åˆç†çš„ä½ç½®</p></blockquote><p>å…±æœ‰5ç§é€šçŸ¥ç±»å‹:</p><ul><li>å‰ç½®é€šçŸ¥</li><li>åç½®é€šçŸ¥</li><li><strong>ç¯ç»•é€šçŸ¥(é‡ç‚¹)</strong></li><li>è¿”å›åé€šçŸ¥(äº†è§£)</li><li>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥(äº†è§£)</li></ul><p>å›¾ç¤ºï¼š</p><p><img src="/img/39227/AOP1.png" alt="AOP1"></p><p>(1)<code>å‰ç½®é€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œå‰ï¼Œåœ¨ä»£ç 1æˆ–è€…ä»£ç 2æ·»åŠ å†…å®¹</p><p>(2)<code>åç½®é€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œåï¼Œä¸ç®¡æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œï¼Œåœ¨ä»£ç 5æ·»åŠ å†…å®¹</p><p>(3)<code>è¿”å›åé€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œåï¼Œåªæœ‰æ–¹æ³•æ­£å¸¸æ‰§è¡Œç»“æŸåæ‰è¿›è¡Œï¼Œåœ¨ä»£ç 3æ·»åŠ å†…å®¹ï¼Œå¦‚æœæ–¹æ³•æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›åé€šçŸ¥å°†ä¸ä¼šè¢«æ·»åŠ </p><p>(4)<code>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åï¼Œåªæœ‰æ–¹æ³•æ‰§è¡Œå‡ºå¼‚å¸¸æ‰è¿›è¡Œï¼Œåœ¨ä»£ç 4æ·»åŠ å†…å®¹ï¼Œåªæœ‰æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰ä¼šè¢«æ·»åŠ </p><p>(5)<code>ç¯ç»•é€šçŸ¥</code>ï¼šç¯ç»•é€šçŸ¥åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œå®ƒå¯ä»¥è¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œçš„å‰åï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥å®ç°å…¶ä»–å››ç§é€šçŸ¥ç±»å‹çš„åŠŸèƒ½</p><h2 id="ğŸä»£ç æ¼”ç¤ºè¯´æ˜"><a href="#ğŸä»£ç æ¼”ç¤ºè¯´æ˜" class="headerlink" title="ğŸä»£ç æ¼”ç¤ºè¯´æ˜"></a>ğŸä»£ç æ¼”ç¤ºè¯´æ˜</h2><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜å‡ ç§é€šçŸ¥ï¼Œå¼•å…¥ä»£ç ç¤ºä¾‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ¼”ç¤ºï¼Œå‡è®¾å…¶ä»–é…ç½®éƒ½å·²ç»æ­£å¸¸</p><p>æ·»åŠ BookDaoå’ŒBookDaoImplç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select is running ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ é€šçŸ¥ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">// å£°æ˜åˆ‡é¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span> <span class="comment">// åˆ‡å…¥ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ1-å‰ç½®é€šçŸ¥"><a href="#ğŸ1-å‰ç½®é€šçŸ¥" class="headerlink" title="ğŸ1.å‰ç½®é€šçŸ¥"></a>ğŸ1.å‰ç½®é€šçŸ¥</h2><p>åœ¨beforeæ–¹æ³•ä¸Šæ·»åŠ <code>@Beforeæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="comment">//æ­¤å¤„ä¹Ÿå¯ä»¥å†™æˆ @Before(&quot;MyAdvice.pt()&quot;),ä¸å»ºè®®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">before advice ...</span><br><span class="line">book dao update ...</span><br></pre></td></tr></table></figure><h2 id="ğŸ2-åç½®é€šçŸ¥"><a href="#ğŸ2-åç½®é€šçŸ¥" class="headerlink" title="ğŸ2.åç½®é€šçŸ¥"></a>ğŸ2.åç½®é€šçŸ¥</h2><p>åœ¨afteræ–¹æ³•ä¸Šæ·»åŠ <code>@Afteræ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book dao update ...</span><br><span class="line">after advice ...</span><br></pre></td></tr></table></figure><h2 id="ğŸ3-ç¯ç»•é€šçŸ¥"><a href="#ğŸ3-ç¯ç»•é€šçŸ¥" class="headerlink" title="ğŸ3.ç¯ç»•é€šçŸ¥"></a>ğŸ3.ç¯ç»•é€šçŸ¥</h2><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><ul><li>åœ¨aroundæ–¹æ³•ä¸Šæ·»åŠ <code>@Aroundæ³¨è§£</code></li><li>å¿…é¡»è¦èƒ½å¯¹åŸå§‹æ“ä½œè¿›è¡Œè°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºå¯¹åŸå§‹æ“ä½œçš„è°ƒç”¨</span></span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before advice ...</span><br><span class="line">book dao update ...</span><br><span class="line">after advice ...</span><br></pre></td></tr></table></figure><h3 id="åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†"><a href="#åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†" class="headerlink" title="åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†"></a>åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†</h3><p>å¯¹BookDaoä¸­çš„selectæ–¹æ³•æ·»åŠ ç¯ç»•é€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundSelect</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºå¯¹åŸå§‹æ“ä½œçš„è°ƒç”¨</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed(); <span class="comment">// è¿”å›Objectç±»å‹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿”å›Objectæ˜¯Objectç±»å‹æ›´é€šç”¨</p></li><li><p>åœ¨ç¯ç»•é€šçŸ¥ä¸­æ˜¯å¯ä»¥å¯¹åŸå§‹æ–¹æ³•è¿”å›å€¼è¿›è¡Œä¿®æ”¹çš„</p></li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li>ç¯ç»•é€šçŸ¥å¿…é¡»ä¾èµ–å½¢å‚ProceedingJoinPointæ‰èƒ½å®ç°å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿›è€Œå®ç°åŸå§‹æ–¹æ³•è°ƒç”¨å‰ååŒæ—¶æ·»åŠ é€šçŸ¥</li><li>é€šçŸ¥ä¸­å¦‚æœæœªä½¿ç”¨ProceedingJoinPointå¯¹åŸå§‹æ–¹æ³•è¿›è¡Œè°ƒç”¨å°†<strong>è·³è¿‡</strong>åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ</li><li>å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨å¯ä»¥ä¸æ¥æ”¶è¿”å›å€¼ï¼Œé€šçŸ¥æ–¹æ³•è®¾ç½®æˆvoidå³å¯ï¼Œå¦‚æœæ¥æ”¶è¿”å›å€¼ï¼Œæœ€å¥½è®¾å®šä¸ºObjectç±»å‹</li><li>åŸå§‹æ–¹æ³•çš„è¿”å›å€¼å¦‚æœæ˜¯voidç±»å‹ï¼Œé€šçŸ¥æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¯ä»¥è®¾ç½®æˆvoid,ä¹Ÿå¯ä»¥è®¾ç½®æˆObject</li><li>ç”±äºæ— æ³•é¢„çŸ¥åŸå§‹æ–¹æ³•è¿è¡Œåæ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤ç¯ç»•é€šçŸ¥æ–¹æ³•å¿…é¡»è¦å¤„ç†Throwableå¼‚å¸¸</li></ol><h2 id="ğŸ4-è¿”å›åé€šçŸ¥"><a href="#ğŸ4-è¿”å›åé€šçŸ¥" class="headerlink" title="ğŸ4.è¿”å›åé€šçŸ¥"></a>ğŸ4.è¿”å›åé€šçŸ¥</h2><p>åœ¨afterReturningæ–¹æ³•ä¸Šæ·»åŠ <code>@AfterReturningæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book dao select is running ...</span><br><span class="line">afterReturning advice ...</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure><p>åŒºåˆ«ï¼šè¿”å›åé€šçŸ¥æ˜¯éœ€è¦åœ¨åŸå§‹æ–¹æ³•<code>select</code>æ­£å¸¸æ‰§è¡Œåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå¦‚æœ<code>select()</code>æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿”å›åé€šçŸ¥æ˜¯ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>â€‹åç½®é€šçŸ¥æ˜¯ä¸ç®¡åŸå§‹æ–¹æ³•æœ‰æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><h2 id="ğŸ5-å¼‚å¸¸åé€šçŸ¥"><a href="#ğŸ5-å¼‚å¸¸åé€šçŸ¥" class="headerlink" title="ğŸ5.å¼‚å¸¸åé€šçŸ¥"></a>ğŸ5.å¼‚å¸¸åé€šçŸ¥</h2><p>åœ¨afterThrowingæ–¹æ³•ä¸Šæ·»åŠ <code>@AfterThrowingæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// select()æ–¹æ³•ä¸­æ·»åŠ ä¸€è¡Œä»£ç int i = 1/0</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book dao select is running ...</span><br><span class="line">afterThrowing advice ...</span><br><span class="line">Exception in main XXX(å¼‚å¸¸ä»£ç )</span><br></pre></td></tr></table></figure><h2 id="ğŸé€šçŸ¥æ³¨è§£æ€»ç»“"><a href="#ğŸé€šçŸ¥æ³¨è§£æ€»ç»“" class="headerlink" title="ğŸé€šçŸ¥æ³¨è§£æ€»ç»“"></a>ğŸé€šçŸ¥æ³¨è§£æ€»ç»“</h2><h3 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h3><table><thead><tr><th>åç§°</th><th>@Before</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰è¿è¡Œ</td></tr></tbody></table><h3 id="After"><a href="#After" class="headerlink" title="@After"></a>@After</h3><table><thead><tr><th>åç§°</th><th>@After</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•åè¿è¡Œ</td></tr></tbody></table><h3 id="AfterReturning"><a href="#AfterReturning" class="headerlink" title="@AfterReturning"></a>@AfterReturning</h3><table><thead><tr><th>åç§°</th><th>@AfterReturning</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ</td></tr></tbody></table><h3 id="AfterThrowing"><a href="#AfterThrowing" class="headerlink" title="@AfterThrowing"></a>@AfterThrowing</h3><table><thead><tr><th>åç§°</th><th>@AfterThrowing</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•è¿è¡ŒæŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œ</td></tr></tbody></table><h3 id="Around"><a href="#Around" class="headerlink" title="@Around"></a>@Around</h3><table><thead><tr><th>åç§°</th><th>@Around</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰åè¿è¡Œ</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringAOP</title>
      <link href="/posts/19494/"/>
      <url>/posts/19494/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç†è§£AOP"><a href="#ğŸç†è§£AOP" class="headerlink" title="ğŸç†è§£AOP"></a>ğŸç†è§£AOP</h2><h3 id="ä»€ä¹ˆæ˜¯AOPï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯AOPï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯AOPï¼Ÿ"></a>ä»€ä¹ˆæ˜¯AOPï¼Ÿ</h3><blockquote><p>åƒOOP(Object Oriented Programming)é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ï¼Œ<strong>AOP(Aspect Oriented Programming)é¢å‘åˆ‡é¢ç¼–ç¨‹</strong>ï¼Œä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼ŒæŒ‡å¯¼å¼€å‘è€…å¦‚ä½•ç»„ç»‡ç¨‹åºç»“æ„</p></blockquote><h3 id="AOPçš„ä½œç”¨"><a href="#AOPçš„ä½œç”¨" class="headerlink" title="AOPçš„ä½œç”¨"></a>AOPçš„ä½œç”¨</h3><blockquote><p>åœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šä¸ºå…¶è¿›è¡Œ<strong>åŠŸèƒ½å¢å¼º</strong></p><p>å®ç°è¿™æ ·çš„åŠŸèƒ½å³<strong>ä»£ç†æ¨¡å¼</strong></p></blockquote><h3 id="AOPçš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#AOPçš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="AOPçš„æ ¸å¿ƒæ¦‚å¿µ"></a>AOPçš„æ ¸å¿ƒæ¦‚å¿µ</h3><p>ç›´æ¥è§£é‡ŠAOPçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œå…ˆä»ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹è¯´èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è®°å½•ç¨‹åºå½“å‰æ‰§è¡Œæ‰§è¡Œï¼ˆå¼€å§‹æ—¶é—´ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//ä¸šåŠ¡æ‰§è¡Œä¸‡æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">10000</span>;i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è®°å½•ç¨‹åºå½“å‰æ‰§è¡Œæ—¶é—´ï¼ˆç»“æŸæ—¶é—´ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//è®¡ç®—æ—¶é—´å·®</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalTime</span> <span class="operator">=</span> endTime-startTime;</span><br><span class="line">        <span class="comment">//è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œä¸‡æ¬¡æ¶ˆè€—æ—¶é—´ï¼š&quot;</span> + totalTime + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao delete ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ˜¯åœ¨BookDaoImplä¸­å¯¹<code>save</code>æ–¹æ³•ä¸­æœ‰è®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>ä½†æ˜¯ä»å®¹å™¨ä¸­è·å–bookDaoå¯¹è±¡åï¼Œåˆ†åˆ«æ‰§è¡Œå…¶<code>save</code>,<code>delete</code>,<code>update</code>å’Œ<code>select</code>æ–¹æ³•ï¼Œä¼šæœ‰ä»¥ä¸‹ç»“æœï¼š</p><p><img src="/img/19494/AOP1.png" alt="AOP1"></p><p>å¯¹äºè®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´åªæœ‰saveæ–¹æ³•æœ‰ï¼Œä¸ºä»€ä¹ˆdeleteå’Œupdateæ–¹æ³•ä¹Ÿä¼šæœ‰å‘¢?</p><p>å®é™…ä¸Šè¿™é‡Œå°±æ˜¯ä½¿ç”¨äº†Springçš„AOPï¼Œåœ¨ä¸æƒŠåŠ¨åŸæœ‰è®¾è®¡(ä»£ç )çš„å‰æä¸‹ï¼Œæƒ³ç»™è°æ·»åŠ åŠŸèƒ½å°±ç»™è°æ·»åŠ ï¼Œå³<code>æ— å…¥ä¾µå¼</code></p><p><strong>æ ¸å¿ƒæ¦‚å¿µå¼•å…¥</strong></p><p><img src="/img/19494/AOP2.png" alt="AOP2"></p><p>(1)å¯¹ä¸Šé¢çš„æ¡ˆä¾‹ä¸­BookServiceImplä¸­æœ‰<code>save</code>,<code>update</code>,<code>delete</code>å’Œ<code>select</code>æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç§°ä¸º<code>è¿æ¥ç‚¹</code></p><p>(2)åœ¨BookServiceImplçš„å››ä¸ªæ–¹æ³•ä¸­ï¼Œ<code>update</code>å’Œ<code>delete</code>åªæœ‰æ‰“å°æ²¡æœ‰è®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—æ—¶é—´ï¼Œä½†æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™å·²ç»æœ‰è¯¥åŠŸèƒ½ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´<code>update</code>å’Œ<code>delete</code>æ–¹æ³•éƒ½å·²ç»è¢«å¢å¼ºï¼Œæ‰€ä»¥å¯¹äºéœ€è¦å¢å¼ºçš„æ–¹æ³•ç§°ä¸º<code>åˆ‡å…¥ç‚¹</code></p><p>(3)æ‰§è¡ŒBookServiceImplçš„updateå’Œdeleteæ–¹æ³•çš„æ—¶å€™éƒ½è¢«æ·»åŠ äº†ä¸€ä¸ªè®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—æ—¶é—´çš„åŠŸèƒ½ï¼Œå°†è¿™ä¸ªåŠŸèƒ½æŠ½å–åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œæ¢å¥è¯è¯´å°±æ˜¯<strong>å­˜æ”¾å…±æ€§åŠŸèƒ½çš„æ–¹æ³•</strong>ï¼Œç§°ä¸º<code>é€šçŸ¥</code></p><p>(4)é€šçŸ¥æ˜¯è¦å¢å¼ºçš„å†…å®¹ï¼Œä¼šæœ‰å¤šä¸ªï¼Œåˆ‡å…¥ç‚¹æ˜¯éœ€è¦è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œä¹Ÿä¼šæœ‰å¤šä¸ªï¼Œé‚£å“ªä¸ªåˆ‡å…¥ç‚¹éœ€è¦æ·»åŠ å“ªä¸ªé€šçŸ¥ï¼Œå°±éœ€è¦æå‰å°†å®ƒä»¬ä¹‹é—´çš„å…³ç³»æè¿°æ¸…æ¥šï¼Œé‚£ä¹ˆå¯¹äºé€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»æè¿°ï¼Œç§°ä¸º<code>åˆ‡é¢</code></p><p>(5)é€šçŸ¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½ç‹¬ç«‹å­˜åœ¨éœ€è¦è¢«å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»ç§°ä¸º<code>é€šçŸ¥ç±»</code></p><p><strong>æ ¸å¿ƒæ¦‚å¿µæ€»ç»“</strong></p><p>**è¿æ¥ç‚¹(JoinPoint)**ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»æ„ä½ç½®ï¼Œç²’åº¦ä¸ºæ‰§è¡Œæ–¹æ³•ã€æŠ›å‡ºå¼‚å¸¸ã€è®¾ç½®å˜é‡ç­‰</p><ul><li>åœ¨SpringAOPä¸­ï¼Œç†è§£ä¸ºæ–¹æ³•çš„æ‰§è¡Œ</li></ul><p>**åˆ‡å…¥ç‚¹(Pointcut)**ï¼šåŒ¹é…è¿æ¥ç‚¹çš„å¼å­</p><ul><li>åœ¨SpringAOPä¸­ï¼Œä¸€ä¸ªåˆ‡å…¥ç‚¹å¯ä»¥æè¿°ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä¹ŸåŒ¹é…å¤šä¸ªæ–¹æ³•<ul><li>ä¸€ä¸ªå…·ä½“çš„æ–¹æ³•:å¦‚com.daoåŒ…ä¸‹çš„BookDaoæ¥å£ä¸­çš„æ— å½¢å‚æ— è¿”å›å€¼çš„saveæ–¹æ³•</li><li>åŒ¹é…å¤šä¸ªæ–¹æ³•:æ‰€æœ‰çš„saveæ–¹æ³•ï¼Œæ‰€æœ‰çš„getå¼€å¤´çš„æ–¹æ³•ï¼Œæ‰€æœ‰ä»¥Daoç»“å°¾çš„æ¥å£ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œæ‰€æœ‰å¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•</li></ul></li><li>è¿æ¥ç‚¹èŒƒå›´è¦æ¯”åˆ‡å…¥ç‚¹èŒƒå›´å¤§ï¼Œæ˜¯åˆ‡å…¥ç‚¹çš„æ–¹æ³•ä¹Ÿä¸€å®šæ˜¯è¿æ¥ç‚¹ï¼Œä½†æ˜¯æ˜¯è¿æ¥ç‚¹çš„æ–¹æ³•å°±ä¸ä¸€å®šè¦è¢«å¢å¼ºï¼Œæ‰€ä»¥å¯èƒ½ä¸æ˜¯åˆ‡å…¥ç‚¹ã€‚</li></ul><p><strong>é€šçŸ¥(Advice)</strong>:åœ¨åˆ‡å…¥ç‚¹å¤„æ‰§è¡Œçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½</p><ul><li>åœ¨SpringAOPä¸­ï¼ŒåŠŸèƒ½æœ€ç»ˆä»¥æ–¹æ³•çš„å½¢å¼å‘ˆç°</li></ul><p><strong>é€šçŸ¥ç±»</strong>ï¼šå®šä¹‰é€šçŸ¥çš„ç±»</p><p><strong>åˆ‡é¢(Aspect)</strong>:æè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="ğŸAOPæ¡ˆä¾‹"><a href="#ğŸAOPæ¡ˆä¾‹" class="headerlink" title="ğŸAOPæ¡ˆä¾‹"></a>ğŸAOPæ¡ˆä¾‹</h2><h3 id="å‰ç½®è¯´æ˜"><a href="#å‰ç½®è¯´æ˜" class="headerlink" title="å‰ç½®è¯´æ˜"></a>å‰ç½®è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°æœ‰æ¥å£BookDaoå’Œå…¶å®ç°ç±»BookDaoImpl</p><p>ç›®å‰æ‰“å°saveæ–¹æ³•çš„æ—¶å€™ï¼Œå› ä¸ºæ–¹æ³•ä¸­æœ‰æ‰“å°ç³»ç»Ÿæ—¶é—´ï¼Œæ‰€ä»¥è¿è¡Œçš„æ—¶å€™æ˜¯å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ—¶é—´ï¼Œå¯¹äºupdateæ–¹æ³•æ¥è¯´ï¼Œå°±æ²¡æœ‰è¯¥åŠŸèƒ½ã€‚ä½¿ç”¨SpringAOPçš„æ–¹å¼åœ¨ä¸æ”¹å˜updateæ–¹æ³•çš„å‰æä¸‹è®©å…¶å…·æœ‰æ‰“å°ç³»ç»Ÿæ—¶é—´çš„åŠŸèƒ½ã€‚</p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><p>ä»…è¯´æ˜AOPç›¸å…³çš„é…ç½®ï¼Œé»˜è®¤ä¾èµ–ç­‰å…¨éƒ¨é…ç½®å®Œæ¯•</p><h4 id="1-å®šä¹‰é€šçŸ¥ç±»"><a href="#1-å®šä¹‰é€šçŸ¥ç±»" class="headerlink" title="1.å®šä¹‰é€šçŸ¥ç±»"></a>1.å®šä¹‰é€šçŸ¥ç±»</h4><p>é€šçŸ¥å°±æ˜¯å°†å…±æ€§åŠŸèƒ½æŠ½å–å‡ºæ¥åå½¢æˆçš„æ–¹æ³•ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯å½“å‰ç³»ç»Ÿæ—¶é—´çš„æ‰“å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»åå’Œæ–¹æ³•åæ— è¦æ±‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-å®šä¹‰åˆ‡å…¥ç‚¹"><a href="#2-å®šä¹‰åˆ‡å…¥ç‚¹" class="headerlink" title="2.å®šä¹‰åˆ‡å…¥ç‚¹"></a>2.å®šä¹‰åˆ‡å…¥ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="comment">// è¦å¢å¼ºçš„æ˜¯updateæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ‡å…¥ç‚¹å®šä¹‰ä¾æ‰˜ä¸€ä¸ªä¸å…·æœ‰å®é™…æ„ä¹‰çš„æ–¹æ³•è¿›è¡Œï¼Œå³<strong>æ— å‚æ•°ã€æ— è¿”å›å€¼ã€æ–¹æ³•ä½“æ— å®é™…é€»è¾‘</strong>ã€‚</li><li><strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼execution</strong>(@Pointcutä¸­çš„å†…å®¹)æœ‰ä¸“é—¨çš„ç¼–å†™æ ¼å¼</li></ul><h4 id="3-åˆ¶ä½œåˆ‡é¢"><a href="#3-åˆ¶ä½œåˆ‡é¢" class="headerlink" title="3.åˆ¶ä½œåˆ‡é¢"></a>3.åˆ¶ä½œåˆ‡é¢</h4><p>åˆ‡é¢æ˜¯ç”¨æ¥æè¿°é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Beforeæè¿°é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»</span></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»‘å®šåˆ‡å…¥ç‚¹ä¸é€šçŸ¥å…³ç³»ï¼Œå¹¶æŒ‡å®šé€šçŸ¥æ·»åŠ åˆ°åŸå§‹è¿æ¥ç‚¹çš„å…·ä½“æ‰§è¡Œ<code>ä½ç½®</code></p><p><img src="/img/19494/AOP3.png" alt="AOP3"></p><p>ğŸš©@Beforeç¿»è¯‘è¿‡æ¥æ˜¯ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´é€šçŸ¥ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œé™¤æ­¤ä¹‹å‰è¿˜æœ‰å…¶ä»–å››ç§ç±»å‹ï¼Œè¿™å°±æ˜¯<code>é€šçŸ¥ç±»å‹</code></p><h4 id="4-å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»"><a href="#4-å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»" class="headerlink" title="4.å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»"></a>4.å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ å…¥ä»¥ä¸‹ä¸¤ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½"><a href="#5-å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½" class="headerlink" title="5.å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½"></a>5.å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="comment">// åŠ å…¥æ­¤æ³¨è§£</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-è¿è¡ŒAppç±»"><a href="#6-è¿è¡ŒAppç±»" class="headerlink" title="6.è¿è¡ŒAppç±»"></a>6.è¿è¡ŒAppç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line">        bookDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1618998676535</span><br><span class="line">book dao update ...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨updateæ–¹æ³•å‰åŠ å…¥äº†æ—¶é—´æˆ³ï¼Œæ–¹æ³•å¢å¼ºæˆåŠŸã€‚</p><h2 id="ğŸæ³¨è§£è¯´æ˜"><a href="#ğŸæ³¨è§£è¯´æ˜" class="headerlink" title="ğŸæ³¨è§£è¯´æ˜"></a>ğŸæ³¨è§£è¯´æ˜</h2><h3 id="EnableAspectJAutoProxy"><a href="#EnableAspectJAutoProxy" class="headerlink" title="@EnableAspectJAutoProxy"></a>@EnableAspectJAutoProxy</h3><table><thead><tr><th>åç§°</th><th>@EnableAspectJAutoProxy</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>é…ç½®ç±»æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é…ç½®ç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½</td></tr></tbody></table><h3 id="Aspect"><a href="#Aspect" class="headerlink" title="@Aspect"></a>@Aspect</h3><table><thead><tr><th>åç§°</th><th>@Aspect</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>ç±»æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>åˆ‡é¢ç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰ç±»ä¸ºAOPåˆ‡é¢ç±»</td></tr></tbody></table><h3 id="Pointcut"><a href="#Pointcut" class="headerlink" title="@Pointcut"></a>@Pointcut</h3><table><thead><tr><th>åç§°</th><th>@Pointcut</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>åˆ‡å…¥ç‚¹æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®åˆ‡å…¥ç‚¹æ–¹æ³•</td></tr><tr><td>å±æ€§</td><td>valueï¼ˆé»˜è®¤ï¼‰ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</td></tr></tbody></table><h3 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h3><table><thead><tr><th>åç§°</th><th>@Before</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰è¿è¡Œ</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ³¨è§£æ³¨å…¥æ¯”è¾ƒ</title>
      <link href="/posts/24359/"/>
      <url>/posts/24359/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ-Autowired"><a href="#ğŸ-Autowired" class="headerlink" title="ğŸ@Autowired"></a>ğŸ@Autowired</h2><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p><strong>å­—æ®µå±æ€§ä¸Šæ–¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br></pre></td></tr></table></figure><p><strong>setæ–¹æ³•ä¸Šæ–¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="keyword">public</span> HelloDao <span class="title function_">getHelloDao</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> helloDao;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloDao</span><span class="params">(HelloDao helloDao)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.helloDao = helloDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•å½¢å‚å‰é¢</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private HelloDao helloDao;</span><br><span class="line">//@Autowired</span><br><span class="line">public HelloServiceImpl(@Autowired HelloDao helloDao) &#123;</span><br><span class="line">this.helloDao = helloDao;</span><br><span class="line">&#125;</span><br><span class="line">// æ„é€ å™¨æ³¨å…¥ä¹Ÿå¯ä¸å†™@Autowiredï¼Œä¹Ÿå¯ä»¥æ³¨å…¥æˆåŠŸã€‚</span><br></pre></td></tr></table></figure><p>ğŸš©å°†@Autowiredå†™åœ¨è¢«æ³¨å…¥çš„æˆå‘˜å˜é‡ä¸Šï¼Œsetteræˆ–è€…æ„é€ å™¨ä¸Šï¼Œå°±ä¸ç”¨åœ¨xmlæ–‡ä»¶ä¸­é…ç½®</p><h3 id="ç±»å‹ç›¸åŒé—®é¢˜"><a href="#ç±»å‹ç›¸åŒé—®é¢˜" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™é»˜è®¤æ ¹æ®<strong>è®¾å®šçš„å±æ€§åç§°</strong>è¿›è¡Œè·å–ã€‚é…åˆ**@Qualifier**ä½¿ç”¨ï¼Œ@Qualifier(â€œXXXâ€) ä¸­çš„ XXæ˜¯ Bean çš„åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;helloWorldDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="comment">// å‘ç°å¤šä¸ªHelloDao,æ³¨å…¥åç§°ä¸ºhelloWorldDao çš„Beanç»„ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="SpringBootä¸­çš„ä½¿ç”¨"><a href="#SpringBootä¸­çš„ä½¿ç”¨" class="headerlink" title="SpringBootä¸­çš„ä½¿ç”¨"></a>SpringBootä¸­çš„ä½¿ç”¨</h3><p>ä½¿ç”¨@Bean+@Autowiredè¿›è¡Œç»„ä»¶æ³¨å…¥ï¼Œå°†@AutowiredåŠ åˆ°å‚æ•°ä¸Šï¼Œä¹Ÿå¯ä»¥çœç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Person <span class="title function_">getPerson</span><span class="params">(<span class="meta">@Autowired</span> Car car)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @Autowiredå¯ä»¥çœç•¥</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Autowiredæ˜¯<strong>Springè‡ªå¸¦</strong>çš„æ³¨è§£ï¼Œé€šè¿‡AutowiredAnnotationBeanPostProcessor ç±»å®ç°çš„ä¾èµ–æ³¨å…¥</p><p>2ã€@Autowiredå¯ä»¥ä½œç”¨åœ¨CONSTRUCTORã€METHODã€PARAMETERã€FIELDã€ANNOTATION_TYPE</p><p>3ã€@Autowiredé»˜è®¤æ˜¯<strong>æ ¹æ®ç±»å‹ï¼ˆbyType ï¼‰</strong>è¿›è¡Œè‡ªåŠ¨è£…é…çš„</p><p>4ã€å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œéœ€è¦æŒ‡å®šæŒ‰ç…§åç§°ï¼ˆbyName ï¼‰è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ**@Qualifier**</p><h2 id="ğŸ-Resource"><a href="#ğŸ-Resource" class="headerlink" title="ğŸ@Resource"></a>ğŸ@Resource</h2><h3 id="ä½¿ç”¨æ–¹å¼-1"><a href="#ä½¿ç”¨æ–¹å¼-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹ç›¸åŒé—®é¢˜-1"><a href="#ç±»å‹ç›¸åŒé—®é¢˜-1" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>é»˜è®¤æ ¹æ®å±æ€§åç§°è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡<strong>name</strong>è¿›è¡ŒæŒ‡å®šè¿›è¡Œæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;BMW&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‰ç…§å±æ€§åç§° car æ³¨å…¥å®¹å™¨ä¸­çš„ç»„ä»¶ã€‚å¦‚æœå®¹å™¨ä¸­BMWè¿˜æœ‰BYDä¸¤ç§ç±»å‹ç»„ä»¶ã€‚æŒ‡å®šåŠ å…¥BMW</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Resourceåœ¨javax.annotationåŒ…ä¸‹</p><p>2ã€@Resourceå¯ä»¥ä½œç”¨TYPEã€FIELDã€METHODä¸Š</p><p>3ã€@Resourceæ˜¯é»˜è®¤æ ¹æ®å±æ€§åç§°è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡nameè¿›è¡ŒæŒ‡å®šè¿›è¡Œæ³¨å…¥</p><h2 id="ğŸ-Inject-äº†è§£"><a href="#ğŸ-Inject-äº†è§£" class="headerlink" title="ğŸ@Inject(äº†è§£)"></a>ğŸ@Inject(äº†è§£)</h2><h3 id="ä½¿ç”¨æ–¹å¼-2"><a href="#ä½¿ç”¨æ–¹å¼-2" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹ç›¸åŒé—®é¢˜-2"><a href="#ç±»å‹ç›¸åŒé—®é¢˜-2" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>é»˜è®¤æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Named(&quot;BMW&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Injectéœ€è¦å¯¼å…¥javax.inject.Inject jaråŒ…</p><p>2ã€@Injectå¯ä»¥ä½œç”¨CONSTRUCTORã€METHODã€FIELDä¸Š</p><p>3ã€@Injectæ˜¯æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringIOC</title>
      <link href="/posts/17382/"/>
      <url>/posts/17382/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç†è§£IOC"><a href="#ğŸç†è§£IOC" class="headerlink" title="ğŸç†è§£IOC"></a>ğŸç†è§£IOC</h2><h3 id="IOCæ¦‚å¿µ"><a href="#IOCæ¦‚å¿µ" class="headerlink" title="IOCæ¦‚å¿µ"></a>IOCæ¦‚å¿µ</h3><blockquote><p>Inversion of Controlï¼Œâ€œæ§åˆ¶åè½¬â€ï¼Œ<strong>æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³</strong>ã€‚</p><p>å°†è®¾è®¡å¥½çš„å¯¹è±¡äº¤ç»™å®¹å™¨æ§åˆ¶ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„åœ¨å¯¹è±¡å†…éƒ¨ç›´æ¥æ§åˆ¶ã€‚</p></blockquote><p>ä¼ ç»Ÿåº”ç”¨ç¨‹åºæ˜¯ç”±æˆ‘ä»¬è‡ªå·±åœ¨å¯¹è±¡ä¸­ä¸»åŠ¨æ§åˆ¶å»ç›´æ¥è·å–ä¾èµ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ­£è½¬ï¼›è€Œåè½¬åˆ™æ˜¯ç”±å®¹å™¨æ¥å¸®å¿™åˆ›å»ºåŠæ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>ä¼ ç»Ÿç¨‹åºè®¾è®¡æ˜¯ä¸»åŠ¨å»åˆ›å»ºç›¸å…³å¯¹è±¡ç„¶åå†ç»„åˆèµ·æ¥ï¼š</p><p><img src="/img/17382/spring-framework-ioc-1.png" alt="spring-framework-ioc-1"></p><p>æœ‰äº†IoC&#x2F;DIçš„å®¹å™¨åï¼Œåœ¨å®¢æˆ·ç«¯ç±»ä¸­ä¸å†ä¸»åŠ¨å»åˆ›å»ºè¿™äº›å¯¹è±¡ï¼š</p><p><img src="/img/17382/spring-framework-ioc-2.png" alt="spring-framework-ioc-2"></p><p>ğŸš©<strong>ä¼˜ç‚¹ï¼šæŠŠåˆ›å»ºå’ŒæŸ¥æ‰¾ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™äº†å®¹å™¨ï¼Œç”±å®¹å™¨è¿›è¡Œæ³¨å…¥ç»„åˆå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´æ˜¯æ¾æ•£è€¦åˆï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æµ‹è¯•ï¼Œåˆ©äºåŠŸèƒ½å¤ç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ä½¿å¾—ç¨‹åºçš„æ•´ä¸ªä½“ç³»ç»“æ„å˜å¾—éå¸¸çµæ´»</strong>ã€‚</p><h3 id="DIæ¦‚å¿µ"><a href="#DIæ¦‚å¿µ" class="headerlink" title="DIæ¦‚å¿µ"></a>DIæ¦‚å¿µ</h3><blockquote><p>Dependency Injectionï¼Œå³ä¾èµ–æ³¨å…¥ï¼šç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸå†³å®šï¼Œå³ç”±å®¹å™¨åŠ¨æ€çš„å°†æŸä¸ªä¾èµ–å…³ç³»æ³¨å…¥åˆ°ç»„ä»¶ä¹‹ä¸­ã€‚</p></blockquote><p>åº”ç”¨ç¨‹åº<strong>ä¾èµ–</strong>äºIoCå®¹å™¨ï¼ŒIoCå®¹å™¨<strong>æ³¨å…¥</strong>åº”ç”¨ç¨‹åºæŸä¸ªå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºä¾èµ–çš„å¯¹è±¡ã€‚</p><p>ğŸš©<strong>ä¼˜ç‚¹ï¼šåªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°</strong>ã€‚</p><p>ğŸš©<strong>IoCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼</strong></p><h2 id="ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼"><a href="#ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼"></a>ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼</h2><h3 id="xmlé…ç½®"><a href="#xmlé…ç½®" class="headerlink" title="xmlé…ç½®"></a>xmlé…ç½®</h3><blockquote><p>å°†beançš„ä¿¡æ¯é…ç½®.xmlæ–‡ä»¶é‡Œï¼Œé€šè¿‡SpringåŠ è½½æ–‡ä»¶ä¸ºæˆ‘ä»¬åˆ›å»ºbeanã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>é…ç½®xx.xmlæ–‡ä»¶</li><li>å£°æ˜å‘½åç©ºé—´å’Œé…ç½®bean</li></ol><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥é€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œé€šä¿—æ˜“æ‡‚ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š é…ç½®ç¹çï¼Œä¸æ˜“ç»´æŠ¤ï¼Œæ¯ç‡¥æ— å‘³ï¼Œæ‰©å±•æ€§å·®ã€‚</li></ul><h3 id="Java-é…ç½®"><a href="#Java-é…ç½®" class="headerlink" title="Java é…ç½®"></a>Java é…ç½®</h3><blockquote><p>å°†ç±»çš„åˆ›å»ºäº¤ç»™æˆ‘ä»¬é…ç½®çš„<strong>JavaConfigç±»</strong>æ¥å®Œæˆï¼ŒSpringåªè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œ æ·»åŠ **@Configurationæ³¨è§£**å£°æ˜ä¸ºé…ç½®ç±»ã€‚</li><li>åˆ›å»ºæ–¹æ³•ï¼Œæ–¹æ³•ä¸ŠåŠ ä¸Š**@bean**ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›ï¼Œè¯¥å®ä¾‹åˆ›å»ºåä¼šäº¤ç»™springç®¡ç†ï¼Œæ–¹æ³•åå»ºè®®ä¸å®ä¾‹åç›¸åŒï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚æ³¨ï¼šå®ä¾‹ç±»ä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£ã€‚</li></ol><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userDao&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDaoImpl <span class="title function_">userDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user service</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserServiceImpl <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        userService.setUserDao(userDao());</span><br><span class="line">        <span class="keyword">return</span> userService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šé€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œé…ç½®æ–¹ä¾¿ï¼Œå› ä¸ºæ˜¯çº¯Javaä»£ç ï¼Œæ‰©å±•æ€§é«˜ï¼Œååˆ†çµæ´»ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç”±äºæ˜¯é‡‡ç”¨Javaç±»çš„æ–¹å¼ï¼Œå£°æ˜ä¸æ˜æ˜¾ï¼Œå¦‚æœå¤§é‡é…ç½®ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®ã€‚</li></ul><h3 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h3><blockquote><p>é€šè¿‡åœ¨ç±»ä¸ŠåŠ æ³¨è§£çš„æ–¹å¼ï¼Œæ¥å£°æ˜ä¸€ä¸ªç±»äº¤ç»™Springç®¡ç†ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æå¸¦æœ‰**@Componentï¼Œ@Controllerï¼Œ@Serviceï¼Œ@Repository**è¿™å››ä¸ªæ³¨è§£çš„ç±»ï¼Œç„¶åå¸®æˆ‘ä»¬åˆ›å»ºå¹¶ç®¡ç†ï¼Œå‰ææ˜¯éœ€è¦å…ˆé…ç½®Springçš„æ³¨è§£æ‰«æå™¨ã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ul><li>å¯¹ç±»æ·»åŠ @Componentç›¸å…³çš„æ³¨è§£ï¼Œæ¯”å¦‚@Controllerï¼Œ@Serviceï¼Œ@Repositoryã€‚</li><li>è®¾ç½®ComponentScançš„basePackage, æ¯”å¦‚<code>&lt;context:component-scan base-package=&#39;tech.pdai.springframework&#39;&gt;</code>, æˆ–è€…<code>@ComponentScan(&quot;tech.pdai.springframework&quot;)</code>æ³¨è§£ï¼Œæˆ–è€… <code>new AnnotationConfigApplicationContext(&quot;tech.pdai.springframework&quot;)</code>æŒ‡å®šæ‰«æçš„basePackageã€‚</li></ul><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¼€å‘ä¾¿æ·ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå…·æœ‰å±€é™æ€§ï¼Œå¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºï¼Œæ— æ³•æ·»åŠ æ³¨è§£ã€‚åªèƒ½é‡‡ç”¨XMLæˆ–JavaConfigçš„æ–¹å¼é…ç½®ã€‚</li></ul><h2 id="ğŸDIçš„ä¸‰ç§æ–¹å¼"><a href="#ğŸDIçš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ğŸDIçš„ä¸‰ç§æ–¹å¼"></a>ğŸDIçš„ä¸‰ç§æ–¹å¼</h2><h3 id="setteræ³¨å…¥"><a href="#setteræ³¨å…¥" class="headerlink" title="setteræ³¨å…¥"></a>setteræ³¨å…¥</h3><p><strong>æ­¥éª¤ï¼š</strong></p><ul><li><p>éœ€è¦new UserServiceImpl()åˆ›å»ºå¯¹è±¡, æ‰€ä»¥éœ€è¦é»˜è®¤æ„é€ å‡½æ•°</p></li><li><p>è°ƒç”¨setUserDao()å‡½æ•°æ³¨å…¥userDaoçš„å€¼, æ‰€ä»¥éœ€è¦setUserDao()å‡½æ•°</p></li></ul><p><strong>ä»£ç ï¼š</strong></p><p>åœ¨XMLé…ç½®ä¸­ï¼Œpropertyéƒ½æ˜¯setteræ–¹å¼æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„serviceç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set dao.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDao user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDaoImpl userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ å‡½æ•°æ³¨å…¥"><a href="#æ„é€ å‡½æ•°æ³¨å…¥" class="headerlink" title="æ„é€ å‡½æ•°æ³¨å…¥"></a>æ„é€ å‡½æ•°æ³¨å…¥</h3><p>XMLé…ç½®ä¸­ï¼Œ<code>&lt;constructor-arg&gt;</code>æ˜¯é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„serviceç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDaoImpl user dao impl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserDaoImpl userDaoImpl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDaoImpl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ‡ç­¾<code>&lt;constructor-arg&gt;</code>ä¸­</p><ul><li>nameå±æ€§å¯¹åº”çš„å€¼ä¸ºæ„é€ å‡½æ•°ä¸­æ–¹æ³•<strong>å½¢å‚çš„å‚æ•°å</strong>ï¼Œå¿…é¡»è¦ä¿æŒä¸€è‡´ã€‚</li><li>refå±æ€§æŒ‡å‘çš„æ˜¯springçš„IOCå®¹å™¨ä¸­å…¶ä»–beanå¯¹è±¡ã€‚</li></ul><h3 id="æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰"><a href="#æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰" class="headerlink" title="æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰"></a>æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰</h3><p>@Autowiredæœ€å¸¸ç”¨ï¼Œä¿®é¥°ç¬¦æœ‰ä¸‰ä¸ªå±æ€§ï¼šConstructorï¼ŒbyTypeï¼ŒbyNameã€‚é»˜è®¤æŒ‰ç…§<strong>byType</strong>æ³¨å…¥ã€‚</p><ul><li><strong>constructor</strong>ï¼šé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œspringä¼šåŒ¹é…ä¸æ„é€ æ–¹æ³•å‚æ•°ç±»å‹ä¸€è‡´çš„beanè¿›è¡Œæ³¨å…¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¤šå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåœ¨å®¹å™¨ä¸­æŸ¥æ‰¾åˆ°å¤šä¸ªåŒ¹é…å¤šå‚æ•°æ„é€ æ–¹æ³•çš„beanï¼Œé‚£ä¹ˆspringä¼šä¼˜å…ˆå°†beanæ³¨å…¥åˆ°<strong>å¤šå‚æ•°çš„æ„é€ æ–¹æ³•</strong>ä¸­ã€‚</li><li><strong>byName</strong>ï¼šè¢«æ³¨å…¥beançš„idåå¿…é¡»ä¸setæ–¹æ³•<strong>ååŠæˆªåŒ¹é…</strong>ï¼Œå¹¶ä¸”idåç§°çš„ç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å¿…é¡»å°å†™ï¼Œè¿™ä¸€ç‚¹ä¸æ‰‹åŠ¨setæ³¨å…¥æœ‰ç‚¹ä¸åŒã€‚</li><li><strong>byType</strong>ï¼šæŸ¥æ‰¾æ‰€æœ‰çš„setæ–¹æ³•ï¼Œå°†ç¬¦åˆå‚æ•°ç±»å‹çš„beanæ³¨å…¥ã€‚</li></ul><p>ä»£ç ï¼š</p><p>åœ¨Serviceç±»ä¸­ï¼ˆåœ¨å¼€å‘ä¸­æœ€å¸¸è§çš„æƒ…å†µï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadPoolExecutor</title>
      <link href="/posts/47319/"/>
      <url>/posts/47319/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸThreadPoolExecutorç®€ä»‹"><a href="#ğŸThreadPoolExecutorç®€ä»‹" class="headerlink" title="ğŸThreadPoolExecutorç®€ä»‹"></a>ğŸThreadPoolExecutorç®€ä»‹</h3><p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleThreadPool</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Runnable</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkerThread</span>(<span class="string">&quot;&quot;</span> + i);</span><br><span class="line">            executor.execute(worker);</span><br><span class="line">          &#125;</span><br><span class="line">        executor.shutdown(); <span class="comment">// This will make the executor accept no new threads and finish all existing threads in the queue</span></span><br><span class="line">        <span class="keyword">while</span> (!executor.isTerminated()) &#123; <span class="comment">// Wait until all threads are finish,and also you can use &quot;executor.awaitTermination();&quot; to wait</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Finished all threads&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç¨‹åºçš„è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> Start. Command = <span class="number">1</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> Start. Command = <span class="number">3</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> Start. Command = <span class="number">0</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> Start. Command = <span class="number">2</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> Start. Command = <span class="number">4</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> Start. Command = <span class="number">8</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> Start. Command = <span class="number">9</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> Start. Command = <span class="number">7</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> Start. Command = <span class="number">6</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> Start. Command = <span class="number">5</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> End.</span><br><span class="line">Finished all threads</span><br></pre></td></tr></table></figure><p>ç¨‹åºåˆ›å»ºäº†å›ºå®šå¤§å°ä¸º5ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ç„¶ååˆ†é…ç»™çº¿ç¨‹æ± 10ä¸ªå·¥ä½œï¼Œå› ä¸ºçº¿ç¨‹æ± å¤§å°ä¸º5ï¼Œå®ƒå°†å¯åŠ¨5ä¸ªå·¥ä½œçº¿ç¨‹å…ˆå¤„ç†5ä¸ªå·¥ä½œï¼Œå…¶ä»–çš„å·¥ä½œåˆ™å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸€æ—¦æœ‰å·¥ä½œå®Œæˆï¼Œç©ºé—²ä¸‹æ¥å·¥ä½œçº¿ç¨‹å°±ä¼šæ¡å–ç­‰å¾…é˜Ÿåˆ—é‡Œçš„å…¶ä»–å·¥ä½œè¿›è¡Œæ‰§è¡Œã€‚</p><h3 id="ğŸä¸ƒä¸ªå‚æ•°"><a href="#ğŸä¸ƒä¸ªå‚æ•°" class="headerlink" title="ğŸä¸ƒä¸ªå‚æ•°"></a>ğŸä¸ƒä¸ªå‚æ•°</h3><img src="/img/47319/ThreadPoolExecuter.png" alt="ThreadPoolExecuter" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                              TimeUnit unit,</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler)</span></span><br></pre></td></tr></table></figure><p><code>corePoolSize</code> çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äºcorePoolSize, å³ä½¿æœ‰å…¶ä»–ç©ºé—²çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡, ä¹Ÿä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°ä¸ºcorePoolSizeï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡è¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚<strong>æ ¸å¿ƒçº¿ç¨‹æ•°ç›®å¯ä»¥ä¸º0</strong></p><p><code>workQueue</code> ç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—. åœ¨JDKä¸­æä¾›äº†å¦‚ä¸‹é˜»å¡é˜Ÿåˆ—: </p><p>â€‹<code>ArrayBlockingQueue</code>: åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼›</p><p>â€‹<code>LinkedBlockingQueue</code>: åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueï¼›</p><p>â€‹<code>SynchronousQueue</code>: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼›</p><p>â€‹<code>PriorityBlockingQueue</code>: å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</p><p><code>maximumPoolSize </code> çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œ<strong>æ ¸å¿ƒçº¿ç¨‹+æ•‘æ€¥çº¿ç¨‹</strong>çš„æœ€å¤§æ•°ç›®ã€‚å¦‚æœå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå‰ææ˜¯å½“å‰çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼›å½“é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—, åˆ™maximumPoolSizeåˆ™ä¸èµ·ä½œç”¨, å› ä¸ºæ— æ³•æäº¤è‡³æ ¸å¿ƒçº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šä¸€ç›´æŒç»­åœ°æ”¾å…¥workQueue.</p><p><code>keepAliveTime </code> çº¿ç¨‹ç©ºé—²æ—¶çš„å­˜æ´»æ—¶é—´ï¼Œå³å½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè¯¥çº¿ç¨‹ç»§ç»­å­˜æ´»çš„æ—¶é—´ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åªåœ¨çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶æ‰æœ‰ç”¨, è¶…è¿‡è¿™ä¸ªæ—¶é—´çš„ç©ºé—²çº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼›</p><p><code>unit </code> keepAliveTimeçš„å•ä½</p><p><code>threadFactory </code> åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„çº¿ç¨‹å·¥å‚å¯ä»¥ç»™æ¯ä¸ªæ–°å»ºçš„çº¿ç¨‹è®¾ç½®ä¸€ä¸ªå…·æœ‰è¯†åˆ«åº¦çš„çº¿ç¨‹åã€‚é»˜è®¤ä¸ºDefaultThreadFactory</p><p><code>handler </code> çº¿ç¨‹æ± çš„<strong>é¥±å’Œç­–ç•¥</strong>ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº†4ç§ç­–ç•¥:</p><p>â€‹<code>AbortPolicy</code>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</p><p>â€‹<code>CallerRunsPolicy</code>: ç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</p><p>â€‹<code>DiscardOldestPolicy</code>: ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</p><p>â€‹<code>DiscardPolicy</code>: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</p><h3 id="ğŸExecuteåŸç†"><a href="#ğŸExecuteåŸç†" class="headerlink" title="ğŸExecuteåŸç†"></a>ğŸExecuteåŸç†</h3><p>å½“ä¸€ä¸ªä»»åŠ¡æäº¤è‡³çº¿ç¨‹æ± ä¹‹å:</p><ol><li>çº¿ç¨‹æ± é¦–å…ˆå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦å°‘äºcorePoolSizeã€‚å¦‚æœæ˜¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœéƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™è¿›å…¥2.</li><li>åˆ¤æ–­BlockingQueueæ˜¯å¦å·²ç»æ»¡äº†ï¼Œå€˜è‹¥è¿˜æ²¡æœ‰æ»¡ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥BlockingQueueã€‚å¦åˆ™è¿›å…¥3.</li><li>å¦‚æœåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¶…è¿‡maximumPoolSizeï¼Œåˆ™äº¤ç»™RejectedExecutionHandleræ¥å¤„ç†ä»»åŠ¡ã€‚</li></ol><h3 id="ğŸä¸‰ç§ç±»å‹"><a href="#ğŸä¸‰ç§ç±»å‹" class="headerlink" title="ğŸä¸‰ç§ç±»å‹"></a>ğŸä¸‰ç§ç±»å‹</h3><h4 id="newFixedThreadPool"><a href="#newFixedThreadPool" class="headerlink" title="newFixedThreadPool"></a>newFixedThreadPool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡è¾¾corePoolSizeåï¼Œå³ä½¿çº¿ç¨‹æ± æ²¡æœ‰å¯æ‰§è¡Œä»»åŠ¡æ—¶ï¼Œä¹Ÿä¸ä¼šé‡Šæ”¾çº¿ç¨‹ã€‚</p><p>FixedThreadPoolçš„å·¥ä½œé˜Ÿåˆ—ä¸ºæ— ç•Œé˜Ÿåˆ—LinkedBlockingQueue(é˜Ÿåˆ—å®¹é‡ä¸ºInteger.MAX_VALUE), è¿™ä¼šå¯¼è‡´ä»¥ä¸‹é—®é¢˜:</p><ul><li>çº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹æ•°é‡ä¸è¶…è¿‡corePoolSize,è¿™å¯¼è‡´äº†maximumPoolSizeå’ŒkeepAliveTimeå°†ä¼šæ˜¯ä¸ªæ— ç”¨å‚æ•°</li><li>ç”±äºä½¿ç”¨äº†æ— ç•Œé˜Ÿåˆ—, æ‰€ä»¥FixedThreadPoolæ°¸è¿œä¸ä¼šæ‹’ç», å³é¥±å’Œç­–ç•¥å¤±æ•ˆ</li></ul><h4 id="newSingleThreadExecutor"><a href="#newSingleThreadExecutor" class="headerlink" title="newSingleThreadExecutor"></a>newSingleThreadExecutor</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå§‹åŒ–çš„çº¿ç¨‹æ± ä¸­åªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œå¦‚æœè¯¥çº¿ç¨‹å¼‚å¸¸ç»“æŸï¼Œä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„çº¿ç¨‹ç»§ç»­æ‰§è¡Œä»»åŠ¡ï¼Œå”¯ä¸€çš„çº¿ç¨‹å¯ä»¥ä¿è¯æ‰€æäº¤ä»»åŠ¡çš„é¡ºåºæ‰§è¡Œã€‚</p><p>ç”±äºä½¿ç”¨äº†æ— ç•Œé˜Ÿåˆ—, æ‰€ä»¥SingleThreadPoolæ°¸è¿œä¸ä¼šæ‹’ç», å³é¥±å’Œç­–ç•¥å¤±æ•ˆ</p><h4 id="newCachedThreadPool"><a href="#newCachedThreadPool" class="headerlink" title="newCachedThreadPool"></a>newCachedThreadPool</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                    <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°å¯è¾¾åˆ°Integer.MAX_VALUEï¼Œå†…éƒ¨ä½¿ç”¨SynchronousQueueä½œä¸ºé˜»å¡é˜Ÿåˆ—ï¼› å’ŒnewFixedThreadPoolåˆ›å»ºçš„çº¿ç¨‹æ± ä¸åŒï¼ŒnewCachedThreadPoolåœ¨æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œå½“çº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹èµ„æºï¼Œå½“æäº¤æ–°ä»»åŠ¡æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œä¼šå¯¼è‡´ä¸€å®šçš„ç³»ç»Ÿå¼€é”€ï¼› æ‰§è¡Œè¿‡ç¨‹ä¸å‰ä¸¤ç§ç¨å¾®ä¸åŒ:</p><ul><li>ä¸»çº¿ç¨‹è°ƒç”¨SynchronousQueueçš„offer()æ–¹æ³•æ”¾å…¥task, å€˜è‹¥æ­¤æ—¶çº¿ç¨‹æ± ä¸­æœ‰ç©ºé—²çš„çº¿ç¨‹å°è¯•è¯»å– SynchronousQueueçš„task, å³è°ƒç”¨äº†SynchronousQueueçš„poll(), é‚£ä¹ˆä¸»çº¿ç¨‹å°†è¯¥taskäº¤ç»™ç©ºé—²çº¿ç¨‹. å¦åˆ™æ‰§è¡Œ(2)</li><li>å½“çº¿ç¨‹æ± ä¸ºç©ºæˆ–è€…æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹, åˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡.</li><li>æ‰§è¡Œå®Œä»»åŠ¡çš„çº¿ç¨‹å€˜è‹¥åœ¨60så†…ä»ç©ºé—², åˆ™ä¼šè¢«ç»ˆæ­¢. å› æ­¤é•¿æ—¶é—´ç©ºé—²çš„CachedThreadPoolä¸ä¼šæŒæœ‰ä»»ä½•çº¿ç¨‹èµ„æº</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„é”</title>
      <link href="/posts/51432/"/>
      <url>/posts/51432/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸæ€»è§ˆ"><a href="#ğŸæ€»è§ˆ" class="headerlink" title="ğŸæ€»è§ˆ"></a>ğŸæ€»è§ˆ</h3><p>Javaä¸­å¾€å¾€æ˜¯æŒ‰ç…§æ˜¯å¦å«æœ‰æŸä¸€ç‰¹æ€§æ¥å®šä¹‰é”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/img/51432/java-lock-1.png" alt="java-lock-1" style="zoom: 67%;" /><h3 id="ğŸä¹è§‚é”-VS-æ‚²è§‚é”"><a href="#ğŸä¹è§‚é”-VS-æ‚²è§‚é”" class="headerlink" title="ğŸä¹è§‚é” VS æ‚²è§‚é”"></a>ğŸä¹è§‚é” VS æ‚²è§‚é”</h3><blockquote><p>å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™<strong>ä¼šå…ˆåŠ é”</strong>ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚<strong>synchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»</strong>éƒ½æ˜¯æ‚²è§‚é”ã€‚</p><p>è€Œä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥<strong>ä¸ä¼šæ·»åŠ é”</strong>ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™æˆ–è€…è‡ªåŠ¨é‡è¯•ï¼‰ã€‚æœ€å¸¸é‡‡ç”¨çš„æ˜¯<strong>CASç®—æ³•</strong>å®ç°ã€‚</p></blockquote><img src="/img/51432/java-lock-2.png" alt="java-lock-2" style="zoom: 50%;" /><ul><li><strong>æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯</strong>ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚</li><li><strong>ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯</strong>ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// ------------------------- æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------</span><br><span class="line">// synchronized</span><br><span class="line">public synchronized void testMethod() &#123;</span><br><span class="line">// æ“ä½œåŒæ­¥èµ„æº</span><br><span class="line">&#125;</span><br><span class="line">// ReentrantLock</span><br><span class="line">private ReentrantLock lock = new ReentrantLock(); // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”</span><br><span class="line">public void modifyPublicResources() &#123;</span><br><span class="line">lock.lock();</span><br><span class="line">// æ“ä½œåŒæ­¥èµ„æº</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ------------------------- ä¹è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------</span><br><span class="line">private AtomicInteger atomicInteger = new AtomicInteger();  // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªAtomicInteger</span><br><span class="line">atomicInteger.incrementAndGet(); //æ‰§è¡Œè‡ªå¢1</span><br></pre></td></tr></table></figure><h3 id="ğŸè‡ªæ—‹é”-VS-éè‡ªæ—‹é”"><a href="#ğŸè‡ªæ—‹é”-VS-éè‡ªæ—‹é”" class="headerlink" title="ğŸè‡ªæ—‹é” VS éè‡ªæ—‹é”"></a>ğŸè‡ªæ—‹é” VS éè‡ªæ—‹é”</h3><p>é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚</p><p>åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹<strong>ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´</strong>ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚</p><blockquote><p>è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œ<strong>è‡ªæ—‹</strong>ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±<strong>å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æº</strong>ï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯<strong>è‡ªæ—‹é”</strong>ã€‚</p></blockquote><img src="/img/51432/java-lock-4.png" alt="java-lock-4" style="zoom:50%;" /><h3 id="ğŸæ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”"><a href="#ğŸæ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”" class="headerlink" title="ğŸæ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”"></a>ğŸæ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</h3><p>è¿™å››ç§é”æ˜¯ä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚</p><p>æ— é” â€“&gt; åå‘é” â€“&gt; è½»é‡çº§é” â€“&gt; é‡é‡çº§é”</p><blockquote><p>åå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è½»é‡çº§é”é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</p></blockquote><h3 id="ğŸå…¬å¹³é”-VS-éå…¬å¹³é”"><a href="#ğŸå…¬å¹³é”-VS-éå…¬å¹³é”" class="headerlink" title="ğŸå…¬å¹³é” VS éå…¬å¹³é”"></a>ğŸå…¬å¹³é” VS éå…¬å¹³é”</h3><blockquote><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„<strong>ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”</strong>ã€‚</p><p>ä¼˜ç‚¹ï¼šç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚</p><p>ç¼ºç‚¹ï¼šæ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚</p><hr><p>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥<strong>æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”</strong>ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚</p><p>ä¼˜ç‚¹ï¼šå¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚</p><p>ç¼ºç‚¹ï¼šå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚</p></blockquote><p>ç¤ºä¾‹ï¼š</p><img src="/img/51432/java-lock-7.png" alt="java-lock-7" style="zoom:50%;" /><p>å‡è®¾æœ‰ä¸€å£æ°´äº•ï¼Œæœ‰ç®¡ç†å‘˜çœ‹å®ˆï¼Œç®¡ç†å‘˜æœ‰ä¸€æŠŠé”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„äººæ‰èƒ½å¤Ÿæ‰“æ°´ï¼Œæ‰“å®Œæ°´è¦æŠŠé”è¿˜ç»™ç®¡ç†å‘˜ã€‚æ¯ä¸ªè¿‡æ¥æ‰“æ°´çš„äººéƒ½è¦ç®¡ç†å‘˜çš„å…è®¸å¹¶æ‹¿åˆ°é”ä¹‹åæ‰èƒ½å»æ‰“æ°´ï¼Œå¦‚æœå‰é¢æœ‰äººæ­£åœ¨æ‰“æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ³è¦æ‰“æ°´çš„äººå°±å¿…é¡»æ’é˜Ÿã€‚ç®¡ç†å‘˜ä¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªè¦å»æ‰“æ°´çš„äººæ˜¯ä¸æ˜¯é˜Ÿä¼é‡Œæ’æœ€å‰é¢çš„äººï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ‰ä¼šç»™ä½ é”è®©ä½ å»æ‰“æ°´ï¼›å¦‚æœä½ ä¸æ˜¯æ’ç¬¬ä¸€çš„äººï¼Œå°±å¿…é¡»å»é˜Ÿå°¾æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…¬å¹³é”ã€‚</p><img src="/img/51432/java-lock-8.png" alt="java-lock-8" style="zoom:50%;" /><p>å¯¹äºéå…¬å¹³é”ï¼Œç®¡ç†å‘˜å¯¹æ‰“æ°´çš„äººæ²¡æœ‰è¦æ±‚ã€‚å³ä½¿ç­‰å¾…é˜Ÿä¼é‡Œæœ‰æ’é˜Ÿç­‰å¾…çš„äººï¼Œä½†å¦‚æœåœ¨ä¸Šä¸€ä¸ªäººåˆšæ‰“å®Œæ°´æŠŠé”è¿˜ç»™ç®¡ç†å‘˜è€Œä¸”ç®¡ç†å‘˜è¿˜æ²¡æœ‰å…è®¸ç­‰å¾…é˜Ÿä¼é‡Œä¸‹ä¸€ä¸ªäººå»æ‰“æ°´æ—¶ï¼Œåˆšå¥½æ¥äº†ä¸€ä¸ªæ’é˜Ÿçš„äººï¼Œè¿™ä¸ªæ’é˜Ÿçš„äººæ˜¯å¯ä»¥ç›´æ¥ä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°é”å»æ‰“æ°´ï¼Œä¸éœ€è¦æ’é˜Ÿï¼ŒåŸæœ¬æ’é˜Ÿç­‰å¾…çš„äººåªèƒ½ç»§ç»­ç­‰å¾…ã€‚</p><h3 id="ğŸå¯é‡å…¥é”-VS-éå¯é‡å…¥é”"><a href="#ğŸå¯é‡å…¥é”-VS-éå¯é‡å…¥é”" class="headerlink" title="ğŸå¯é‡å…¥é” VS éå¯é‡å…¥é”"></a>ğŸå¯é‡å…¥é” VS éå¯é‡å…¥é”</h3><blockquote><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†<strong>è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”</strong>ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­<strong>ReentrantLockå’Œsynchronized</strong>éƒ½æ˜¯å¯é‡å…¥é”ã€‚</p></blockquote><p>å¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•1æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">        doOthers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doOthers</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•2æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è§£é‡Š</span></span><br><span class="line">ç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¢«å†…ç½®é”<span class="keyword">synchronized</span>ä¿®é¥°çš„ï¼ŒdoSomething()æ–¹æ³•ä¸­è°ƒç”¨doOthers()æ–¹æ³•ã€‚å› ä¸ºå†…ç½®é”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨doOthers()æ—¶å¯ä»¥ç›´æ¥è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼Œè¿›å…¥doOthers()è¿›è¡Œæ“ä½œ</span><br><span class="line">å¦‚æœæ˜¯ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨è°ƒç”¨doOthers()ä¹‹å‰éœ€è¦å°†æ‰§è¡ŒdoSomething()æ—¶è·å–å½“å‰å¯¹è±¡çš„é”é‡Šæ”¾æ‰ï¼Œå®é™…ä¸Šè¯¥å¯¹è±¡é”å·²è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ï¼Œä¸”æ— æ³•é‡Šæ”¾ã€‚æ‰€ä»¥æ­¤æ—¶ä¼šå‡ºç°æ­»é”</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><img src="/img/51432/java-lock-12.png" alt="java-lock-12" style="zoom:50%;" /><p>å‡è®¾æœ‰å¤šä¸ªäººåœ¨æ’é˜Ÿæ‰“æ°´ï¼Œæ­¤æ—¶ç®¡ç†å‘˜å…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„å¤šä¸ªæ°´æ¡¶ç»‘å®šã€‚è¿™ä¸ªäººç”¨å¤šä¸ªæ°´æ¡¶æ‰“æ°´æ—¶ï¼Œç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šå¹¶æ‰“å®Œæ°´ä¹‹åï¼Œç¬¬äºŒä¸ªæ°´æ¡¶ä¹Ÿå¯ä»¥ç›´æ¥å’Œé”ç»‘å®šå¹¶å¼€å§‹æ‰“æ°´ï¼Œæ‰€æœ‰çš„æ°´æ¡¶éƒ½æ‰“å®Œæ°´ä¹‹åæ‰“æ°´äººæ‰ä¼šå°†é”è¿˜ç»™ç®¡ç†å‘˜ã€‚è¿™ä¸ªäººçš„æ‰€æœ‰æ‰“æ°´æµç¨‹éƒ½èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œåç»­ç­‰å¾…çš„äººä¹Ÿèƒ½å¤Ÿæ‰“åˆ°æ°´ã€‚è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚</p><img src="/img/51432/java-lock-13.png" alt="java-lock-13" style="zoom:50%;" /><p>ä½†å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œæ­¤æ—¶ç®¡ç†å‘˜åªå…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„ä¸€ä¸ªæ°´æ¡¶ç»‘å®šã€‚ç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šæ‰“å®Œæ°´ä¹‹åå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªæ°´æ¡¶ä¸èƒ½å’Œé”ç»‘å®šä¹Ÿæ— æ³•æ‰“æ°´ã€‚å½“å‰çº¿ç¨‹å‡ºç°æ­»é”ï¼Œæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•è¢«å”¤é†’ã€‚</p><h3 id="ğŸç‹¬äº«é”-æ’ä»–é”-VS-å…±äº«é”"><a href="#ğŸç‹¬äº«é”-æ’ä»–é”-VS-å…±äº«é”" class="headerlink" title="ğŸç‹¬äº«é”(æ’ä»–é”) VS å…±äº«é”"></a>ğŸç‹¬äº«é”(æ’ä»–é”) VS å…±äº«é”</h3><blockquote><p><strong>ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”</strong>ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚<strong>JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”</strong>ã€‚</p><p><strong>å…±äº«é”</strong>æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹<strong>åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®</strong>ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volatile</title>
      <link href="/posts/27530/"/>
      <url>/posts/27530/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸvolatileç®€ä»‹"><a href="#ğŸvolatileç®€ä»‹" class="headerlink" title="ğŸvolatileç®€ä»‹"></a>ğŸvolatileç®€ä»‹</h3><p>çº¿ç¨‹å®‰å…¨äº§ç”Ÿçš„ä¸‰ä¸ªä¸»è¦çš„é—®é¢˜æ˜¯ï¼šåŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚volatileå…³é”®å­—å¯ä»¥<strong>è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§</strong>ï¼Œä½†<strong>ä¸èƒ½è§£å†³åŸå­æ€§</strong>ã€‚</p><h3 id="ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰"><a href="#ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰" class="headerlink" title="ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰"></a>ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰</h3><blockquote><p>å¤šçº¿ç¨‹ä¸‹ï¼Œä¸åŒçº¿ç¨‹çš„<strong>æŒ‡ä»¤å‘ç”Ÿäº†äº¤é”™</strong>å¯¼è‡´çš„å…±äº«å˜é‡çš„è¯»å†™æ··ä¹±</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚å¯¹äºä¸€ä¸ªå‡æ³•æ“ä½œï¼Œæœ‰å¯èƒ½ç”±ä¸‰ä¸ªæŒ‡ä»¤ç»„æˆï¼Œæ“ä½œæ—¶éœ€è¦ä¿è¯ä¸‰æŒ‡ä»¤ä¸€è‡´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">subtract</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> balance;</span><br><span class="line">    b -= <span class="number">5</span>;</span><br><span class="line">    balance = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>volatile å¹¶ä¸èƒ½è§£å†³åŸå­æ€§</strong>ï¼Œç”¨æ‚²è§‚é”æˆ–ä¹è§‚é”è§£å†³</p><h3 id="ğŸå¯è§æ€§ï¼ˆâˆšï¼‰"><a href="#ğŸå¯è§æ€§ï¼ˆâˆšï¼‰" class="headerlink" title="ğŸå¯è§æ€§ï¼ˆâˆšï¼‰"></a>ğŸå¯è§æ€§ï¼ˆâˆšï¼‰</h3><blockquote><p>ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ã€æˆ–ç¼“å­˜ä¼˜åŒ–ã€æˆ– CPU æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¯¼è‡´çš„<strong>å¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹å¦å¤–çš„çº¿ç¨‹çœ‹ä¸åˆ°</strong></p></blockquote><p>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿ<strong>é˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–</strong>å‘ç”Ÿï¼Œè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForeverLoop</span> &#123;</span><br><span class="line">    <span class="comment">// volatile ä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿé˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–å‘ç”Ÿ</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            stop = <span class="literal">true</span>;</span><br><span class="line">            get().debug(<span class="string">&quot;modify stop to true...&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, stop);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, stop);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¦‚æœwhileå¾ªç¯äº†ç‰¹åˆ«å¤šæ¬¡ï¼ˆå‡ ç™¾ä¸‡æ¬¡ï¼‰ï¼Œè¶…è¿‡äº†jitçš„é˜ˆå€¼ï¼Œä¾¿è®¤ä¸ºè¿™ä¸ªæ¡ä»¶ä¸€ç›´ä¸å˜</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚è¿™é‡Œçš„ï¼stopä¸€ç›´è®¤ä¸ºæ˜¯true</span></span><br><span class="line">    <span class="comment">// ç”¨volatileä¿®é¥°stopå¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è¿›è€Œè§£å†³çº¿ç¨‹çš„å¯è§æ€§é—®é¢˜</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        get().debug(<span class="string">&quot;stopped... c:&#123;&#125;&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰"><a href="#ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰" class="headerlink" title="ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰"></a>ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰</h3><blockquote><p>ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ã€æˆ–ç¼“å­˜ä¼˜åŒ–ã€æˆ– CPU æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¯¼è‡´æŒ‡ä»¤çš„<strong>å®é™…æ‰§è¡Œé¡ºåºä¸ç¼–å†™é¡ºåºä¸ä¸€è‡´</strong></p></blockquote><p>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ä¼šåœ¨è¯»ã€å†™å…±äº«å˜é‡æ—¶åŠ å…¥ä¸åŒçš„<strong>å±éšœ</strong>ï¼Œé˜»æ­¢å…¶ä»–è¯»å†™æ“ä½œè¶Šè¿‡å±éšœï¼Œä»è€Œè¾¾åˆ°<strong>é˜»æ­¢é‡æ’åº</strong>çš„æ•ˆæœ</p><ul><li>volatile <strong>å˜é‡å†™</strong>åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœæ’åˆ° volatile å˜é‡å†™<strong>ä¹‹ä¸‹</strong></li><li>volatile <strong>å˜é‡è¯»</strong>åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœæ’åˆ° volatile å˜é‡è¯»<strong>ä¹‹ä¸Š</strong></li><li>volatile è¯»å†™åŠ å…¥çš„å±éšœåªèƒ½é˜²æ­¢åŒä¸€çº¿ç¨‹å†…çš„æŒ‡ä»¤é‡æ’</li></ul><p>ğŸš©å…³é”®å­—ï¼šä¸Šè¯»ä¸‹å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JCStressTest</span></span><br><span class="line"><span class="meta">@Outcome(id = &#123;&quot;0, 0&quot;, &quot;1, 1&quot;, &quot;0, 1&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)</span></span><br><span class="line"><span class="meta">@Outcome(id = &quot;1, 0&quot;, expect = Expect.FORBIDDEN, desc = &quot;FORBIDDEN&quot;)</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Case2</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Actor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor1</span><span class="params">()</span> &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// volatileä¿®é¥°çš„y,å†™åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœ</span></span><br><span class="line">        <span class="comment">// ^^^^^^^^^^^^^^</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Actor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor2</span><span class="params">(II_Result r)</span> &#123;</span><br><span class="line">        r.r1 = y;</span><br><span class="line">        <span class="comment">// volatileä¿®é¥°çš„y,è¯»åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœ</span></span><br><span class="line">        <span class="comment">// VVVVVVVVVVVVVV</span></span><br><span class="line">        r.r2 = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸåœºæ™¯ç¤ºä¾‹"><a href="#ğŸåœºæ™¯ç¤ºä¾‹" class="headerlink" title="ğŸåœºæ™¯ç¤ºä¾‹"></a>ğŸåœºæ™¯ç¤ºä¾‹</h3><p>å•ä¾‹æ¨¡å¼çš„å®ç°ä¹‹ä¸€ï¼š<strong>æ‡’æ±‰å¼åŒæ£€é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            syschronized(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>åˆ†é…å†…å­˜ç©ºé—´</li><li>åˆå§‹åŒ–å¯¹è±¡</li><li>å°†å†…å­˜ç©ºé—´çš„åœ°å€èµ‹å€¼ç»™å¯¹åº”çš„å¼•ç”¨</li></ol><p>ç”±äºæ“ä½œç³»ç»Ÿå¯ä»¥<code>å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åº</code> ï¼Œå¯èƒ½å°†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡å¼•ç”¨æš´éœ²å‡ºæ¥ã€‚ç»™ç§æœ‰çš„é™æ€å˜é‡åŠ ä¸Švolatileå…³é”®å­—å°±å¯ä»¥é˜²æ­¢æŒ‡ä»¤é‡æ’åº</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCæ€»è§ˆ</title>
      <link href="/posts/64049/"/>
      <url>/posts/64049/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸJUCç®€ä»‹"><a href="#ğŸJUCç®€ä»‹" class="headerlink" title="ğŸJUCç®€ä»‹"></a>ğŸJUCç®€ä»‹</h3><blockquote><p><strong>java.util.concurrent</strong> ï¼ˆJUCï¼‰å¹¶å‘ç¼–ç¨‹åŒ…æ˜¯ä¸“é—¨ä¸º Java å¹¶å‘ç¼–ç¨‹è®¾è®¡çš„</p></blockquote><p>JUCåŒ…æä¾›äº†äº”å¤§æ–¹é¢çš„å†…å®¹ï¼š</p><p>é”ï¼ˆlocksï¼‰éƒ¨åˆ†ï¼šæä¾›é€‚åˆå„ç±»åœºåˆçš„é”å·¥å…·ï¼›<br>åŸå­å˜é‡ï¼ˆatomicï¼‰éƒ¨åˆ†ï¼šåŸå­å˜é‡ç±»ç›¸å…³ï¼Œæ˜¯æ„å»ºéé˜»å¡ç®—æ³•çš„åŸºç¡€ï¼›<br>å¹¶å‘æ¡†æ¶ï¼ˆexecutorï¼‰éƒ¨åˆ†ï¼šæä¾›çº¿ç¨‹æ± ç›¸å…³ç±»å‹ï¼›<br>å¹¶å‘å®¹å™¨ï¼ˆcollectionsï¼‰ éƒ¨åˆ†ï¼šæä¾›ä¸€ç³»åˆ—å¹¶å‘å®¹å™¨ç›¸å…³ç±»å‹ï¼›<br>åŒæ­¥å·¥å…·ï¼ˆtoolsï¼‰éƒ¨åˆ†ï¼šæä¾›ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸”åœºæ™¯ä¸°å¯Œçš„å„ç±»åŒæ­¥å·¥å…·ï¼Œå¦‚ä¿¡å·é‡ã€é—­é”ã€æ …æ ç­‰åŠŸèƒ½ï¼›</p><p><img src="/img/64049/java-thread-x-juc-overview.png" alt="java-thread-x-juc-overview"></p><h3 id="ğŸLockæ¡†æ¶å’ŒToolsç±»"><a href="#ğŸLockæ¡†æ¶å’ŒToolsç±»" class="headerlink" title="ğŸLockæ¡†æ¶å’ŒToolsç±»"></a>ğŸLockæ¡†æ¶å’ŒToolsç±»</h3><h4 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-overview-lock.png" alt="java-thread-x-juc-overview-lock"></p><h4 id="æ¥å£-Condition"><a href="#æ¥å£-Condition" class="headerlink" title="æ¥å£: Condition"></a>æ¥å£: Condition</h4><p>Lock æ›¿ä»£äº† <strong>synchronized</strong> æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼ŒCondition æ›¿ä»£äº† Object ç›‘è§†å™¨æ–¹æ³•(waitã€notify å’Œ notifyAll)çš„ä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡**await(),signal()**æ¥ä¼‘çœ &#x2F;å”¤é†’çº¿ç¨‹ã€‚</p><hr><h4 id="æ¥å£-Lock"><a href="#æ¥å£-Lock" class="headerlink" title="æ¥å£: Lock"></a>æ¥å£: Lock</h4><p>Lockå®ç°æä¾›äº†æ¯”ä½¿ç”¨synchronizedæ–¹æ³•å’Œè¯­å¥å¯è·å¾—çš„<strong>æ›´å¹¿æ³›çš„é”å®šæ“ä½œ</strong>ã€‚æ­¤å®ç°å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³çš„Conditionå¯¹è±¡ã€‚</p><hr><h4 id="æ¥å£-ReadWriteLock"><a href="#æ¥å£-ReadWriteLock" class="headerlink" title="æ¥å£: ReadWriteLock"></a>æ¥å£: ReadWriteLock</h4><p>ç»´æŠ¤äº†<strong>ä¸€å¯¹</strong>ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œã€‚åªè¦æ²¡æœ‰ writerï¼Œè¯»å–é”å¯ä»¥ç”±å¤šä¸ª reader çº¿ç¨‹åŒæ—¶ä¿æŒã€‚å†™å…¥é”æ˜¯ç‹¬å çš„ã€‚</p><hr><h4 id="é”å¸¸ç”¨ç±»-LockSupport"><a href="#é”å¸¸ç”¨ç±»-LockSupport" class="headerlink" title="é”å¸¸ç”¨ç±»: LockSupport"></a>é”å¸¸ç”¨ç±»: LockSupport</h4><p>ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„<strong>åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­</strong>ã€‚LockSupportçš„åŠŸèƒ½å’ŒThreadä¸­çš„ Thread.suspend()å’ŒThread.resume()æœ‰ç‚¹ç±»ä¼¼ï¼ŒLockSupportä¸­çš„<strong>park() å’Œ unpark()</strong> çš„ä½œç”¨åˆ†åˆ«æ˜¯é˜»å¡çº¿ç¨‹å’Œè§£é™¤é˜»å¡çº¿ç¨‹ã€‚ä½†æ˜¯park()å’Œunpark()ä¸ä¼šé‡åˆ°Thread.suspend å’Œ Thread.resumeæ‰€å¯èƒ½å¼•å‘çš„æ­»é”é—®é¢˜ã€‚</p><hr><h4 id="ğŸˆé”å¸¸ç”¨ç±»-ReentrantLock"><a href="#ğŸˆé”å¸¸ç”¨ç±»-ReentrantLock" class="headerlink" title="ğŸˆé”å¸¸ç”¨ç±»: ReentrantLock"></a>ğŸˆé”å¸¸ç”¨ç±»: ReentrantLock</h4><p>ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é” Lockï¼Œå®ƒå…·æœ‰ä¸ä½¿ç”¨ <strong>synchronized</strong> æ–¹æ³•å’Œè¯­å¥æ‰€è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„ä¸€äº›åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p><hr><h4 id="é”å¸¸ç”¨ç±»-ReentrantReadWriteLock"><a href="#é”å¸¸ç”¨ç±»-ReentrantReadWriteLock" class="headerlink" title="é”å¸¸ç”¨ç±»: ReentrantReadWriteLock"></a>é”å¸¸ç”¨ç±»: ReentrantReadWriteLock</h4><p>ReentrantReadWriteLockæ˜¯è¯»å†™é”æ¥å£<strong>ReadWriteLockçš„å®ç°ç±»</strong>ï¼Œå®ƒåŒ…æ‹¬Lockå­ç±»ReadLockå’ŒWriteLockã€‚ReadLockæ˜¯å…±äº«é”ï¼ŒWriteLockæ˜¯ç‹¬å é”ã€‚</p><h3 id="ğŸCollections-å¹¶å‘é›†åˆ"><a href="#ğŸCollections-å¹¶å‘é›†åˆ" class="headerlink" title="ğŸCollections: å¹¶å‘é›†åˆ"></a>ğŸCollections: å¹¶å‘é›†åˆ</h3><h4 id="æ€»è§ˆ-1"><a href="#æ€»è§ˆ-1" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-overview-collections.png" alt="java-thread-x-juc-overview-collections"></p><h4 id="ğŸˆMap-ConcurrentHashMap"><a href="#ğŸˆMap-ConcurrentHashMap" class="headerlink" title="ğŸˆMap: ConcurrentHashMap"></a>ğŸˆMap: ConcurrentHashMap</h4><p>çº¿ç¨‹å®‰å…¨çš„HashMapã€‚ConcurrentHashMapåœ¨JDK 7ä¹‹å‰æ˜¯é€šè¿‡Lockå’Œsegment(åˆ†æ®µé”)å®ç°ï¼ŒJDK 8 ä¹‹åæ”¹ä¸ºCAS+synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚</p><hr><h4 id="List-CopyOnWriteArrayList"><a href="#List-CopyOnWriteArrayList" class="headerlink" title="List: CopyOnWriteArrayList"></a>List: CopyOnWriteArrayList</h4><p>ArrayList çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œ(addã€set ç­‰ç­‰)éƒ½æ˜¯é€šè¿‡å¯¹åº•å±‚æ•°ç»„è¿›è¡Œä¸€æ¬¡æ–°çš„å¤åˆ¶æ¥å®ç°çš„ï¼Œå¼€é”€å¤§ã€‚</p><p>1.å½“éå†æ“ä½œçš„æ•°é‡å¤§å¤§è¶…è¿‡å¯å˜æ“ä½œçš„æ•°é‡æ—¶ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–æ›¿ä»£æ–¹æ³•æ›´æœ‰æ•ˆã€‚</p><p>2.åœ¨ä¸èƒ½æˆ–ä¸æƒ³è¿›è¡ŒåŒæ­¥éå†ï¼Œä½†åˆéœ€è¦ä»å¹¶å‘çº¿ç¨‹ä¸­æ’é™¤å†²çªæ—¶ï¼Œä¹Ÿå¾ˆæœ‰ç”¨</p><h3 id="ğŸAtomic-åŸå­ç±»"><a href="#ğŸAtomic-åŸå­ç±»" class="headerlink" title="ğŸAtomic: åŸå­ç±»"></a>ğŸAtomic: åŸå­ç±»</h3><h4 id="æ€»è§ˆ-2"><a href="#æ€»è§ˆ-2" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p>å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”±JVMä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚å®é™…ä¸Šæ˜¯å€ŸåŠ©ç¡¬ä»¶çš„ç›¸å…³æŒ‡ä»¤æ¥å®ç°çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹</p><h4 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h4><p>ä¹è§‚é”çš„å…¸å‹ä»£è¡¨</p><h3 id="ğŸExecutors-çº¿ç¨‹æ± "><a href="#ğŸExecutors-çº¿ç¨‹æ± " class="headerlink" title="ğŸExecutors: çº¿ç¨‹æ± "></a>ğŸExecutors: çº¿ç¨‹æ± </h3><h4 id="æ€»è§ˆ-3"><a href="#æ€»è§ˆ-3" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-executors.png" alt="java-thread-x-juc-executors"></p><h4 id="æ¥å£-Executor"><a href="#æ¥å£-Executor" class="headerlink" title="æ¥å£: Executor"></a>æ¥å£: Executor</h4><p>Executoræ¥å£æä¾›ä¸€ç§å°†ä»»åŠ¡æäº¤ä¸æ¯ä¸ªä»»åŠ¡å°†å¦‚ä½•è¿è¡Œçš„<strong>æœºåˆ¶</strong>(åŒ…æ‹¬çº¿ç¨‹ä½¿ç”¨çš„ç»†èŠ‚ã€è°ƒåº¦ç­‰)åˆ†ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚é€šå¸¸ä½¿ç”¨ Executor è€Œä¸æ˜¯æ˜¾å¼åœ°åˆ›å»ºçº¿ç¨‹ã€‚</p><hr><h4 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h4><p>FutureTask ä¸º Future æä¾›äº†åŸºç¡€å®ç°ï¼Œå¦‚è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ(get)å’Œå–æ¶ˆä»»åŠ¡(cancel)ç­‰ã€‚å¦‚æœä»»åŠ¡å°šæœªå®Œæˆï¼Œè·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶å°†ä¼šé˜»å¡ã€‚ä¸€æ—¦æ‰§è¡Œç»“æŸï¼Œä»»åŠ¡å°±ä¸èƒ½è¢«é‡å¯æˆ–å–æ¶ˆ(é™¤éä½¿ç”¨runAndResetæ‰§è¡Œè®¡ç®—)ã€‚FutureTask å¸¸ç”¨æ¥å°è£… Callable å’Œ Runnableï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚é™¤äº†ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¹‹å¤–ï¼Œæ­¤ç±»ä¹Ÿæä¾›äº†ä¸€äº›åŠŸèƒ½æ€§å‡½æ•°ä¾›æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰ task ç±»ä½¿ç”¨ã€‚FutureTask çš„çº¿ç¨‹å®‰å…¨ç”±<strong>CAS</strong>æ¥ä¿è¯ã€‚</p><hr><h4 id="ğŸˆThreadPoolExecutor"><a href="#ğŸˆThreadPoolExecutor" class="headerlink" title="ğŸˆThreadPoolExecutor"></a>ğŸˆThreadPoolExecutor</h4><p>ThreadPoolExecutorå®ç°äº†AbstractExecutorServiceæ¥å£ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª ExecutorServiceï¼Œå®ƒä½¿ç”¨å¯èƒ½çš„å‡ ä¸ªæ± çº¿ç¨‹ä¹‹ä¸€æ‰§è¡Œæ¯ä¸ªæäº¤çš„ä»»åŠ¡ï¼Œé€šå¸¸ä½¿ç”¨ Executors å·¥å‚æ–¹æ³•é…ç½®ã€‚ çº¿ç¨‹æ± å¯ä»¥è§£å†³ä¸¤ä¸ªä¸åŒé—®é¢˜: ç”±äºå‡å°‘äº†æ¯ä¸ªä»»åŠ¡è°ƒç”¨çš„å¼€é”€ï¼Œå®ƒä»¬é€šå¸¸å¯ä»¥åœ¨æ‰§è¡Œå¤§é‡å¼‚æ­¥ä»»åŠ¡æ—¶æä¾›å¢å¼ºçš„æ€§èƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æä¾›ç»‘å®šå’Œç®¡ç†èµ„æº(åŒ…æ‹¬æ‰§è¡Œä»»åŠ¡é›†æ—¶ä½¿ç”¨çš„çº¿ç¨‹)çš„æ–¹æ³•ã€‚æ¯ä¸ª ThreadPoolExecutor è¿˜ç»´æŠ¤ç€ä¸€äº›åŸºæœ¬çš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å®Œæˆçš„ä»»åŠ¡æ•°ã€‚</p><hr><h4 id="æ ¸å¿ƒ-ScheduledThreadExecutor"><a href="#æ ¸å¿ƒ-ScheduledThreadExecutor" class="headerlink" title="æ ¸å¿ƒ: ScheduledThreadExecutor"></a>æ ¸å¿ƒ: ScheduledThreadExecutor</h4><p>ScheduledThreadPoolExecutorå®ç°ScheduledExecutorServiceæ¥å£ï¼Œå¯å®‰æ’åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œå‘½ä»¤ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œå‘½ä»¤ã€‚éœ€è¦å¤šä¸ªè¾…åŠ©çº¿ç¨‹æ—¶ï¼Œæˆ–è€…è¦æ±‚ ThreadPoolExecutor å…·æœ‰<strong>é¢å¤–çš„çµæ´»æ€§æˆ–åŠŸèƒ½</strong>æ—¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹ä½¿ç”¨æ–¹å¼</title>
      <link href="/posts/58290/"/>
      <url>/posts/58290/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸå®ç°Runnableæ¥å£"><a href="#ğŸå®ç°Runnableæ¥å£" class="headerlink" title="ğŸå®ç°Runnableæ¥å£"></a>ğŸå®ç°Runnableæ¥å£</h3><p>éœ€è¦å®ç°run()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Thread è°ƒç”¨ <strong>start()</strong> æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyRunnable</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸå®ç°Callableæ¥å£"><a href="#ğŸå®ç°Callableæ¥å£" class="headerlink" title="ğŸå®ç°Callableæ¥å£"></a>ğŸå®ç°Callableæ¥å£</h3><p>ä¸ Runnable ç›¸æ¯”ï¼ŒCallable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">MyCallable</span> <span class="variable">mc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>();</span><br><span class="line">    <span class="comment">// åˆ©ç”¨FutureTaskå°è£…è¿”å›å€¼</span></span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(mc);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft);</span><br><span class="line">    thread.start();</span><br><span class="line">    System.out.println(ft.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸç»§æ‰¿-Thread-ç±»"><a href="#ğŸç»§æ‰¿-Thread-ç±»" class="headerlink" title="ğŸç»§æ‰¿ Thread ç±»"></a>ğŸç»§æ‰¿ Thread ç±»</h3><p>ä¹Ÿæ˜¯éœ€è¦å®ç° <strong>run()</strong> æ–¹æ³•ï¼Œå› ä¸º Thread ç±»ä¹Ÿå®ç°äº† Runable æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyThread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">    mt.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“è°ƒç”¨ <strong>start()</strong> æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå°†è¯¥çº¿ç¨‹æ”¾å…¥<strong>å°±ç»ªé˜Ÿåˆ—</strong>ä¸­ç­‰å¾…è¢«è°ƒåº¦ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«è°ƒåº¦æ—¶ä¼šæ‰§è¡Œè¯¥çº¿ç¨‹çš„ <strong>run()</strong> æ–¹æ³•</p></blockquote><h3 id="ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼"><a href="#ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼" class="headerlink" title="ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼"></a>ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼</h3><p>å®ç°æ¥å£æ›´å¥½:</p><ul><li>Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£</li><li>å®ç°æ¥å£å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹çŠ¶æ€</title>
      <link href="/posts/3d00/"/>
      <url>/posts/3d00/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸçº¿ç¨‹6ç§çŠ¶æ€"><a href="#ğŸçº¿ç¨‹6ç§çŠ¶æ€" class="headerlink" title="ğŸçº¿ç¨‹6ç§çŠ¶æ€"></a>ğŸçº¿ç¨‹6ç§çŠ¶æ€</h3><p><img src="/img/3d00/ThreadStatus.png" alt="ThreadStatus"></p><h4 id="æ–°å»º-New"><a href="#æ–°å»º-New" class="headerlink" title="æ–°å»º(New)"></a>æ–°å»º(New)</h4><p>â€‹å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨ <strong>start æ–¹æ³•</strong>æ—¶å¤„äºæ–°å»ºçŠ¶æ€,  æ­¤æ—¶æœªä¸æ“ä½œç³»ç»Ÿåº•å±‚çº¿ç¨‹å…³è”</p><h4 id="å¯è¿è¡Œ-Runnable"><a href="#å¯è¿è¡Œ-Runnable" class="headerlink" title="å¯è¿è¡Œ(Runnable)"></a>å¯è¿è¡Œ(Runnable)</h4><p>â€‹è°ƒç”¨äº† start æ–¹æ³•ï¼Œå°±ä¼šç”±æ–°å»ºè¿›å…¥å¯è¿è¡Œ</p><p>â€‹å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚åŒ…å«äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ <strong>Running å’Œ Ready</strong></p><h4 id="æ­»äº¡-Terminated"><a href="#æ­»äº¡-Terminated" class="headerlink" title="æ­»äº¡(Terminated)"></a>æ­»äº¡(Terminated)</h4><p>â€‹å¯ä»¥æ˜¯çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸ</p><h4 id="é˜»å¡-Blocking"><a href="#é˜»å¡-Blocking" class="headerlink" title="é˜»å¡(Blocking)"></a>é˜»å¡(Blocking)</h4><p>â€‹å½“è·å–é”å¤±è´¥åï¼Œç”±å¯è¿è¡Œè¿›å…¥ Monitor çš„é˜»å¡é˜Ÿåˆ—é˜»å¡ï¼Œæ­¤æ—¶ä¸å ç”¨ cpu æ—¶é—´<br>â€‹å½“æŒé”çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„é˜»å¡çº¿ç¨‹ï¼Œå”¤é†’åçš„çº¿ç¨‹è¿›å…¥å¯è¿è¡ŒçŠ¶æ€</p><h4 id="æ— é™æœŸç­‰å¾…-Waiting"><a href="#æ— é™æœŸç­‰å¾…-Waiting" class="headerlink" title="æ— é™æœŸç­‰å¾…(Waiting)"></a>æ— é™æœŸç­‰å¾…(Waiting)</h4><p>â€‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡</p><table><thead><tr><th align="center">å¸¸è§è¿›å…¥æ–¹æ³•</th><th align="center">å¸¸è§é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td align="center">æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td align="center">Object.notify() &#x2F; Object.notifyAll()</td></tr><tr><td align="center">æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td align="center">è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr></tbody></table><h4 id="é™æœŸç­‰å¾…-Timed-Waiting"><a href="#é™æœŸç­‰å¾…-Timed-Waiting" class="headerlink" title="é™æœŸç­‰å¾…(Timed Waiting)"></a>é™æœŸç­‰å¾…(Timed Waiting)</h4><p>â€‹æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’</p><table><thead><tr><th align="center">å¸¸è§è¿›å…¥æ–¹æ³•</th><th align="center">å¸¸è§é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td align="center">Thread.sleep() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ</td></tr><tr><td align="center">è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ &#x2F; Object.notify() &#x2F; Object.notifyAll()</td></tr><tr><td align="center">è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ &#x2F; è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr></tbody></table><blockquote><p>é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«ï¼šé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼›è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨ Thread.sleep() å’Œ Object.wait() ç­‰æ–¹æ³•è¿›å…¥</p></blockquote><h3 id="ğŸwait-vs-sleep"><a href="#ğŸwait-vs-sleep" class="headerlink" title="ğŸwait vs sleep"></a>ğŸwait vs sleep</h3><h4 id="å…±åŒç‚¹"><a href="#å…±åŒç‚¹" class="headerlink" title="å…±åŒç‚¹"></a>å…±åŒç‚¹</h4><p>â€‹wait() ï¼Œwait(long) å’Œ sleep(long) çš„æ•ˆæœéƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒ CPU çš„ä½¿ç”¨æƒï¼Œè¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong></p><h4 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h4><p>â—  æ–¹æ³•å½’å±ä¸åŒ<br>    sleep(long) æ˜¯ <strong>Thread</strong> çš„é™æ€æ–¹æ³•<br>    è€Œ wait()ï¼Œwait(long) éƒ½æ˜¯ <strong>Object</strong> çš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰<br>â—  é†’æ¥æ—¶æœºä¸åŒ<br>    æ‰§è¡Œ sleep(long) å’Œ wait(long) çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥<br>    wait(long) å’Œ wait() è¿˜å¯ä»¥è¢« <strong>notify</strong> å”¤é†’ï¼Œwait() å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»<br>    å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’<br>â—  é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰<br>    wait æ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å– wait å¯¹è±¡çš„é”ï¼Œè€Œ sleep åˆ™æ— æ­¤é™åˆ¶<br>    wait æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰<br>    è€Œ sleep å¦‚æœåœ¨ synchronized ä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</p><blockquote><p><strong>waitæ‰”æ‰é”ç¡è§‰ï¼ŒsleepæŠ±ç€é”ç¡è§‰</strong></p></blockquote><h3 id="ğŸçº¿ç¨‹é—´çš„åä½œ"><a href="#ğŸçº¿ç¨‹é—´çš„åä½œ" class="headerlink" title="ğŸçº¿ç¨‹é—´çš„åä½œ"></a>ğŸçº¿ç¨‹é—´çš„åä½œ</h3><blockquote><p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒ</p></blockquote><h4 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h4><p>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        B(A a) &#123;</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                a.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>(a);</span><br><span class="line">        b.start();</span><br><span class="line">        a.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">A</span><br><span class="line">B</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>è™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ <strong>join()</strong> æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿ<strong>ä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡º</strong></p><h4 id="wait-x2F-notify-x2F-notifyAll"><a href="#wait-x2F-notify-x2F-notifyAll" class="headerlink" title="wait() &#x2F; notify() &#x2F; notifyAll()"></a>wait() &#x2F; notify() &#x2F; notifyAll()</h4><p>è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitNotifyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">    <span class="type">WaitNotifyExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WaitNotifyExample</span>();</span><br><span class="line">    executorService.execute(() -&gt; example.after());</span><br><span class="line">    executorService.execute(() -&gt; example.before());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">before</span><br><span class="line">after</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚</li><li>åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExeceptionã€‚</li><li>ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œ<strong>çº¿ç¨‹ä¼šé‡Šæ”¾é”</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”</li></ul><h4 id="await-x2F-signal-x2F-signalAll"><a href="#await-x2F-signal-x2F-signalAll" class="headerlink" title="await() &#x2F; signal() &#x2F; signalAll()"></a>await() &#x2F; signal() &#x2F; signalAll()</h4><p>java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥<strong>æŒ‡å®šç­‰å¾…çš„æ¡ä»¶</strong>ï¼Œå› æ­¤æ›´åŠ çµæ´»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AwaitSignalExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            condition.await();</span><br><span class="line">            System.out.println(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">    <span class="type">AwaitSignalExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AwaitSignalExample</span>();</span><br><span class="line">    executorService.execute(() -&gt; example.after());</span><br><span class="line">    executorService.execute(() -&gt; example.before());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">before</span><br><span class="line">after</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ’åº</title>
      <link href="/posts/11306/"/>
      <url>/posts/11306/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸæ–¹æ¡ˆæè¿°"><a href="#ğŸæ–¹æ¡ˆæè¿°" class="headerlink" title="ğŸæ–¹æ¡ˆæè¿°"></a>ğŸæ–¹æ¡ˆæè¿°</h3><blockquote><p>å¿«æ’çš„æ–¹æ¡ˆä¹‹<strong>åŒè¾¹å¾ªç¯å¿«æ’ï¼ˆhoare éœå°”åˆ†åŒºæ–¹æ¡ˆæ”¹ï¼‰</strong></p></blockquote><p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œæ¯ä¸€è¶Ÿèƒ½å¤Ÿç¡®å®šä¸€ä¸ªåŸºå‡†ç‚¹çš„ä½ç½®</p><ol><li>é€‰æ‹©æœ€å·¦å…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹å…ƒç´ </li><li>j æŒ‡é’ˆè´Ÿè´£ä»å³å‘å·¦æ‰¾æ¯”åŸºå‡†ç‚¹å°çš„å…ƒç´ ï¼Œi æŒ‡é’ˆè´Ÿè´£ä»å·¦å‘å³æ‰¾æ¯”åŸºå‡†ç‚¹å¤§çš„å…ƒç´ ï¼Œä¸€æ—¦æ‰¾åˆ°äºŒè€…äº¤æ¢ï¼Œç›´è‡³ iï¼Œj ç›¸äº¤</li><li>æœ€ååŸºå‡†ç‚¹ä¸ iï¼ˆæ­¤æ—¶ i ä¸ j ç›¸ç­‰ï¼‰äº¤æ¢ï¼Œi å³ä¸ºåˆ†åŒºä½ç½®</li></ol><h3 id="ğŸä»£ç å®ç°"><a href="#ğŸä»£ç å®ç°" class="headerlink" title="ğŸä»£ç å®ç°"></a>ğŸä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾…åŠ©äº¤æ¢å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">    array[i] = array[j];</span><br><span class="line">    array[j] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¡®å®šåŸºå‡†ç‚¹ï¼Œè¿”å›åŸºå‡†ç‚¹ç´¢å¼•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pv</span> <span class="operator">=</span> a[l]; <span class="comment">//åŸºå‡†ç‚¹å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> h;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">        <span class="comment">// j ä»å³æ‰¾å°çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[j] &gt; pv)&#123;</span><br><span class="line">            j -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// i ä»å·¦æ‰¾å¤§çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[i] &lt;= pv)&#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// äºŒè€…äº¤æ¢</span></span><br><span class="line">    swap(a,i,j);   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€ååŸºå‡†ç‚¹ä¸ iï¼ˆæ­¤æ—¶ i ä¸ j ç›¸ç­‰ï¼‰äº¤æ¢ï¼Œi å³ä¸ºåˆ†åŒºä½ç½®</span></span><br><span class="line">    swap(a,l,j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°ï¼Œä¸partitionçš„å‚æ•°ç›¸åŒï¼Œå¯å¿«é€Ÿæ‰‹æ’•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= h)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> partition(a,l,h);</span><br><span class="line">    quick(a,l,p-<span class="number">1</span>);</span><br><span class="line">    quick(a,p+<span class="number">1</span>,h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸæ³¨æ„äº‹é¡¹"><a href="#ğŸæ³¨æ„äº‹é¡¹" class="headerlink" title="ğŸæ³¨æ„äº‹é¡¹"></a>ğŸæ³¨æ„äº‹é¡¹</h3><ol><li>åŸºå‡†ç‚¹åœ¨å·¦è¾¹ï¼Œå¹¶ä¸”è¦å…ˆ j å i </li><li>å†…å¾ªç¯ä¸­ä¹Ÿè¦åŠ ä¸Šâ€i&lt;jâ€æ¡ä»¶ï¼Œwhile( **i** **&lt; j** &amp;&amp; a[j] &gt; pv ) jâ€“ </li><li>è¿™é‡Œæ˜¯**&lt;&#x3D;**ï¼Œå› ä¸ºå·¦è¾¹å¼€å§‹ä½ç½®åœ¨åŸºå‡†ç‚¹ä¸Šï¼Œwhile ( <strong>i</strong> <strong>&lt; j</strong> &amp;&amp; a[i] <strong>&lt;&#x3D;</strong> pv ) i++</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Synchronized</title>
      <link href="/posts/49469/"/>
      <url>/posts/49469/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸSynchronizedç®€ä»‹"><a href="#ğŸSynchronizedç®€ä»‹" class="headerlink" title="ğŸSynchronizedç®€ä»‹"></a>ğŸSynchronizedç®€ä»‹</h3><p>Synchronizedå…³é”®å­—æ˜¯ä¸€ç§çº¿ç¨‹äº’æ–¥åŒæ­¥æ–¹æ¡ˆï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p>ä¸€æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼ˆ<strong>æ‚²è§‚é”</strong>ï¼‰</p><p>æ¯ä¸ªå®ä¾‹éƒ½å¯¹åº”æœ‰è‡ªå·±çš„ä¸€æŠŠé”(<strong>this</strong>),ä¸åŒå®ä¾‹ä¹‹é—´äº’ä¸å½±å“ï¼ˆä¾‹å¤–ï¼šé”å¯¹è±¡æ˜¯*.classä»¥åŠsynchronizedä¿®é¥°çš„æ˜¯staticæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰€æœ‰å¯¹è±¡å…¬ç”¨åŒä¸€æŠŠé”ï¼‰</p><p>synchronizedä¿®é¥°çš„æ–¹æ³•ï¼Œ<strong>æ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œéƒ½ä¼šé‡Šæ”¾é”</p><h3 id="ğŸSynchronizedä½¿ç”¨"><a href="#ğŸSynchronizedä½¿ç”¨" class="headerlink" title="ğŸSynchronizedä½¿ç”¨"></a>ğŸSynchronizedä½¿ç”¨</h3><h4 id="å¯¹è±¡é”"><a href="#å¯¹è±¡é”" class="headerlink" title="å¯¹è±¡é”"></a>å¯¹è±¡é”</h4><p>åŒ…æ‹¬åŒæ­¥ä»£ç å—é”(è‡ªå·±æŒ‡å®šé”å¯¹è±¡)å’Œæ–¹æ³•é”(é»˜è®¤é”å¯¹è±¡ä¸ºthis,å½“å‰å®ä¾‹å¯¹è±¡)</p><h5 id="ä»£ç å—å½¢å¼"><a href="#ä»£ç å—å½¢å¼" class="headerlink" title="ä»£ç å—å½¢å¼"></a>ä»£ç å—å½¢å¼</h5><blockquote><p>æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡ï¼Œä¹Ÿå¯æ˜¯æ˜¯this,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”</p></blockquote><p>é”ä¸ºthisç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥ä»£ç å—å½¢å¼â€”â€”é”ä¸ºthis,ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨çš„é”æ˜¯ä¸€æ ·çš„,çº¿ç¨‹1å¿…é¡»è¦ç­‰åˆ°çº¿ç¨‹0é‡Šæ”¾äº†è¯¥é”åï¼Œæ‰èƒ½æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><p>é”ä¸ºè‡ªå®šä¹‰ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»º2æŠŠé”</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">block1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">block2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªä»£ç å—ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€æŠŠé”ï¼Œå½“ä»–é‡Šæ”¾åï¼Œåé¢çš„ä»£ç å—ç”±äºä½¿ç”¨çš„æ˜¯ç¬¬äºŒæŠŠé”ï¼Œå› æ­¤å¯ä»¥é©¬ä¸Šæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">synchronized</span> (block1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;block1é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;block1é”,&quot;</span>+Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (block2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;block2é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;block2é”,&quot;</span>+Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ®µåŒæ­¥ä»£ç å—ä¹‹åï¼Œç¬¬äºŒä¸ªåŒæ­¥ä»£ç å—å¯ä»¥é©¬ä¸Šå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨çš„é”ä¸æ˜¯åŒä¸€æŠŠ</span></span><br><span class="line">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">block1é”,Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span>ã€€ã€€</span><br><span class="line">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">block2é”,Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">block1é”,Thread-<span class="number">1</span>ç»“æŸ</span><br><span class="line">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">block2é”,Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h5 id="æ–¹æ³•é”"><a href="#æ–¹æ³•é”" class="headerlink" title="æ–¹æ³•é”"></a>æ–¹æ³•é”</h5><blockquote><p>synchronizedä¿®é¥°æ™®é€šæ–¹æ³•ï¼Œé”å¯¹è±¡é»˜è®¤ä¸ºthis</p></blockquote><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸ŠåŠ å…³é”®å­—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h4 id="ç±»é”"><a href="#ç±»é”" class="headerlink" title="ç±»é”"></a>ç±»é”</h4><p>synchronizeä¿®é¥°é™æ€çš„æ–¹æ³•æˆ–æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</p><h5 id="ä¿®é¥°é™æ€æ–¹æ³•"><a href="#ä¿®é¥°é™æ€æ–¹æ³•" class="headerlink" title="ä¿®é¥°é™æ€æ–¹æ³•"></a>ä¿®é¥°é™æ€æ–¹æ³•</h5><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// synchronizedç”¨åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯å½“å‰æ‰€åœ¨çš„Classç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œéœ€è¦çš„é”éƒ½åªæœ‰ä¸€æŠŠ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance1);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance2);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><p>ğŸš©æ³¨æ„ï¼šå’Œä¿®é¥°æ™®é€šæ–¹æ³•çš„åŒºåˆ«ï¼šå¯¹äºæ™®é€šæ–¹æ³•è€Œè¨€æ˜¯æ¯ä¸ªå®ä¾‹æœ‰ä¸€æŠŠé”ï¼Œå¯¹äºé™æ€æ–¹æ³•è€Œè¨€æ˜¯ç±»ä¸Šçš„é”ï¼Œå®ä¾‹çš„çº¿ç¨‹å…±ç”¨</p><h5 id="æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡"><a href="#æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡" class="headerlink" title="æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡"></a>æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</h5><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰€æœ‰çº¿ç¨‹éœ€è¦çš„é”éƒ½æ˜¯åŒä¸€æŠŠ</span></span><br><span class="line">        <span class="keyword">synchronized</span>(SynchronizedObjectLock.class)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance1);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance2);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h3 id="ğŸSynchronizedä¸Lockçš„åŒºåˆ«"><a href="#ğŸSynchronizedä¸Lockçš„åŒºåˆ«" class="headerlink" title="ğŸSynchronizedä¸Lockçš„åŒºåˆ«"></a>ğŸSynchronizedä¸Lockçš„åŒºåˆ«</h3><p>â— è¯­æ³•å±‚é¢<br>  â—‹ synchronized æ˜¯å…³é”®å­—ï¼Œæºç åœ¨ jvm ä¸­ï¼Œç”¨ c++ è¯­è¨€å®ç°<br>  â—‹ Lock æ˜¯<strong>æ¥å£</strong>ï¼Œæºç ç”± jdk æä¾›ï¼Œç”¨ java è¯­è¨€å®ç°<br>  â—‹ ä½¿ç”¨ synchronized æ—¶ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œä½¿ç”¨ Lock æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ unlock()é‡Šæ”¾é”<br>â— åŠŸèƒ½å±‚é¢<br>  â—‹ äºŒè€…å‡å±äºæ‚²è§‚é”ï¼Œéƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½<br>  â—‹ Lock æä¾›äº†è®¸å¤š synchronized ä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€<strong>å¯æ‰“æ–­ã€å¯è¶…æ—¶</strong>ã€å¤šæ¡ä»¶å˜é‡<br>  â—‹ Lock æœ‰é€‚åˆä¸åŒåœºæ™¯çš„å®ç°ï¼Œå¦‚ <strong>ReentrantLock</strong>ï¼Œ ReentrantReadWriteLock<br>â— æ€§èƒ½å±‚é¢<br>  â—‹ åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ–<br>  â—‹ åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒLock çš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</p><h3 id="ğŸSynchronizedæ³¨æ„äº‹é¡¹"><a href="#ğŸSynchronizedæ³¨æ„äº‹é¡¹" class="headerlink" title="ğŸSynchronizedæ³¨æ„äº‹é¡¹"></a>ğŸSynchronizedæ³¨æ„äº‹é¡¹</h3><ul><li>é”å¯¹è±¡<strong>ä¸èƒ½ä¸ºç©º</strong>ï¼Œå› ä¸ºé”çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¯¹è±¡å¤´é‡Œ</li><li>ä½œç”¨åŸŸä¸å®œè¿‡å¤§ï¼Œå½±å“ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ï¼Œæ§åˆ¶èŒƒå›´è¿‡å¤§ï¼Œç¼–å†™ä»£ç ä¹Ÿå®¹æ˜“å‡ºé”™</li><li>é¿å…æ­»é”</li><li>åœ¨èƒ½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ—¢ä¸è¦ç”¨Lockä¹Ÿä¸è¦ç”¨synchronizedå…³é”®å­—ï¼Œç”¨java.util.concurrentåŒ…ï¼ˆJUCï¼‰ä¸­çš„å„ç§å„æ ·çš„ç±»ï¼Œå¦‚æœä¸ç”¨è¯¥åŒ…ä¸‹çš„ç±»ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨synchronizedå…³é”®å­—</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadLocal</title>
      <link href="/posts/19329/"/>
      <url>/posts/19329/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸThreadLocalç®€ä»‹"><a href="#ğŸThreadLocalç®€ä»‹" class="headerlink" title="ğŸThreadLocalç®€ä»‹"></a>ğŸThreadLocalç®€ä»‹</h4><p>ThreadLocalæ˜¯ä¸€ä¸ªå°†åœ¨å¤šçº¿ç¨‹ä¸­ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„å˜é‡å‰¯æœ¬çš„ç±»; å½“ä½¿ç”¨ThreadLocalæ¥ç»´æŠ¤å˜é‡æ—¶, ThreadLocalä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»º<strong>å•ç‹¬çš„å˜é‡å‰¯æœ¬</strong>, é¿å…å› å¤šçº¿ç¨‹æ“ä½œå…±äº«å˜é‡è€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</p><blockquote><p>å…³é”®è¯ï¼š<strong>çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…±äº«</strong></p></blockquote><h4 id="ğŸThreadLocalç®€å•ç¤ºä¾‹"><a href="#ğŸThreadLocalç®€å•ç¤ºä¾‹" class="headerlink" title="ğŸThreadLocalç®€å•ç¤ºä¾‹"></a>ğŸThreadLocalç®€å•ç¤ºä¾‹</h4><p>ä»¥ç½‘ä¸Šç¤ºä¾‹æœ€å¤šçš„æ•°æ®åº“é“¾æ¥ç®¡ç†ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThreadLocal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨, å¾—åˆ°çš„æ˜¯åŒä¸€ä¸ª Connection å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + (i + <span class="number">1</span>)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤šä¸ªçº¿ç¨‹è°ƒç”¨, å¾—åˆ°çš„æ˜¯è‡ªå·±çš„ Connection å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + (i + <span class="number">1</span>)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> tl.get(); <span class="comment">// åˆ°å½“å‰çº¿ç¨‹è·å–èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">                conn = innerGetConnection(); <span class="comment">// åˆ›å»ºæ–°çš„è¿æ¥å¯¹è±¡</span></span><br><span class="line">                tl.set(conn); <span class="comment">// å°†èµ„æºå­˜å…¥å½“å‰çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title function_">innerGetConnection</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸThreadLocalåŸç†"><a href="#ğŸThreadLocalåŸç†" class="headerlink" title="ğŸThreadLocalåŸç†"></a>ğŸThreadLocalåŸç†</h4><p>æ¯ä¸ªçº¿ç¨‹å†…æœ‰ä¸€ä¸ª ThreadLocalMap ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡</p><blockquote><p>åˆå§‹åŒ–ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> T <span class="title function_">setInitialValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> initialValue();</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè°ƒç”¨æˆ‘ä»¬ä¸Šé¢å†™çš„é‡è½½è¿‡åçš„initialValueæ–¹æ³•, äº§ç”Ÿä¸€ä¸ªConnectionå¯¹è±¡;</li><li>ç»§ç»­æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„threadLocalsæ˜¯ä¸æ˜¯ç©ºçš„, å¦‚æœThreadLocalMapå·²è¢«åˆå§‹åŒ–, é‚£ä¹ˆç›´æ¥å°†äº§ç”Ÿçš„å¯¹è±¡æ·»åŠ åˆ°ThreadLocalMapä¸­, å¦‚æœæ²¡æœ‰åˆå§‹åŒ–, åˆ™åˆ›å»ºå¹¶æ·»åŠ å¯¹è±¡åˆ°å…¶ä¸­;</li></ul><blockquote><p>è°ƒç”¨ <strong>set</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ <strong>ThreadLocal è‡ªå·±ä½œä¸º key</strong>ï¼Œèµ„æºå¯¹è±¡ä½œä¸º valueï¼Œæ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocalMap é›†åˆä¸­</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è°ƒç”¨ <strong>get</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (threadLocals != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> threadLocals.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹å¯¹è±¡t, ç„¶åä»çº¿ç¨‹tä¸­è·å–åˆ°ThreadLocalMapçš„æˆå‘˜å±æ€§threadLocals</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså·²ç»åˆå§‹åŒ–(å³ä¸ä¸ºnull) å¹¶ä¸”å­˜åœ¨ä»¥å½“å‰ThreadLocalå¯¹è±¡ä¸ºKeyçš„å€¼, åˆ™ç›´æ¥è¿”å›å½“å‰çº¿ç¨‹è¦è·å–çš„å¯¹è±¡(ä¾‹ä¸­ä¸ºConnection);</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså·²ç»åˆå§‹åŒ–(å³ä¸ä¸ºnull)ä½†æ˜¯ä¸å­˜åœ¨ä»¥å½“å‰ThreadLocalå¯¹è±¡ä¸ºKeyçš„çš„å¯¹è±¡, é‚£ä¹ˆé‡æ–°åˆ›å»ºä¸€ä¸ªConnectionå¯¹è±¡, å¹¶ä¸”æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„threadLocals Mapä¸­,å¹¶è¿”å›</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså±æ€§è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–, åˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªThreadLocalMapå¯¹è±¡, å¹¶ä¸”åˆ›å»ºä¸€ä¸ªConnectionå¯¹è±¡å¹¶æ·»åŠ åˆ°ThreadLocalMapå¯¹è±¡ä¸­å¹¶è¿”å›</li></ul><blockquote><p>è°ƒç”¨ <strong>remove</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼</p></blockquote><h4 id="ğŸThreadLocalMapå¯¹è±¡"><a href="#ğŸThreadLocalMapå¯¹è±¡" class="headerlink" title="ğŸThreadLocalMapå¯¹è±¡"></a>ğŸThreadLocalMapå¯¹è±¡</h4><h5 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h5><blockquote><ul><li>æ²¡æœ‰å®ç°Mapæ¥å£;</li><li>æ²¡æœ‰publicçš„æ–¹æ³•, æœ€å¤šæœ‰ä¸€ä¸ªdefaultçš„æ„é€ æ–¹æ³•, å› ä¸ºè¿™ä¸ªThreadLocalMapçš„æ–¹æ³•ä»…ä»…åœ¨ThreadLocalç±»ä¸­è°ƒç”¨, å±äºé™æ€å†…éƒ¨ç±»</li><li>ThreadLocalMapçš„Entryå®ç°ç»§æ‰¿äº†WeakReference&lt;ThreadLocal&lt;?&gt;&gt;ï¼Œå³å¼±å¼•ç”¨</li><li>è¯¥æ–¹æ³•ä»…ä»…ç”¨äº†ä¸€ä¸ªEntryæ•°ç»„æ¥å­˜å‚¨Key, Value; Entryå¹¶ä¸æ˜¯é“¾è¡¨å½¢å¼, è€Œæ˜¯æ¯ä¸ªbucketé‡Œé¢ä»…ä»…æ”¾ä¸€ä¸ªEntry</li></ul></blockquote><p>ä»¥ä¸€ä¸ªç¤ºä¾‹è§£é‡Šï¼š</p><p><img src="/img/19329/ThreadLocalMap1.png" alt="image.png"></p><ul><li>key çš„ hash å€¼ç»Ÿä¸€åˆ†é…</li><li>åˆå§‹å®¹é‡ <strong>16</strong>ï¼Œæ‰©å®¹å› å­ <strong>2&#x2F;3</strong>ï¼Œæ‰©å®¹<strong>å®¹é‡ç¿»å€</strong></li><li>key ç´¢å¼•å†²çªåç”¨<strong>å¼€æ”¾å¯»å€æ³•</strong>è§£å†³å†²çª</li></ul><h5 id="key-è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨"><a href="#key-è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨" class="headerlink" title="key è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨"></a><strong>key è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨</strong></h5><blockquote><p>å¼±å¼•ç”¨ï¼škeyè¢«é‡Šæ”¾å†…å­˜ï¼Œvalueè¿˜åœ¨</p></blockquote><p>Thread å¯èƒ½éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼ˆå¦‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼‰ï¼Œå¦‚æœ key ä¸å†ä½¿ç”¨ï¼Œéœ€è¦åœ¨å†…å­˜ä¸è¶³ï¼ˆGCï¼Œ<strong>åƒåœ¾å›æ”¶</strong>ï¼‰æ—¶é‡Šæ”¾å…¶å ç”¨çš„å†…å­˜</p><h5 id="ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº"><a href="#ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº" class="headerlink" title="ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº"></a><strong>ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº</strong></h5><ul><li>è¢«åŠ¨ GC é‡Šæ”¾ key</li></ul><p>â€‹ä»…æ˜¯è®© key çš„å†…å­˜é‡Šæ”¾ï¼Œå…³è” value çš„å†…å­˜å¹¶ä¸ä¼šé‡Šæ”¾</p><ul><li>æ‡’æƒ°è¢«åŠ¨é‡Šæ”¾ value</li></ul><p>â€‹get key æ—¶ï¼Œå‘ç°æ˜¯ null keyï¼Œåˆ™é‡Šæ”¾å…¶ value å†…å­˜</p><p>â€‹getåŸæœ¬ä¸å­˜åœ¨çš„keyï¼Œä¼šåˆ›å»ºä¸€ä¸ªkeyï¼Œè€Œvalueä¸ºnull</p><p><img src="/img/19329/ThreadLocalMap2.png" alt="image.png"></p><p>â€‹set key æ—¶ï¼Œä¼šä½¿ç”¨å¯å‘å¼æ‰«æï¼Œæ¸…é™¤ä¸´è¿‘çš„ null key çš„ value å†…å­˜ï¼Œå¯å‘æ¬¡æ•°ä¸å…ƒç´ ä¸ªæ•°ï¼Œæ˜¯å¦å‘ç° null key æœ‰å…³</p><p><img src="/img/19329/ThreadLocalMap3.png" alt="image.png"></p><p><img src="/img/19329/ThreadLocalMap4.png" alt="image.png"></p><p>â€‹set 8 æ—¶ä¼šå°†ä¸´è¿‘çš„9ã€10å…¨éƒ¨é‡Šæ”¾ï¼Œè€Œ14ç”±äºè·ç¦»è¿œä¸ä¼š</p><ul><li>ä¸»åŠ¨ remove é‡Šæ”¾ keyï¼Œvalue</li></ul><p>â€‹ä¼šåŒæ—¶é‡Šæ”¾ keyï¼Œvalue çš„å†…å­˜ï¼Œä¹Ÿä¼šæ¸…é™¤ä¸´è¿‘çš„ null key çš„ value å†…å­˜</p><p>â€‹æ¨èä½¿ç”¨å®ƒï¼Œå› ä¸ºä¸€èˆ¬ä½¿ç”¨ ThreadLocal æ—¶éƒ½æŠŠå®ƒä½œä¸ºé™æ€å˜é‡ï¼ˆå³å¼ºå¼•ç”¨ï¼‰ï¼Œå› æ­¤æ— æ³•è¢«åŠ¨ä¾é  GC å›æ”¶</p><h4 id="ğŸThreadLocalåº”ç”¨åœºæ™¯"><a href="#ğŸThreadLocalåº”ç”¨åœºæ™¯" class="headerlink" title="ğŸThreadLocalåº”ç”¨åœºæ™¯"></a>ğŸThreadLocalåº”ç”¨åœºæ™¯</h4><ul><li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªâ€œåºåˆ—å·â€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerialNum</span> &#123;</span><br><span class="line">    <span class="comment">// The next serial number to be assigned</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">nextSerialNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ThreadLocal</span> <span class="variable">serialNum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>() &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">synchronized</span> Object <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(nextSerialNum++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((Integer) (serialNum.get())).intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Sessionçš„ç®¡ç†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ThreadLocal</span> <span class="variable">threadSession</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title function_">getSession</span><span class="params">()</span> <span class="keyword">throws</span> InfrastructureException &#123;  </span><br><span class="line">    <span class="type">Session</span> <span class="variable">s</span> <span class="operator">=</span> (Session) threadSession.get();  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;  </span><br><span class="line">            s = getSessionFactory().openSession();  </span><br><span class="line">            threadSession.set(s);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (HibernateException ex) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InfrastructureException</span>(ex);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> s;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li>åœ¨çº¿ç¨‹å†…éƒ¨åˆ›å»ºThreadLocal</li></ul><p>â€‹åœ¨å¤šçº¿ç¨‹çš„ç±»(å¦‚ThreadDemoç±»)ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡threadXxxï¼Œç”¨æ¥ä¿å­˜çº¿ç¨‹é—´éœ€è¦éš”ç¦»å¤„ç†çš„å¯¹è±¡xxxã€‚</p><p>â€‹åœ¨ThreadDemoç±»ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè·å–è¦éš”ç¦»è®¿é—®çš„æ•°æ®çš„æ–¹æ³•getXxx()ï¼Œåœ¨æ–¹æ³•ä¸­åˆ¤æ–­ï¼Œè‹¥ThreadLocalå¯¹è±¡ä¸ºnullæ—¶å€™ï¼Œåº”è¯¥new()ä¸€ä¸ªéš”ç¦»è®¿é—®ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å¼ºåˆ¶è½¬æ¢ä¸ºè¦åº”ç”¨çš„ç±»å‹ã€‚</p><p>â€‹åœ¨ThreadDemoç±»çš„run()æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨getXxx()æ–¹æ³•è·å–è¦æ“ä½œçš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œåœ¨ä»»ä½•æ—¶åˆ»éƒ½æ“ä½œçš„æ˜¯è¿™ä¸ªå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalTest</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    </span><br><span class="line">    ThreadLocal&lt;Student&gt; StudentThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Student&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentThreadName</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is running...&quot;</span>);</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> random.nextInt(<span class="number">100</span>);</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is set age: &quot;</span>  + age);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">Student</span> <span class="operator">=</span> getStudent(); <span class="comment">//é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½ç‹¬ç«‹çš„newä¸€ä¸ªStudentå¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„çš„Studentå¯¹è±¡éƒ½å¯ä»¥è®¾ç½®ä¸åŒçš„å€¼</span></span><br><span class="line">        Student.setAge(age);</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is first get age: &quot;</span> + Student.getAge());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println( currentThreadName + <span class="string">&quot; is second get age: &quot;</span> + Student.getAge());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Student <span class="title function_">getStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">Student</span> <span class="operator">=</span> StudentThreadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == Student) &#123;</span><br><span class="line">            Student = <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">            StudentThreadLocal.set(Student);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocalTest</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalTest</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(t,<span class="string">&quot;Thread A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(t,<span class="string">&quot;Thread B&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘åŸºç¡€</title>
      <link href="/posts/1954/"/>
      <url>/posts/1954/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š"><a href="#ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š" class="headerlink" title="ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š"></a>ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š</h3><h4 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h4><blockquote><p>å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹1æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">i = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//çº¿ç¨‹2æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">j = i;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šçº¿ç¨‹1å¯¹å˜é‡iä¿®æ”¹äº†ä¹‹åï¼Œçº¿ç¨‹2æ²¡æœ‰ç«‹å³çœ‹åˆ°çº¿ç¨‹1ä¿®æ”¹çš„å€¼ã€‚</p><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><blockquote><p>åŸå­æ€§ï¼šä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œ è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹1æ‰§è¡Œ</span></span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹2æ‰§è¡Œ</span></span><br><span class="line">i += <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><code>i += 1</code>éœ€è¦ä¸‰æ¡ CPU æŒ‡ä»¤:</p><ol><li>å°†å˜é‡ i ä»å†…å­˜è¯»å–åˆ° CPUå¯„å­˜å™¨ï¼›</li><li>åœ¨CPUå¯„å­˜å™¨ä¸­æ‰§è¡Œ i + 1 æ“ä½œï¼›</li><li>å°†æœ€åçš„ç»“æœiå†™å…¥å†…å­˜ï¼ˆç¼“å­˜æœºåˆ¶å¯¼è‡´å¯èƒ½å†™å…¥çš„æ˜¯ CPU ç¼“å­˜è€Œä¸æ˜¯å†…å­˜ï¼‰</li></ol><h4 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h4><blockquote><p>æœ‰åºæ€§ï¼šå³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;              </span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">i = <span class="number">1</span>;                <span class="comment">//è¯­å¥1  </span></span><br><span class="line">flag = <span class="literal">true</span>;          <span class="comment">//è¯­å¥2</span></span><br></pre></td></tr></table></figure><p>ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œè¯­å¥1æ˜¯åœ¨è¯­å¥2å‰é¢çš„ï¼Œé‚£ä¹ˆJVMåœ¨çœŸæ­£æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ä¼šä¿è¯è¯­å¥1ä¸€å®šä¼šåœ¨è¯­å¥2å‰é¢æ‰§è¡Œå—? </p><p>ä¸ä¸€å®šï¼Œè¿™é‡Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åº.</p><h3 id="ğŸJMM-Javaå†…å­˜æ¨¡å‹-è§£å†³æ–¹æ¡ˆ"><a href="#ğŸJMM-Javaå†…å­˜æ¨¡å‹-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ğŸJMM(Javaå†…å­˜æ¨¡å‹)è§£å†³æ–¹æ¡ˆ"></a>ğŸJMM(Javaå†…å­˜æ¨¡å‹)è§£å†³æ–¹æ¡ˆ</h3><h4 id="åŸå­æ€§-1"><a href="#åŸå­æ€§-1" class="headerlink" title="åŸå­æ€§"></a><strong>åŸå­æ€§</strong></h4><p>Javaå†…å­˜æ¨¡å‹åªä¿è¯äº†<strong>åŸºæœ¬è¯»å–å’Œèµ‹å€¼</strong>æ˜¯åŸå­æ€§æ“ä½œï¼Œå¦‚æœè¦å®ç°æ›´å¤§èŒƒå›´æ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥å®ç°ã€‚ç”±äºsynchronizedå’ŒLockèƒ½å¤Ÿä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥ä»£ç å—ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸å­˜åœ¨åŸå­æ€§é—®é¢˜äº†ï¼Œä»è€Œä¿è¯äº†åŸå­æ€§ã€‚</p><hr><h4 id="å¯è§æ€§-1"><a href="#å¯è§æ€§-1" class="headerlink" title="å¯è§æ€§"></a><strong>å¯è§æ€§</strong></h4><p>å½“ä¸€ä¸ªå…±äº«å˜é‡è¢«<strong>volatile</strong>ä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šç«‹å³è¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»å†…å­˜ä¸­è¯»å–æ–°å€¼</p><p>å¦å¤–ï¼Œé€šè¿‡synchronizedå’ŒLockä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œsynchronizedå’ŒLockèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”åœ¨é‡Šæ”¾é”ä¹‹å‰ä¼šå°†å¯¹å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚</p><hr><h4 id="æœ‰åºæ€§-1"><a href="#æœ‰åºæ€§-1" class="headerlink" title="æœ‰åºæ€§"></a><strong>æœ‰åºæ€§</strong></h4><p>ä¹Ÿæ˜¯ä½¿ç”¨volatileå…³é”®å­—ã€synchronizedå’ŒLock</p><h3 id="ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h3><h4 id="1-äº’æ–¥åŒæ­¥"><a href="#1-äº’æ–¥åŒæ­¥" class="headerlink" title="(1)äº’æ–¥åŒæ­¥"></a><strong>(1)äº’æ–¥åŒæ­¥</strong></h4><p>å¯¹å…±äº«æ•°æ®è¿›è¡ŒåŠ é”ï¼š<strong>synchronized å’Œ ReentrantLock</strong></p><p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p><h4 id="2-éé˜»å¡åŒæ­¥"><a href="#2-éé˜»å¡åŒæ­¥" class="headerlink" title="(2)éé˜»å¡åŒæ­¥"></a><strong>(2)éé˜»å¡åŒæ­¥</strong></h4><h5 id="ä¸€-CAS"><a href="#ä¸€-CAS" class="headerlink" title="(ä¸€)CAS"></a>(ä¸€)CAS</h5><p>æ¯”è¾ƒå¹¶äº¤æ¢(Compare-and-Swapï¼ŒCAS)ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚</p><p>å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œ<strong>åªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º B</strong>ã€‚</p><h5 id="äºŒ-AtomicInteger"><a href="#äºŒ-AtomicInteger" class="headerlink" title="(äºŒ)AtomicInteger"></a><strong>(äºŒ)AtomicInteger</strong></h5><p>ä¹è§‚é”ï¼šé€šè¿‡ getIntVolatile(var1, var2) å¾—åˆ°æ—§çš„é¢„æœŸå€¼ï¼Œé€šè¿‡è°ƒç”¨ compareAndSwapInt() æ¥è¿›è¡Œ CAS æ¯”è¾ƒ</p><p><strong>(ä¸‰)ABA</strong></p><p>å¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚</p><p>J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±» AtomicStampedReference æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="(3)æ— åŒæ­¥æ–¹æ¡ˆ"></a><strong>(3)æ— åŒæ­¥æ–¹æ¡ˆ</strong></h4><p>ä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ã€‚</p><h5 id="ä¸€-æ ˆå°é—­"><a href="#ä¸€-æ ˆå°é—­" class="headerlink" title="(ä¸€)æ ˆå°é—­"></a><strong>(ä¸€)æ ˆå°é—­</strong></h5><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰ã€‚</p><h5 id="äºŒ-çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local-Storageï¼‰"><a href="#äºŒ-çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local-Storageï¼‰" class="headerlink" title="(äºŒ)çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰"></a><strong>(äºŒ)çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰</strong></h5><p>å…³é”®ï¼š<strong>çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…±äº«</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal.set(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(threadLocal.get());</span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal.set(<span class="number">2</span>);</span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š1</p><p>è§£é‡Šï¼šthread1 ä¸­è®¾ç½® threadLocal ä¸º 1ï¼Œè€Œ thread2 è®¾ç½® threadLocal ä¸º 2ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œthread1 è¯»å– threadLocal ä¾ç„¶æ˜¯ 1ï¼Œä¸å— thread2 çš„å½±å“ã€‚</p><p><strong>åŸç†è§£æ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalExample1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal1.set(<span class="number">1</span>);</span><br><span class="line">            threadLocal2.set(<span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal1.set(<span class="number">2</span>);</span><br><span class="line">            threadLocal2.set(<span class="number">2</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.pdai.tech/images/pics/3646544a-cb57-451d-9e03-d3c4f5e4434a.png" alt="image"></p><p>æ¯ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap å¯¹è±¡</p><p>Thread ç±»ä¸­å®šä¹‰äº† ThreadLocal.ThreadLocalMap æˆå‘˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ThreadLocal values pertaining to this thread. This map is maintained</span></span><br><span class="line"><span class="comment"> * by the ThreadLocal class. */</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨ä¸€ä¸ª ThreadLocal çš„ set(T value) æ–¹æ³•æ—¶ï¼Œå…ˆå¾—åˆ°å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå°† ThreadLocal(è‡ªå·±)-&gt;value é”®å€¼å¯¹æ’å…¥åˆ°è¯¥ Map ä¸­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨get()æ–¹æ³•æ—¶ï¼ŒThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ remove ()æ–¹æ³•ï¼Œä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€é•¿å›æ–‡å­ä¸²</title>
      <link href="/posts/52608/"/>
      <url>/posts/52608/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸé¢˜ç›®æè¿°"><a href="#ğŸé¢˜ç›®æè¿°" class="headerlink" title="ğŸé¢˜ç›®æè¿°"></a>ğŸé¢˜ç›®æè¿°</h4><p>â€‹ç»™ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚</p><p>â€‹å¦‚æœå­—ç¬¦ä¸²çš„ååºä¸åŸå§‹å­—ç¬¦ä¸²ç›¸åŒï¼Œåˆ™è¯¥å­—ç¬¦ä¸²ç§°ä¸ºå›æ–‡å­—ç¬¦ä¸²ã€‚</p><h4 id="ğŸæ€è·¯"><a href="#ğŸæ€è·¯" class="headerlink" title="ğŸæ€è·¯"></a>ğŸæ€è·¯</h4><p>ä¸­å¿ƒæ‰©æ•£æ³•ï¼š</p><blockquote><p>é¡¾åæ€ä¹‰ï¼Œå³å¯¹å­—ç¬¦ä¸²sè¿›è¡Œéå†ï¼Œæ¯ä¸ªæˆ–æ¯å¯¹å­—ç¬¦è¿›è¡Œä¸­å¿ƒæ‰©å±•ï¼Œè®°å½•è¿‡ç¨‹ä¸­çš„æœ€å¤§å€¼ã€‚</p><p>æ¯”è¾ƒå›°éš¾çš„åœ°æ–¹åœ¨äºï¼Œå¦‚ä½•å¯¹å¥‡æ•°å’Œå¶æ•°å­—ç¬¦ä¸²è¿›è¡ŒåŒºåˆ†ï¼Ÿå¦‚abbaå’Œabaï¼Œä¸€ä¸ªä»¥ä¸­é—´ä¸¤ä¸ªbä¸ºä¸­å¿ƒï¼Œä¸€ä¸ªä»¥ä¸­é—´ä¸€ä¸ªbä¸ºä¸­å¿ƒã€‚</p><p>æ¯”è¾ƒå·§å¦™çš„æ–¹å¼ä¸ºåŒæŒ‡é’ˆæ–¹æ³•ï¼Œä¹Ÿå³ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ä¸ºç›¸åŒå’Œç›¸å·®ä¸€ä½è¿›è¡Œæ‰©æ•£ï¼Œè¿”å›å¥‡æ•°å­ä¸²é•¿åº¦å’Œå¶æ•°å­ä¸²é•¿åº¦ï¼Œå†è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦å¤–ï¼Œé¢˜ç›®ä¸ä»…ä»…è¿”å›å­ä¸²çš„é•¿åº¦ï¼Œè¿˜æœ‰å­ä¸²æœ¬èº«ï¼Œæ‰€ä»¥éœ€è¦è®°å½•å­ä¸²çš„å¼€å§‹ç´¢å¼•ï¼Œå³ä»£ç ä¸­çš„beginï¼Œé™¤2çš„æ–¹å¼ç»Ÿä¸€äº†å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µã€‚</p></blockquote><h4 id="ğŸä»£ç "><a href="#ğŸä»£ç " class="headerlink" title="ğŸä»£ç "></a>ğŸä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">expand</span><span class="params">(String s,<span class="type">int</span> c1,<span class="type">int</span> c2)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">while</span>(c1&gt;=<span class="number">0</span>&amp;&amp;c2&lt;len&amp;&amp;s.charAt(c1)==s.charAt(c2))&#123;</span><br><span class="line">            c1 -= <span class="number">1</span>;</span><br><span class="line">            c2 += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c2-c1-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">if</span>(len &lt; <span class="number">2</span>) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max_len</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆè¿”å›å­ä¸²çš„å¼€å§‹ç´¢å¼•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">begin</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">odd_len</span> <span class="operator">=</span> expand(s,i,i); <span class="comment">// å¥‡æ•°æ‰©æ•£</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">even_len</span> <span class="operator">=</span> expand(s,i,i+<span class="number">1</span>); <span class="comment">// å¶æ•°æ‰©æ•£</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">cur_len</span> <span class="operator">=</span> Math.max(odd_len,even_len);</span><br><span class="line">            <span class="keyword">if</span>(cur_len &gt; max_len)&#123;</span><br><span class="line">                max_len = cur_len;</span><br><span class="line">                begin = i - (max_len - <span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(begin,begin+max_len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
