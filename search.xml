<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>JUCå·¥å…·</title>
      <link href="/posts/22027/"/>
      <url>/posts/22027/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸAQS"><a href="#ğŸAQS" class="headerlink" title="ğŸAQS"></a>ğŸAQS</h2><h3 id="1-åŸç†"><a href="#1-åŸç†" class="headerlink" title="1 åŸç†"></a>1 åŸç†</h3><blockquote><p>å…¨ç§°æ˜¯ <strong>AbstractQueuedSynchronizer</strong>ï¼Œæ˜¯é˜»å¡å¼é”å’Œç›¸å…³çš„åŒæ­¥å™¨å·¥å…·çš„<strong>æ¡†æ¶</strong></p></blockquote><p>å¦‚ReentrantLockã€ReentrantReadWriteLockã€CountDownLatchã€Semaphoreç­‰éƒ½æ˜¯åŸºäºAQS</p><h4 id="ç›®çš„"><a href="#ç›®çš„" class="headerlink" title="ç›®çš„"></a>ç›®çš„</h4><p>é˜»å¡ç‰ˆæœ¬è·å–é” acquire å’Œéé˜»å¡çš„ç‰ˆæœ¬å°è¯•è·å–é” tryAcquireã€è·å–é”è¶…æ—¶æœºåˆ¶ã€é€šè¿‡æ‰“æ–­å–æ¶ˆæœºåˆ¶ ã€ç‹¬å æœºåˆ¶åŠå…±äº«æœºåˆ¶ã€æ¡ä»¶ä¸æ»¡è¶³æ—¶çš„ç­‰å¾…æœºåˆ¶</p><h4 id="è®¾è®¡"><a href="#è®¾è®¡" class="headerlink" title="è®¾è®¡"></a>è®¾è®¡</h4><p>(1)ç”¨ state å±æ€§æ¥è¡¨ç¤ºèµ„æºçš„çŠ¶æ€ï¼ˆåˆ†ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼‰ï¼Œå­ç±»éœ€è¦å®šä¹‰å¦‚ä½•ç»´æŠ¤è¿™ä¸ªçŠ¶æ€ï¼Œæ§åˆ¶å¦‚ä½•è·å–é”å’Œé‡Šæ”¾é” </p><p>â€‹getState - è·å– state çŠ¶æ€ </p><p>â€‹setState - è®¾ç½® state çŠ¶æ€ </p><p>â€‹compareAndSetState - cas æœºåˆ¶è®¾ç½® state çŠ¶æ€ </p><p>â€‹ç‹¬å æ¨¡å¼æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®èµ„æºï¼Œè€Œå…±äº«æ¨¡å¼å¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹è®¿é—®èµ„æº </p><p>è·å–é”é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(state çŠ¶æ€ä¸å…è®¸è·å–) &#123;</span><br><span class="line"> <span class="keyword">if</span>(é˜Ÿåˆ—ä¸­è¿˜æ²¡æœ‰æ­¤çº¿ç¨‹) &#123;</span><br><span class="line">å…¥é˜Ÿå¹¶é˜»å¡</span><br><span class="line">    &#125;</span><br><span class="line"> &#125;</span><br><span class="line">å½“å‰çº¿ç¨‹å‡ºé˜Ÿ</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”é€»è¾‘</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(state çŠ¶æ€å…è®¸äº†) &#123;</span><br><span class="line">æ¢å¤é˜»å¡çš„çº¿ç¨‹(s)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>(2)æä¾›äº†åŸºäº FIFO çš„ç­‰å¾…é˜Ÿåˆ—ï¼Œç±»ä¼¼äº Monitor çš„ EntryList </p><p>é˜Ÿåˆ—ä¸­æœ‰ head å’Œ tail ä¸¤ä¸ªæŒ‡é’ˆèŠ‚ç‚¹ï¼Œéƒ½ç”¨ volatile ä¿®é¥°é…åˆ cas ä½¿ç”¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ state ç»´æŠ¤èŠ‚ç‚¹çŠ¶æ€</p><img src="/img/22027/JUCå·¥å…·1.png" alt="image-20231205204946084" style="zoom:50%;" /><p>(3)æ¡ä»¶å˜é‡æ¥å®ç°ç­‰å¾…ã€å”¤é†’æœºåˆ¶ï¼Œæ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡ï¼Œç±»ä¼¼äº Monitor çš„ WaitSet</p><h3 id="2-è‡ªå®šä¹‰"><a href="#2-è‡ªå®šä¹‰" class="headerlink" title="2 è‡ªå®šä¹‰"></a>2 è‡ªå®šä¹‰</h3><h4 id="è‡ªå®šä¹‰åŒæ­¥å™¨"><a href="#è‡ªå®šä¹‰åŒæ­¥å™¨" class="headerlink" title="è‡ªå®šä¹‰åŒæ­¥å™¨"></a>è‡ªå®šä¹‰åŒæ­¥å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">MySync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acquires == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (compareAndSetState(<span class="number">0</span>, <span class="number">1</span>)) &#123;</span><br><span class="line">                setExclusiveOwnerThread(Thread.currentThread());</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (acquires == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (getState() == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            setExclusiveOwnerThread(<span class="literal">null</span>);</span><br><span class="line">            setState(<span class="number">0</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> Condition <span class="title function_">newCondition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConditionObject</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isHeldExclusively</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getState() == <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="è‡ªå®šä¹‰é”"><a href="#è‡ªå®šä¹‰é”" class="headerlink" title="è‡ªå®šä¹‰é”"></a>è‡ªå®šä¹‰é”</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLock</span> <span class="keyword">implements</span> <span class="title class_">Lock</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">MySync</span> <span class="variable">sync</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MySync</span>();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œå¯æ‰“æ–­</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lockInterruptibly</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        sync.acquireInterruptibly(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// å°è¯•ä¸€æ¬¡ï¼Œä¸æˆåŠŸè¿”å›ï¼Œä¸è¿›å…¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// å°è¯•ï¼Œä¸æˆåŠŸï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œæœ‰æ—¶é™</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.tryAcquireNanos(<span class="number">1</span>, unit.toNanos(time));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="comment">// ç”Ÿæˆæ¡ä»¶å˜é‡</span></span><br><span class="line">    <span class="keyword">public</span> Condition <span class="title function_">newCondition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æµ‹è¯•"><a href="#æµ‹è¯•" class="headerlink" title="æµ‹è¯•"></a>æµ‹è¯•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">MyLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyLock</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;locking...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;unlocking...&quot;</span>);</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;locking...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;unlocking...&quot;</span>);</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;,<span class="string">&quot;t2&quot;</span>).start();  </span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">22:29:28.727 c.TestAqs [t1] - locking... </span><br><span class="line">22:29:29.732 c.TestAqs [t1] - unlocking... </span><br><span class="line">22:29:29.732 c.TestAqs [t2] - locking... </span><br><span class="line">22:29:29.732 c.TestAqs [t2] - unlocking... </span><br></pre></td></tr></table></figure><h2 id="ğŸReentrantReadWriteLock"><a href="#ğŸReentrantReadWriteLock" class="headerlink" title="ğŸReentrantReadWriteLock"></a>ğŸReentrantReadWriteLock</h2><blockquote><p>å½“è¯»æ“ä½œè¿œè¿œé«˜äºå†™æ“ä½œæ—¶ï¼Œè¿™æ—¶å€™ä½¿ç”¨<strong>è¯»å†™é”</strong>è®©<strong>è¯»-è¯»</strong>å¯ä»¥å¹¶å‘ï¼Œæé«˜æ€§èƒ½ã€‚ ç±»ä¼¼äºæ•°æ®åº“ä¸­çš„  from â€¦ lock in share mode</p></blockquote><p>æä¾›ä¸€ä¸ª <strong>æ•°æ®å®¹å™¨ç±»</strong>ï¼Œå†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„ <strong>read() æ–¹æ³•</strong>ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„ <strong>write() æ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataContainer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> ReentrantReadWriteLock.<span class="type">ReadLock</span> <span class="variable">r</span> <span class="operator">=</span> rw.readLock();</span><br><span class="line">    <span class="keyword">private</span> ReentrantReadWriteLock.<span class="type">WriteLock</span> <span class="variable">w</span> <span class="operator">=</span> rw.writeLock();</span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">read</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å–è¯»é”...&quot;</span>);</span><br><span class="line">        r.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;è¯»å–&quot;</span>);</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;é‡Šæ”¾è¯»é”...&quot;</span>);</span><br><span class="line">            r.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å–å†™é”...&quot;</span>);</span><br><span class="line">        w.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å†™å…¥&quot;</span>);</span><br><span class="line">            sleep(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;é‡Šæ”¾å†™é”...&quot;</span>);</span><br><span class="line">            w.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»é”-è¯»é” å¯ä»¥å¹¶å‘:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataContainer</span> <span class="variable">dataContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataContainer</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">     dataContainer.read();</span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">     dataContainer.read();</span><br><span class="line">&#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼šThread-0 é”å®šæœŸé—´ï¼ŒThread-1 çš„è¯»æ“ä½œä¸å—å½±å“</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">14.341</span> c.DataContainer [t2] - è·å–è¯»é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">14.341</span> c.DataContainer [t1] - è·å–è¯»é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">14.345</span> c.DataContainer [t1] - è¯»å– </span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">14.345</span> c.DataContainer [t2] - è¯»å– </span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">15.365</span> c.DataContainer [t2] - é‡Šæ”¾è¯»é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">05</span>:<span class="number">15.386</span> c.DataContainer [t1] - é‡Šæ”¾è¯»é”...</span><br></pre></td></tr></table></figure><p>è¯»é”-å†™é” ç›¸äº’é˜»å¡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">DataContainer</span> <span class="variable">dataContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataContainer</span>();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">     dataContainer.read();</span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">Thread.sleep(<span class="number">100</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">     dataContainer.write();</span><br><span class="line">&#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼šå¿…é¡»ç­‰è¯»é”é‡Šæ”¾æ‰èƒ½è·å¾—å†™é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">21.838</span> c.DataContainer [t1] - è·å–è¯»é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">21.838</span> c.DataContainer [t2] - è·å–å†™é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">21.841</span> c.DataContainer [t2] - å†™å…¥ </span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">22.843</span> c.DataContainer [t2] - é‡Šæ”¾å†™é”... </span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">22.843</span> c.DataContainer [t1] - è¯»å– </span><br><span class="line"><span class="number">14</span>:<span class="number">04</span>:<span class="number">23.843</span> c.DataContainer [t1] - é‡Šæ”¾è¯»é”... </span><br></pre></td></tr></table></figure><p>æ³¨æ„ï¼š</p><ul><li>è¯»é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ </li><li>é‡å…¥æ—¶å‡çº§ä¸æ”¯æŒï¼šå³æŒæœ‰è¯»é”çš„æƒ…å†µä¸‹å»è·å–å†™é”ï¼Œä¼šå¯¼è‡´è·å–å†™é”æ°¸ä¹…ç­‰å¾…</li><li>é‡å…¥æ—¶é™çº§æ”¯æŒï¼šå³æŒæœ‰å†™é”çš„æƒ…å†µä¸‹å»è·å–è¯»é”</li></ul><h2 id="ğŸStampedLock"><a href="#ğŸStampedLock" class="headerlink" title="ğŸStampedLock"></a>ğŸStampedLock</h2><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><blockquote><p>åœ¨ä½¿ç”¨è¯»é”ã€å†™é”æ—¶éƒ½å¿…é¡»é…åˆã€æˆ³ã€‘ä½¿ç”¨ï¼Œè¯¥é”ä¸æ”¯æŒæ¡ä»¶å˜é‡ã€ä¸æ”¯æŒå¯é‡å…¥</p></blockquote><p>åŠ è§£è¯»é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">stamp</span> <span class="operator">=</span> lock.readLock();</span><br><span class="line">lock.unlockRead(stamp);</span><br></pre></td></tr></table></figure><p>åŠ è§£å†™é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">stamp</span> <span class="operator">=</span> lock.writeLock();</span><br><span class="line">lock.unlockWrite(stamp);</span><br></pre></td></tr></table></figure><p>ä¹è§‚è¯»ï¼ŒStampedLock æ”¯æŒ  tryOptimisticRead() æ–¹æ³•ï¼ˆä¹è§‚è¯»ï¼‰ï¼Œè¯»å–å®Œæ¯•åéœ€è¦åšä¸€æ¬¡<strong>æˆ³æ ¡éªŒ</strong>å¦‚æœæ ¡éªŒé€šè¿‡ï¼Œè¡¨ç¤ºè¿™æœŸé—´ç¡®å®æ²¡æœ‰å†™æ“ä½œï¼Œæ•°æ®å¯ä»¥å®‰å…¨ä½¿ç”¨ï¼Œå¦‚æœæ ¡éªŒæ²¡é€šè¿‡ï¼Œéœ€è¦é‡æ–°è·å–è¯»é”ï¼Œä¿è¯æ•°æ®å®‰å…¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">long</span> <span class="variable">stamp</span> <span class="operator">=</span> lock.tryOptimisticRead();</span><br><span class="line"> <span class="comment">// éªŒæˆ³</span></span><br><span class="line"><span class="keyword">if</span>(!lock.validate(stamp))&#123;</span><br><span class="line"> <span class="comment">// é”å‡çº§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>æä¾›ä¸€ä¸ªæ•°æ®å®¹å™¨ç±»ï¼Œå†…éƒ¨åˆ†åˆ«ä½¿ç”¨è¯»é”ä¿æŠ¤æ•°æ®çš„read() æ–¹æ³•ï¼Œå†™é”ä¿æŠ¤æ•°æ®çš„  write() æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">DataContainerStamped</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> data;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">StampedLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StampedLock</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DataContainerStamped</span><span class="params">(<span class="type">int</span> data)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">(<span class="type">int</span> readTime)</span> &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">stamp</span> <span class="operator">=</span> lock.tryOptimisticRead();</span><br><span class="line">        log.debug(<span class="string">&quot;optimistic read locking...&#123;&#125;&quot;</span>, stamp);</span><br><span class="line">        sleep(readTime);</span><br><span class="line">        <span class="keyword">if</span> (lock.validate(stamp)) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;</span>, stamp, data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// é”å‡çº§ - è¯»é”</span></span><br><span class="line">        log.debug(<span class="string">&quot;updating to read lock... &#123;&#125;&quot;</span>, stamp);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            stamp = lock.readLock();</span><br><span class="line">            log.debug(<span class="string">&quot;read lock &#123;&#125;&quot;</span>, stamp);</span><br><span class="line">            sleep(readTime);</span><br><span class="line">            log.debug(<span class="string">&quot;read finish...&#123;&#125;, data:&#123;&#125;&quot;</span>, stamp, data);</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;read unlock &#123;&#125;&quot;</span>, stamp);</span><br><span class="line">            lock.unlockRead(stamp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> newData)</span>&#123;</span><br><span class="line">        <span class="type">long</span> stamp=lock.writeLock();</span><br><span class="line">        log.debug(<span class="string">&quot;write lock &#123;&#125;&quot;</span>,stamp);</span><br><span class="line">        <span class="keyword">try</span>&#123;</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">            <span class="built_in">this</span>.data=newData;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span>&#123;</span><br><span class="line">            log.debug(<span class="string">&quot;write unlock &#123;&#125;&quot;</span>,stamp);</span><br><span class="line">            lock.unlockWrite(stamp);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯»-è¯» å¯ä»¥ä¼˜åŒ–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">DataContainerStamped</span> <span class="variable">dataContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataContainerStamped</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        dataContainer.read(<span class="number">1</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        dataContainer.read(<span class="number">0</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼šå®é™…æ²¡æœ‰åŠ è¯»é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">15</span>:<span class="number">58</span>:<span class="number">50.217</span> c.DataContainerStamped [t1] - optimistic read locking..<span class="number">.256</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">58</span>:<span class="number">50.717</span> c.DataContainerStamped [t2] - optimistic read locking..<span class="number">.256</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">58</span>:<span class="number">50.717</span> c.DataContainerStamped [t2] - read finish..<span class="number">.256</span>, data:<span class="number">1</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">58</span>:<span class="number">51.220</span> c.DataContainerStamped [t1] - read finish..<span class="number">.256</span>, data:<span class="number">1</span> </span><br></pre></td></tr></table></figure><p>è¯»-å†™ æ—¶ä¼˜åŒ–-è¯»è¡¥åŠ è¯»é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">DataContainerStamped</span> <span class="variable">dataContainer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataContainerStamped</span>(<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        dataContainer.read(<span class="number">1</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        dataContainer.write(<span class="number">100</span>);</span><br><span class="line">    &#125;,<span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">00.219</span> c.DataContainerStamped [t1] - optimistic read locking..<span class="number">.256</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">00.717</span> c.DataContainerStamped [t2] - write lock <span class="number">384</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">01.225</span> c.DataContainerStamped [t1] - updating to read lock... <span class="number">256</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">02.719</span> c.DataContainerStamped [t2] - write unlock <span class="number">384</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">02.719</span> c.DataContainerStamped [t1] - read lock <span class="number">513</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">03.719</span> c.DataContainerStamped [t1] - read finish..<span class="number">.513</span>, data:<span class="number">1000</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">57</span>:<span class="number">03.719</span> c.DataContainerStamped [t1] - read unlock <span class="number">513</span> </span><br></pre></td></tr></table></figure><h2 id="ğŸSemaphore"><a href="#ğŸSemaphore" class="headerlink" title="ğŸSemaphore"></a>ğŸSemaphore</h2><blockquote><p> ä¿¡å·é‡ï¼Œç”¨æ¥é™åˆ¶èƒ½åŒæ—¶è®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹ä¸Šé™</p></blockquote><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. åˆ›å»º semaphore å¯¹è±¡</span></span><br><span class="line">    <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="comment">// 2. 10ä¸ªçº¿ç¨‹åŒæ—¶è¿è¡Œ</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="comment">// 3. è·å–è®¸å¯</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                semaphore.acquire();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                log.debug(<span class="string">&quot;running...&quot;</span>);</span><br><span class="line">                sleep(<span class="number">1</span>);</span><br><span class="line">                log.debug(<span class="string">&quot;end...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">// 4. é‡Šæ”¾è®¸å¯</span></span><br><span class="line">        semaphore.release();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">15.485</span> c.TestSemaphore [Thread-<span class="number">2</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">15.485</span> c.TestSemaphore [Thread-<span class="number">1</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">15.485</span> c.TestSemaphore [Thread-<span class="number">0</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">2</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">0</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">1</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">3</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">5</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">16.490</span> c.TestSemaphore [Thread-<span class="number">4</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">5</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">4</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">3</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">6</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">7</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">17.490</span> c.TestSemaphore [Thread-<span class="number">9</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">18.491</span> c.TestSemaphore [Thread-<span class="number">6</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">18.491</span> c.TestSemaphore [Thread-<span class="number">7</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">18.491</span> c.TestSemaphore [Thread-<span class="number">9</span>] - end... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">18.491</span> c.TestSemaphore [Thread-<span class="number">8</span>] - running... </span><br><span class="line"><span class="number">07</span>:<span class="number">35</span>:<span class="number">19.492</span> c.TestSemaphore [Thread-<span class="number">8</span>] - end... </span><br></pre></td></tr></table></figure><h2 id="ğŸCountdownLatch"><a href="#ğŸCountdownLatch" class="headerlink" title="ğŸCountdownLatch"></a>ğŸCountdownLatch</h2><blockquote><p>ç”¨æ¥è¿›è¡Œçº¿ç¨‹åŒæ­¥åä½œï¼Œç­‰å¾…æ‰€æœ‰çº¿ç¨‹å®Œæˆå€’è®¡æ—¶</p></blockquote><p>å…¶ä¸­æ„é€ å‚æ•°ç”¨æ¥åˆå§‹åŒ–ç­‰å¾…è®¡æ•°å€¼ï¼Œawait() ç”¨æ¥ç­‰å¾…è®¡æ•°å½’é›¶ï¼ŒcountDown() ç”¨æ¥è®©è®¡æ•°å‡ä¸€</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1.5</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;).start();</span><br><span class="line">    log.debug(<span class="string">&quot;waiting...&quot;</span>);</span><br><span class="line">    latch.await();</span><br><span class="line">    log.debug(<span class="string">&quot;wait end...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">00.778</span> c.TestCountDownLatch [main] - waiting... </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">00.778</span> c.TestCountDownLatch [Thread-<span class="number">2</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">00.778</span> c.TestCountDownLatch [Thread-<span class="number">0</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">00.778</span> c.TestCountDownLatch [Thread-<span class="number">1</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">01.782</span> c.TestCountDownLatch [Thread-<span class="number">0</span>] - end..<span class="number">.2</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">02.283</span> c.TestCountDownLatch [Thread-<span class="number">2</span>] - end..<span class="number">.1</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">02.782</span> c.TestCountDownLatch [Thread-<span class="number">1</span>] - end..<span class="number">.0</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">44</span>:<span class="number">02.782</span> c.TestCountDownLatch [main] - wait end... </span><br></pre></td></tr></table></figure><p>é…åˆçº¿ç¨‹æ± ä½¿ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">3</span>);</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">4</span>);</span><br><span class="line">    service.submit(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;);</span><br><span class="line">    service.submit(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1.5</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;);</span><br><span class="line">    service.submit(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;begin...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        latch.countDown();</span><br><span class="line">        log.debug(<span class="string">&quot;end...&#123;&#125;&quot;</span>, latch.getCount());</span><br><span class="line">    &#125;);</span><br><span class="line">    service.submit(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;waiting...&quot;</span>);</span><br><span class="line">            latch.await();</span><br><span class="line">            log.debug(<span class="string">&quot;wait end...&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">25.831</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">3</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">25.831</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">1</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">25.831</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">2</span>] - begin... </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">25.831</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">4</span>] - waiting... </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">26.835</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">1</span>] - end..<span class="number">.2</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">27.335</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">2</span>] - end..<span class="number">.1</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">27.835</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">3</span>] - end..<span class="number">.0</span> </span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">27.835</span> c.TestCountDownLatch [pool-<span class="number">1</span>-thread-<span class="number">4</span>] - wait end...</span><br></pre></td></tr></table></figure><h2 id="ğŸCyclicBarrier"><a href="#ğŸCyclicBarrier" class="headerlink" title="ğŸCyclicBarrier"></a>ğŸCyclicBarrier</h2><blockquote><p>å¾ªç¯æ …æ ï¼Œç”¨æ¥è¿›è¡Œçº¿ç¨‹åä½œï¼Œç­‰å¾…çº¿ç¨‹æ»¡è¶³æŸä¸ªè®¡æ•°ã€‚</p></blockquote><p>æ„é€ æ—¶è®¾ç½®ã€è®¡æ•°ä¸ªæ•°ã€ï¼Œæ¯ä¸ªçº¿ç¨‹æ‰§ è¡Œåˆ°æŸä¸ªéœ€è¦â€œåŒæ­¥â€çš„æ—¶åˆ»è°ƒç”¨ await() æ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“ç­‰å¾…çš„çº¿ç¨‹æ•°æ»¡è¶³ã€è®¡æ•°ä¸ªæ•°ã€æ—¶ï¼Œç»§ç»­æ‰§è¡Œã€‚</p><p>ä¸ CountDownLatch çš„ä¸»è¦åŒºåˆ«ï¼šCyclicBarrier æ˜¯å¯ä»¥é‡ç”¨çš„ï¼ŒCyclicBarrierã€äººæ»¡å‘è½¦ã€‘</p><p>ä½¿ç”¨ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CyclicBarrier</span> <span class="variable">cb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">2</span>); <span class="comment">// ä¸ªæ•°ä¸º2æ—¶æ‰ä¼šç»§ç»­æ‰§è¡Œ</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;çº¿ç¨‹1å¼€å§‹..&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    cb.await(); <span class="comment">// å½“ä¸ªæ•°ä¸è¶³æ—¶ï¼Œç­‰å¾…</span></span><br><span class="line">&#125;<span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">System.out.println(<span class="string">&quot;çº¿ç¨‹1ç»§ç»­å‘ä¸‹è¿è¡Œ...&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;çº¿ç¨‹2å¼€å§‹..&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"><span class="keyword">try</span> &#123; Thread.sleep(<span class="number">2000</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; &#125;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    cb.await(); <span class="comment">// 2 ç§’åï¼Œçº¿ç¨‹ä¸ªæ•°å¤Ÿ2ï¼Œç»§ç»­è¿è¡Œ</span></span><br><span class="line">&#125;<span class="keyword">catch</span> (InterruptedException | BrokenBarrierException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;çº¿ç¨‹2ç»§ç»­å‘ä¸‹è¿è¡Œ...&quot;</span>+<span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCæ— é”</title>
      <link href="/posts/11206/"/>
      <url>/posts/11206/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸCAS"><a href="#ğŸCAS" class="headerlink" title="ğŸCAS"></a>ğŸCAS</h2><h3 id="é—®é¢˜å¼•å…¥"><a href="#é—®é¢˜å¼•å…¥" class="headerlink" title="é—®é¢˜å¼•å…¥"></a>é—®é¢˜å¼•å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccountUnsafe</span> <span class="keyword">implements</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountUnsafe</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="comment">// è·å–ä½™é¢</span></span><br><span class="line">    Integer <span class="title function_">getBalance</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">// å–æ¬¾</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ–¹æ³•å†…ä¼šå¯åŠ¨ 1000 ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹åš -10 å…ƒ çš„æ“ä½œ</span></span><br><span class="line"><span class="comment">     * å¦‚æœåˆå§‹ä½™é¢ä¸º 10000 é‚£ä¹ˆæ­£ç¡®çš„ç»“æœåº”å½“æ˜¯ 0</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(Account account)</span> &#123;</span><br><span class="line">        List&lt;Thread&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">            ts.add(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                account.withdraw(<span class="number">10</span>);</span><br><span class="line">            &#125;));</span><br><span class="line">        &#125;</span><br><span class="line">        ts.forEach(Thread::start);</span><br><span class="line">        ts.forEach(t -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                t.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">        System.out.println(account.getBalance()</span><br><span class="line">                + <span class="string">&quot; cost: &quot;</span> + (end-start)/<span class="number">1000_000</span> + <span class="string">&quot; ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¿è¯ä¸Šè¿°withdrawæ–¹æ³•çš„æ­£ç¡®æ€§ï¼Œå¯ä»¥è¿›è¡ŒåŠ é”ã€‚</p><h3 id="åŠ é”æ–¹æ¡ˆ"><a href="#åŠ é”æ–¹æ¡ˆ" class="headerlink" title="åŠ é”æ–¹æ¡ˆ"></a>åŠ é”æ–¹æ¡ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccountUnsafe</span> <span class="keyword">implements</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer balance;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountUnsafe</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        balance -= amount;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ— é”æ–¹æ¡ˆ"><a href="#æ— é”æ–¹æ¡ˆ" class="headerlink" title="æ— é”æ–¹æ¡ˆ"></a>æ— é”æ–¹æ¡ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">AccountSafe</span> <span class="keyword">implements</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AtomicInteger balance;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountSafe</span><span class="params">(Integer balance)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.balance = <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(balance);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">getBalance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> balance.get();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">withdraw</span><span class="params">(Integer amount)</span> &#123;</span><br><span class="line">        <span class="comment">// ä¸æ–­å¾ªç¯æ›´æ”¹</span></span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="comment">// æ¯”å¦‚æ‹¿åˆ°äº†æ—§å€¼ 1000</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">prev</span> <span class="operator">=</span> balance.get();</span><br><span class="line">            <span class="comment">// åœ¨è¿™ä¸ªåŸºç¡€ä¸Š 1000-10 = 990</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">next</span> <span class="operator">=</span> prev - amount;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">             compareAndSet æ­£æ˜¯åšè¿™ä¸ªæ£€æŸ¥ï¼Œåœ¨ set å‰ï¼Œå…ˆæ¯”è¾ƒ prev ä¸å½“å‰å€¼</span></span><br><span class="line"><span class="comment">             - ä¸ä¸€è‡´äº†ï¼Œnext ä½œåºŸï¼Œè¿”å› false è¡¨ç¤ºå¤±è´¥</span></span><br><span class="line"><span class="comment">             æ¯”å¦‚ï¼Œåˆ«çš„çº¿ç¨‹å·²ç»åšäº†å‡æ³•ï¼Œå½“å‰å€¼å·²ç»è¢«å‡æˆäº† 990</span></span><br><span class="line"><span class="comment">             é‚£ä¹ˆæœ¬çº¿ç¨‹çš„è¿™æ¬¡ 990 å°±ä½œåºŸäº†ï¼Œè¿›å…¥ while ä¸‹æ¬¡å¾ªç¯é‡è¯•</span></span><br><span class="line"><span class="comment">             - ä¸€è‡´ï¼Œä»¥ next è®¾ç½®ä¸ºæ–°å€¼ï¼Œè¿”å› true è¡¨ç¤ºæˆåŠŸ</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">if</span> (balance.compareAndSet(prev, next)) &#123; <span class="comment">// CASæ“ä½œ</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢çš„æ–¹æ³•</span></span><br><span class="line">        <span class="comment">// balance.addAndGet(-1 * amount);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>compareAndSetï¼Œç®€ç§°<strong>CAS</strong> ï¼ˆä¹Ÿæœ‰ Compare And Swap çš„è¯´æ³•ï¼‰ï¼Œå®ƒå¿…é¡»æ˜¯åŸå­æ“ä½œï¼š</p><img src="/img/11206/æ— é”1.png" alt="image-20231113163814280" style="zoom: 50%;" /><p><strong>æ— é”æ•ˆç‡é«˜ï¼š</strong></p><p>â€‹æ— é”æƒ…å†µä¸‹ï¼Œå³ä½¿é‡è¯•å¤±è´¥ï¼Œçº¿ç¨‹å§‹ç»ˆåœ¨é«˜é€Ÿè¿è¡Œï¼Œæ²¡æœ‰åœæ­‡ï¼Œè€Œ synchronized ä¼šè®©çº¿ç¨‹åœ¨æ²¡æœ‰è·å¾—é”çš„æ—¶å€™ï¼Œå‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè¿›å…¥é˜»å¡</p><h2 id="ğŸåŸå­æ•´æ•°"><a href="#ğŸåŸå­æ•´æ•°" class="headerlink" title="ğŸåŸå­æ•´æ•°"></a>ğŸåŸå­æ•´æ•°</h2><p>JUCæä¾›æœ‰ï¼šAtomicBooleanã€AtomicIntegerã€AtomicLongæ¥ä¿è¯å¤šçº¿ç¨‹æ“ä½œçš„ä¸€è‡´æ€§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»¥AtomicIntegerä¸ºä¾‹</span></span><br><span class="line"></span><br><span class="line"><span class="type">AtomicInteger</span> <span class="variable">i</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"><span class="comment">// è·å–å¹¶è‡ªå¢ï¼ˆi = 0, ç»“æœ i = 1, è¿”å› 0ï¼‰ï¼Œç±»ä¼¼äº i++</span></span><br><span class="line">System.out.println(i.getAndIncrement());</span><br><span class="line"><span class="comment">// è‡ªå¢å¹¶è·å–ï¼ˆi = 1, ç»“æœ i = 2, è¿”å› 2ï¼‰ï¼Œç±»ä¼¼äº ++i</span></span><br><span class="line">System.out.println(i.incrementAndGet());</span><br><span class="line"><span class="comment">// è‡ªå‡å¹¶è·å–ï¼ˆi = 2, ç»“æœ i = 1, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº --i</span></span><br><span class="line">System.out.println(i.decrementAndGet());</span><br><span class="line"><span class="comment">// è·å–å¹¶è‡ªå‡ï¼ˆi = 1, ç»“æœ i = 0, è¿”å› 1ï¼‰ï¼Œç±»ä¼¼äº i--</span></span><br><span class="line">System.out.println(i.getAndDecrement());</span><br><span class="line"><span class="comment">// è·å–å¹¶åŠ å€¼ï¼ˆi = 0, ç»“æœ i = 5, è¿”å› 0ï¼‰</span></span><br><span class="line">System.out.println(i.getAndAdd(<span class="number">5</span>));</span><br><span class="line"><span class="comment">// åŠ å€¼å¹¶è·å–ï¼ˆi = 5, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line">System.out.println(i.addAndGet(-<span class="number">5</span>));</span><br><span class="line"><span class="comment">// è·å–å¹¶æ›´æ–°ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = -2, è¿”å› 0ï¼‰</span></span><br><span class="line"><span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">System.out.println(i.getAndUpdate(p -&gt; p - <span class="number">2</span>));</span><br><span class="line"><span class="comment">// æ›´æ–°å¹¶è·å–ï¼ˆi = -2, p ä¸º i çš„å½“å‰å€¼, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line"><span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">System.out.println(i.updateAndGet(p -&gt; p + <span class="number">2</span>));</span><br><span class="line"><span class="comment">// è·å–å¹¶è®¡ç®—ï¼ˆi = 0, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 10, è¿”å› 0ï¼‰</span></span><br><span class="line"><span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line"><span class="comment">// getAndUpdate å¦‚æœåœ¨ lambda ä¸­å¼•ç”¨äº†å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œè¦ä¿è¯è¯¥å±€éƒ¨å˜é‡æ˜¯ final çš„</span></span><br><span class="line"><span class="comment">// getAndAccumulate å¯ä»¥é€šè¿‡ å‚æ•°1 æ¥å¼•ç”¨å¤–éƒ¨çš„å±€éƒ¨å˜é‡ï¼Œä½†å› ä¸ºå…¶ä¸åœ¨ lambda ä¸­å› æ­¤ä¸å¿…æ˜¯ final</span></span><br><span class="line">System.out.println(i.getAndAccumulate(<span class="number">10</span>, (p, x) -&gt; p + x));</span><br><span class="line"><span class="comment">// è®¡ç®—å¹¶è·å–ï¼ˆi = 10, p ä¸º i çš„å½“å‰å€¼, x ä¸ºå‚æ•°1, ç»“æœ i = 0, è¿”å› 0ï¼‰</span></span><br><span class="line"><span class="comment">// å…¶ä¸­å‡½æ•°ä¸­çš„æ“ä½œèƒ½ä¿è¯åŸå­ï¼Œä½†å‡½æ•°éœ€è¦æ— å‰¯ä½œç”¨</span></span><br><span class="line">System.out.println(i.accumulateAndGet(-<span class="number">10</span>, (p, x) -&gt; p + x));</span><br></pre></td></tr></table></figure><h2 id="ğŸåŸå­å¼•ç”¨"><a href="#ğŸåŸå­å¼•ç”¨" class="headerlink" title="ğŸåŸå­å¼•ç”¨"></a>ğŸåŸå­å¼•ç”¨</h2><p>JUCæä¾›æœ‰ï¼šAtomicReferenceã€AtomicMarkableReferenceã€AtomicStampedReference</p><h3 id="ABAé—®é¢˜"><a href="#ABAé—®é¢˜" class="headerlink" title="ABAé—®é¢˜"></a>ABAé—®é¢˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> AtomicReference&lt;String&gt; ref = <span class="keyword">new</span> <span class="title class_">AtomicReference</span>&lt;&gt;(<span class="string">&quot;A&quot;</span>);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;main start...&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å–å€¼ A</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå…±äº«å˜é‡è¢«å®ƒçº¿ç¨‹ä¿®æ”¹è¿‡ï¼Ÿ</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> ref.get();</span><br><span class="line">    other();</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// å°è¯•æ”¹ä¸º C</span></span><br><span class="line">    log.debug(<span class="string">&quot;change A-&gt;C &#123;&#125;&quot;</span>, ref.compareAndSet(prev, <span class="string">&quot;C&quot;</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">other</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;change A-&gt;B &#123;&#125;&quot;</span>, ref.compareAndSet(ref.get(), <span class="string">&quot;B&quot;</span>));</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;change B-&gt;A &#123;&#125;&quot;</span>, ref.compareAndSet(ref.get(), <span class="string">&quot;A&quot;</span>));</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">11:29:52.325 c.Test36 [main] - main start... </span><br><span class="line">11:29:52.379 c.Test36 [t1] - change A-&gt;B true </span><br><span class="line">11:29:52.879 c.Test36 [t2] - change B-&gt;A true </span><br><span class="line">11:29:53.880 c.Test36 [main] - change A-&gt;C true </span><br></pre></td></tr></table></figure><p>ä¸»çº¿ç¨‹ä»…èƒ½åˆ¤æ–­å‡ºå…±äº«å˜é‡çš„å€¼ä¸æœ€åˆå€¼ A æ˜¯å¦ç›¸åŒï¼Œä¸èƒ½æ„ŸçŸ¥åˆ°è¿™ç§ä» A æ”¹ä¸º B åˆ æ”¹å› A çš„æƒ…å†µï¼Œå¦‚æœä¸»çº¿ç¨‹ å¸Œæœ›ï¼š <strong>åªè¦æœ‰å…¶å®ƒçº¿ç¨‹ã€åŠ¨è¿‡äº†ã€‘å…±äº«å˜é‡ï¼Œé‚£ä¹ˆè‡ªå·±çš„ cas å°±ç®—å¤±è´¥</strong>ï¼Œè¿™æ—¶ï¼Œä»…æ¯”è¾ƒå€¼æ˜¯ä¸å¤Ÿçš„ï¼Œéœ€è¦<strong>å†åŠ ä¸€ä¸ªç‰ˆæœ¬å·</strong>ï¼Œäºæ˜¯å¼•å‡º<strong>AtomicStampedReference</strong></p><h3 id="AtomicStampedReference"><a href="#AtomicStampedReference" class="headerlink" title="AtomicStampedReference"></a>AtomicStampedReference</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> AtomicStampedReference&lt;String&gt; ref = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="string">&quot;A&quot;</span>, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;main start...&quot;</span>);</span><br><span class="line">    <span class="comment">// è·å–å€¼ A</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">prev</span> <span class="operator">=</span> ref.getReference();</span><br><span class="line">    <span class="comment">// è·å–ç‰ˆæœ¬å·</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">stamp</span> <span class="operator">=</span> ref.getStamp();</span><br><span class="line">    log.debug(<span class="string">&quot;ç‰ˆæœ¬ &#123;&#125;&quot;</span>, stamp);</span><br><span class="line">    <span class="comment">// å¦‚æœä¸­é—´æœ‰å…¶å®ƒçº¿ç¨‹å¹²æ‰°ï¼Œå‘ç”Ÿäº† ABA ç°è±¡</span></span><br><span class="line">    other();</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">// å°è¯•æ”¹ä¸º C</span></span><br><span class="line">    log.debug(<span class="string">&quot;change A-&gt;C &#123;&#125;&quot;</span>, ref.compareAndSet(prev, <span class="string">&quot;C&quot;</span>, stamp, stamp + <span class="number">1</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">other</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;change A-&gt;B &#123;&#125;&quot;</span>, ref.compareAndSet(ref.getReference(), <span class="string">&quot;B&quot;</span>,</span><br><span class="line">                ref.getStamp(), ref.getStamp() + <span class="number">1</span>));</span><br><span class="line">        log.debug(<span class="string">&quot;æ›´æ–°ç‰ˆæœ¬ä¸º &#123;&#125;&quot;</span>, ref.getStamp());</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>).start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;change B-&gt;A &#123;&#125;&quot;</span>, ref.compareAndSet(ref.getReference(), <span class="string">&quot;A&quot;</span>,</span><br><span class="line">                ref.getStamp(), ref.getStamp() + <span class="number">1</span>));</span><br><span class="line">        log.debug(<span class="string">&quot;æ›´æ–°ç‰ˆæœ¬ä¸º &#123;&#125;&quot;</span>, ref.getStamp());</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">34.891</span> c.Test36 [main] - main start... </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">34.894</span> c.Test36 [main] - ç‰ˆæœ¬ <span class="number">0</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">34.956</span> c.Test36 [t1] - change A-&gt;B <span class="literal">true</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">34.956</span> c.Test36 [t1] - æ›´æ–°ç‰ˆæœ¬ä¸º <span class="number">1</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">35.457</span> c.Test36 [t2] - change B-&gt;A <span class="literal">true</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">35.457</span> c.Test36 [t2] - æ›´æ–°ç‰ˆæœ¬ä¸º <span class="number">2</span> </span><br><span class="line"><span class="number">15</span>:<span class="number">41</span>:<span class="number">36.457</span> c.Test36 [main] - change A-&gt;C <span class="literal">false</span></span><br></pre></td></tr></table></figure><p>AtomicStampedReference å¯ä»¥ç»™åŸå­å¼•ç”¨åŠ ä¸Šç‰ˆæœ¬å·ï¼Œè¿½è¸ªåŸå­å¼•ç”¨æ•´ä¸ªçš„å˜åŒ–è¿‡ç¨‹ï¼Œå¦‚ï¼š A -&gt; B -&gt; A -&gt; C ï¼Œé€šè¿‡AtomicStampedReferenceï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œå¼•ç”¨å˜é‡ä¸­é€”è¢«æ›´æ”¹äº†å‡ æ¬¡ã€‚ ä½†æ˜¯æœ‰æ—¶å€™ï¼Œå¹¶ä¸å…³å¿ƒå¼•ç”¨å˜é‡æ›´æ”¹äº†å‡ æ¬¡ï¼Œ<strong>åªæ˜¯å•çº¯çš„å…³å¿ƒæ˜¯å¦æ›´æ”¹è¿‡</strong>ï¼Œäºæ˜¯å¼•å‡º<strong>AtomicMarkableReference</strong></p><h3 id="AtomicMarkableReference"><a href="#AtomicMarkableReference" class="headerlink" title="AtomicMarkableReference"></a>AtomicMarkableReference</h3><p>å¼•å…¥ç¤ºä¾‹</p><img src="/img/11206/æ— é”2.png" alt="image-20231113193355337" style="zoom: 67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">GarbageBag</span> &#123;</span><br><span class="line">    String desc;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">GarbageBag</span><span class="params">(String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDesc</span><span class="params">(String desc)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.desc = desc;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.toString() + <span class="string">&quot; &quot;</span> + desc;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestABAAtomicMarkableReference</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">GarbageBag</span> <span class="variable">bag</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GarbageBag</span>(<span class="string">&quot;è£…æ»¡äº†åƒåœ¾&quot;</span>);</span><br><span class="line">        <span class="comment">// å‚æ•°2 mark å¯ä»¥çœ‹ä½œä¸€ä¸ªæ ‡è®°ï¼Œè¡¨ç¤ºåƒåœ¾è¢‹æ»¡äº†</span></span><br><span class="line">        AtomicMarkableReference&lt;GarbageBag&gt; ref = <span class="keyword">new</span> <span class="title class_">AtomicMarkableReference</span>&lt;&gt;(bag, <span class="literal">true</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;ä¸»çº¿ç¨‹ start...&quot;</span>);</span><br><span class="line">        <span class="type">GarbageBag</span> <span class="variable">prev</span> <span class="operator">=</span> ref.getReference();</span><br><span class="line">        log.debug(prev.toString());</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ‰“æ‰«å«ç”Ÿçš„çº¿ç¨‹ start...&quot;</span>);</span><br><span class="line">            bag.setDesc(<span class="string">&quot;ç©ºåƒåœ¾è¢‹&quot;</span>);</span><br><span class="line">            <span class="keyword">while</span> (!ref.compareAndSet(bag, bag, <span class="literal">true</span>, <span class="literal">false</span>)) &#123;&#125;</span><br><span class="line">            log.debug(bag.toString());</span><br><span class="line">        &#125;).start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;ä¸»çº¿ç¨‹æƒ³æ¢ä¸€åªæ–°åƒåœ¾è¢‹ï¼Ÿ&quot;</span>);</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> ref.compareAndSet(prev, <span class="keyword">new</span> <span class="title class_">GarbageBag</span>(<span class="string">&quot;ç©ºåƒåœ¾è¢‹&quot;</span>), <span class="literal">true</span>, <span class="literal">false</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;æ¢äº†ä¹ˆï¼Ÿ&quot;</span> + success);</span><br><span class="line">        log.debug(ref.getReference().toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">09.264</span> [main] ä¸»çº¿ç¨‹ start... </span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">09.270</span> [main] cn.itcast.GarbageBag@5f0fd5a0 è£…æ»¡äº†åƒåœ¾</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">09.293</span> [Thread-<span class="number">1</span>] æ‰“æ‰«å«ç”Ÿçš„çº¿ç¨‹ start... </span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">09.294</span> [Thread-<span class="number">1</span>] cn.itcast.GarbageBag@5f0fd5a0 ç©ºåƒåœ¾è¢‹</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">10.294</span> [main] ä¸»çº¿ç¨‹æƒ³æ¢ä¸€åªæ–°åƒåœ¾è¢‹ï¼Ÿ</span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">10.294</span> [main] æ¢äº†ä¹ˆï¼Ÿ<span class="literal">false</span> </span><br><span class="line"><span class="number">2019</span>-<span class="number">10</span>-<span class="number">13</span> <span class="number">15</span>:<span class="number">30</span>:<span class="number">10.294</span> [main] cn.itcast.GarbageBag@5f0fd5a0 ç©ºåƒåœ¾è¢‹</span><br></pre></td></tr></table></figure><h2 id="ğŸåŸå­æ•°ç»„"><a href="#ğŸåŸå­æ•°ç»„" class="headerlink" title="ğŸåŸå­æ•°ç»„"></a>ğŸåŸå­æ•°ç»„</h2><p>JUCæä¾›æœ‰ï¼šAtomicIntegerArrayã€AtomicLongArrayã€AtomicReferenceArray</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> å‚æ•°1ï¼Œæä¾›æ•°ç»„ã€å¯ä»¥æ˜¯çº¿ç¨‹ä¸å®‰å…¨æ•°ç»„æˆ–çº¿ç¨‹å®‰å…¨æ•°ç»„</span></span><br><span class="line"><span class="comment"> å‚æ•°2ï¼Œè·å–æ•°ç»„é•¿åº¦çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> å‚æ•°3ï¼Œè‡ªå¢æ–¹æ³•ï¼Œå›ä¼  array, index</span></span><br><span class="line"><span class="comment"> å‚æ•°4ï¼Œæ‰“å°æ•°ç»„çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// supplier æä¾›è€… æ— ä¸­ç”Ÿæœ‰ ()-&gt;ç»“æœ</span></span><br><span class="line"><span class="comment">// function å‡½æ•° ä¸€ä¸ªå‚æ•°ä¸€ä¸ªç»“æœ (å‚æ•°)-&gt;ç»“æœ, BiFunction (å‚æ•°1,å‚æ•°2)-&gt;ç»“æœ</span></span><br><span class="line"><span class="comment">// consumer æ¶ˆè´¹è€… ä¸€ä¸ªå‚æ•°æ²¡ç»“æœ (å‚æ•°)-&gt;void, BiConsumer (å‚æ•°1,å‚æ•°2)-&gt;</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(</span></span><br><span class="line"><span class="params">        Supplier&lt;T&gt; arraySupplier,</span></span><br><span class="line"><span class="params">        Function&lt;T, Integer&gt; lengthFun,</span></span><br><span class="line"><span class="params">        BiConsumer&lt;T, Integer&gt; putConsumer,</span></span><br><span class="line"><span class="params">        Consumer&lt;T&gt; printConsumer )</span> &#123;</span><br><span class="line">    List&lt;Thread&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">T</span> <span class="variable">array</span> <span class="operator">=</span> arraySupplier.get();</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> lengthFun.apply(array);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; length; i++) &#123;</span><br><span class="line">        <span class="comment">// æ¯ä¸ªçº¿ç¨‹å¯¹æ•°ç»„ä½œ 10000 æ¬¡æ“ä½œ</span></span><br><span class="line">        ts.add(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">10000</span>; j++) &#123;</span><br><span class="line">                putConsumer.accept(array, j%length);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    ts.forEach(t -&gt; t.start()); <span class="comment">// å¯åŠ¨æ‰€æœ‰çº¿ç¨‹</span></span><br><span class="line">    ts.forEach(t -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;); <span class="comment">// ç­‰æ‰€æœ‰çº¿ç¨‹ç»“æŸ</span></span><br><span class="line">    printConsumer.accept(array);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸å®‰å…¨æƒ…å†µ"><a href="#ä¸å®‰å…¨æƒ…å†µ" class="headerlink" title="ä¸å®‰å…¨æƒ…å†µ"></a>ä¸å®‰å…¨æƒ…å†µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">demo(</span><br><span class="line">    ()-&gt;<span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>],</span><br><span class="line">    (array)-&gt;array.length,</span><br><span class="line">    (array, index) -&gt; array[index]++,</span><br><span class="line">    array-&gt; System.out.println(Arrays.toString(array))</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">9870</span>, <span class="number">9862</span>, <span class="number">9774</span>, <span class="number">9697</span>, <span class="number">9683</span>, <span class="number">9678</span>, <span class="number">9679</span>, <span class="number">9668</span>, <span class="number">9680</span>, <span class="number">9698</span>]</span><br></pre></td></tr></table></figure><h3 id="å®‰å…¨æƒ…å†µ"><a href="#å®‰å…¨æƒ…å†µ" class="headerlink" title="å®‰å…¨æƒ…å†µ"></a>å®‰å…¨æƒ…å†µ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">demo(</span><br><span class="line">    ()-&gt; <span class="keyword">new</span> <span class="title class_">AtomicIntegerArray</span>(<span class="number">10</span>),</span><br><span class="line">    (array) -&gt; array.length(),</span><br><span class="line">    (array, index) -&gt; array.getAndIncrement(index),</span><br><span class="line">    array -&gt; System.out.println(array)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>, <span class="number">10000</span>]</span><br></pre></td></tr></table></figure><h2 id="ğŸå­—æ®µæ›´æ–°å™¨"><a href="#ğŸå­—æ®µæ›´æ–°å™¨" class="headerlink" title="ğŸå­—æ®µæ›´æ–°å™¨"></a>ğŸå­—æ®µæ›´æ–°å™¨</h2><p>åˆ©ç”¨å­—æ®µæ›´æ–°å™¨ï¼Œå¯ä»¥é’ˆ<strong>å¯¹å¯¹è±¡çš„æŸä¸ªåŸŸï¼ˆFieldï¼‰è¿›è¡ŒåŸå­æ“ä½œ</strong>ï¼Œåªèƒ½<strong>é…åˆ volatile ä¿®é¥°çš„å­—æ®µ</strong>ä½¿ç”¨ï¼Œå¦åˆ™ä¼šå‡ºç°å¼‚å¸¸ã€‚JUCæä¾›æœ‰AtomicReferenceFieldUpdaterã€AtomicIntegerFieldUpdaterã€AtomicLongFieldUpdater</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Test5</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">int</span> field;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AtomicIntegerFieldUpdater</span> <span class="variable">fieldUpdater</span> <span class="operator">=</span> AtomicIntegerFieldUpdater.newUpdater(Test5.class, <span class="string">&quot;field&quot;</span>);</span><br><span class="line">        <span class="type">Test5</span> <span class="variable">test5</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Test5</span>();</span><br><span class="line">        fieldUpdater.compareAndSet(test5, <span class="number">0</span>, <span class="number">10</span>);</span><br><span class="line">        <span class="comment">// ä¿®æ”¹æˆåŠŸ field = 10</span></span><br><span class="line">        System.out.println(test5.field);</span><br><span class="line">        <span class="comment">// ä¿®æ”¹æˆåŠŸ field = 20</span></span><br><span class="line">        fieldUpdater.compareAndSet(test5, <span class="number">10</span>, <span class="number">20</span>);</span><br><span class="line">        System.out.println(test5.field);</span><br><span class="line">        <span class="comment">// ä¿®æ”¹å¤±è´¥ field = 20</span></span><br><span class="line">        fieldUpdater.compareAndSet(test5, <span class="number">10</span>, <span class="number">30</span>);</span><br><span class="line">        System.out.println(test5.field);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="comment">// 10</span></span><br><span class="line"><span class="comment">// 20</span></span><br><span class="line"><span class="comment">// 20</span></span><br></pre></td></tr></table></figure><h2 id="ğŸåŸå­ç´¯åŠ å™¨"><a href="#ğŸåŸå­ç´¯åŠ å™¨" class="headerlink" title="ğŸåŸå­ç´¯åŠ å™¨"></a>ğŸåŸå­ç´¯åŠ å™¨</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T&gt; <span class="keyword">void</span> <span class="title function_">demo</span><span class="params">(Supplier&lt;T&gt; adderSupplier, Consumer&lt;T&gt; action)</span> &#123;</span><br><span class="line">    <span class="type">T</span> <span class="variable">adder</span> <span class="operator">=</span> adderSupplier.get();</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">    List&lt;Thread&gt; ts = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// 4 ä¸ªçº¿ç¨‹ï¼Œæ¯äººç´¯åŠ  50 ä¸‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) &#123;</span><br><span class="line">        ts.add(<span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; <span class="number">500000</span>; j++) &#123;</span><br><span class="line">                action.accept(adder);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">    ts.forEach(t -&gt; t.start());</span><br><span class="line">    ts.forEach(t -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            t.join();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.nanoTime();</span><br><span class="line">    System.out.println(adder + <span class="string">&quot; cost:&quot;</span> + (end - start)/<span class="number">1000_000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>AtomicLong VS LongAdder</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    demo(() -&gt; <span class="keyword">new</span> <span class="title class_">LongAdder</span>(), adder -&gt; adder.increment());</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    demo(() -&gt; <span class="keyword">new</span> <span class="title class_">AtomicLong</span>(), adder -&gt; adder.getAndIncrement());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">43</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">9</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">7</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">7</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">7</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">31</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">27</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">28</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">24</span> </span><br><span class="line"><span class="number">1000000</span> cost:<span class="number">22</span> </span><br></pre></td></tr></table></figure><p>åˆ†æï¼šLongAdderæ€§èƒ½æå‡çš„åŸå› å¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœ‰ç«äº‰æ—¶ï¼Œè®¾ç½®å¤šä¸ªç´¯åŠ å•å…ƒï¼ŒTherad-0 ç´¯åŠ  Cell[0]ï¼Œè€Œ Thread-1 ç´¯åŠ  Cell[1]â€¦ æœ€åå°†ç»“æœæ±‡æ€»ã€‚è¿™æ ·å®ƒä»¬åœ¨<strong>ç´¯åŠ æ—¶æ“ä½œçš„ä¸åŒçš„ Cell å˜é‡</strong>ï¼Œå› æ­¤<strong>å‡å°‘äº†CASé‡è¯•å¤±è´¥</strong>ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ReentrantLock</title>
      <link href="/posts/13968/"/>
      <url>/posts/13968/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸReentrantLockç®€ä»‹"><a href="#ğŸReentrantLockç®€ä»‹" class="headerlink" title="ğŸReentrantLockç®€ä»‹"></a>ğŸReentrantLockç®€ä»‹</h2><p>ReentrantLockæ˜¯JUCåŒ…ä¸‹å®ç°Lockæ¥å£çš„ä¸€ç§é”å¯¹è±¡ï¼Œä¸ synchronized ä¸€æ ·ï¼Œ<strong>éƒ½æ”¯æŒå¯é‡å…¥ï¼Œéƒ½æ˜¯æ‚²è§‚é”</strong>ã€‚</p><p>ä½†æ˜¯å®ƒä¹Ÿæœ‰ç‹¬ç‰¹çš„åœ°æ–¹ï¼š</p><ol><li>å¯ä¸­æ–­ </li><li>å¯ä»¥è®¾ç½®è¶…æ—¶æ—¶é—´ </li><li>å¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é” </li><li>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡</li></ol><p>ä½¿ç”¨çš„åŸºæœ¬è¯­æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–é”</span></span><br><span class="line">reentrantLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"> <span class="comment">// ä¸´ç•ŒåŒº</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"> <span class="comment">// é‡Šæ”¾é”</span></span><br><span class="line"> reentrantLock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå¯é‡å…¥"><a href="#ğŸå¯é‡å…¥" class="headerlink" title="ğŸå¯é‡å…¥"></a>ğŸå¯é‡å…¥</h2><blockquote><p>å¯é‡å…¥æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹å¦‚æœé¦–æ¬¡è·å¾—äº†è¿™æŠŠé”ï¼Œæœ‰æƒåˆ©å†æ¬¡è·å–è¿™æŠŠé”ï¼ˆé€’å½’é”ï¼‰</p></blockquote><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    method1();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method1</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;execute method1&quot;</span>);</span><br><span class="line">        method2();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method2</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;execute method2&quot;</span>);</span><br><span class="line">        method3();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">method3</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;execute method3&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>method1ä¸Šé”åå¯ä»¥ç»§ç»­æ‰§è¡Œmethod2ï¼Œmethod2ä¸Šé”åå¯ä»¥ç»§ç»­æ‰§è¡Œmethod3</p><p>è¾“å‡ºå¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">17</span>:<span class="number">59</span>:<span class="number">11.862</span> [main] c.TestReentrant - execute method1 </span><br><span class="line"><span class="number">17</span>:<span class="number">59</span>:<span class="number">11.865</span> [main] c.TestReentrant - execute method2 </span><br><span class="line"><span class="number">17</span>:<span class="number">59</span>:<span class="number">11.865</span> [main] c.TestReentrant - execute method3 </span><br></pre></td></tr></table></figure><h2 id="ğŸå¯æ‰“æ–­"><a href="#ğŸå¯æ‰“æ–­" class="headerlink" title="ğŸå¯æ‰“æ–­"></a>ğŸå¯æ‰“æ–­</h2><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;å¯åŠ¨...&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        lock.lockInterruptibly();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.debug(<span class="string">&quot;ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line">log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">t1.start();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    t1.interrupt();</span><br><span class="line">    log.debug(<span class="string">&quot;æ‰§è¡Œæ‰“æ–­&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">02</span>:<span class="number">40.520</span> [main] c.TestInterrupt - è·å¾—äº†é”</span><br><span class="line"><span class="number">18</span>:<span class="number">02</span>:<span class="number">40.524</span> [t1] c.TestInterrupt - å¯åŠ¨... </span><br><span class="line"><span class="number">18</span>:<span class="number">02</span>:<span class="number">41.530</span> [main] c.TestInterrupt - æ‰§è¡Œæ‰“æ–­</span><br><span class="line">java.lang.InterruptedException </span><br><span class="line"> at </span><br><span class="line">java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireInterruptibly(AbstractQueuedSynchr</span><br><span class="line">onizer.java:<span class="number">898</span>) </span><br><span class="line"> at </span><br><span class="line">java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireInterruptibly(AbstractQueuedSynchron</span><br><span class="line">izer.java:<span class="number">1222</span>) </span><br><span class="line"> at java.util.concurrent.locks.ReentrantLock.lockInterruptibly(ReentrantLock.java:<span class="number">335</span>) </span><br><span class="line"> at cn.itcast.n4.reentrant.TestInterrupt.lambda$main$<span class="number">0</span>(TestInterrupt.java:<span class="number">17</span>) </span><br><span class="line"> at java.lang.Thread.run(Thread.java:<span class="number">748</span>) </span><br><span class="line"><span class="number">18</span>:<span class="number">02</span>:<span class="number">41.532</span> [t1] c.TestInterrupt - ç­‰é”çš„è¿‡ç¨‹ä¸­è¢«æ‰“æ–­</span><br></pre></td></tr></table></figure><h2 id="ğŸå¯è¶…æ—¶"><a href="#ğŸå¯è¶…æ—¶" class="headerlink" title="ğŸå¯è¶…æ—¶"></a>ğŸå¯è¶…æ—¶</h2><h3 id="1-ç«‹åˆ»å¤±è´¥"><a href="#1-ç«‹åˆ»å¤±è´¥" class="headerlink" title="1 ç«‹åˆ»å¤±è´¥"></a>1 ç«‹åˆ»å¤±è´¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;å¯åŠ¨...&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!lock.tryLock()) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line">log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">t1.start();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sleep(<span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">15</span>:<span class="number">02.918</span> [main] c.TestTimeout - è·å¾—äº†é”</span><br><span class="line"><span class="number">18</span>:<span class="number">15</span>:<span class="number">02.921</span> [t1] c.TestTimeout - å¯åŠ¨... </span><br><span class="line"><span class="number">18</span>:<span class="number">15</span>:<span class="number">02.921</span> [t1] c.TestTimeout - è·å–ç«‹åˆ»å¤±è´¥ï¼Œè¿”å›</span><br></pre></td></tr></table></figure><h3 id="2-è¶…æ—¶å¤±è´¥"><a href="#2-è¶…æ—¶å¤±è´¥" class="headerlink" title="2 è¶…æ—¶å¤±è´¥"></a>2 è¶…æ—¶å¤±è´¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;å¯åŠ¨...&quot;</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!lock.tryLock(<span class="number">1</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;è·å–ç­‰å¾… 1s åå¤±è´¥ï¼Œè¿”å›&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">lock.lock();</span><br><span class="line">log.debug(<span class="string">&quot;è·å¾—äº†é”&quot;</span>);</span><br><span class="line">t1.start();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    sleep(<span class="number">2</span>);</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">19</span>:<span class="number">40.537</span> [main] c.TestTimeout - è·å¾—äº†é”</span><br><span class="line"><span class="number">18</span>:<span class="number">19</span>:<span class="number">40.544</span> [t1] c.TestTimeout - å¯åŠ¨... </span><br><span class="line"><span class="number">18</span>:<span class="number">19</span>:<span class="number">41.547</span> [t1] c.TestTimeout - è·å–ç­‰å¾… 1s åå¤±è´¥ï¼Œè¿”å›</span><br></pre></td></tr></table></figure><h2 id="ğŸå…¬å¹³é”"><a href="#ğŸå…¬å¹³é”" class="headerlink" title="ğŸå…¬å¹³é”"></a>ğŸå…¬å¹³é”</h2><p>ReentrantLocké»˜è®¤å’Œsynchronizedä¸€æ ·éƒ½æ˜¯éå…¬å¹³é”ï¼Œä½†æ˜¯ReentrantLockå¯ä»¥è®¾ç½®ä¸ºå…¬å¹³é”</p><p>é»˜è®¤ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">false</span>);</span><br><span class="line">lock.lock();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">500</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; running...&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;t&quot;</span> + i).start();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 1s ä¹‹åå»äº‰æŠ¢é”</span></span><br><span class="line">Thread.sleep(<span class="number">1000</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; start...&quot;</span>);</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; running...&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;å¼ºè¡Œæ’å…¥&quot;</span>).start();</span><br><span class="line">lock.unlock();</span><br></pre></td></tr></table></figure><p>ä¸€ç§è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">t39 running... </span><br><span class="line">t40 running... </span><br><span class="line">t41 running... </span><br><span class="line">t42 running... </span><br><span class="line">t43 running... </span><br><span class="line">å¼ºè¡Œæ’å…¥ start... </span><br><span class="line">å¼ºè¡Œæ’å…¥ running... </span><br><span class="line">t44 running... </span><br><span class="line">t45 running... </span><br><span class="line">t46 running... </span><br><span class="line">t47 running... </span><br><span class="line">t49 running...</span><br></pre></td></tr></table></figure><p><strong>è®¾ç½®ä¸ºå…¬å¹³é”</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">t465 running... </span><br><span class="line">t464 running... </span><br><span class="line">t477 running... </span><br><span class="line">t442 running... </span><br><span class="line">t468 running... </span><br><span class="line">t493 running... </span><br><span class="line">t482 running... </span><br><span class="line">t485 running... </span><br><span class="line">t481 running... </span><br><span class="line">å¼ºè¡Œæ’å…¥ running... </span><br></pre></td></tr></table></figure><h2 id="ğŸæ¡ä»¶å˜é‡"><a href="#ğŸæ¡ä»¶å˜é‡" class="headerlink" title="ğŸæ¡ä»¶å˜é‡"></a>ğŸæ¡ä»¶å˜é‡</h2><p>ReentrantLock çš„æ¡ä»¶å˜é‡æ¯” synchronized å¼ºå¤§ä¹‹å¤„åœ¨äºï¼Œå®ƒæ˜¯æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡çš„</p><ul><li>synchronized æ˜¯é‚£äº›ä¸æ»¡è¶³æ¡ä»¶çš„çº¿ç¨‹éƒ½åœ¨ä¸€é—´ä¼‘æ¯å®¤ç­‰æ¶ˆæ¯ </li><li>ReentrantLock æ”¯æŒå¤šé—´ä¼‘æ¯å®¤ï¼Œæœ‰ä¸“é—¨ç­‰çƒŸçš„ä¼‘æ¯å®¤ã€ä¸“é—¨ç­‰æ—©é¤çš„ä¼‘æ¯å®¤ã€å”¤é†’æ—¶ä¹Ÿæ˜¯æŒ‰ä¼‘æ¯å®¤æ¥å”¤é†’</li></ul><p>è¦ç‚¹ï¼š </p><ul><li>await å‰éœ€è¦è·å¾—é” </li><li>await æ‰§è¡Œåï¼Œä¼šé‡Šæ”¾é”ï¼Œè¿›å…¥ conditionObject ç­‰å¾… </li><li>await çš„çº¿ç¨‹è¢«å”¤é†’ï¼ˆæˆ–æ‰“æ–­ã€æˆ–è¶…æ—¶ï¼‰å»é‡æ–°ç«äº‰ lock é” </li><li>ç«äº‰ lock é”æˆåŠŸåï¼Œä» await åç»§ç»­æ‰§è¡Œ</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="keyword">static</span> <span class="type">Condition</span> <span class="variable">waitCigaretteQueue</span> <span class="operator">=</span> lock.newCondition(); <span class="comment">// è®¾ç½®ä¸åŒçš„æ¡ä»¶å˜é‡</span></span><br><span class="line"><span class="keyword">static</span> <span class="type">Condition</span> <span class="variable">waitbreakfastQueue</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">hasCigrette</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">hasBreakfast</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">while</span> (!hasCigrette) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    waitCigaretteQueue.await(); <span class="comment">// è°ƒç”¨ç‰¹å®šå˜é‡çš„ç­‰å¾…æ–¹æ³•</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;ç­‰åˆ°äº†å®ƒçš„çƒŸ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">while</span> (!hasBreakfast) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    waitbreakfastQueue.await(); <span class="comment">// è°ƒç”¨ç‰¹å®šå˜é‡çš„ç­‰å¾…æ–¹æ³•</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;ç­‰åˆ°äº†å®ƒçš„æ—©é¤&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    sendBreakfast();</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">    sendCigarette();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendCigarette</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;é€çƒŸæ¥äº†&quot;</span>);</span><br><span class="line">        hasCigrette = <span class="literal">true</span>;</span><br><span class="line">        waitCigaretteQueue.signal(); <span class="comment">// è°ƒç”¨ç‰¹å®šå˜é‡çš„å”¤é†’æ–¹æ³•</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sendBreakfast</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;é€æ—©é¤æ¥äº†&quot;</span>);</span><br><span class="line">        hasBreakfast = <span class="literal">true</span>;</span><br><span class="line">        waitbreakfastQueue.signal(); <span class="comment">// è°ƒç”¨ç‰¹å®šå˜é‡çš„å”¤é†’æ–¹æ³•</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">27.680</span> [main] c.TestCondition - é€æ—©é¤æ¥äº†</span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">27.682</span> [Thread-<span class="number">1</span>] c.TestCondition - ç­‰åˆ°äº†å®ƒçš„æ—©é¤</span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">28.683</span> [main] c.TestCondition - é€çƒŸæ¥äº†</span><br><span class="line"><span class="number">18</span>:<span class="number">52</span>:<span class="number">28.683</span> [Thread-<span class="number">0</span>] c.TestCondition - ç­‰åˆ°äº†å®ƒçš„çƒŸ</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringCloudæ€»è§ˆ</title>
      <link href="/posts/22987/"/>
      <url>/posts/22987/</url>
      
        <content type="html"><![CDATA[<p><img src="/img/22987/cloud1.png" alt="image-20231023222616284"></p><h2 id="ğŸå¾®æœåŠ¡æ¶æ„"><a href="#ğŸå¾®æœåŠ¡æ¶æ„" class="headerlink" title="ğŸå¾®æœåŠ¡æ¶æ„"></a>ğŸå¾®æœåŠ¡æ¶æ„</h2><ul><li>å•ä¸€èŒè´£ï¼šå¾®æœåŠ¡æ‹†åˆ†ç²’åº¦æ›´å°ï¼Œæ¯ä¸€ä¸ªæœåŠ¡éƒ½å¯¹åº”å”¯ä¸€çš„ä¸šåŠ¡èƒ½åŠ›ï¼Œåšåˆ°å•ä¸€èŒè´£</li><li>è‡ªæ²»ï¼šå›¢é˜Ÿç‹¬ç«‹ã€æŠ€æœ¯ç‹¬ç«‹ã€æ•°æ®ç‹¬ç«‹ï¼Œç‹¬ç«‹éƒ¨ç½²å’Œäº¤ä»˜</li><li>é¢å‘æœåŠ¡ï¼šæœåŠ¡æä¾›ç»Ÿä¸€æ ‡å‡†çš„æ¥å£ï¼Œä¸è¯­è¨€å’ŒæŠ€æœ¯æ— å…³</li><li>éš”ç¦»æ€§å¼ºï¼šæœåŠ¡è°ƒç”¨åšå¥½éš”ç¦»ã€å®¹é”™ã€é™çº§ï¼Œé¿å…å‡ºç°çº§è”é—®é¢˜</li></ul><p><img src="/img/22987/cloud2.png" alt="image-20231023223116302"></p><p>ä¼˜ç‚¹ï¼šæ‹†åˆ†ç²’åº¦æ›´å°ã€æœåŠ¡æ›´ç‹¬ç«‹ã€<strong>è€¦åˆåº¦æ›´ä½</strong></p><p>ç¼ºç‚¹ï¼š<strong>æ¶æ„å¤æ‚</strong>ï¼Œè¿ç»´ã€ç›‘æ§ã€éƒ¨ç½²éš¾åº¦æé«˜</p><h2 id="ğŸEurekaå’ŒNacos"><a href="#ğŸEurekaå’ŒNacos" class="headerlink" title="ğŸEurekaå’ŒNacos"></a>ğŸEurekaå’ŒNacos</h2><h3 id="Eurekaæ³¨å†Œä¸­å¿ƒ"><a href="#Eurekaæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Eurekaæ³¨å†Œä¸­å¿ƒ"></a>Eurekaæ³¨å†Œä¸­å¿ƒ</h3><p><img src="/img/22987/cloud3.png" alt="image-20231023224251854"></p><h4 id="1-æ³¨å†Œå’Œæ‹‰å–"><a href="#1-æ³¨å†Œå’Œæ‹‰å–" class="headerlink" title="1 æ³¨å†Œå’Œæ‹‰å–"></a>1 æ³¨å†Œå’Œæ‹‰å–</h4><p>æœåŠ¡æ³¨å†Œï¼šuser-serviceæœåŠ¡å®ä¾‹å¯åŠ¨åï¼Œå°†è‡ªå·±çš„ä¿¡æ¯æ³¨å†Œåˆ°eureka-serverï¼ˆEurekaæœåŠ¡ç«¯ï¼‰ã€‚eureka-serverä¿å­˜æœåŠ¡åç§°åˆ°æœåŠ¡å®ä¾‹åœ°å€åˆ—è¡¨çš„æ˜ å°„å…³ç³»</p><p>æœåŠ¡æ‹‰å–ï¼ˆå‘ç°ï¼‰ï¼šorder-serviceæ ¹æ®æœåŠ¡åç§°ï¼Œæ‹‰å–å®ä¾‹åœ°å€åˆ—è¡¨</p><h4 id="2-è´Ÿè½½å‡è¡¡å’Œè¿œç¨‹è°ƒç”¨"><a href="#2-è´Ÿè½½å‡è¡¡å’Œè¿œç¨‹è°ƒç”¨" class="headerlink" title="2 è´Ÿè½½å‡è¡¡å’Œè¿œç¨‹è°ƒç”¨"></a>2 è´Ÿè½½å‡è¡¡å’Œè¿œç¨‹è°ƒç”¨</h4><p>order-serviceä»å®ä¾‹åˆ—è¡¨ä¸­åˆ©ç”¨è´Ÿè½½å‡è¡¡ç®—æ³•é€‰ä¸­ä¸€ä¸ªå®ä¾‹åœ°å€ï¼Œå¹¶å‘èµ·è¿œç¨‹è°ƒç”¨</p><p><img src="/img/22987/cloud4.png" alt="image-20231023225031849"></p><p>ä»¥ä¸Šæ­¥éª¤è¯´æ˜å¦‚ä¸‹ï¼š</p><ol><li>æ‹¦æˆªRestTemplateè¯·æ±‚<a href="http://userservice/user/1">http://userservice/user/1</a></li><li>RibbonLoadBalancerClientä¼šä»è¯·æ±‚urlä¸­è·å–æœåŠ¡åç§°ï¼Œä¹Ÿå°±æ˜¯user-service</li><li>DynamicServerListLoadBalanceræ ¹æ®user-serviceåˆ°eurekaæ‹‰å–æœåŠ¡åˆ—è¡¨</li><li>eurekaè¿”å›åˆ—è¡¨ï¼Œlocalhost:8081ã€localhost:8082</li><li>IRuleåˆ©ç”¨å†…ç½®è´Ÿè½½å‡è¡¡è§„åˆ™ï¼Œä»åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªï¼Œä¾‹å¦‚localhost:8081</li><li>RibbonLoadBalancerClientä¿®æ”¹è¯·æ±‚åœ°å€ï¼Œç”¨localhost:8081æ›¿ä»£userserviceï¼Œå¾—åˆ°<a href="http://localhost:8081/user/1%EF%BC%8C%E5%8F%91%E8%B5%B7%E7%9C%9F%E5%AE%9E%E8%AF%B7%E6%B1%82">http://localhost:8081/user/1ï¼Œå‘èµ·çœŸå®è¯·æ±‚</a></li></ol><h4 id="3-å¿ƒè·³æ£€æµ‹"><a href="#3-å¿ƒè·³æ£€æµ‹" class="headerlink" title="3 å¿ƒè·³æ£€æµ‹"></a>3 å¿ƒè·³æ£€æµ‹</h4><p>user-serviceä¼šæ¯éš”ä¸€æ®µæ—¶é—´ï¼ˆé»˜è®¤30ç§’ï¼‰å‘eureka-serverå‘èµ·è¯·æ±‚ï¼ŒæŠ¥å‘Šè‡ªå·±çŠ¶æ€ï¼Œç§°ä¸ºå¿ƒè·³ã€‚å½“è¶…è¿‡ä¸€å®šæ—¶é—´<strong>æ²¡æœ‰å‘é€å¿ƒè·³</strong>æ—¶ï¼Œeureka-serverä¼šè®¤ä¸ºå¾®æœåŠ¡å®ä¾‹æ•…éšœï¼Œå°†è¯¥å®ä¾‹ä»æœåŠ¡åˆ—è¡¨ä¸­<strong>å‰”é™¤</strong></p><h3 id="Nacosæ³¨å†Œä¸­å¿ƒ"><a href="#Nacosæ³¨å†Œä¸­å¿ƒ" class="headerlink" title="Nacosæ³¨å†Œä¸­å¿ƒ"></a>Nacosæ³¨å†Œä¸­å¿ƒ</h3><p><img src="/img/22987/cloud5.png" alt="image-20231023225517829"></p><h4 id="1-é›†ç¾¤"><a href="#1-é›†ç¾¤" class="headerlink" title="1 é›†ç¾¤"></a>1 é›†ç¾¤</h4><p><img src="/img/22987/cloud6.png" alt="image-20231023225710815"></p><p>å¾®æœåŠ¡äº’ç›¸è®¿é—®æ—¶ï¼Œåº”è¯¥å°½å¯èƒ½è®¿é—®åŒé›†ç¾¤å®ä¾‹ï¼Œå› ä¸ºæœ¬åœ°è®¿é—®é€Ÿåº¦æ›´å¿«ã€‚å½“æœ¬é›†ç¾¤å†…ä¸å¯ç”¨æ—¶ï¼Œæ‰è®¿é—®å…¶å®ƒé›†ç¾¤</p><h4 id="2-ç¯å¢ƒéš”ç¦»"><a href="#2-ç¯å¢ƒéš”ç¦»" class="headerlink" title="2 ç¯å¢ƒéš”ç¦»"></a>2 ç¯å¢ƒéš”ç¦»</h4><p>nacosä¸­å¯ä»¥æœ‰å¤šä¸ªnamespaceï¼Œnamespaceä¸‹å¯ä»¥æœ‰groupã€serviceç­‰</p><p>ä¸åŒnamespaceä¹‹é—´ç›¸äº’éš”ç¦»ï¼Œä¸åŒnamespaceçš„æœåŠ¡<strong>äº’ç›¸ä¸å¯è§</strong></p><h4 id="3-ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹"><a href="#3-ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹" class="headerlink" title="3 ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹"></a>3 ä¸´æ—¶å®ä¾‹å’Œéä¸´æ—¶å®ä¾‹</h4><p>ä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºè¶…è¿‡ä¸€å®šæ—¶é—´ï¼Œ<strong>ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤</strong>ï¼Œé»˜è®¤çš„ç±»å‹</p><p>éä¸´æ—¶å®ä¾‹ï¼šå¦‚æœå®ä¾‹å®•æœºï¼Œ<strong>ä¸ä¼šä»æœåŠ¡åˆ—è¡¨å‰”é™¤</strong>ï¼Œä¹Ÿå¯ä»¥å«æ°¸ä¹…å®ä¾‹</p><h3 id="åŒºåˆ«Eurekaå’ŒNacos"><a href="#åŒºåˆ«Eurekaå’ŒNacos" class="headerlink" title="åŒºåˆ«Eurekaå’ŒNacos"></a>åŒºåˆ«Eurekaå’ŒNacos</h3><h4 id="1-å…±åŒç‚¹"><a href="#1-å…±åŒç‚¹" class="headerlink" title="1 å…±åŒç‚¹"></a>1 å…±åŒç‚¹</h4><ul><li>éƒ½æ”¯æŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡æ‹‰å–</li><li>éƒ½æ”¯æŒæœåŠ¡æä¾›è€…å¿ƒè·³æ–¹å¼åšå¥åº·æ£€æµ‹</li></ul><h4 id="2-åŒºåˆ«"><a href="#2-åŒºåˆ«" class="headerlink" title="2 åŒºåˆ«"></a>2 åŒºåˆ«</h4><ul><li>Nacosæ”¯æŒæœåŠ¡ç«¯ä¸»åŠ¨æ£€æµ‹æä¾›è€…çŠ¶æ€ï¼š<strong>ä¸´æ—¶</strong>å®ä¾‹é‡‡ç”¨<strong>å¿ƒè·³</strong>æ¨¡å¼ï¼Œ<strong>éä¸´æ—¶</strong>å®ä¾‹é‡‡ç”¨<strong>ä¸»åŠ¨æ£€æµ‹</strong>æ¨¡å¼</li><li>ä¸´æ—¶å®ä¾‹å¿ƒè·³ä¸æ­£å¸¸ä¼šè¢«å‰”é™¤ï¼Œ<strong>éä¸´æ—¶å®ä¾‹åˆ™ä¸ä¼šè¢«å‰”é™¤</strong></li><li>Nacosæ”¯æŒæœåŠ¡åˆ—è¡¨å˜æ›´çš„<strong>æ¶ˆæ¯æ¨é€</strong>æ¨¡å¼ï¼ŒæœåŠ¡åˆ—è¡¨æ›´æ–°æ›´åŠæ—¶</li><li>Nacosé›†ç¾¤é»˜è®¤é‡‡ç”¨APæ–¹å¼ï¼Œå½“é›†ç¾¤ä¸­å­˜åœ¨éä¸´æ—¶å®ä¾‹æ—¶ï¼Œé‡‡ç”¨<strong>CP</strong>æ¨¡å¼ï¼›Eurekaé‡‡ç”¨<strong>AP</strong>æ–¹å¼</li></ul><h2 id="ğŸFeignè¿œç¨‹è°ƒç”¨"><a href="#ğŸFeignè¿œç¨‹è°ƒç”¨" class="headerlink" title="ğŸFeignè¿œç¨‹è°ƒç”¨"></a>ğŸFeignè¿œç¨‹è°ƒç”¨</h2><h3 id="é—®é¢˜æ¼”ç¤º"><a href="#é—®é¢˜æ¼”ç¤º" class="headerlink" title="é—®é¢˜æ¼”ç¤º"></a>é—®é¢˜æ¼”ç¤º</h3><p><img src="/img/22987/cloud7.png" alt="image-20231025223937497"></p><p>RestTemplateå‘èµ·è¿œç¨‹è°ƒç”¨çš„ä»£ç ç¼ºç‚¹ï¼š</p><p>ä»£ç å¯è¯»æ€§å·®ï¼Œç¼–ç¨‹ä½“éªŒä¸ç»Ÿä¸€</p><p>å‚æ•°å¤æ‚URLéš¾ä»¥ç»´æŠ¤</p><h3 id="Feignæ–¹æ¡ˆ"><a href="#Feignæ–¹æ¡ˆ" class="headerlink" title="Feignæ–¹æ¡ˆ"></a>Feignæ–¹æ¡ˆ</h3><p>ç¼–å†™Feignçš„å®¢æˆ·ç«¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@FeignClient(&quot;userservice&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserClient</span> &#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/user/&#123;id&#125;&quot;)</span></span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨</p><img src="/img/22987/cloud8.png" alt="image-20231025224218162" style="zoom:80%;" /><h2 id="ğŸGatewayæœåŠ¡ç½‘å…³"><a href="#ğŸGatewayæœåŠ¡ç½‘å…³" class="headerlink" title="ğŸGatewayæœåŠ¡ç½‘å…³"></a>ğŸGatewayæœåŠ¡ç½‘å…³</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p><img src="/img/22987/cloud9.png" alt="image-20231025224517110"></p><p><strong>æƒé™æ§åˆ¶</strong>ï¼šç½‘å…³ä½œä¸ºå¾®æœåŠ¡å…¥å£ï¼Œéœ€è¦æ ¡éªŒç”¨æˆ·æ˜¯æ˜¯å¦æœ‰è¯·æ±‚èµ„æ ¼ï¼Œå¦‚æœæ²¡æœ‰åˆ™è¿›è¡Œæ‹¦æˆªã€‚</p><p><strong>è·¯ç”±å’Œè´Ÿè½½å‡è¡¡</strong>ï¼šä¸€åˆ‡è¯·æ±‚éƒ½å¿…é¡»å…ˆç»è¿‡gatewayï¼Œä½†ç½‘å…³ä¸å¤„ç†ä¸šåŠ¡ï¼Œè€Œæ˜¯æ ¹æ®æŸç§è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°æŸä¸ªå¾®æœåŠ¡ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš<strong>è·¯ç”±</strong>ã€‚å½“ç„¶è·¯ç”±çš„ç›®æ ‡æœåŠ¡æœ‰å¤šä¸ªæ—¶ï¼Œè¿˜éœ€è¦åšè´Ÿè½½å‡è¡¡ã€‚</p><p><strong>é™æµ</strong>ï¼šå½“è¯·æ±‚æµé‡è¿‡é«˜æ—¶ï¼Œåœ¨ç½‘å…³ä¸­æŒ‰ç…§ä¸‹æµçš„å¾®æœåŠ¡èƒ½å¤Ÿæ¥å—çš„é€Ÿåº¦æ¥æ”¾è¡Œè¯·æ±‚ï¼Œé¿å…æœåŠ¡å‹åŠ›è¿‡å¤§ã€‚</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p><img src="/img/22987/cloud10.png" alt="image-20231025224740104"></p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>èƒŒåŒ…é—®é¢˜</title>
      <link href="/posts/60354/"/>
      <url>/posts/60354/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ0-1èƒŒåŒ…é—®é¢˜"><a href="#ğŸ0-1èƒŒåŒ…é—®é¢˜" class="headerlink" title="ğŸ0-1èƒŒåŒ…é—®é¢˜"></a>ğŸ0-1èƒŒåŒ…é—®é¢˜</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>nä¸ªç‰©å“éƒ½æ˜¯å›ºä½“ï¼Œæœ‰é‡é‡å’Œä»·å€¼ã€‚ç°åœ¨è¦å–èµ°<strong>ä¸è¶…è¿‡10å…‹</strong>çš„ç‰©å“ã€‚æ¯æ¬¡<strong>å¯ä»¥ä¸æ‹¿æˆ–å…¨æ‹¿</strong>ï¼Œé—®æœ€é«˜ä»·å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>ç¤ºä¾‹ï¼š</p><table><thead><tr><th>ç¼–å·</th><th>é‡é‡ï¼ˆgï¼‰</th><th>ä»·å€¼</th><th>æè¿°</th><th>ç®€ç§°</th></tr></thead><tbody><tr><td>0</td><td>4</td><td>1600</td><td>é»„é‡‘ä¸€å—</td><td>A</td></tr><tr><td>1</td><td>8</td><td>2400</td><td>çº¢å®çŸ³ä¸€å—</td><td>R</td></tr><tr><td>2</td><td>5</td><td>30</td><td>ç™½é“¶ä¸€å—</td><td>S</td></tr><tr><td>3</td><td>1</td><td>1,000,000</td><td>é’»çŸ³ä¸€ç²’</td><td>D</td></tr></tbody></table><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>è¯¥é—®é¢˜ä¸èƒ½ä½¿ç”¨è´ªå¿ƒæ±‚è§£ï¼Œæ­£ç¡®æ€è·¯ä¸ºåŠ¨æ€è§„åˆ’</p><p>è€ƒè™‘äºŒç»´dpæ•°ç»„ï¼Œ<strong>è¡Œä»£è¡¨è¯¥ç¼–å·å¯¹åº”çš„ç‰©å“ï¼Œåˆ—ä»£è¡¨èƒŒåŒ…é‡é‡</strong>ï¼ˆ0~nï¼‰,<code>dp[i][j]</code>ä»£è¡¨<strong>iç§ç‰©ä½“ä¸‹jé‡é‡çš„æœ€å¤§ä»·å€¼</strong></p><p>åˆ†æå¦‚ä¸‹ï¼š</p><p>â€‹012345678910</p><p>0  0000AAAAAAAé»„é‡‘</p><p>1  0000AAAARRRçº¢å®çŸ³</p><p>2  0000AAAARRRç™½é“¶</p><p>3  0D    D   D   D    DA DA DA DA DR DR  é’»çŸ³</p><hr><p>è½¬ä¸ºé€’æ¨å¼å¦‚ä¸‹ï¼š</p><p>1.è£…ä¸ä¸‹ï¼šä¿æŒä¸Šä¸€è¡Œä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br><span class="line"><span class="comment">// å¦‚dp[1][7] = dp[0][7];</span></span><br></pre></td></tr></table></figure><p>2.è£…å¾—ä¸‹ï¼šmax(ä¸Šä¸€è¡Œä»·å€¼ï¼Œå½“å‰ç‰©å“ä»·å€¼+<strong>ä¸Šä¸€è¡Œ</strong>ä¸­å‡å»å½“å‰ç‰©å“é‡é‡çš„ä»·å€¼)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = max(dp[i-<span class="number">1</span>][j],item.value+dp[i-<span class="number">1</span>][j-item.weight]);</span><br><span class="line"><span class="comment">// å¦‚dp[3][5] = dp[2][5] + dp[2][5-D.weight];</span></span><br></pre></td></tr></table></figure><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KnapsackProblem</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        1   2   3   4   5   6   7   8   9   10</span></span><br><span class="line"><span class="comment">                    a</span></span><br><span class="line"><span class="comment">                    a               r</span></span><br><span class="line"><span class="comment">                    a               r</span></span><br><span class="line"><span class="comment">        d               da          da  dr  dr</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">        <span class="type">int</span> index;</span><br><span class="line">        String name;</span><br><span class="line">        <span class="type">int</span> weight;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Item</span><span class="params">(<span class="type">int</span> index, String name, <span class="type">int</span> weight, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.index = index;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Item(&quot;</span> + name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Item[] items = <span class="keyword">new</span> <span class="title class_">Item</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">1</span>, <span class="string">&quot;é»„é‡‘&quot;</span>, <span class="number">4</span>, <span class="number">1600</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">2</span>, <span class="string">&quot;å®çŸ³&quot;</span>, <span class="number">8</span>, <span class="number">2400</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">3</span>, <span class="string">&quot;ç™½é“¶&quot;</span>, <span class="number">5</span>, <span class="number">30</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">4</span>, <span class="string">&quot;é’»çŸ³&quot;</span>, <span class="number">1</span>, <span class="number">10000</span>),</span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(select(items, <span class="number">10</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(Item[] items, <span class="type">int</span> total)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[items.length][total + <span class="number">1</span>]; <span class="comment">// total + 1æ˜¯é˜²æ­¢0</span></span><br><span class="line">        print(dp);</span><br><span class="line">        <span class="type">Item</span> <span class="variable">item0</span> <span class="operator">=</span> items[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; total + <span class="number">1</span>; j++) &#123; <span class="comment">// å…ˆå¤„ç†ç¬¬ä¸€è¡Œ</span></span><br><span class="line">            <span class="keyword">if</span> (j &gt;= item0.weight) &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = item0.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        print(dp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; dp.length; i++) &#123;</span><br><span class="line">            <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> items[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; total + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="comment">// x: ä¸Šä¸€æ¬¡åŒå®¹é‡èƒŒåŒ…çš„æœ€å¤§ä»·å€¼</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> dp[i - <span class="number">1</span>][j];</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= item.weight) &#123;</span><br><span class="line">                    <span class="comment">// j-item.weight: å½“å‰èƒŒåŒ…å®¹é‡-è¿™æ¬¡ç‰©å“é‡é‡=å‰©ä½™èƒŒåŒ…ç©ºé—´</span></span><br><span class="line">                    <span class="comment">// y: å‰©ä½™èƒŒåŒ…ç©ºé—´èƒ½è£…ä¸‹çš„æœ€å¤§ä»·å€¼ + è¿™æ¬¡ç‰©å“ä»·å€¼</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> dp[i - <span class="number">1</span>][j - item.weight] + item.value;</span><br><span class="line">                    dp[i][j] = Integer.max(x, y);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = x;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            print(dp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[dp.length - <span class="number">1</span>][total];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span>[][] dp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;   &quot;</span> + <span class="string">&quot;-&quot;</span>.repeat(<span class="number">63</span>));</span><br><span class="line">        Object[] array = IntStream.range(<span class="number">0</span>, dp[<span class="number">0</span>].length + <span class="number">1</span>).boxed().toArray();</span><br><span class="line">        System.out.printf((<span class="string">&quot;%5d &quot;</span>.repeat(dp[<span class="number">0</span>].length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] d : dp) &#123;</span><br><span class="line">            array = Arrays.stream(d).boxed().toArray();</span><br><span class="line">            System.out.printf((<span class="string">&quot;%5d &quot;</span>.repeat(d.length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå®Œå…¨èƒŒåŒ…é—®é¢˜"><a href="#ğŸå®Œå…¨èƒŒåŒ…é—®é¢˜" class="headerlink" title="ğŸå®Œå…¨èƒŒåŒ…é—®é¢˜"></a>ğŸå®Œå…¨èƒŒåŒ…é—®é¢˜</h2><h3 id="é—®é¢˜æè¿°-1"><a href="#é—®é¢˜æè¿°-1" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>nä¸ªç‰©å“éƒ½æ˜¯å›ºä½“ï¼Œæœ‰é‡é‡å’Œä»·å€¼ã€‚ç°åœ¨è¦å–èµ°<strong>ä¸è¶…è¿‡10å…‹</strong>çš„ç‰©å“ã€‚é—®æœ€é«˜ä»·å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>ä¸0-1èƒŒåŒ…é—®é¢˜çš„åŒºåˆ«åœ¨äºå¯ä»¥<strong>æ‹¿å¤šæ¬¡</strong></p><p>ç¤ºä¾‹ï¼š</p><table><thead><tr><th>ç¼–å·</th><th>é‡é‡ï¼ˆgï¼‰</th><th>ä»·å€¼</th><th>æè¿°</th><th>ç®€ç§°</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>3</td><td>é’é“œ</td><td>C</td></tr><tr><td>2</td><td>3</td><td>4</td><td>ç™½é“¶</td><td>S</td></tr><tr><td>3</td><td>4</td><td>7</td><td>é»„é‡‘</td><td>A</td></tr></tbody></table><h3 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å’Œ0-1èƒŒåŒ…åŒæ ·çš„æ€è·¯ï¼Œè€ƒè™‘äºŒç»´dpæ•°ç»„ï¼Œ<strong>è¡Œä»£è¡¨è¯¥ç¼–å·å¯¹åº”çš„ç‰©å“ï¼Œåˆ—ä»£è¡¨èƒŒåŒ…é‡é‡</strong>ï¼ˆ0~nï¼‰,<code>dp[i][j]</code>ä»£è¡¨<strong>iç§ç‰©ä½“ä¸‹jé‡é‡çš„æœ€å¤§ä»·å€¼</strong></p><p>åˆ†æå¦‚ä¸‹ï¼š</p><p>â€‹0123456</p><p>1  00CC   2C  2C 3Cé’é“œ</p><p>1  00CS   2C  SC 3C ç™½é“¶</p><p>1  00CS   A    A    ACé»„é‡‘</p><hr><p>è½¬ä¸ºé€’æ¨å¼å¦‚ä¸‹ï¼š</p><p>1.è£…ä¸ä¸‹ï¼šä¿æŒä¸Šä¸€è¡Œä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br></pre></td></tr></table></figure><p>2.è£…å¾—ä¸‹ï¼šmax(ä¸Šä¸€è¡Œä»·å€¼ï¼Œå½“å‰ç‰©å“ä»·å€¼+<strong>æœ¬è¡Œ</strong>ä¸­å‡å»å½“å‰ç‰©å“é‡é‡çš„ä»·å€¼)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = max(dp[i-<span class="number">1</span>][j],item.value+dp[i][j-item.weight]);</span><br></pre></td></tr></table></figure><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">KnapsackProblemComplete</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Item</span> &#123;</span><br><span class="line">        <span class="type">int</span> index;</span><br><span class="line">        String name;</span><br><span class="line">        <span class="type">int</span> weight;</span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Item</span><span class="params">(<span class="type">int</span> index, String name, <span class="type">int</span> weight, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.index = index;</span><br><span class="line">            <span class="built_in">this</span>.name = name;</span><br><span class="line">            <span class="built_in">this</span>.weight = weight;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Item(&quot;</span> + name + <span class="string">&quot;)&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Item[] items = <span class="keyword">new</span> <span class="title class_">Item</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">1</span>, <span class="string">&quot;é’é“œ&quot;</span>, <span class="number">2</span>, <span class="number">3</span>),    <span class="comment">// c</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">2</span>, <span class="string">&quot;ç™½é“¶&quot;</span>, <span class="number">3</span>, <span class="number">4</span>),    <span class="comment">// s</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">Item</span>(<span class="number">3</span>, <span class="string">&quot;é»„é‡‘&quot;</span>, <span class="number">4</span>, <span class="number">7</span>),    <span class="comment">// a</span></span><br><span class="line">        &#125;;</span><br><span class="line">        System.out.println(select(items, <span class="number">6</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">            0   1   2   3   4   5   6</span></span><br><span class="line"><span class="comment">        1   0   0   c   c   cc  cc  ccc</span></span><br><span class="line"><span class="comment">        2   0   0   c   s   cc  cs  ccc</span></span><br><span class="line"><span class="comment">        3   0   0   c   s   a   a   ac</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">(Item[] items, <span class="type">int</span> total)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[items.length][total + <span class="number">1</span>];</span><br><span class="line">        <span class="type">Item</span> <span class="variable">item0</span> <span class="operator">=</span> items[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; total + <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= item0.weight) &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j - item0.weight] + item0.value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        print(dp);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; items.length; i++) &#123;</span><br><span class="line">            <span class="type">Item</span> <span class="variable">item</span> <span class="operator">=</span> items[i];            </span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; total + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="comment">// x: ä¸Šä¸€æ¬¡åŒå®¹é‡èƒŒåŒ…çš„æœ€å¤§ä»·å€¼</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> dp[i - <span class="number">1</span>][j];</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= item.weight) &#123;</span><br><span class="line">                    <span class="comment">// j-item.weight: å½“å‰èƒŒåŒ…å®¹é‡-è¿™æ¬¡ç‰©å“é‡é‡=å‰©ä½™èƒŒåŒ…ç©ºé—´</span></span><br><span class="line">                    <span class="comment">// y: å‰©ä½™èƒŒåŒ…ç©ºé—´èƒ½è£…ä¸‹çš„æœ€å¤§ä»·å€¼ + è¿™æ¬¡ç‰©å“ä»·å€¼</span></span><br><span class="line">                    <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> dp[i][j - item.weight] + item.value;</span><br><span class="line">                    dp[i][j] = Integer.max(x, y);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = x;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            print(dp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[dp.length - <span class="number">1</span>][total];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span>[][] dp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;   &quot;</span> + <span class="string">&quot;-&quot;</span>.repeat(<span class="number">63</span>));</span><br><span class="line">        Object[] array = IntStream.range(<span class="number">0</span>, dp[<span class="number">0</span>].length + <span class="number">1</span>).boxed().toArray();</span><br><span class="line">        System.out.printf((<span class="string">&quot;%5d &quot;</span>.repeat(dp[<span class="number">0</span>].length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] d : dp) &#123;</span><br><span class="line">            array = Arrays.stream(d).boxed().toArray();</span><br><span class="line">            System.out.printf((<span class="string">&quot;%5d &quot;</span>.repeat(d.length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé›¶é’±å…‘æ¢é—®é¢˜"><a href="#ğŸé›¶é’±å…‘æ¢é—®é¢˜" class="headerlink" title="ğŸé›¶é’±å…‘æ¢é—®é¢˜"></a>ğŸé›¶é’±å…‘æ¢é—®é¢˜</h2><h3 id="é—®é¢˜æè¿°-2"><a href="#é—®é¢˜æè¿°-2" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>å‡‘æˆæ€»é‡‘é¢çš„å‡‘æ³•ä¸­ï¼Œéœ€è¦ç¡¬å¸çš„æœ€å°‘ä¸ªæ•°æ˜¯å¤šå°‘ï¼Ÿ</p><p>ç¤ºä¾‹ï¼šç°æœ‰é¢å€¼1ã€2ã€5ï¼Œæ±‚å‡‘æˆæ€»é‡‘é¢ä¸º5çš„æœ€å°ä¸ªæ•°</p><h3 id="æ€è·¯-2"><a href="#æ€è·¯-2" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>å’ŒèƒŒåŒ…é—®é¢˜ä¸€æ ·çš„åˆ†ææ–¹æ³•</p><p>é¢å€¼012345</p><p>â€‹1  0111111  1111  11111</p><p>â€‹2  01221 22  221</p><p>â€‹5  01221 22   5    </p><p>æ€»é‡‘é¢ï¼šç±»æ¯”ä¸ºèƒŒåŒ…å®¹é‡</p><p>ç¡¬å¸é¢å€¼ï¼šç±»æ¯”ä¸ºç‰©å“é‡é‡</p><p>ç¡¬å¸ä¸ªæ•°ï¼šç±»æ¯”ä¸ºç‰©å“ä»·å€¼ï¼ˆå›ºå®šä¸º1ï¼‰</p><p>é—®é¢˜ï¼šæ±‚ä»·å€¼ï¼ˆä¸ªæ•°ï¼‰<strong>æœ€å°çš„</strong></p><hr><p>è½¬ä¸ºé€’æ¨å¼å¦‚ä¸‹ï¼š</p><p>1.è£…ä¸ä¸‹ï¼šä¿æŒä¸Šæ¬¡ä»·å€¼ï¼ˆä¸ªæ•°ï¼‰ä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br></pre></td></tr></table></figure><p>2.è£…å¾—ä¸‹ï¼šmin(ä¸Šæ¬¡ä»·å€¼ï¼ˆä¸ªæ•°ï¼‰ï¼Œå‰©ä½™å®¹é‡èƒ½è£…ä¸‹çš„æœ€å°ä»·å€¼ï¼ˆä¸ªæ•°ï¼‰**+1**)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = min(dp[i-<span class="number">1</span>][j],dp[i][j-coin]+<span class="number">1</span>);</span><br></pre></td></tr></table></figure><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangeMakingProblemLeetcode322</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">coinChange</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> amount + <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[coins.length][amount + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; amount + <span class="number">1</span>; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (j &gt;= coins[<span class="number">0</span>]) &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = <span class="number">1</span> + dp[<span class="number">0</span>][j - coins[<span class="number">0</span>]];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = max;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; coins.length; i++) &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">1</span>; j &lt; amount + <span class="number">1</span>; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (j &gt;= coins[i]) &#123;</span><br><span class="line">                    dp[i][j] = Math.min(dp[i - <span class="number">1</span>][j], <span class="number">1</span> + dp[i][j - coins[i]]);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    dp[i][j] = dp[i - <span class="number">1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            print(dp);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> dp[coins.length - <span class="number">1</span>][amount];</span><br><span class="line">        <span class="keyword">return</span> r &gt; amount ? -<span class="number">1</span> : r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChangeMakingProblemLeetcode322</span> <span class="variable">leetcode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChangeMakingProblemLeetcode322</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> leetcode.coinChange(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>&#125;, <span class="number">5</span>);</span><br><span class="line"><span class="comment">//        int count = leetcode.coinChange(new int[]&#123;25, 10, 5, 1&#125;, 41);</span></span><br><span class="line"><span class="comment">//        int count = leetcode.coinChange(new int[]&#123;2&#125;, 3);</span></span><br><span class="line"><span class="comment">//        int count = leetcode.coinChange(new int[]&#123;15, 10, 1&#125;, 21);</span></span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span>[][] dp)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;-&quot;</span>.repeat(<span class="number">18</span>));</span><br><span class="line">        Object[] array = IntStream.range(<span class="number">0</span>, dp[<span class="number">0</span>].length + <span class="number">1</span>).boxed().toArray();</span><br><span class="line">        System.out.printf((<span class="string">&quot;%2d &quot;</span>.repeat(dp[<span class="number">0</span>].length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span>[] d : dp) &#123;</span><br><span class="line">            array = Arrays.stream(d).boxed().toArray();</span><br><span class="line">            System.out.printf((<span class="string">&quot;%2d &quot;</span>.repeat(d.length)) + <span class="string">&quot;%n&quot;</span>, array);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé›¶é’±å…‘æ¢é—®é¢˜II"><a href="#ğŸé›¶é’±å…‘æ¢é—®é¢˜II" class="headerlink" title="ğŸé›¶é’±å…‘æ¢é—®é¢˜II"></a>ğŸé›¶é’±å…‘æ¢é—®é¢˜II</h2><h3 id="é—®é¢˜æè¿°-3"><a href="#é—®é¢˜æè¿°-3" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>å‡‘æˆæ€»é‡‘é¢çš„<strong>å‡‘æ³•</strong>æœ‰å¤šå°‘ï¼Ÿ</p><p>ç¤ºä¾‹ï¼šç°æœ‰é¢å€¼1ã€2ã€5ï¼Œæ±‚å‡‘æˆæ€»é‡‘é¢ä¸º5çš„æœ€å°ä¸ªæ•°</p><h3 id="æ€è·¯-3"><a href="#æ€è·¯-3" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>é¢å€¼012345</p><p>â€‹1     1111111  1111  11111</p><p>â€‹2     1111111  1111  11111</p><p>â€‹        2    21    2112111</p><p>â€‹                   22  221</p><p>â€‹5     1 111111  1111  11111</p><p>â€‹        2    21    2112111</p><p>â€‹                   22  221</p><p>â€‹5</p><hr><p>è½¬ä¸ºé€’æ¨å¼å¦‚ä¸‹ï¼š</p><p>1.è£…ä¸ä¸‹ï¼šä¿æŒä¸Šæ¬¡ä¸å˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br></pre></td></tr></table></figure><p>2.è£…å¾—ä¸‹ï¼š<strong>ç»§æ‰¿ä¸Šæ¬¡çš„</strong>+å‡å»å½“å‰é¢å€¼çš„å‰©ä½™é¢å€¼å¯¹åº”çš„ä¸ªæ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-coin];</span><br></pre></td></tr></table></figure><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChangeMakingProblem</span> &#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     é¢å€¼    0        1        2        3        4        5</span></span><br><span class="line"><span class="comment">       1    1        1        1        1        1        1</span></span><br><span class="line"><span class="comment">       2    1        1        2        2        3        3</span></span><br><span class="line"><span class="comment">       5    1        1        2        2        3        4</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     é¢å€¼    0        1        2        3</span></span><br><span class="line"><span class="comment">            1        0        0        0</span></span><br><span class="line"><span class="comment">       2    1        0        1        0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">change</span><span class="params">(<span class="type">int</span>[] coins, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[][] dp = <span class="keyword">new</span> <span class="title class_">int</span>[coins.length][amount + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;coins.length; i++)&#123; <span class="comment">// ç¬¬ä¸€åˆ—å…¨è®¾ç½®ä¸º0</span></span><br><span class="line">            dp[i][<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j &lt; amount+<span class="number">1</span>;j++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=coins[<span class="number">0</span>])&#123;</span><br><span class="line">                dp[<span class="number">0</span>][j] = dp[<span class="number">0</span>][j - coins[<span class="number">0</span>]];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i &lt; coins.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">1</span>;j &lt; amount+<span class="number">1</span>;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(j &gt;= coins[i])&#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j] + dp[i][j-coins[i]];</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    dp[i][j] = dp[i-<span class="number">1</span>][j];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dp[coins.length - <span class="number">1</span>][amount];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChangeMakingProblemLeetcode518</span> <span class="variable">leetcode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChangeMakingProblemLeetcode518</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> leetcode.change(<span class="keyword">new</span> <span class="title class_">int</span>[]&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>&#125;, <span class="number">5</span>);</span><br><span class="line">        System.out.println(count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisç¼“å­˜é—®é¢˜</title>
      <link href="/posts/8423/"/>
      <url>/posts/8423/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç¼“å­˜ç©¿é€"><a href="#ğŸç¼“å­˜ç©¿é€" class="headerlink" title="ğŸç¼“å­˜ç©¿é€"></a>ğŸç¼“å­˜ç©¿é€</h2><h3 id="é—®é¢˜æè¿°"><a href="#é—®é¢˜æè¿°" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>keyå¯¹åº”çš„æ•°æ®åœ¨æ•°æ®æºå¹¶ä¸å­˜åœ¨ï¼Œæ¯æ¬¡<strong>é’ˆå¯¹æ­¤keyçš„è¯·æ±‚ä»ç¼“å­˜è·å–ä¸åˆ°</strong>ï¼Œè¯·æ±‚éƒ½ä¼šå‹åˆ°æ•°æ®æºï¼Œä»è€Œå¯èƒ½å‹å®æ•°æ®æºã€‚</p><img src="/img/8423/Redisç¼“å­˜1.png" alt="image-20231015222002338" style="zoom:67%;" /><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ï¼ˆ1ï¼‰  <strong>å¯¹ç©ºå€¼ç¼“å­˜ï¼š</strong>å¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©ºï¼ˆä¸ç®¡æ˜¯æ•°æ®æ˜¯å¦ä¸å­˜åœ¨ï¼‰ï¼Œæˆ‘ä»¬ä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœï¼ˆnullï¼‰è¿›è¡Œç¼“å­˜ï¼Œè®¾ç½®ç©ºç»“æœçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿ</p><p>ï¼ˆ2ï¼‰  <strong>è®¾ç½®å¯è®¿é—®çš„åå•ï¼ˆç™½åå•ï¼‰ï¼š</strong></p><p>ä½¿ç”¨bitmapsç±»å‹å®šä¹‰ä¸€ä¸ªå¯ä»¥è®¿é—®çš„åå•ï¼Œåå•idä½œä¸ºbitmapsçš„åç§»é‡ï¼Œæ¯æ¬¡è®¿é—®å’Œbitmapé‡Œé¢çš„idè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœè®¿é—®idä¸åœ¨bitmapsé‡Œé¢ï¼Œè¿›è¡Œæ‹¦æˆªï¼Œä¸å…è®¸è®¿é—®ã€‚</p><p>ï¼ˆ3ï¼‰  <strong>é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨</strong>ï¼š(å¸ƒéš†è¿‡æ»¤å™¨ï¼ˆBloom Filterï¼‰æ˜¯1970å¹´ç”±å¸ƒéš†æå‡ºçš„ã€‚å®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªå¾ˆé•¿çš„äºŒè¿›åˆ¶å‘é‡(ä½å›¾)å’Œä¸€ç³»åˆ—éšæœºæ˜ å°„å‡½æ•°ï¼ˆå“ˆå¸Œå‡½æ•°ï¼‰ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨å¯ä»¥ç”¨äºæ£€ç´¢ä¸€ä¸ªå…ƒç´ æ˜¯å¦åœ¨ä¸€ä¸ªé›†åˆä¸­ã€‚å®ƒçš„ä¼˜ç‚¹æ˜¯ç©ºé—´æ•ˆç‡å’ŒæŸ¥è¯¢æ—¶é—´éƒ½è¿œè¿œè¶…è¿‡ä¸€èˆ¬çš„ç®—æ³•ï¼Œç¼ºç‚¹æ˜¯æœ‰ä¸€å®šçš„è¯¯è¯†åˆ«ç‡å’Œåˆ é™¤å›°éš¾ã€‚)</p><p>å°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„bitmapsä¸­ï¼Œä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢« è¿™ä¸ªbitmapsæ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚</p><p><strong>ï¼ˆ4ï¼‰</strong>  <strong>è¿›è¡Œå®æ—¶ç›‘æ§ï¼š</strong>å½“å‘ç°Redisçš„å‘½ä¸­ç‡å¼€å§‹æ€¥é€Ÿé™ä½ï¼Œéœ€è¦æ’æŸ¥è®¿é—®å¯¹è±¡å’Œè®¿é—®çš„æ•°æ®ï¼Œå’Œè¿ç»´äººå‘˜é…åˆï¼Œå¯ä»¥è®¾ç½®é»‘åå•é™åˆ¶æœåŠ¡ã€‚</p><h2 id="ğŸç¼“å­˜é›ªå´©"><a href="#ğŸç¼“å­˜é›ªå´©" class="headerlink" title="ğŸç¼“å­˜é›ªå´©"></a>ğŸç¼“å­˜é›ªå´©</h2><h3 id="é—®é¢˜æè¿°-1"><a href="#é—®é¢˜æè¿°-1" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p>ç¼“å­˜ä¸­<strong>å¤§é‡keyå¤±æ•ˆ</strong>åå½“é«˜å¹¶å‘åˆ°æ¥æ—¶å¯¼è‡´<strong>å¤§é‡è¯·æ±‚åˆ°æ•°æ®åº“</strong>ï¼Œç¬é—´è€—å°½æ•°æ®åº“èµ„æºï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•ä½¿ç”¨ã€‚</p><p>é€ æˆç¼“å­˜é›ªå´©é—®é¢˜çš„åŸå› æ˜¯æ˜¯<strong>å¤§é‡keyæ‹¥æœ‰äº†ç›¸åŒçš„è¿‡æœŸæ—¶é—´</strong>ï¼Œæ¯”å¦‚å¯¹è¯¾ç¨‹ä¿¡æ¯è®¾ç½®ç¼“å­˜è¿‡æœŸæ—¶é—´ä¸º10åˆ†é’Ÿï¼Œåœ¨å¤§é‡è¯·æ±‚åŒæ—¶æŸ¥è¯¢å¤§é‡çš„è¯¾ç¨‹ä¿¡æ¯æ—¶ï¼Œæ­¤æ—¶å°±ä¼šæœ‰å¤§é‡çš„è¯¾ç¨‹å­˜åœ¨ç›¸åŒçš„è¿‡æœŸæ—¶é—´ï¼Œä¸€æ—¦å¤±æ•ˆå°†åŒæ—¶å¤±æ•ˆï¼Œé€ æˆé›ªå´©é—®é¢˜ã€‚</p><img src="/img/8423/Redisç¼“å­˜3.png" alt="image-20231015223549756" style="zoom:67%;" /><h3 id="è§£å†³æ–¹æ¡ˆ-1"><a href="#è§£å†³æ–¹æ¡ˆ-1" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ï¼ˆ1ï¼‰  <strong>æ„å»ºå¤šçº§ç¼“å­˜æ¶æ„ï¼š</strong>nginxç¼“å­˜ + redisç¼“å­˜ +å…¶ä»–ç¼“å­˜ï¼ˆehcacheç­‰ï¼‰</p><p>ï¼ˆ2ï¼‰  <strong>ä½¿ç”¨é”æˆ–é˜Ÿåˆ—ï¼š</strong></p><p>ç”¨åŠ é”æˆ–è€…é˜Ÿåˆ—çš„æ–¹å¼ä¿è¯æ¥ä¿è¯ä¸ä¼šæœ‰å¤§é‡çš„çº¿ç¨‹å¯¹æ•°æ®åº“ä¸€æ¬¡æ€§è¿›è¡Œè¯»å†™ï¼Œä»è€Œé¿å…å¤±æ•ˆæ—¶å¤§é‡çš„å¹¶å‘è¯·æ±‚è½åˆ°åº•å±‚å­˜å‚¨ç³»ç»Ÿä¸Šã€‚ä¸é€‚ç”¨é«˜å¹¶å‘æƒ…å†µ</p><p>ï¼ˆ3ï¼‰  <strong>è®¾ç½®è¿‡æœŸæ ‡å¿—æ›´æ–°ç¼“å­˜ï¼š</strong></p><p>è®°å½•ç¼“å­˜æ•°æ®æ˜¯å¦è¿‡æœŸï¼ˆè®¾ç½®æå‰é‡ï¼‰ï¼Œå¦‚æœè¿‡æœŸä¼šè§¦å‘é€šçŸ¥å¦å¤–çš„çº¿ç¨‹åœ¨åå°å»æ›´æ–°å®é™…keyçš„ç¼“å­˜ã€‚</p><p>ï¼ˆ4ï¼‰  <strong>å°†ç¼“å­˜å¤±æ•ˆæ—¶é—´åˆ†æ•£å¼€ï¼š</strong></p><p>æ¯”å¦‚æˆ‘ä»¬å¯ä»¥åœ¨åŸæœ‰çš„å¤±æ•ˆæ—¶é—´åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªéšæœºå€¼ï¼Œæ¯”å¦‚1-5åˆ†é’Ÿéšæœºï¼Œè¿™æ ·æ¯ä¸€ä¸ªç¼“å­˜çš„è¿‡æœŸæ—¶é—´çš„é‡å¤ç‡å°±ä¼šé™ä½ï¼Œå°±å¾ˆéš¾å¼•å‘é›†ä½“å¤±æ•ˆçš„äº‹ä»¶ã€‚</p><h2 id="ğŸç¼“å­˜å‡»ç©¿"><a href="#ğŸç¼“å­˜å‡»ç©¿" class="headerlink" title="ğŸç¼“å­˜å‡»ç©¿"></a>ğŸç¼“å­˜å‡»ç©¿</h2><h3 id="é—®é¢˜æè¿°-2"><a href="#é—®é¢˜æè¿°-2" class="headerlink" title="é—®é¢˜æè¿°"></a>é—®é¢˜æè¿°</h3><p><strong>å¤§é‡å¹¶å‘è®¿é—®åŒä¸€ä¸ªçƒ­ç‚¹æ•°æ®</strong>ï¼Œå½“çƒ­ç‚¹æ•°æ®å¤±æ•ˆååŒæ—¶å»è¯·æ±‚æ•°æ®åº“ï¼Œç¬é—´è€—å°½æ•°æ®åº“èµ„æºï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•ä½¿ç”¨ã€‚</p><p>æ¯”å¦‚æŸæ‰‹æœºæ–°å“å‘å¸ƒï¼Œå½“ç¼“å­˜å¤±æ•ˆæ—¶æœ‰å¤§é‡å¹¶å‘åˆ°æ¥å¯¼è‡´åŒæ—¶å»è®¿é—®æ•°æ®åº“ã€‚</p><img src="/img/8423/Redisç¼“å­˜2.png" alt="image-20231015222718419" style="zoom:67%;" /><h3 id="è§£å†³æ–¹æ¡ˆ-2"><a href="#è§£å†³æ–¹æ¡ˆ-2" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><p>ï¼ˆ1ï¼‰<strong>é¢„å…ˆè®¾ç½®çƒ­é—¨æ•°æ®ï¼š</strong>åœ¨redisé«˜å³°è®¿é—®ä¹‹å‰ï¼ŒæŠŠä¸€äº›çƒ­é—¨æ•°æ®æå‰å­˜å…¥åˆ°redisé‡Œé¢ï¼ŒåŠ å¤§è¿™äº›çƒ­é—¨æ•°æ®keyçš„æ—¶é•¿</p><p>ï¼ˆ2ï¼‰<strong>å®æ—¶è°ƒæ•´ï¼š</strong>ç°åœºç›‘æ§å“ªäº›æ•°æ®çƒ­é—¨ï¼Œå®æ—¶è°ƒæ•´keyçš„è¿‡æœŸæ—¶é•¿</p><p>ï¼ˆ3ï¼‰<strong>ä½¿ç”¨é”ï¼š</strong></p><p>â€‹å°±æ˜¯åœ¨ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™ï¼ˆåˆ¤æ–­æ‹¿å‡ºæ¥çš„å€¼ä¸ºç©ºï¼‰ï¼Œä¸æ˜¯ç«‹å³å»load dbã€‚</p><p>â€‹å…ˆä½¿ç”¨ç¼“å­˜å·¥å…·çš„æŸäº›å¸¦æˆåŠŸæ“ä½œè¿”å›å€¼çš„æ“ä½œï¼ˆæ¯”å¦‚Redisçš„SETNXï¼‰å»setä¸€ä¸ªmutex key</p><p>â€‹å½“æ“ä½œè¿”å›æˆåŠŸæ—¶ï¼Œå†è¿›è¡Œload dbçš„æ“ä½œï¼Œå¹¶å›è®¾ç¼“å­˜,æœ€ååˆ é™¤mutex keyï¼›</p><p>â€‹å½“æ“ä½œè¿”å›å¤±è´¥ï¼Œè¯æ˜æœ‰çº¿ç¨‹åœ¨load dbï¼Œå½“å‰çº¿ç¨‹ç¡çœ ä¸€æ®µæ—¶é—´å†é‡è¯•æ•´ä¸ªgetç¼“å­˜çš„æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaè®¾è®¡æ¨¡å¼</title>
      <link href="/posts/18992/"/>
      <url>/posts/18992/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ€»è§ˆ"><a href="#ğŸæ€»è§ˆ" class="headerlink" title="ğŸæ€»è§ˆ"></a>ğŸæ€»è§ˆ</h2><p><img src="/img/18992/design-pattern1.png" alt="img"></p><h3 id="å¸¸è§åˆ›å»ºå‹"><a href="#å¸¸è§åˆ›å»ºå‹" class="headerlink" title="å¸¸è§åˆ›å»ºå‹"></a>å¸¸è§åˆ›å»ºå‹</h3><p>å•ä¾‹æ¨¡å¼(Singleton pattern)ï¼šç¡®ä¿ä¸€ä¸ªç±»<strong>åªæœ‰ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå¹¶æä¾›è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹</p><p>ç®€å•å·¥å‚(Simple Factory)ï¼šæŠŠ<strong>å®ä¾‹åŒ–çš„æ“ä½œå•ç‹¬æ”¾åˆ°ä¸€ä¸ªç±»</strong>ä¸­ï¼Œè¿™ä¸ªç±»å°±æˆä¸ºç®€å•å·¥å‚ç±»ï¼Œè®©ç®€å•å·¥å‚ç±»æ¥å†³å®šåº”è¯¥ç”¨å“ªä¸ªå…·ä½“å­ç±»æ¥å®ä¾‹åŒ–ï¼Œè¿™æ ·åšèƒ½æŠŠå®¢æˆ·ç±»å’Œå…·ä½“å­ç±»çš„å®ç°è§£è€¦ï¼Œå®¢æˆ·ç±»ä¸å†éœ€è¦çŸ¥é“æœ‰å“ªäº›å­ç±»ä»¥åŠåº”å½“å®ä¾‹åŒ–å“ªä¸ªå­ç±»</p><p>å·¥å‚æ–¹æ³•(Factory Method)ï¼šå®ƒå®šä¹‰äº†ä¸€ä¸ª<strong>åˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»</strong>ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»</p><p>æŠ½è±¡å·¥å‚(Abstract Factory)ï¼ŒæŠ½è±¡å·¥å‚æ¨¡å¼åˆ›å»ºçš„æ˜¯å¯¹è±¡å®¶æ—ï¼Œä¹Ÿå°±æ˜¯<strong>å¾ˆå¤šå¯¹è±¡è€Œä¸æ˜¯ä¸€ä¸ªå¯¹è±¡</strong>ï¼Œå¹¶ä¸”è¿™äº›å¯¹è±¡æ˜¯ç›¸å…³çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¿…é¡»ä¸€èµ·åˆ›å»ºå‡ºæ¥</p><p>ç”Ÿæˆå™¨(Builder)ï¼Œå°è£…ä¸€ä¸ªå¯¹è±¡çš„æ„é€ è¿‡ç¨‹ï¼Œå¹¶å…è®¸<strong>æŒ‰æ­¥éª¤æ„é€ </strong>(StringBuilderã€StringBuffer)</p><p>åŸå‹æ¨¡å¼(Prototype)ï¼Œä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œé€šè¿‡<strong>å¤åˆ¶è¿™ä¸ªåŸå‹</strong>æ¥åˆ›å»ºæ–°å¯¹è±¡(Object.clone())</p><h3 id="å¸¸è§ç»“æ„å‹"><a href="#å¸¸è§ç»“æ„å‹" class="headerlink" title="å¸¸è§ç»“æ„å‹"></a>å¸¸è§ç»“æ„å‹</h3><p>é€‚é…å™¨æ¨¡å¼(Adapter pattern): å°†ä¸€ä¸ªç±»çš„æ¥å£, <strong>è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£</strong>ã€‚ é€‚é…å™¨è®©åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚ å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆ, ç±»é€‚é…å™¨ä½¿ç”¨å¤šé‡ç»§æ‰¿</p><p>æ¡¥æ¥æ¨¡å¼(Bridge pattern): ä½¿ç”¨æ¡¥æ¥æ¨¡å¼é€šè¿‡å°†å®ç°å’ŒæŠ½è±¡æ”¾åœ¨ä¸¤ä¸ªä¸åŒçš„ç±»å±‚æ¬¡ä¸­è€Œä½¿å®ƒä»¬å¯ä»¥ç‹¬ç«‹æ”¹å˜</p><p>ç»„åˆæ¨¡å¼(Composite pattern): å…è®¸ä½ å°†å¯¹è±¡ç»„åˆæˆ<strong>æ ‘å½¢ç»“æ„</strong>æ¥è¡¨ç°â€æ•´ä½“&#x2F;éƒ¨åˆ†â€å±‚æ¬¡ç»“æ„. ç»„åˆèƒ½è®©å®¢æˆ·ä»¥ä¸€è‡´çš„æ–¹å¼å¤„ç†ä¸ªåˆ«å¯¹è±¡ä»¥åŠå¯¹è±¡ç»„åˆ</p><p>è£…é¥°è€…æ¨¡å¼(Decorator pattern): åŠ¨æ€åœ°å°†è´£ä»»é™„åŠ åˆ°å¯¹è±¡ä¸Š, è‹¥è¦<strong>æ‰©å±•åŠŸèƒ½</strong>, è£…é¥°è€…æä¾›äº†æ¯”ç»§æ‰¿æ›´æœ‰å¼¹æ€§çš„æ›¿ä»£æ–¹æ¡ˆ</p><p>ä»£ç†æ¨¡å¼(Proxy pattern): ä¸ºå¦ä¸€ä¸ªå¯¹è±¡<strong>æä¾›ä¸€ä¸ªæ›¿èº«æˆ–å ä½ç¬¦</strong>ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</p><h3 id="å¸¸è§è¡Œä¸ºå‹"><a href="#å¸¸è§è¡Œä¸ºå‹" class="headerlink" title="å¸¸è§è¡Œä¸ºå‹"></a>å¸¸è§è¡Œä¸ºå‹</h3><p>è´£ä»»é“¾æ¨¡å¼(Chain of responsibility pattern): é€šè¿‡è´£ä»»é“¾æ¨¡å¼, ä½ å¯ä»¥ä¸ºæŸä¸ªè¯·æ±‚<strong>åˆ›å»ºä¸€ä¸ªå¯¹è±¡é“¾</strong>. æ¯ä¸ªå¯¹è±¡ä¾åºæ£€æŸ¥æ­¤è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†æˆ–è€…å°†å®ƒä¼ ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡</p><p>ç­–ç•¥æ¨¡å¼(Strategy pattern): å®šä¹‰äº†ç®—æ³•æ—, åˆ†åˆ«å°é—­èµ·æ¥, è®©å®ƒä»¬ä¹‹é—´å¯ä»¥äº’ç›¸æ›¿æ¢, æ­¤æ¨¡å¼è®©ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„å®¢æˆ·</p><p>æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template pattern): åœ¨ä¸€ä¸ªæ–¹æ³•ä¸­å®šä¹‰ä¸€ä¸ª<strong>ç®—æ³•çš„éª¨æ¶, è€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­</strong>. æ¨¡æ¿æ–¹æ³•ä½¿å¾—å­ç±»å¯ä»¥åœ¨ä¸æ”¹å˜ç®—æ³•ç»“æ„çš„æƒ…å†µä¸‹, é‡æ–°å®šä¹‰ç®—æ³•ä¸­çš„æŸäº›æ­¥éª¤</p><h2 id="ğŸå•ä¾‹æ¨¡å¼ï¼ˆğŸš©ï¼‰"><a href="#ğŸå•ä¾‹æ¨¡å¼ï¼ˆğŸš©ï¼‰" class="headerlink" title="ğŸå•ä¾‹æ¨¡å¼ï¼ˆğŸš©ï¼‰"></a>ğŸå•ä¾‹æ¨¡å¼ï¼ˆğŸš©ï¼‰</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>ç¡®ä¿ä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›è¯¥å®ä¾‹çš„å…¨å±€è®¿é—®ç‚¹</p></blockquote><p>ä½¿ç”¨<strong>ä¸€ä¸ªç§æœ‰æ„é€ å‡½æ•°ã€ä¸€ä¸ªç§æœ‰é™æ€å˜é‡ä»¥åŠä¸€ä¸ªå…¬æœ‰é™æ€å‡½æ•°</strong>æ¥å®ç°</p><p>ç§æœ‰æ„é€ å‡½æ•°ä¿è¯äº†ä¸èƒ½é€šè¿‡æ„é€ å‡½æ•°æ¥åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œåªèƒ½é€šè¿‡å…¬æœ‰é™æ€å‡½æ•°è¿”å›å”¯ä¸€çš„ç§æœ‰é™æ€å˜é‡</p><p><img src="/img/18992/design-pattern3.png" alt="img"></p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><h4 id="1-é¥¿æ±‰å¼"><a href="#1-é¥¿æ±‰å¼" class="headerlink" title="1.é¥¿æ±‰å¼"></a>1.é¥¿æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton1</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// ç§æœ‰æ„é€ å‡½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;å•ä¾‹å¯¹è±¡ä¸èƒ½é‡å¤åˆ›å»º&quot;</span>); <span class="comment">//é˜²æ­¢åå°„ç ´åå•ä¾‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton1()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç§æœ‰é™æ€å˜é‡ï¼Œåˆå§‹åŒ–ç±»çš„æ—¶å€™å°±åˆ›å»ºå¥½å®ä¾‹ï¼Œç§°ä¸ºé¥¿æ±‰å¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton1</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton1</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¬æœ‰é™æ€å‡½æ•°</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton1 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123; <span class="comment">//é‡å†™æ–¹æ³•,é˜²æ­¢ååºåˆ—åŒ–ç ´åå•ä¾‹</span></span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-æšä¸¾é¥¿æ±‰å¼"><a href="#2-æšä¸¾é¥¿æ±‰å¼" class="headerlink" title="2.æšä¸¾é¥¿æ±‰å¼"></a>2.æšä¸¾é¥¿æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">Singleton2</span> &#123; <span class="comment">// enumå…³é”®å­—</span></span><br><span class="line">    INSTANCE;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton2</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton2()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> getClass().getName() + <span class="string">&quot;@&quot;</span> + Integer.toHexString(hashCode());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton2 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤©ç„¶é˜²æ­¢åå°„ã€ååºåˆ—åŒ–ç ´åå•ä¾‹</p><h4 id="3-æ‡’æ±‰å¼"><a href="#3-æ‡’æ±‰å¼" class="headerlink" title="3.æ‡’æ±‰å¼"></a>3.æ‡’æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton3</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton3</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton3()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç±»åˆå§‹åŒ–æ—¶æš‚æ—¶ä¸åˆ›å»ºå®ä¾‹ï¼Œç§°ä¸ºæ‡’æ±‰å¼</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">Singleton3</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Singleton3.class</span></span><br><span class="line">    <span class="comment">// synchronizedåŠ é”,åœ¨ä¸€ä¸ªæ—¶é—´ç‚¹åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥è¯¥æ–¹æ³•ï¼Œä»è€Œé¿å…äº†å¤šæ¬¡å®ä¾‹åŒ– INSTANCE çš„é—®é¢˜</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> Singleton3 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">            INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton3</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åªæœ‰<strong>é¦–æ¬¡åˆ›å»ºå•ä¾‹å¯¹è±¡</strong>æ—¶æ‰éœ€è¦åŒæ­¥ï¼Œä½†è¯¥ä»£ç å®é™…ä¸Šæ¯æ¬¡è°ƒç”¨éƒ½ä¼šåŒæ­¥ï¼Œå› æ­¤æœ‰ä¸‹é¢çš„åŒæ£€é”DCLæ–¹æ¡ˆ</p><h4 id="4-åŒæ£€é”æ‡’æ±‰å¼"><a href="#4-åŒæ£€é”æ‡’æ±‰å¼" class="headerlink" title="4.åŒæ£€é”æ‡’æ±‰å¼"></a>4.åŒæ£€é”æ‡’æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton4</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton4</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton4()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">Singleton4</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">//volatileé˜²æ­¢æŒ‡ä»¤é‡æ’ï¼Œè¿”å›æœªå®Œæˆå¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton4 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆåˆ¤æ–­ INSTANCE æ˜¯å¦å·²ç»è¢«å®ä¾‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰è¢«å®ä¾‹åŒ–ï¼Œé‚£ä¹ˆæ‰å¯¹å®ä¾‹åŒ–è¯­å¥è¿›è¡ŒåŠ é”</span></span><br><span class="line">        <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton4.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (INSTANCE == <span class="literal">null</span>) &#123;</span><br><span class="line">                    INSTANCE = <span class="keyword">new</span> <span class="title class_">Singleton4</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-å†…éƒ¨ç±»æ‡’æ±‰å¼"><a href="#5-å†…éƒ¨ç±»æ‡’æ±‰å¼" class="headerlink" title="5.å†…éƒ¨ç±»æ‡’æ±‰å¼"></a>5.å†…éƒ¨ç±»æ‡’æ±‰å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton5</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton5</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;private Singleton5()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†…éƒ¨ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Holder</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> <span class="type">Singleton5</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton5</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton5 <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Holder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">otherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;otherMethod()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“Singletonç±»åŠ è½½æ—¶ï¼Œé™æ€å†…éƒ¨ç±»Holderæ²¡æœ‰è¢«åŠ è½½è¿›å†…å­˜ã€‚åªæœ‰å½“è°ƒç”¨<code>getInstance()</code>æ–¹æ³•ä»è€Œè§¦å‘Holder.INSTANCE æ—¶ Holder æ‰ä¼šè¢«åŠ è½½ï¼Œæ­¤æ—¶åˆå§‹åŒ– INSTANCE å®ä¾‹</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p><img src="/img/18992/design-pattern2.png" alt="img"></p><h3 id="ä½“ç°"><a href="#ä½“ç°" class="headerlink" title="ä½“ç°"></a>ä½“ç°</h3><ul><li>Runtime é¥¿æ±‰å¼å•ä¾‹</li><li>Console åŒæ£€é”æ‡’æ±‰å¼å•ä¾‹</li><li>Collections ä¸­çš„ EmptyNavigableSet å†…éƒ¨ç±»æ‡’æ±‰å¼å•ä¾‹</li><li>ReverseComparator.REVERSE_ORDER å†…éƒ¨ç±»æ‡’æ±‰å¼å•ä¾‹</li><li>Comparators.NaturalOrderComparator.INSTANCE æšä¸¾é¥¿æ±‰å¼å•ä¾‹</li></ul><h3 id="å¥½å¤„"><a href="#å¥½å¤„" class="headerlink" title="å¥½å¤„"></a>å¥½å¤„</h3><ul><li>é˜²æ­¢å…¶å®ƒå¯¹è±¡å¯¹è‡ªå·±çš„å®ä¾‹åŒ–ï¼Œç¡®ä¿æ‰€æœ‰çš„å¯¹è±¡éƒ½è®¿é—®ä¸€ä¸ªå®ä¾‹</li><li>æä¾›äº†å¯¹å”¯ä¸€å®ä¾‹çš„å—æ§è®¿é—®</li><li>ç”±äºåœ¨ç³»ç»Ÿå†…å­˜ä¸­åªå­˜åœ¨ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤å¯ä»¥èŠ‚çº¦ç³»ç»Ÿèµ„æºï¼Œå½“éœ€è¦é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¯¹è±¡æ—¶å•ä¾‹æ¨¡å¼æ— ç–‘å¯ä»¥æé«˜ç³»ç»Ÿçš„æ€§èƒ½</li><li>å…è®¸å¯å˜æ•°ç›®çš„å®ä¾‹</li></ul><h2 id="ğŸå·¥å‚æ–¹æ³•æ¨¡å¼"><a href="#ğŸå·¥å‚æ–¹æ³•æ¨¡å¼" class="headerlink" title="ğŸå·¥å‚æ–¹æ³•æ¨¡å¼"></a>ğŸå·¥å‚æ–¹æ³•æ¨¡å¼</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>å®šä¹‰äº†ä¸€ä¸ªåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œä½†ç”±å­ç±»å†³å®šè¦å®ä¾‹åŒ–å“ªä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æŠŠå®ä¾‹åŒ–æ“ä½œæ¨è¿Ÿåˆ°å­ç±»</p></blockquote><p>åœ¨ç®€å•å·¥å‚ä¸­ï¼Œåˆ›å»ºå¯¹è±¡çš„æ˜¯å¦ä¸€ä¸ªç±»ï¼Œè€Œåœ¨å·¥å‚æ–¹æ³•ä¸­ï¼Œæ˜¯<strong>ç”±å­ç±»æ¥åˆ›å»ºå¯¹è±¡</strong></p><p><img src="/img/18992/design-pattern4.png" alt="img"></p><h3 id="å®ç°-1"><a href="#å®ç°-1" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Product</span> <span class="variable">product</span> <span class="operator">=</span> factoryMethod();</span><br><span class="line">        <span class="comment">// do something with the product</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteFactory</span> <span class="keyword">extends</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteFactory1</span> <span class="keyword">extends</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct1</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteFactory2</span> <span class="keyword">extends</span> <span class="title class_">Factory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> Product <span class="title function_">factoryMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcreteProduct2</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸåŸå‹æ¨¡å¼"><a href="#ğŸåŸå‹æ¨¡å¼" class="headerlink" title="ğŸåŸå‹æ¨¡å¼"></a>ğŸåŸå‹æ¨¡å¼</h2><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>ä½¿ç”¨åŸå‹å®ä¾‹æŒ‡å®šè¦åˆ›å»ºå¯¹è±¡çš„ç±»å‹ï¼Œé€šè¿‡å¤åˆ¶è¿™ä¸ªåŸå‹æ¥åˆ›å»ºæ–°å¯¹è±¡</p></blockquote><p><img src="/img/18992/design-pattern5.png" alt="img"></p><h3 id="å®ç°-2"><a href="#å®ç°-2" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line">    <span class="keyword">abstract</span> Prototype <span class="title function_">myClone</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcretePrototype</span> <span class="keyword">extends</span> <span class="title class_">Prototype</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String filed;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcretePrototype</span><span class="params">(String filed)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.filed = filed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    Prototype <span class="title function_">myClone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototype</span>(filed);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> filed;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">prototype</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcretePrototype</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">        <span class="type">Prototype</span> <span class="variable">clone</span> <span class="operator">=</span> prototype.myClone();</span><br><span class="line">        System.out.println(clone.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šabc</span></span><br></pre></td></tr></table></figure><h2 id="ğŸé€‚é…å™¨æ¨¡å¼"><a href="#ğŸé€‚é…å™¨æ¨¡å¼" class="headerlink" title="ğŸé€‚é…å™¨æ¨¡å¼"></a>ğŸé€‚é…å™¨æ¨¡å¼</h2><h3 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>å°†ä¸€ä¸ªç±»çš„æ¥å£, è½¬æ¢æˆå®¢æˆ·æœŸæœ›çš„å¦ä¸€ä¸ªæ¥å£ã€‚ é€‚é…å™¨è®©åŸæœ¬æ¥å£ä¸å…¼å®¹çš„ç±»å¯ä»¥åˆä½œæ— é—´ã€‚ å¯¹è±¡é€‚é…å™¨ä½¿ç”¨ç»„åˆ, ç±»é€‚é…å™¨ä½¿ç”¨å¤šé‡ç»§æ‰¿</p></blockquote><p><img src="/img/18992/design-pattern6.png" alt="img"></p><p><img src="/img/18992/design-pattern7.png" alt="img"></p><h3 id="å®ç°-3"><a href="#å®ç°-3" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Turkey</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">gobble</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WildTurkey</span> <span class="keyword">implements</span> <span class="title class_">Turkey</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">gobble</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;gobble!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TurkeyAdapter</span> <span class="keyword">implements</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">    Turkey turkey;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TurkeyAdapter</span><span class="params">(Turkey turkey)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.turkey = turkey;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">quack</span><span class="params">()</span> &#123;</span><br><span class="line">        turkey.gobble();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Turkey</span> <span class="variable">turkey</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WildTurkey</span>();</span><br><span class="line">        <span class="type">Duck</span> <span class="variable">duck</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TurkeyAdapter</span>(turkey);</span><br><span class="line">        duck.quack();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é¸­å­(Duck)å’Œç«é¸¡(Turkey)æ‹¥æœ‰ä¸åŒçš„å«å£°ï¼ŒDuck çš„å«å£°è°ƒç”¨ quack() æ–¹æ³•ï¼Œè€Œ Turkey è°ƒç”¨ gobble() æ–¹æ³•ã€‚å°† Turkey çš„ gobble() æ–¹æ³•é€‚é…æˆ Duck çš„ quack() æ–¹æ³•ï¼Œä»è€Œè®©ç«é¸¡å†’å……é¸­å­</span></span><br></pre></td></tr></table></figure><h2 id="ğŸä»£ç†æ¨¡å¼"><a href="#ğŸä»£ç†æ¨¡å¼" class="headerlink" title="ğŸä»£ç†æ¨¡å¼"></a>ğŸä»£ç†æ¨¡å¼</h2><h3 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>ä¸ºå¦ä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªæ›¿èº«æˆ–å ä½ç¬¦ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®</p></blockquote><p><img src="/img/18992/design-pattern8.png" alt="img"></p><h3 id="å®ç°-4"><a href="#å®ç°-4" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">showImage</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HighResolutionImage</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> URL imageURL;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">long</span> startTime;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getWidth</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> width;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HighResolutionImage</span><span class="params">(URL imageURL)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.imageURL = imageURL;</span><br><span class="line">        <span class="built_in">this</span>.startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="built_in">this</span>.width = <span class="number">600</span>;</span><br><span class="line">        <span class="built_in">this</span>.height = <span class="number">600</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLoad</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿå›¾ç‰‡åŠ è½½ï¼Œå»¶è¿Ÿ 3s åŠ è½½å®Œæˆ</span></span><br><span class="line">        <span class="type">long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">return</span> endTime - startTime &gt; <span class="number">3000</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showImage</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Real Image: &quot;</span> + imageURL);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageProxy</span> <span class="keyword">implements</span> <span class="title class_">Image</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HighResolutionImage highResolutionImage;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ImageProxy</span><span class="params">(HighResolutionImage highResolutionImage)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.highResolutionImage = highResolutionImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showImage</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!highResolutionImage.isLoad()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Temp Image: &quot;</span> + highResolutionImage.getWidth() + <span class="string">&quot; &quot;</span> + highResolutionImage.getHeight());</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        highResolutionImage.showImage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ImageViewer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">image</span> <span class="operator">=</span> <span class="string">&quot;http://image.jpg&quot;</span>;</span><br><span class="line">        <span class="type">URL</span> <span class="variable">url</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">URL</span>(image);</span><br><span class="line">        <span class="type">HighResolutionImage</span> <span class="variable">highResolutionImage</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HighResolutionImage</span>(url);</span><br><span class="line">        <span class="type">ImageProxy</span> <span class="variable">imageProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ImageProxy</span>(highResolutionImage);</span><br><span class="line">        imageProxy.showImage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿäº†å›¾ç‰‡å»¶è¿ŸåŠ è½½çš„æƒ…å†µä¸‹ä½¿ç”¨ä¸å›¾ç‰‡å¤§å°ç›¸ç­‰çš„ä¸´æ—¶å†…å®¹å»æ›¿æ¢åŸå§‹å›¾ç‰‡ï¼Œç›´åˆ°å›¾ç‰‡åŠ è½½å®Œæˆæ‰å°†å›¾ç‰‡æ˜¾ç¤ºå‡ºæ¥</span></span><br></pre></td></tr></table></figure><h2 id="ğŸè´£ä»»é“¾æ¨¡å¼"><a href="#ğŸè´£ä»»é“¾æ¨¡å¼" class="headerlink" title="ğŸè´£ä»»é“¾æ¨¡å¼"></a>ğŸè´£ä»»é“¾æ¨¡å¼</h2><h3 id="æ¦‚è¿°-5"><a href="#æ¦‚è¿°-5" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>é€šè¿‡è´£ä»»é“¾æ¨¡å¼, ä½ å¯ä»¥ä¸ºæŸä¸ªè¯·æ±‚åˆ›å»ºä¸€ä¸ªå¯¹è±¡é“¾. æ¯ä¸ªå¯¹è±¡ä¾åºæ£€æŸ¥æ­¤è¯·æ±‚å¹¶å¯¹å…¶è¿›è¡Œå¤„ç†æˆ–è€…å°†å®ƒä¼ ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªå¯¹è±¡</p></blockquote><p><img src="/img/18992/design-pattern9.png" alt="img"></p><h3 id="å®ç°-5"><a href="#å®ç°-5" class="headerlink" title="å®ç°"></a>å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Handler successor;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Handler</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.successor = successor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(Request request)</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteHandler1</span> <span class="keyword">extends</span> <span class="title class_">Handler</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteHandler1</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(successor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getType() == RequestType.type1) &#123;</span><br><span class="line">            System.out.println(request.getName() + <span class="string">&quot; is handle by ConcreteHandler1&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.handleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteHandler2</span> <span class="keyword">extends</span> <span class="title class_">Handler</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConcreteHandler2</span><span class="params">(Handler successor)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(successor);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">handleRequest</span><span class="params">(Request request)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (request.getType() == RequestType.type2) &#123;</span><br><span class="line">            System.out.println(request.getName() + <span class="string">&quot; is handle by ConcreteHandler2&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (successor != <span class="literal">null</span>) &#123;</span><br><span class="line">            successor.handleRequest(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Request</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> RequestType type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Request</span><span class="params">(RequestType type, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.type = type;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> RequestType <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">RequestType</span> &#123;</span><br><span class="line">    type1, type2</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Client</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handler1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteHandler1</span>(<span class="literal">null</span>);</span><br><span class="line">        <span class="type">Handler</span> <span class="variable">handler2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteHandler2</span>(handler1);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(RequestType.type1, <span class="string">&quot;request1&quot;</span>);</span><br><span class="line">        handler2.handleRequest(request1);</span><br><span class="line">        <span class="type">Request</span> <span class="variable">request2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Request</span>(RequestType.type2, <span class="string">&quot;request2&quot;</span>);</span><br><span class="line">        handler2.handleRequest(request2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º:</span></span><br><span class="line"><span class="comment">// request1 is handle by ConcreteHandler1</span></span><br><span class="line"><span class="comment">// request2 is handle by ConcreteHandler2</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> JavaåŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Threadæ–¹æ³•</title>
      <link href="/posts/4124/"/>
      <url>/posts/4124/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ€»è§ˆ"><a href="#ğŸæ€»è§ˆ" class="headerlink" title="ğŸæ€»è§ˆ"></a>ğŸæ€»è§ˆ</h2><table><thead><tr><th align="center">åç§°</th><th align="left">è¯´æ˜</th><th align="left">æ³¨æ„äº‹é¡¹</th></tr></thead><tbody><tr><td align="center">start()</td><td align="left">å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œåœ¨æ–°çš„çº¿ç¨‹<strong>è¿è¡Œ run æ–¹æ³•</strong></td><td align="left">start æ–¹æ³•åªæ˜¯è®©çº¿ç¨‹è¿›å…¥å°±ç»ªï¼Œé‡Œé¢ä»£ç <strong>ä¸ä¸€å®šç«‹åˆ»è¿è¡Œ</strong>ï¼ˆCPU çš„æ—¶é—´ç‰‡è¿˜æ²¡åˆ†ç»™å®ƒï¼‰ã€‚æ¯ä¸ªçº¿ç¨‹å¯¹è±¡çš„ startæ–¹æ³•<strong>åªèƒ½è°ƒç”¨ä¸€æ¬¡</strong>ï¼Œè°ƒç”¨äº†å¤šæ¬¡ä¼šå‡ºç° IllegalThreadStateException</td></tr><tr><td align="center">run()</td><td align="left">æ–°çº¿ç¨‹å¯åŠ¨åä¼š è°ƒç”¨çš„æ–¹æ³•</td><td align="left">å¦‚æœåœ¨æ„é€  Thread å¯¹è±¡æ—¶ä¼ é€’äº† Runnable å‚æ•°ï¼Œåˆ™çº¿ç¨‹å¯åŠ¨åä¼šè°ƒç”¨ Runnable ä¸­çš„ run æ–¹æ³•ï¼Œå¦åˆ™é»˜è®¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä½†å¯ä»¥åˆ›å»º Thread çš„å­ç±»å¯¹è±¡ï¼Œæ¥è¦†ç›–é»˜è®¤è¡Œä¸º</td></tr><tr><td align="center">join()</td><td align="left">ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</td><td align="left"></td></tr><tr><td align="center">join(long n)</td><td align="left">ç­‰å¾…çº¿ç¨‹è¿è¡Œç»“æŸ</td><td align="left">æœ€å¤šç­‰å¾… n  æ¯«ç§’</td></tr><tr><td align="center">setPriority(int)</td><td align="left">ä¿®æ”¹çº¿ç¨‹ä¼˜å…ˆçº§</td><td align="left">javaä¸­è§„å®šçº¿ç¨‹ä¼˜å…ˆçº§æ˜¯1~10 çš„æ•´æ•°ï¼Œè¾ƒå¤§çš„ä¼˜å…ˆçº§<strong>èƒ½æé«˜è¯¥çº¿ç¨‹è¢« CPU è°ƒåº¦çš„æœºç‡</strong></td></tr><tr><td align="center">interrupt()</td><td align="left">æ‰“æ–­çº¿ç¨‹</td><td align="left">å¦‚æœè¢«æ‰“æ–­çº¿ç¨‹æ­£åœ¨ sleepï¼Œwaitï¼Œjoin ä¼šå¯¼è‡´è¢«æ‰“æ–­çš„çº¿ç¨‹æŠ›å‡º InterruptedExceptionï¼Œ<strong>å¹¶æ¸…é™¤æ‰“æ–­æ ‡è®°</strong> ï¼›å¦‚æœæ‰“æ–­çš„æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹ï¼Œåˆ™ä¼š<strong>è®¾ç½®æ‰“æ–­æ ‡è®°</strong> ï¼›park çš„çº¿ç¨‹è¢«æ‰“æ–­ï¼Œä¹Ÿä¼š<strong>è®¾ç½®æ‰“æ–­æ ‡è®°</strong></td></tr><tr><td align="center">sleep(long n)</td><td align="left">è®©å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ä¼‘çœ næ¯«ç§’ï¼Œ ä¼‘çœ æ—¶è®©å‡ºcpu  çš„æ—¶é—´ç‰‡ç»™å…¶å®ƒçº¿ç¨‹</td><td align="left">staticï¼Œå±äºObjectçš„æ–¹æ³•</td></tr><tr><td align="center">yield()</td><td align="left">æç¤ºçº¿ç¨‹è°ƒåº¦å™¨è®©å‡ºå½“å‰çº¿ç¨‹å¯¹ CPUçš„ä½¿ç”¨</td><td align="left">staticï¼Œè¯¥æ–¹æ³•åªæ˜¯å¯¹çº¿ç¨‹è°ƒåº¦å™¨çš„ä¸€ä¸ªå»ºè®®</td></tr></tbody></table><h2 id="ğŸstartå’Œrun"><a href="#ğŸstartå’Œrun" class="headerlink" title="ğŸstartå’Œrun"></a>ğŸstartå’Œrun</h2><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="string">&quot;t1&quot;</span>) &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(Thread.currentThread().getName());</span><br><span class="line">            FileReader.read(Constants.MP4_FULL_PATH);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    t1.run();</span><br><span class="line">    <span class="comment">// t1.start();</span></span><br><span class="line">    log.debug(<span class="string">&quot;do other things ...&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-è°ƒç”¨-run"><a href="#1-è°ƒç”¨-run" class="headerlink" title="1.è°ƒç”¨ run"></a>1.è°ƒç”¨ run</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">19</span>:<span class="number">39</span>:<span class="number">14</span> [main] c.TestStart - main</span><br><span class="line"><span class="number">19</span>:<span class="number">39</span>:<span class="number">14</span> [main] c.FileReader - read [<span class="number">1.</span>mp4] start ...</span><br><span class="line"><span class="number">19</span>:<span class="number">39</span>:<span class="number">18</span> [main] c.FileReader - read [<span class="number">1.</span>mp4] end ... cost: <span class="number">4227</span> ms</span><br><span class="line"><span class="number">19</span>:<span class="number">39</span>:<span class="number">18</span> [main] c.TestStart - <span class="keyword">do</span> other things ...</span><br></pre></td></tr></table></figure><p>ç¨‹åºä»åœ¨ main çº¿ç¨‹è¿è¡Œï¼Œ FileReader.read() æ–¹æ³•è°ƒç”¨æ˜¯<strong>åŒæ­¥</strong>çš„</p><h4 id="2-è°ƒç”¨-start"><a href="#2-è°ƒç”¨-start" class="headerlink" title="2.è°ƒç”¨ start"></a>2.è°ƒç”¨ start</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">19</span>:<span class="number">41</span>:<span class="number">30</span> [main] c.TestStart - <span class="keyword">do</span> other things ...</span><br><span class="line"><span class="number">19</span>:<span class="number">41</span>:<span class="number">30</span> [t1] c.TestStart - t1</span><br><span class="line"><span class="number">19</span>:<span class="number">41</span>:<span class="number">30</span> [t1] c.FileReader - read [<span class="number">1.</span>mp4] start ...</span><br><span class="line"><span class="number">19</span>:<span class="number">41</span>:<span class="number">35</span> [t1] c.FileReader - read [<span class="number">1.</span>mp4] end ... cost: <span class="number">4542</span> ms</span><br></pre></td></tr></table></figure><p>ç¨‹åºåœ¨ t1 çº¿ç¨‹è¿è¡Œï¼Œ FileReader.read() æ–¹æ³•è°ƒç”¨æ˜¯<strong>å¼‚æ­¥</strong>çš„</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ç›´æ¥è°ƒç”¨ run æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œäº† runï¼Œ<strong>æ²¡æœ‰å¯åŠ¨æ–°çš„çº¿ç¨‹</strong> </p><p>ä½¿ç”¨ start æ˜¯å¯åŠ¨æ–°çš„çº¿ç¨‹ï¼Œé€šè¿‡æ–°çš„çº¿ç¨‹<strong>é—´æ¥æ‰§è¡Œ</strong> run ä¸­çš„ä»£ç </p><h2 id="ğŸsleepå’Œyield"><a href="#ğŸsleepå’Œyield" class="headerlink" title="ğŸsleepå’Œyield"></a>ğŸsleepå’Œyield</h2><h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h3><ol><li>è°ƒç”¨ sleep ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ <strong>Timed Waiting</strong> çŠ¶æ€ï¼ˆé˜»å¡ï¼‰</li><li>å…¶å®ƒçº¿ç¨‹å¯ä»¥ä½¿ç”¨ <strong>interrupt</strong> æ–¹æ³•æ‰“æ–­æ­£åœ¨ç¡çœ çš„çº¿ç¨‹ï¼Œè¿™æ—¶ sleep æ–¹æ³•ä¼šæŠ›å‡º InterruptedException</li><li>ç¡çœ ç»“æŸåçš„çº¿ç¨‹<strong>æœªå¿…ä¼šç«‹åˆ»</strong>å¾—åˆ°æ‰§è¡Œ</li></ol><h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><ol><li>è°ƒç”¨ yield ä¼šè®©å½“å‰çº¿ç¨‹ä» Running è¿›å…¥ <strong>Runnable å°±ç»ªçŠ¶æ€</strong>ï¼Œç„¶åè°ƒåº¦æ‰§è¡Œå…¶å®ƒçº¿ç¨‹</li><li>å…·ä½“çš„å®ç°ä¾èµ–äºæ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦å™¨</li></ol><h2 id="ğŸjoin"><a href="#ğŸjoin" class="headerlink" title="ğŸjoin"></a>ğŸjoin</h2><h3 id="åº”ç”¨åŒæ­¥"><a href="#åº”ç”¨åŒæ­¥" class="headerlink" title="åº”ç”¨åŒæ­¥"></a>åº”ç”¨åŒæ­¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    test1();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    log.debug(<span class="string">&quot;å¼€å§‹&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;å¼€å§‹&quot;</span>);</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        r = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    t1.start();</span><br><span class="line">    log.debug(<span class="string">&quot;ç»“æœä¸º:&#123;&#125;&quot;</span>, r);</span><br><span class="line">    log.debug(<span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å› ä¸ºä¸»çº¿ç¨‹å’Œçº¿ç¨‹ t1 æ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œt1 çº¿ç¨‹éœ€è¦ 1 ç§’ä¹‹åæ‰èƒ½ç®—å‡º r=10</span></span><br><span class="line"><span class="comment">// è€Œä¸»çº¿ç¨‹ä¸€å¼€å§‹å°±è¦æ‰“å° r çš„ç»“æœï¼Œæ‰€ä»¥åªèƒ½æ‰“å°å‡º r=0</span></span><br></pre></td></tr></table></figure><h4 id="1-æ–¹æ³•è°ƒç”¨è§’åº¦çœ‹åŒæ­¥ã€å¼‚æ­¥ï¼š"><a href="#1-æ–¹æ³•è°ƒç”¨è§’åº¦çœ‹åŒæ­¥ã€å¼‚æ­¥ï¼š" class="headerlink" title="1.æ–¹æ³•è°ƒç”¨è§’åº¦çœ‹åŒæ­¥ã€å¼‚æ­¥ï¼š"></a>1.æ–¹æ³•è°ƒç”¨è§’åº¦çœ‹åŒæ­¥ã€å¼‚æ­¥ï¼š</h4><ul><li>éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œæ‰èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯åŒæ­¥</li><li>ä¸éœ€è¦ç­‰å¾…ç»“æœè¿”å›ï¼Œå°±èƒ½ç»§ç»­è¿è¡Œå°±æ˜¯å¼‚æ­¥</li></ul><h4 id="2-è§£å†³æ–¹æ¡ˆï¼š"><a href="#2-è§£å†³æ–¹æ¡ˆï¼š" class="headerlink" title="2.è§£å†³æ–¹æ¡ˆï¼š"></a>2.è§£å†³æ–¹æ¡ˆï¼š</h4><p>t1.start()ä¹‹å+t1.join()</p><img src="/img/4124/join1.png" alt="image-20231010111653053" style="zoom: 50%;" /><h3 id="æ›´å¤šçº¿ç¨‹join"><a href="#æ›´å¤šçº¿ç¨‹join" class="headerlink" title="æ›´å¤šçº¿ç¨‹join"></a>æ›´å¤šçº¿ç¨‹join</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    test2();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">        r1 = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        r2 = <span class="number">20</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line">    t1.join();</span><br><span class="line">    t2.join();</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    log.debug(<span class="string">&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;</span>, r1, r2, end - start);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ª joinï¼šç­‰å¾… t1 æ—¶, t2 å¹¶æ²¡æœ‰åœæ­¢, è€Œåœ¨è¿è¡Œ</span></span><br><span class="line"><span class="comment">// ç¬¬äºŒä¸ª joinï¼š1s å, æ‰§è¡Œåˆ°æ­¤, t2 ä¹Ÿè¿è¡Œäº† 1s, å› æ­¤ä¹Ÿåªéœ€å†ç­‰å¾… 1s</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºï¼ˆé¢ å€’2ä¸ªjoinä¸€æ ·ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">45</span>:<span class="number">43.239</span> [main] c.TestJoin - r1: <span class="number">10</span> r2: <span class="number">20</span> cost: <span class="number">2005</span></span><br></pre></td></tr></table></figure><img src="/img/4124/join2.png" alt="image-20231010112317910" style="zoom: 50%;" /><h3 id="æœ‰æ—¶æ•ˆçš„-join"><a href="#æœ‰æ—¶æ•ˆçš„-join" class="headerlink" title="æœ‰æ—¶æ•ˆçš„ join"></a>æœ‰æ—¶æ•ˆçš„ join</h3><h4 id="1-ç­‰å¤Ÿæ—¶é—´ï¼šjoinä¼šæå‰ç»“æŸ"><a href="#1-ç­‰å¤Ÿæ—¶é—´ï¼šjoinä¼šæå‰ç»“æŸ" class="headerlink" title="1.ç­‰å¤Ÿæ—¶é—´ï¼šjoinä¼šæå‰ç»“æŸ"></a>1.ç­‰å¤Ÿæ—¶é—´ï¼šjoinä¼šæå‰ç»“æŸ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    test3();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        sleep(<span class="number">1</span>); <span class="comment">// ç¡1ç§’</span></span><br><span class="line">        r1 = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    t1.start();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ</span></span><br><span class="line">    t1.join(<span class="number">1500</span>);</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    log.debug(<span class="string">&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;</span>, r1, r2, end - start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">48</span>:<span class="number">01.320</span> [main] c.TestJoin - r1: <span class="number">10</span> r2: <span class="number">0</span> cost: <span class="number">1010</span></span><br></pre></td></tr></table></figure><h4 id="2-æœªç­‰å¤Ÿæ—¶é—´"><a href="#2-æœªç­‰å¤Ÿæ—¶é—´" class="headerlink" title="2.æœªç­‰å¤Ÿæ—¶é—´"></a>2.æœªç­‰å¤Ÿæ—¶é—´</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="variable">r2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    test3();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test3</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        sleep(<span class="number">2</span>); <span class="comment">// ç¡2ç§’</span></span><br><span class="line">        r1 = <span class="number">10</span>;</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    t1.start();</span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ‰§è¡Œç»“æŸä¼šå¯¼è‡´ join ç»“æŸ</span></span><br><span class="line">    t1.join(<span class="number">1500</span>);</span><br><span class="line">    <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">    log.debug(<span class="string">&quot;r1: &#123;&#125; r2: &#123;&#125; cost: &#123;&#125;&quot;</span>, r1, r2, end - start);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">52</span>:<span class="number">15.623</span> [main] c.TestJoin - r1: <span class="number">0</span> r2: <span class="number">0</span> cost: <span class="number">1502</span></span><br></pre></td></tr></table></figure><h2 id="ğŸinterrupt"><a href="#ğŸinterrupt" class="headerlink" title="ğŸinterrupt"></a>ğŸinterrupt</h2><h3 id="æ‰“æ–­-sleepï¼Œwaitï¼Œjoin-çš„çº¿ç¨‹"><a href="#æ‰“æ–­-sleepï¼Œwaitï¼Œjoin-çš„çº¿ç¨‹" class="headerlink" title="æ‰“æ–­ sleepï¼Œwaitï¼Œjoin çš„çº¿ç¨‹"></a>æ‰“æ–­ sleepï¼Œwaitï¼Œjoin çš„çº¿ç¨‹</h3><p>æ‰“æ–­é˜»å¡çš„çº¿ç¨‹ï¼Œä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">        sleep(<span class="number">1</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>);</span><br><span class="line">    t1.start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    t1.interrupt();</span><br><span class="line">    log.debug(<span class="string">&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;</span>, t1.isInterrupted());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">java.lang.InterruptedException: sleep interrupted</span><br><span class="line"> at java.lang.Thread.sleep(Native Method)</span><br><span class="line"> at java.lang.Thread.sleep(Thread.java:<span class="number">340</span>)</span><br><span class="line"> at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:<span class="number">386</span>)</span><br><span class="line"> at cn.itcast.n2.util.Sleeper.sleep(Sleeper.java:<span class="number">8</span>)</span><br><span class="line"> at cn.itcast.n4.TestInterrupt.lambda$test1$<span class="number">3</span>(TestInterrupt.java:<span class="number">59</span>)</span><br><span class="line"> at java.lang.Thread.run(Thread.java:<span class="number">745</span>)</span><br><span class="line"><span class="number">21</span>:<span class="number">18</span>:<span class="number">10.374</span> [main] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: <span class="literal">false</span></span><br></pre></td></tr></table></figure><h3 id="æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹"><a href="#æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹" class="headerlink" title="æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹"></a>æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹</h3><p>æ‰“æ–­æ­£å¸¸è¿è¡Œçš„çº¿ç¨‹, ä¸ä¼šæ¸…ç©ºæ‰“æ–­çŠ¶æ€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(()-&gt;&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">interrupted</span> <span class="operator">=</span> current.isInterrupted();</span><br><span class="line">            <span class="keyword">if</span>(interrupted) &#123;</span><br><span class="line">                log.debug(<span class="string">&quot; æ‰“æ–­çŠ¶æ€: &#123;&#125;&quot;</span>, interrupted);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>);</span><br><span class="line">    t2.start();</span><br><span class="line">    sleep(<span class="number">0.5</span>);</span><br><span class="line">    t2.interrupt();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">57</span>:<span class="number">37.964</span> [t2] c.TestInterrupt - æ‰“æ–­çŠ¶æ€: <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="ğŸsetDaemon"><a href="#ğŸsetDaemon" class="headerlink" title="ğŸsetDaemon"></a>ğŸsetDaemon</h2><h3 id="å®ˆæŠ¤çº¿ç¨‹"><a href="#å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å®ˆæŠ¤çº¿ç¨‹"></a>å®ˆæŠ¤çº¿ç¨‹</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒJava è¿›ç¨‹éœ€è¦ç­‰å¾…æ‰€æœ‰çº¿ç¨‹éƒ½è¿è¡Œç»“æŸï¼Œæ‰ä¼šç»“æŸã€‚</p><p>è€Œå®ˆæŠ¤çº¿ç¨‹ï¼Œåªè¦å…¶å®ƒéå®ˆæŠ¤çº¿ç¨‹è¿è¡Œç»“æŸäº†ï¼Œå³ä½¿å®ˆæŠ¤çº¿ç¨‹çš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œä¹Ÿä¼š<strong>å¼ºåˆ¶ç»“æŸ</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">log.debug(<span class="string">&quot;å¼€å§‹è¿è¡Œ...&quot;</span>);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;å¼€å§‹è¿è¡Œ...&quot;</span>);</span><br><span class="line">        sleep(<span class="number">2</span>);</span><br><span class="line">        log.debug(<span class="string">&quot;è¿è¡Œç»“æŸ...&quot;</span>);</span><br><span class="line">    &#125;, <span class="string">&quot;daemon&quot;</span>);</span><br><span class="line"><span class="comment">// è®¾ç½®è¯¥çº¿ç¨‹ä¸ºå®ˆæŠ¤çº¿ç¨‹</span></span><br><span class="line">t1.setDaemon(<span class="literal">true</span>);</span><br><span class="line">t1.start();</span><br><span class="line">    sleep(<span class="number">1</span>);</span><br><span class="line">log.debug(<span class="string">&quot;è¿è¡Œç»“æŸ...&quot;</span>);</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">08:<span class="number">26</span>:<span class="number">38.123</span> [main] c.TestDaemon - å¼€å§‹è¿è¡Œ... </span><br><span class="line">08:<span class="number">26</span>:<span class="number">38.213</span> [daemon] c.TestDaemon - å¼€å§‹è¿è¡Œ... </span><br><span class="line">08:<span class="number">26</span>:<span class="number">39.215</span> [main] c.TestDaemon - è¿è¡Œç»“æŸ... </span><br></pre></td></tr></table></figure><h3 id="å¸¸è§å®ˆæŠ¤çº¿ç¨‹"><a href="#å¸¸è§å®ˆæŠ¤çº¿ç¨‹" class="headerlink" title="å¸¸è§å®ˆæŠ¤çº¿ç¨‹"></a>å¸¸è§å®ˆæŠ¤çº¿ç¨‹</h3><p>åƒåœ¾å›æ”¶å™¨çº¿ç¨‹</p><p>Tomcat ä¸­çš„ Acceptor å’Œ Poller çº¿ç¨‹éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼Œæ‰€ä»¥ Tomcat æ¥æ”¶åˆ° shutdown å‘½ä»¤åï¼Œä¸ä¼šç­‰ å¾…å®ƒä»¬å¤„ç†å®Œå½“å‰è¯·æ±‚</p><h2 id="ğŸwait-x2F-notify-x2F-notifyAll"><a href="#ğŸwait-x2F-notify-x2F-notifyAll" class="headerlink" title="ğŸwait()&#x2F;notify()&#x2F;notifyAll()"></a>ğŸwait()&#x2F;notify()&#x2F;notifyAll()</h2><h3 id="Monitor-Javaå¯¹è±¡å¤´"><a href="#Monitor-Javaå¯¹è±¡å¤´" class="headerlink" title="Monitor-Javaå¯¹è±¡å¤´"></a>Monitor-Javaå¯¹è±¡å¤´</h3><p>32 ä½è™šæ‹Ÿæœº</p><img src="/img/4124/Moniter1.png" alt="image-20231010131540915" style="zoom: 67%;" /><p>å…¶ä¸­ Mark Word ç»“æ„ä¸º</p><img src="/img/4124/Moniter2.png" alt="image-20231010131648053" style="zoom:67%;" /><h3 id="APIä»‹ç»"><a href="#APIä»‹ç»" class="headerlink" title="APIä»‹ç»"></a>APIä»‹ç»</h3><h4 id="objçš„æ–¹æ³•"><a href="#objçš„æ–¹æ³•" class="headerlink" title="objçš„æ–¹æ³•"></a>objçš„æ–¹æ³•</h4><p>obj.wait()â€”â€”è®©è¿›å…¥ object ç›‘è§†å™¨çš„çº¿ç¨‹åˆ° waitSet ç­‰å¾… </p><p>obj.notify()â€”â€”åœ¨ object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹ä¸­æŒ‘ä¸€ä¸ªå”¤é†’ </p><p>obj.notifyAll()â€”â€”è®© object ä¸Šæ­£åœ¨ waitSet ç­‰å¾…çš„çº¿ç¨‹å…¨éƒ¨å”¤é†’</p><p><strong>å¿…é¡»è·å¾—æ­¤å¯¹è±¡çš„é”ï¼Œæ‰èƒ½è°ƒç”¨è¿™å‡ ä¸ªæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ‰§è¡Œ....&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                obj.wait(); <span class="comment">// è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;å…¶å®ƒä»£ç ....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ‰§è¡Œ....&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                obj.wait(); <span class="comment">// è®©çº¿ç¨‹åœ¨objä¸Šä¸€ç›´ç­‰å¾…ä¸‹å»</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            log.debug(<span class="string">&quot;å…¶å®ƒä»£ç ....&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;).start();</span><br><span class="line">    <span class="comment">// ä¸»çº¿ç¨‹ä¸¤ç§’åæ‰§è¡Œ</span></span><br><span class="line">    sleep(<span class="number">2</span>);</span><br><span class="line">    log.debug(<span class="string">&quot;å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹&quot;</span>);</span><br><span class="line">    <span class="keyword">synchronized</span> (obj) &#123;</span><br><span class="line">        obj.notify(); <span class="comment">// å”¤é†’objä¸Šä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line">        <span class="comment">// obj.notifyAll(); // å”¤é†’objä¸Šæ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>notify çš„ä¸€ç§ç»“æœ(éšæœºå”¤é†’)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">00</span>:<span class="number">53.096</span> [Thread-<span class="number">0</span>] c.TestWaitNotify - æ‰§è¡Œ.... </span><br><span class="line"><span class="number">20</span>:<span class="number">00</span>:<span class="number">53.099</span> [Thread-<span class="number">1</span>] c.TestWaitNotify - æ‰§è¡Œ.... </span><br><span class="line"><span class="number">20</span>:<span class="number">00</span>:<span class="number">55.096</span> [main] c.TestWaitNotify - å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹</span><br><span class="line"><span class="number">20</span>:<span class="number">00</span>:<span class="number">55.096</span> [Thread-<span class="number">0</span>] c.TestWaitNotify - å…¶å®ƒä»£ç .... </span><br></pre></td></tr></table></figure><p>notifyAll çš„ç»“æœ(å”¤é†’æ‰€æœ‰)</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">19</span>:<span class="number">58</span>:<span class="number">15.457</span> [Thread-<span class="number">0</span>] c.TestWaitNotify - æ‰§è¡Œ.... </span><br><span class="line"><span class="number">19</span>:<span class="number">58</span>:<span class="number">15.460</span> [Thread-<span class="number">1</span>] c.TestWaitNotify - æ‰§è¡Œ.... </span><br><span class="line"><span class="number">19</span>:<span class="number">58</span>:<span class="number">17.456</span> [main] c.TestWaitNotify - å”¤é†’ obj ä¸Šå…¶å®ƒçº¿ç¨‹</span><br><span class="line"><span class="number">19</span>:<span class="number">58</span>:<span class="number">17.456</span> [Thread-<span class="number">1</span>] c.TestWaitNotify - å…¶å®ƒä»£ç .... </span><br><span class="line"><span class="number">19</span>:<span class="number">58</span>:<span class="number">17.456</span> [Thread-<span class="number">0</span>] c.TestWaitNotify - å…¶å®ƒä»£ç ....</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>wait() â€”â€”ä¼šé‡Šæ”¾å¯¹è±¡çš„é”ï¼Œè¿›å…¥ WaitSet ç­‰å¾…åŒºï¼Œä»è€Œè®©<strong>å…¶ä»–çº¿ç¨‹æœ‰æœºä¼šè·å–å¯¹è±¡çš„é”</strong>ã€‚æ— é™åˆ¶ç­‰å¾…ï¼Œç›´åˆ° notify ä¸ºæ­¢ </p><p>wait(long n) â€”â€”æœ‰æ—¶é™çš„ç­‰å¾…, åˆ° n æ¯«ç§’åç»“æŸç­‰å¾…ï¼Œæˆ–æ˜¯è¢« notify</p><h3 id="wait-x2F-notify-çš„æ­£ç¡®ä½¿ç”¨"><a href="#wait-x2F-notify-çš„æ­£ç¡®ä½¿ç”¨" class="headerlink" title="wait&#x2F;notify çš„æ­£ç¡®ä½¿ç”¨"></a>wait&#x2F;notify çš„æ­£ç¡®ä½¿ç”¨</h3><h4 id="1-åŒºåˆ«sleepå’Œnotify"><a href="#1-åŒºåˆ«sleepå’Œnotify" class="headerlink" title="1.åŒºåˆ«sleepå’Œnotify"></a>1.åŒºåˆ«sleepå’Œnotify</h4><p>sleep æ˜¯ Thread æ–¹æ³•ï¼Œè€Œ wait æ˜¯ Object çš„æ–¹æ³• </p><p>sleep ä¸éœ€è¦å¼ºåˆ¶å’Œ synchronized é…åˆä½¿ç”¨ï¼Œä½† <strong>wait éœ€è¦å’Œ synchronized ä¸€èµ·ç”¨</strong> </p><p>sleep åœ¨ç¡çœ çš„åŒæ—¶<strong>ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”</strong>ï¼Œä½† wait åœ¨ç­‰å¾…çš„æ—¶å€™<strong>ä¼šé‡Šæ”¾å¯¹è±¡é”</strong></p><h4 id="2-ç¤ºä¾‹"><a href="#2-ç¤ºä¾‹" class="headerlink" title="2.ç¤ºä¾‹"></a>2.ç¤ºä¾‹</h4><img src="/img/4124/wait1.png" alt="image-20231010143349416" style="zoom: 67%;" /><p><strong>æ­¥éª¤1</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">room</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">hasCigarette</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="type">boolean</span> <span class="variable">hasTakeout</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (!hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">            sleep(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;å°å—&quot;</span>).start();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;å…¶å®ƒäºº&quot;</span>).start();</span><br><span class="line">&#125;</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="comment">// è¿™é‡Œèƒ½ä¸èƒ½åŠ  synchronized (room)ï¼Ÿ</span></span><br><span class="line">    hasCigarette = <span class="literal">true</span>;</span><br><span class="line">    log.debug(<span class="string">&quot;çƒŸåˆ°äº†å™¢ï¼&quot;</span>);</span><br><span class="line">&#125;, <span class="string">&quot;é€çƒŸçš„&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">49.883</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">49.887</span> [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">50.882</span> [é€çƒŸçš„] c.TestCorrectPosture - çƒŸåˆ°äº†å™¢ï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.887</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">true</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.887</span> [å°å—] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.887</span> [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.887</span> [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.888</span> [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.888</span> [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">49</span>:<span class="number">51.888</span> [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br></pre></td></tr></table></figure><p>åˆ†æ</p><ul><li>å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹ï¼Œéƒ½è¦ä¸€ç›´é˜»å¡ï¼Œæ•ˆç‡å¤ªä½</li><li>å°å—çº¿ç¨‹å¿…é¡»ç¡è¶³ 2s åæ‰èƒ½é†’æ¥ï¼Œå°±ç®—çƒŸæå‰é€åˆ°ï¼Œä¹Ÿæ— æ³•ç«‹åˆ»é†’æ¥</li><li>åŠ äº† synchronized (room) åï¼Œå°±å¥½æ¯”å°å—åœ¨é‡Œé¢åé”äº†é—¨ç¡è§‰ï¼ŒçƒŸæ ¹æœ¬æ²¡æ³•é€è¿›é—¨ï¼Œmain æ²¡åŠ <br>synchronized å°±å¥½åƒ main çº¿ç¨‹æ˜¯ç¿»çª—æˆ·è¿›æ¥çš„</li></ul><p><strong>æ­¥éª¤2-[ä½¿ç”¨wait&#x2F;notify]</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (!hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                room.wait(<span class="number">2000</span>); <span class="comment">// ä½¿ç”¨waitç­‰å¾…</span></span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;å°å—&quot;</span>).start();</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="string">&quot;å…¶å®ƒäºº&quot;</span>).start();</span><br><span class="line">&#125;</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        hasCigarette = <span class="literal">true</span>;</span><br><span class="line">        log.debug(<span class="string">&quot;çƒŸåˆ°äº†å™¢ï¼&quot;</span>);</span><br><span class="line">        room.notify(); <span class="comment">// ä½¿ç”¨notifyå”¤é†’</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;é€çƒŸçš„&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">20:51:42.489 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[false] </span><br><span class="line">20:51:42.493 [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line">20:51:42.493 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line">20:51:42.493 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line">20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line">20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line">20:51:42.494 [å…¶å®ƒäºº] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line">20:51:43.490 [é€çƒŸçš„] c.TestCorrectPosture - çƒŸåˆ°äº†å™¢ï¼</span><br><span class="line">20:51:43.490 [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[true] </span><br><span class="line">20:51:43.490 [å°å—] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br></pre></td></tr></table></figure><p>åˆ†æ</p><p>è§£å†³äº†å…¶å®ƒå¹²æ´»çš„çº¿ç¨‹é˜»å¡çš„é—®é¢˜</p><p><strong>æ­¥éª¤3-[å¤šçº¿ç¨‹ç­‰å¾…]</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (!hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                room.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;æœ‰çƒŸæ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasCigarette);</span><br><span class="line">        <span class="keyword">if</span> (hasCigarette) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡å¹²æˆæ´»...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;å°å—&quot;</span>).start();</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">        log.debug(<span class="string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasTakeout);</span><br><span class="line">        <span class="keyword">if</span> (!hasTakeout) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                room.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        log.debug(<span class="string">&quot;å¤–å–é€åˆ°æ²¡ï¼Ÿ[&#123;&#125;]&quot;</span>, hasTakeout);</span><br><span class="line">        <span class="keyword">if</span> (hasTakeout) &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;å¯ä»¥å¼€å§‹å¹²æ´»äº†&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;æ²¡å¹²æˆæ´»...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;å°å¥³&quot;</span>).start();</span><br><span class="line">sleep(<span class="number">1</span>);</span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        hasTakeout = <span class="literal">true</span>;</span><br><span class="line">        log.debug(<span class="string">&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;</span>);</span><br><span class="line">        room.notify();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;é€å¤–å–çš„&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">12.173</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">12.176</span> [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">12.176</span> [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">12.176</span> [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">13.174</span> [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">13.174</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">53</span>:<span class="number">13.174</span> [å°å—] c.TestCorrectPosture - æ²¡å¹²æˆæ´»...</span><br></pre></td></tr></table></figure><p>åˆ†æ</p><p>notify åªèƒ½éšæœºå”¤é†’ä¸€ä¸ª WaitSet ä¸­çš„çº¿ç¨‹ï¼Œè¿™æ—¶å¦‚æœæœ‰å…¶å®ƒçº¿ç¨‹ä¹Ÿåœ¨ç­‰å¾…ï¼Œé‚£ä¹ˆå°±å¯èƒ½å”¤é†’ä¸äº†æ­£ç¡®çš„çº¿<br>ç¨‹ï¼Œç§°ä¹‹ä¸º<strong>è™šå‡å”¤é†’</strong></p><p><strong>æ­¥éª¤4-[ä½¿ç”¨notifyAll]</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (room) &#123;</span><br><span class="line">        hasTakeout = <span class="literal">true</span>;</span><br><span class="line">        log.debug(<span class="string">&quot;å¤–å–åˆ°äº†å™¢ï¼&quot;</span>);</span><br><span class="line">        room.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;, <span class="string">&quot;é€å¤–å–çš„&quot;</span>).start();</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">23.978</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">23.982</span> [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">23.982</span> [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">23.982</span> [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">24.979</span> [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">24.979</span> [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[<span class="literal">true</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">24.980</span> [å°å¥³] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">24.980</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">55</span>:<span class="number">24.980</span> [å°å—] c.TestCorrectPosture - æ²¡å¹²æˆæ´»... </span><br></pre></td></tr></table></figure><p>åˆ†æ</p><p>ç”¨ notifyAll ä»…è§£å†³æŸä¸ªçº¿ç¨‹çš„å”¤é†’é—®é¢˜ï¼Œä½†ä½¿ç”¨ if + wait åˆ¤æ–­ä»…æœ‰ä¸€æ¬¡æœºä¼šï¼Œä¸€æ—¦æ¡ä»¶ä¸æˆç«‹ï¼Œå°±<strong>æ²¡æœ‰é‡æ–°åˆ¤æ–­çš„æœºä¼š</strong>äº†</p><p><strong>æ­¥éª¤5-[ä½¿ç”¨while]</strong></p><p>å°† if æ”¹ä¸º while</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (!hasCigarette) &#123;</span><br><span class="line"> log.debug(<span class="string">&quot;æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼&quot;</span>);</span><br><span class="line"> <span class="keyword">try</span> &#123;</span><br><span class="line"> room.wait();</span><br><span class="line"> &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line"> e.printStackTrace();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">34.322</span> [å°å—] c.TestCorrectPosture - æœ‰çƒŸæ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">34.326</span> [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">34.326</span> [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[<span class="literal">false</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">34.326</span> [å°å¥³] c.TestCorrectPosture - æ²¡å¤–å–ï¼Œå…ˆæ­‡ä¼šï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">35.323</span> [é€å¤–å–çš„] c.TestCorrectPosture - å¤–å–åˆ°äº†å™¢ï¼</span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">35.324</span> [å°å¥³] c.TestCorrectPosture - å¤–å–é€åˆ°æ²¡ï¼Ÿ[<span class="literal">true</span>] </span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">35.324</span> [å°å¥³] c.TestCorrectPosture - å¯ä»¥å¼€å§‹å¹²æ´»äº†</span><br><span class="line"><span class="number">20</span>:<span class="number">58</span>:<span class="number">35.324</span> [å°å—] c.TestCorrectPosture - æ²¡çƒŸï¼Œå…ˆæ­‡ä¼šï¼</span><br></pre></td></tr></table></figure><p><strong>æ¨¡æ¿æ€»ç»“</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line"> <span class="keyword">while</span>(æ¡ä»¶ä¸æˆç«‹) &#123;</span><br><span class="line"> lock.wait();</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="comment">// å¹²æ´»</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å¦ä¸€ä¸ªçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line"> lock.notifyAll();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisäº‹åŠ¡å’Œé”</title>
      <link href="/posts/61575/"/>
      <url>/posts/61575/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>Redisäº‹åŠ¡æ˜¯ä¸€ä¸ªå•ç‹¬çš„éš”ç¦»æ“ä½œï¼šäº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­</p><p>Redisäº‹åŠ¡å°±æ˜¯<strong>ä¸€æ¬¡æ€§ã€é¡ºåºæ€§ã€æ’ä»–æ€§</strong>çš„æ‰§è¡Œä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„ä¸€ç³»åˆ—å‘½ä»¤</p><h2 id="ğŸä½¿ç”¨"><a href="#ğŸä½¿ç”¨" class="headerlink" title="ğŸä½¿ç”¨"></a>ğŸä½¿ç”¨</h2><h3 id="ç›¸å…³å‘½ä»¤"><a href="#ç›¸å…³å‘½ä»¤" class="headerlink" title="ç›¸å…³å‘½ä»¤"></a>ç›¸å…³å‘½ä»¤</h3><blockquote><p>MULTI ï¼šå¼€å¯äº‹åŠ¡ï¼Œredisä¼šå°†åç»­çš„å‘½ä»¤é€ä¸ªæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œç„¶åä½¿ç”¨EXECå‘½ä»¤æ¥åŸå­åŒ–æ‰§è¡Œè¿™ä¸ªå‘½ä»¤ç³»åˆ—ã€‚</p><p>EXECï¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„æ‰€æœ‰æ“ä½œå‘½ä»¤ã€‚</p><p>DISCARDï¼šå–æ¶ˆäº‹åŠ¡ï¼Œæ”¾å¼ƒæ‰§è¡Œäº‹åŠ¡å—ä¸­çš„æ‰€æœ‰å‘½ä»¤ã€‚</p><p>WATCHï¼šç›‘è§†ä¸€ä¸ªæˆ–å¤šä¸ªkey,å¦‚æœäº‹åŠ¡åœ¨æ‰§è¡Œå‰ï¼Œè¿™ä¸ªkey(æˆ–å¤šä¸ªkey)è¢«å…¶ä»–å‘½ä»¤ä¿®æ”¹ï¼Œåˆ™äº‹åŠ¡è¢«ä¸­æ–­ï¼Œä¸ä¼šæ‰§è¡Œäº‹åŠ¡ä¸­çš„ä»»ä½•å‘½ä»¤ã€‚</p><p>UNWATCHï¼šå–æ¶ˆWATCHå¯¹æ‰€æœ‰keyçš„ç›‘è§†ã€‚</p></blockquote><h3 id="æ‰§è¡Œæ­¥éª¤"><a href="#æ‰§è¡Œæ­¥éª¤" class="headerlink" title="æ‰§è¡Œæ­¥éª¤"></a>æ‰§è¡Œæ­¥éª¤</h3><p>ä»è¾“å…¥Multiå‘½ä»¤å¼€å§‹ï¼Œè¾“å…¥çš„å‘½ä»¤éƒ½ä¼šä¾æ¬¡è¿›å…¥å‘½ä»¤é˜Ÿåˆ—ä¸­ï¼Œä½†ä¸ä¼šæ‰§è¡Œã€‚</p><p>ç›´åˆ°è¾“å…¥Execåï¼ŒRedisä¼šå°†ä¹‹å‰çš„å‘½ä»¤é˜Ÿåˆ—ä¸­çš„å‘½ä»¤ä¾æ¬¡æ‰§è¡Œã€‚</p><p>ç»„é˜Ÿçš„è¿‡ç¨‹ä¸­å¯ä»¥é€šè¿‡Discardæ¥æ”¾å¼ƒç»„é˜Ÿã€‚</p><img src="/img/61575/redis1.png" alt="image-20231005110525637" style="zoom:80%;" /><h4 id="æ ‡å‡†æ‰§è¡Œç¤ºä¾‹"><a href="#æ ‡å‡†æ‰§è¡Œç¤ºä¾‹" class="headerlink" title="æ ‡å‡†æ‰§è¡Œç¤ºä¾‹"></a>æ ‡å‡†æ‰§è¡Œç¤ºä¾‹</h4><p>ç»™k1ã€k2åˆ†åˆ«èµ‹å€¼ï¼Œåœ¨äº‹åŠ¡ä¸­ä¿®æ”¹k1ã€k2ï¼Œæ‰§è¡Œäº‹åŠ¡åï¼ŒæŸ¥çœ‹k1ã€k2å€¼éƒ½è¢«ä¿®æ”¹</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;22&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h4 id="äº‹åŠ¡å–æ¶ˆç¤ºä¾‹"><a href="#äº‹åŠ¡å–æ¶ˆç¤ºä¾‹" class="headerlink" title="äº‹åŠ¡å–æ¶ˆç¤ºä¾‹"></a>äº‹åŠ¡å–æ¶ˆç¤ºä¾‹</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 33</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 34</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD</span><br><span class="line">OK</span><br></pre></td></tr></table></figure><h4 id="äº‹åŠ¡é”™è¯¯ç¤ºä¾‹"><a href="#äº‹åŠ¡é”™è¯¯ç¤ºä¾‹" class="headerlink" title="äº‹åŠ¡é”™è¯¯ç¤ºä¾‹"></a>äº‹åŠ¡é”™è¯¯ç¤ºä¾‹</h4><p><strong>1.ç¼–è¯‘å™¨é”™è¯¯</strong>ï¼šç»„é˜Ÿä¸­æŸä¸ªå‘½ä»¤å‡ºç°äº†æŠ¥å‘Šé”™è¯¯ï¼Œæ‰§è¡Œæ—¶<strong>æ•´ä¸ªçš„é˜Ÿåˆ—å‘½ä»¤éƒ½ä¼šè¢«å–æ¶ˆ</strong></p><img src="/img/61575/redis2.png" alt="image-20231005111315260" style="zoom:80%;" /><p>åœ¨å¼€å¯äº‹åŠ¡åï¼Œä¿®æ”¹k1å€¼ä¸º11ï¼Œk2å€¼ä¸º22ï¼Œä½†k2è¯­æ³•é”™è¯¯ï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œk1ã€k2ä¿ç•™åŸå€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; sets k2 22</span><br><span class="line">(error) ERR unknown <span class="built_in">command</span> `sets`, with args beginning with: `k2`, `22`, </span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">(error) EXECABORT Transaction discarded because of previous errors.</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;v1&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><p><strong>2.è¿è¡Œæ—¶é”™è¯¯</strong>ï¼šæ‰§è¡Œé˜¶æ®µæŸä¸ªå‘½ä»¤æŠ¥å‡ºäº†é”™è¯¯ï¼Œåˆ™<strong>åªæœ‰æŠ¥é”™çš„å‘½ä»¤ä¸ä¼šè¢«æ‰§è¡Œï¼Œè€Œå…¶ä»–çš„å‘½ä»¤éƒ½ä¼šæ‰§è¡Œ</strong>ï¼Œä¸ä¼šå›æ»š</p><img src="/img/61575/redis3.png" alt="image-20231005111523706" style="zoom:80%;" /><p>åœ¨å¼€å¯äº‹åŠ¡åï¼Œä¿®æ”¹k1å€¼ä¸º11ï¼Œk2å€¼ä¸º22ï¼Œä½†å°†k2çš„ç±»å‹ä½œä¸ºListï¼Œåœ¨è¿è¡Œæ—¶æ£€æµ‹ç±»å‹é”™è¯¯ï¼Œæœ€ç»ˆå¯¼è‡´äº‹åŠ¡æäº¤å¤±è´¥ï¼Œæ­¤æ—¶äº‹åŠ¡å¹¶æ²¡æœ‰å›æ»šï¼Œè€Œæ˜¯è·³è¿‡é”™è¯¯å‘½ä»¤ç»§ç»­æ‰§è¡Œï¼Œ ç»“æœk1å€¼æ”¹å˜ã€k2ä¿ç•™åŸå€¼</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 11</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; lpush k2 22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">1) OK</span><br><span class="line">2) (error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h3 id="CASæ“ä½œå®ç°ä¹è§‚é”"><a href="#CASæ“ä½œå®ç°ä¹è§‚é”" class="headerlink" title="CASæ“ä½œå®ç°ä¹è§‚é”"></a>CASæ“ä½œå®ç°ä¹è§‚é”</h3><h4 id="æ‚²è§‚é”å’Œä¹è§‚é”"><a href="#æ‚²è§‚é”å’Œä¹è§‚é”" class="headerlink" title="æ‚²è§‚é”å’Œä¹è§‚é”"></a>æ‚²è§‚é”å’Œä¹è§‚é”</h4><p><strong>æ‚²è§‚é”(Pessimistic Lock)<strong>ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šblockç›´åˆ°å®ƒæ‹¿åˆ°é”ã€‚</strong>ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶</strong>ï¼Œæ¯”å¦‚<strong>è¡Œé”</strong>ï¼Œ<strong>è¡¨é”</strong>ç­‰ï¼Œ<strong>è¯»é”</strong>ï¼Œ<strong>å†™é”</strong>ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚</p><p><strong>ä¹è§‚é”(Optimistic Lock)<strong>ï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·ç­‰æœºåˆ¶ã€‚</strong>ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡</strong>ã€‚<strong>Rediså°±æ˜¯åˆ©ç”¨è¿™ç§check-and-setæœºåˆ¶ï¼ˆCASï¼‰å®ç°äº‹åŠ¡çš„ã€‚</strong></p><h4 id="WATCHç›‘è§†key"><a href="#WATCHç›‘è§†key" class="headerlink" title="WATCHç›‘è§†key"></a>WATCHç›‘è§†key</h4><p>åœ¨æ‰§è¡Œmultiä¹‹å‰ï¼Œå…ˆæ‰§è¡Œwatch key1 [key2],å¯ä»¥ç›‘è§†ä¸€ä¸ª(æˆ–å¤šä¸ª) key ï¼Œå¦‚æœåœ¨äº‹åŠ¡<strong>æ‰§è¡Œä¹‹å‰è¿™ä¸ª(æˆ–è¿™äº›) key è¢«å…¶ä»–å‘½ä»¤æ‰€æ”¹åŠ¨ï¼Œé‚£ä¹ˆäº‹åŠ¡å°†è¢«æ‰“æ–­</strong></p><hr><p><strong>åŸç†</strong></p><p>åŸå­æ€§åœ°ä¸ºæŸä¸ªå€¼è¿›è¡Œå¢ 1 æ“ä½œ</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">val = GET mykey</span><br><span class="line">val = val + 1</span><br><span class="line">SET mykey <span class="variable">$val</span></span><br></pre></td></tr></table></figure><p>å½“å¤šä¸ªå®¢æˆ·ç«¯åŒæ—¶å¯¹åŒä¸€ä¸ªé”®è¿›è¡Œè¿™æ ·çš„æ“ä½œæ—¶ï¼Œ å°±ä¼šäº§ç”Ÿç«äº‰æ¡ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ å¦‚æœå®¢æˆ·ç«¯ A å’Œ B éƒ½è¯»å–äº†é”®åŸæ¥çš„å€¼ï¼Œ æ¯”å¦‚ 10 ï¼Œ é‚£ä¹ˆä¸¤ä¸ªå®¢æˆ·ç«¯éƒ½ä¼šå°†é”®çš„å€¼è®¾ä¸º 11 ï¼Œ ç»“æœé”™è¯¯</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">WATCH mykey</span><br><span class="line">val = GET mykey</span><br><span class="line">val = val + 1</span><br><span class="line">MULTI</span><br><span class="line">SET mykey <span class="variable">$val</span></span><br><span class="line">EXEC</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼Œå¦‚æœåœ¨ WATCH æ‰§è¡Œä¹‹åï¼Œ EXEC æ‰§è¡Œä¹‹å‰ï¼Œ æœ‰å…¶ä»–å®¢æˆ·ç«¯ä¿®æ”¹äº† mykey çš„å€¼ï¼Œ é‚£ä¹ˆå½“å‰å®¢æˆ·ç«¯çš„äº‹åŠ¡å°±ä¼šå¤±è´¥ã€‚ ç¨‹åºä¸æ–­é‡è¯•è¿™ä¸ªæ“ä½œï¼Œ ç›´åˆ°æ²¡æœ‰å‘ç”Ÿç¢°æ’ä¸ºæ­¢</p><hr><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; WATCH k1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 11</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 12</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC</span><br><span class="line">(nil)</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;11&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;v2&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h4 id="UNWATCHå–æ¶ˆç›‘è§†key"><a href="#UNWATCHå–æ¶ˆç›‘è§†key" class="headerlink" title="UNWATCHå–æ¶ˆç›‘è§†key"></a>UNWATCHå–æ¶ˆç›‘è§†key</h4><p>å–æ¶ˆ WATCH å‘½ä»¤å¯¹æ‰€æœ‰ key çš„ç›‘è§†</p><p>å¦‚æœåœ¨æ‰§è¡Œ WATCH å‘½ä»¤ä¹‹åï¼ŒEXEC å‘½ä»¤æˆ–DISCARD å‘½ä»¤å…ˆè¢«æ‰§è¡Œäº†çš„è¯ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦å†æ‰§è¡ŒUNWATCH äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 v1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 v2</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; WATCH k1</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 11</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; UNWATCH</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k1 12</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">set</span> k2 22</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; <span class="built_in">exec</span></span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line"><span class="string">&quot;12&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; get k2</span><br><span class="line"><span class="string">&quot;22&quot;</span></span><br><span class="line">127.0.0.1:6379&gt;</span><br></pre></td></tr></table></figure><h2 id="ğŸäº‹åŠ¡æ€§è´¨"><a href="#ğŸäº‹åŠ¡æ€§è´¨" class="headerlink" title="ğŸäº‹åŠ¡æ€§è´¨"></a>ğŸäº‹åŠ¡æ€§è´¨</h2><ul><li>å•ç‹¬çš„éš”ç¦»æ“ä½œ</li></ul><p>â€‹äº‹åŠ¡ä¸­çš„æ‰€æœ‰å‘½ä»¤éƒ½ä¼šåºåˆ—åŒ–ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œã€‚äº‹åŠ¡åœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸ä¼šè¢«å…¶ä»–å®¢æˆ·ç«¯å‘é€æ¥çš„å‘½ä»¤è¯·æ±‚æ‰€æ‰“æ–­ã€‚ </p><ul><li>æ²¡æœ‰éš”ç¦»çº§åˆ«çš„æ¦‚å¿µ</li></ul><p>â€‹é˜Ÿåˆ—ä¸­çš„å‘½ä»¤æ²¡æœ‰æäº¤ä¹‹å‰éƒ½ä¸ä¼šå®é™…è¢«æ‰§è¡Œï¼Œå› ä¸ºäº‹åŠ¡æäº¤å‰ä»»ä½•æŒ‡ä»¤éƒ½ä¸ä¼šè¢«å®é™…æ‰§è¡Œ</p><ul><li>ä¸ä¿è¯åŸå­æ€§</li></ul><p>â€‹äº‹åŠ¡ä¸­å¦‚æœæœ‰ä¸€æ¡å‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå…¶åçš„å‘½ä»¤ä»ç„¶ä¼šè¢«æ‰§è¡Œï¼Œæ²¡æœ‰å›æ»š </p><h2 id="ğŸäº‹åŠ¡å…¶ä»–å®ç°"><a href="#ğŸäº‹åŠ¡å…¶ä»–å®ç°" class="headerlink" title="ğŸäº‹åŠ¡å…¶ä»–å®ç°"></a>ğŸäº‹åŠ¡å…¶ä»–å®ç°</h2><p>åŸºäº<strong>Lua</strong>è„šæœ¬ï¼ŒRediså¯ä»¥ä¿è¯è„šæœ¬å†…çš„å‘½ä»¤ä¸€æ¬¡æ€§ã€æŒ‰é¡ºåºåœ°æ‰§è¡Œï¼Œå…¶åŒæ—¶ä¹Ÿä¸æä¾›äº‹åŠ¡è¿è¡Œé”™è¯¯çš„å›æ»šï¼Œæ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœéƒ¨åˆ†å‘½ä»¤è¿è¡Œé”™è¯¯ï¼Œå‰©ä¸‹çš„å‘½ä»¤è¿˜æ˜¯ä¼šç»§ç»­è¿è¡Œå®Œ</p><p>åŸºäºä¸­é—´æ ‡è®°å˜é‡ï¼Œé€šè¿‡å¦å¤–çš„æ ‡è®°å˜é‡æ¥æ ‡è¯†äº‹åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆï¼Œè¯»å–æ•°æ®æ—¶å…ˆè¯»å–è¯¥æ ‡è®°å˜é‡åˆ¤æ–­æ˜¯å¦äº‹åŠ¡æ‰§è¡Œå®Œæˆã€‚ä½†è¿™æ ·ä¼šéœ€è¦é¢å¤–å†™ä»£ç å®ç°ï¼Œæ¯”è¾ƒç¹ç</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç¼€å’Œ</title>
      <link href="/posts/26737/"/>
      <url>/posts/26737/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><h3 id="å‰ç¼€å’Œ"><a href="#å‰ç¼€å’Œ" class="headerlink" title="å‰ç¼€å’Œ"></a>å‰ç¼€å’Œ</h3><p>æ±‚æ•°åˆ—çš„å’Œæ—¶ï¼ŒSn &#x3D; a1+a2+a3+â€¦an; æ­¤æ—¶Snå°±æ˜¯æ•°åˆ—çš„å‰ n é¡¹å’Œã€‚ä¾‹ S5 &#x3D; a1 + a2 + a3 + a4 + a5; S2 &#x3D; a1 + a2ã€‚å¯ä»¥é€šè¿‡ S5-S2 å¾—åˆ° a3+a4+a5 çš„å€¼ï¼Œå‰ç¼€å’Œæ•°ç»„é‡Œä¿å­˜çš„å°±æ˜¯å‰ n é¡¹çš„å’Œ</p><img src="/img/26737/å‰ç¼€å’Œ1.png" alt="å‰ç¼€å’Œ" style="zoom:80%;" /><h3 id="ä»£ç æ¡†æ¶"><a href="#ä»£ç æ¡†æ¶" class="headerlink" title="ä»£ç æ¡†æ¶"></a>ä»£ç æ¡†æ¶</h3><p><strong>å‰ç¼€å’Œ + HashMap[ä¸¤æ•°ä¹‹å’Œ]</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line"></span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map  = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//ä¸€æ¬¡éå†</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; ++i) &#123;</span><br><span class="line">            <span class="comment">//å­˜åœ¨æ—¶ï¼Œæˆ‘ä»¬ç”¨æ•°ç»„å¾—å€¼ä¸º keyï¼Œç´¢å¼•ä¸º value</span></span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(target - nums[i]))&#123;              </span><br><span class="line">               <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,map.get(target-nums[i])&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//å­˜å…¥å€¼</span></span><br><span class="line">            map.put(nums[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è¿”å›</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;&#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><h4 id="å’Œä¸ºKçš„å­æ•°ç»„"><a href="#å’Œä¸ºKçš„å­æ•°ç»„" class="headerlink" title="å’Œä¸ºKçš„å­æ•°ç»„"></a>å’Œä¸ºKçš„å­æ•°ç»„</h4><p>é“¾æ¥ï¼š<a href="https://leetcode.cn/problems/subarray-sum-equals-k/description/">560. å’Œä¸º K çš„å­æ•°ç»„ - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h4 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>å°†æ‰€æœ‰çš„å‰ç¼€å’Œè¯¥å‰ç¼€å’Œå‡ºç°çš„æ¬¡æ•°å­˜åˆ°mapé‡Œï¼Œå¯ä»¥é€šè¿‡ presum - kçš„ä¸ªæ•°è·å¾— k çš„ä¸ªæ•°</p><h4 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">subarraySum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// &lt;å‰ç¼€ï¼Œæ¬¡æ•°&gt;</span></span><br><span class="line">        HashMap&lt;Integer,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">//ç»†èŠ‚ï¼Œè¿™é‡Œéœ€è¦é¢„å­˜å‰ç¼€å’Œä¸º 0 çš„æƒ…å†µï¼Œä¼šæ¼æ‰å‰å‡ ä½å°±æ»¡è¶³çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">//ä¾‹å¦‚è¾“å…¥[1,1,0]ï¼Œk = 2 å¦‚æœæ²¡æœ‰è¿™è¡Œä»£ç ï¼Œåˆ™ä¼šè¿”å›0,æ¼æ‰äº†1+1=2ï¼Œå’Œ1+1+0=2çš„æƒ…å†µ</span></span><br><span class="line">        <span class="comment">//è¾“å…¥ï¼š[3,1,1,0] k = 2æ—¶åˆ™ä¸ä¼šæ¼æ‰</span></span><br><span class="line">        <span class="comment">//å› ä¸ºpresum[3] - presum[0]è¡¨ç¤ºå‰é¢ 3 ä½çš„å’Œï¼Œæ‰€ä»¥éœ€è¦map.put(0,1),å«ä¸‹åº•</span></span><br><span class="line">        map.put(<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">presum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x : nums) &#123;</span><br><span class="line">            presum += x;</span><br><span class="line">            <span class="comment">//å½“å‰å‰ç¼€å’Œå·²çŸ¥ï¼Œåˆ¤æ–­æ˜¯å¦å«æœ‰ presum - kçš„å‰ç¼€å’Œï¼Œé‚£ä¹ˆå°±çŸ¥é“æŸä¸€åŒºé—´çš„å’Œä¸º k äº†ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(presum - k)) &#123;</span><br><span class="line">                count += map.get(presum - k);<span class="comment">//è·å–æ¬¡æ•°</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æ›´æ–°</span></span><br><span class="line">            map.put(presum,map.getOrDefault(presum,<span class="number">0</span>) + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://leetcode.cn/circle/discuss/EQWhUd/">åˆ†äº«ï½œå¾—äº†ï¼Œå‰ç¼€å’Œè¢«æˆ‘ä¸€ä¸‹ç»™æ‰’å…‰äº† - åŠ›æ‰£ï¼ˆLeetCodeï¼‰</a></p><h2 id="ğŸE1ï¼šå¹³å‡æ•°ä¸ºkçš„æœ€é•¿è¿ç»­å­æ•°ç»„"><a href="#ğŸE1ï¼šå¹³å‡æ•°ä¸ºkçš„æœ€é•¿è¿ç»­å­æ•°ç»„" class="headerlink" title="ğŸE1ï¼šå¹³å‡æ•°ä¸ºkçš„æœ€é•¿è¿ç»­å­æ•°ç»„"></a>ğŸE1ï¼šå¹³å‡æ•°ä¸ºkçš„æœ€é•¿è¿ç»­å­æ•°ç»„</h2><blockquote><p>2023å¹´ç¾å›¢ç§‹æ‹›ç¬”è¯•</p></blockquote><h4 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h4><p>ç»™å®š<em>n</em>ä¸ªæ­£æ•´æ•°ç»„æˆçš„æ•°ç»„ï¼Œæ±‚å¹³å‡æ•°æ­£å¥½ç­‰äº <em>k</em> çš„æœ€é•¿è¿ç»­å­æ•°ç»„çš„é•¿åº¦</p><h5 id="è¾“å…¥æè¿°"><a href="#è¾“å…¥æè¿°" class="headerlink" title="è¾“å…¥æè¿°:"></a><strong>è¾“å…¥æè¿°:</strong></h5><blockquote><p>ç¬¬ä¸€è¡Œè¾“å…¥ä¸¤ä¸ªæ­£æ•´æ•°nå’Œkï¼Œç”¨ç©ºæ ¼éš”å¼€ã€‚<br>ç¬¬äºŒè¡Œè¾“å…¥nä¸ªæ­£æ•´æ•°aiï¼Œç”¨æ¥è¡¨ç¤ºæ•°ç»„ã€‚<br>1â‰¤nâ‰¤200000<br>1â‰¤k,aiâ‰¤10^9</p></blockquote><h5 id="è¾“å‡ºæè¿°"><a href="#è¾“å‡ºæè¿°" class="headerlink" title="è¾“å‡ºæè¿°:"></a><strong>è¾“å‡ºæè¿°:</strong></h5><blockquote><p>å¦‚æœä¸å­˜åœ¨ä»»ä½•ä¸€ä¸ªè¿ç»­å­æ•°ç»„çš„å¹³å‡æ•°ç­‰äºkï¼Œåˆ™è¾“å‡º-1ã€‚<br>å¦åˆ™è¾“å‡ºå¹³å‡æ•°æ­£å¥½ç­‰äº k çš„æœ€é•¿è¿ç»­å­æ•°ç»„çš„é•¿åº¦ã€‚</p></blockquote><p><strong>ç¤ºä¾‹1</strong></p><p><strong>è¾“å…¥</strong></p><blockquote><p>5 2<br>1 3 2 4 1</p></blockquote><p><strong>è¾“å‡º</strong></p><blockquote><p>3</p></blockquote><p><strong>è¯´æ˜</strong></p><blockquote><p>å–å‰ä¸‰ä¸ªæ•°å³å¯ï¼Œå¹³å‡æ•°ä¸º2ã€‚</p></blockquote><h4 id="æ€è·¯-1"><a href="#æ€è·¯-1" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h4><p>1.æ—¢ç„¶è¦æ±‚å¹³å‡æ•°ä¸ºk,åªéœ€æŠŠæ‰€æœ‰å…ƒç´ <strong>å‡å»k</strong>,è‹¥ä¸€äº›å…ƒç´ å’Œä¸º0å³è¯´æ˜è¿™äº›å…ƒç´ å¹³å‡æ•°ä¸ºk<br>2.ä½¿ç”¨map&lt;sum,i&gt;è¡¨ç¤º<strong>å‰iä¸ªä½ç½®çš„å’Œ</strong><br>3.éå†å…ƒç´ è¿›è¡Œæ±‚å’Œï¼š<br>    å½“å‡ºç°ä¸å­˜åœ¨çš„sumæ—¶è¿›è¡Œè®°å½•<br>    å½“å‡ºç°å·²å­˜åœ¨çš„sumæ—¶,å‡è®¾æ­¤æ—¶ä¸‹æ ‡ä¸ºjï¼Œè®°å½•sumä¸‹æ ‡ä¸ºi<br>    åˆ™è¯´æ˜åœ¨(i+1,j)è¿™ä¸€æ®µæ‰€æœ‰å…ƒç´ çš„å’Œä¸º0,å³å…¶å¹³å‡æ•°æ˜¯k,æ˜¯ç¬¦åˆè¦æ±‚çš„<br>4.æ‰¾å‡ºæœ€é•¿çš„å­æ•°ç»„å³å¯</p><h4 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Scanner</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Scanner</span>(System.in);</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> in.nextInt();</span><br><span class="line">    <span class="type">long</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">long</span> cur;</span><br><span class="line">    <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡å‡ºç°çš„å€¼å’Œä¸‹æ ‡</span></span><br><span class="line">    HashMap&lt;Long,Integer&gt; m = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€ä¸ªå€¼æœ‰å¯èƒ½å°±ä¸ºk</span></span><br><span class="line">    m.put(<span class="number">0L</span>,<span class="number">0</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;=n;i++)&#123;</span><br><span class="line">        cur = pre + in.nextInt() - k;</span><br><span class="line">        <span class="keyword">if</span>(m.containsKey(cur))&#123;</span><br><span class="line">            res = Math.max(res,i-m.get(cur));</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            m.put(cur,i);</span><br><span class="line">        &#125;</span><br><span class="line">        pre = cur;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(res);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redisæ•°æ®ç±»å‹</title>
      <link href="/posts/6834/"/>
      <url>/posts/6834/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>Redisä¸­æ‰€æœ‰çš„keyï¼ˆé”®ï¼‰éƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œå€¼çš„æ•°æ®ç±»å‹æœ‰5ç§ï¼š<strong>Stringã€Listã€Setã€Zsetã€Hash</strong></p><img src="/img/6834/redis1.jpeg" alt="img" style="zoom:67%;" /><table><thead><tr><th align="center">ç±»å‹</th><th align="center">å­˜å‚¨çš„å€¼</th><th align="center">æ“ä½œ</th></tr></thead><tbody><tr><td align="center">String</td><td align="center">å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€æ•´æ•°æˆ–æµ®ç‚¹æ•°</td><td align="center">å¯¹æ•´ä¸ªå­—ç¬¦ä¸²æˆ–å­—ç¬¦ä¸²çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ“ä½œï¼›å¯¹æ•´æ•°æˆ–æµ®ç‚¹æ•°è¿›è¡Œè‡ªå¢æˆ–è‡ªå‡æ“ä½œ</td></tr><tr><td align="center">List</td><td align="center">ä¸€ä¸ªé“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«ä¸€ä¸ªå­—ç¬¦ä¸²</td><td align="center">å¯¹é“¾è¡¨çš„ä¸¤ç«¯è¿›è¡Œpushå’Œpopæ“ä½œï¼Œè¯»å–å•ä¸ªæˆ–å¤šä¸ªå…ƒç´ ï¼›æ ¹æ®å€¼æŸ¥æ‰¾æˆ–åˆ é™¤å…ƒç´ </td></tr><tr><td align="center">Set</td><td align="center">åŒ…å«å­—ç¬¦ä¸²çš„æ— åºé›†åˆ</td><td align="center">å­—ç¬¦ä¸²çš„é›†åˆï¼ŒåŒ…å«åŸºç¡€çš„æ–¹æ³•æœ‰çœ‹æ˜¯å¦å­˜åœ¨æ·»åŠ ã€è·å–ã€åˆ é™¤ï¼›è¿˜åŒ…å«è®¡ç®—äº¤é›†ã€å¹¶é›†ã€å·®é›†ç­‰</td></tr><tr><td align="center">Hash</td><td align="center">åŒ…å«é”®å€¼å¯¹çš„æ— åºæ•£åˆ—è¡¨</td><td align="center">åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ </td></tr><tr><td align="center">Zset</td><td align="center">å’Œæ•£åˆ—ä¸€æ ·ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹</td><td align="center">å­—ç¬¦ä¸²æˆå‘˜ä¸æµ®ç‚¹æ•°åˆ†æ•°ä¹‹é—´çš„æœ‰åºæ˜ å°„ï¼›å…ƒç´ çš„æ’åˆ—é¡ºåºç”±åˆ†æ•°çš„å¤§å°å†³å®šï¼›åŒ…å«æ–¹æ³•æœ‰æ·»åŠ ã€è·å–ã€åˆ é™¤å•ä¸ªå…ƒç´ ä»¥åŠæ ¹æ®åˆ†å€¼èŒƒå›´æˆ–æˆå‘˜æ¥è·å–å…ƒç´ </td></tr></tbody></table><h2 id="ğŸString"><a href="#ğŸString" class="headerlink" title="ğŸString"></a>ğŸString</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Stringç±»å‹æ˜¯<strong>äºŒè¿›åˆ¶å®‰å…¨</strong>çš„ï¼Œstringå¯ä»¥åŒ…å«ä»»ä½•æ•°æ®ï¼Œå¦‚æ•°å­—ï¼Œå­—ç¬¦ä¸²ï¼Œjpgå›¾ç‰‡æˆ–è€…åºåˆ—åŒ–çš„å¯¹è±¡</p><h3 id="å‘½ä»¤"><a href="#å‘½ä»¤" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><img src="/img/6834/redis2.jpeg" alt="image-20230926151736752" style="zoom: 80%;" /><h3 id="åº”ç”¨"><a href="#åº”ç”¨" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p><strong>ç¼“å­˜</strong>ï¼š ç»å…¸ä½¿ç”¨åœºæ™¯ï¼ŒæŠŠå¸¸ç”¨ä¿¡æ¯ï¼Œå­—ç¬¦ä¸²ï¼Œå›¾ç‰‡æˆ–è€…è§†é¢‘ç­‰ä¿¡æ¯æ”¾åˆ°redisä¸­ï¼Œredis<strong>ä½œä¸ºç¼“å­˜å±‚</strong>ï¼ŒmysqlåšæŒä¹…åŒ–å±‚ï¼Œé™ä½mysqlçš„è¯»å†™å‹åŠ›</p><p><strong>è®¡æ•°å™¨</strong>ï¼šredisæ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼ˆ<strong>åŸå­æ€§</strong>ï¼‰ï¼Œä¸€ä¸ªå‘½ä»¤æ‰§è¡Œå®Œæ‰ä¼šæ‰§è¡Œä¸‹ä¸€ä¸ªï¼ŒåŒæ—¶æ•°æ®å¯ä»¥ä¸€æ­¥è½åœ°åˆ°å…¶ä»–çš„æ•°æ®æº</p><p><strong>session</strong>ï¼šspring session + rediså®ç°sessionå…±äº«</p><h2 id="ğŸList"><a href="#ğŸList" class="headerlink" title="ğŸList"></a>ğŸList</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Liståº•å±‚ä¸ºåŒç«¯é“¾è¡¨</p><ul><li>å…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼Œå³å‹ç¼©åˆ—è¡¨ziplistï¼ˆå…ƒç´ è¾ƒå°‘çš„æƒ…å†µä¸‹ä¼šä½¿ç”¨ä¸€å—è¿ç»­çš„å†…å­˜å­˜å‚¨ï¼‰</li><li>å½“æ•°æ®é‡æ¯”è¾ƒå¤šçš„æ—¶å€™ä¼šæ”¹æˆquicklistï¼Œå°†å¤šä¸ªziplistä½¿ç”¨åŒå‘æŒ‡é’ˆä¸²èµ·æ¥ä½¿ç”¨ã€‚è¿™æ ·æ—¢æ»¡è¶³äº†å¿«é€Ÿçš„æ’å…¥åˆ é™¤æ€§èƒ½ï¼Œåˆä¸ä¼šå‡ºç°å¤ªå¤§çš„ç©ºé—´å†—ä½™</li></ul><img src="/img/6834/redis4.jpeg" alt="image-20230926153312332" style="zoom:80%;" /><h3 id="å‘½ä»¤-1"><a href="#å‘½ä»¤-1" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><img src="/img/6834/redis3.jpeg" alt="image-20230926152748719" style="zoom:80%;" /><h3 id="åº”ç”¨-1"><a href="#åº”ç”¨-1" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>lpush+lpop&#x3D;Stack(æ ˆ)</p><p>lpush+rpop&#x3D;Queueï¼ˆé˜Ÿåˆ—ï¼‰</p><p>lpush+ltrim&#x3D;Capped Collectionï¼ˆæœ‰é™é›†åˆï¼‰</p><p>lpush+brpop&#x3D;Message Queueï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</p><h2 id="ğŸSet"><a href="#ğŸSet" class="headerlink" title="ğŸSet"></a>ğŸSet</h2><h3 id="æ¦‚è¿°-2"><a href="#æ¦‚è¿°-2" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Set æ˜¯ String ç±»å‹çš„<strong>æ— åºé›†åˆ</strong>ã€‚é›†åˆæˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œè¿™å°±æ„å‘³ç€é›†åˆä¸­<strong>ä¸èƒ½å‡ºç°é‡å¤</strong>çš„æ•°æ®</p><p>åº•å±‚å…¶å®æ˜¯ä¸€ä¸ªvalueä¸ºnullçš„hashè¡¨ï¼Œæ‰€ä»¥æ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾çš„<strong>å¤æ‚åº¦éƒ½æ˜¯O(1)</strong></p><h3 id="å‘½ä»¤-2"><a href="#å‘½ä»¤-2" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><img src="/img/6834/redis5.jpeg" alt="image-20230926153655152" style="zoom:80%;" /><h3 id="åº”ç”¨-2"><a href="#åº”ç”¨-2" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p><strong>æ ‡ç­¾</strong>ï¼ˆtagï¼‰ï¼šç»™ç”¨æˆ·æ·»åŠ æ ‡ç­¾ï¼Œæˆ–è€…ç”¨æˆ·ç»™æ¶ˆæ¯æ·»åŠ æ ‡ç­¾ï¼Œè¿™æ ·æœ‰åŒä¸€æ ‡ç­¾æˆ–è€…ç±»ä¼¼æ ‡ç­¾çš„å¯ä»¥ç»™æ¨èå…³æ³¨çš„äº‹æˆ–è€…å…³æ³¨çš„äºº</p><p><strong>ç‚¹èµï¼Œæˆ–ç‚¹è¸©ï¼Œæ”¶è—ç­‰</strong>ï¼šå¯ä»¥æ”¾åˆ°setä¸­å®ç°</p><h2 id="ğŸHash"><a href="#ğŸHash" class="headerlink" title="ğŸHash"></a>ğŸHash</h2><h3 id="æ¦‚è¿°-3"><a href="#æ¦‚è¿°-3" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Hashæ˜¯ä¸€ä¸ªstringç±»å‹çš„fieldå’Œvalueçš„æ˜ å°„è¡¨ï¼Œhashç‰¹åˆ«é€‚åˆç”¨äº<strong>å­˜å‚¨å¯¹è±¡</strong>ã€‚ç±»ä¼¼Javaé‡Œé¢çš„<strong>Map&lt;String,Object&gt;</strong></p><h3 id="å‘½ä»¤-3"><a href="#å‘½ä»¤-3" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><img src="/img/6834/redis6.jpeg" alt="image-20230926173013194" style="zoom:80%;" /><h3 id="åº”ç”¨-3"><a href="#åº”ç”¨-3" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>å­˜å‚¨å¯¹è±¡ç±»å‹</p><h2 id="ğŸZset"><a href="#ğŸZset" class="headerlink" title="ğŸZset"></a>ğŸZset</h2><h3 id="æ¦‚è¿°-4"><a href="#æ¦‚è¿°-4" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>Redisæœ‰åºé›†åˆzsetä¸æ™®é€šé›†åˆsetéå¸¸ç›¸ä¼¼ï¼Œæ˜¯ä¸€ä¸ªæ²¡æœ‰é‡å¤å…ƒç´ çš„å­—ç¬¦ä¸²é›†åˆã€‚</p><p>ä¸åŒä¹‹å¤„æ˜¯æœ‰åºé›†åˆçš„æ¯ä¸ªæˆå‘˜éƒ½å…³è”äº†ä¸€ä¸ª<strong>è¯„åˆ†ï¼ˆscoreï¼‰</strong>,è¿™ä¸ªè¯„åˆ†ï¼ˆscoreï¼‰è¢«ç”¨æ¥æŒ‰ç…§ä»æœ€ä½åˆ†åˆ°æœ€é«˜åˆ†çš„æ–¹å¼æ’åºé›†åˆä¸­çš„æˆå‘˜ã€‚é›†åˆçš„æˆå‘˜æ˜¯å”¯ä¸€çš„ï¼Œä½†æ˜¯è¯„åˆ†å¯ä»¥æ˜¯é‡å¤çš„</p><p><strong>åº•å±‚ç»“æ„</strong></p><p>hashï¼šhashçš„ä½œç”¨å°±æ˜¯å…³è”å…ƒç´ valueå’Œæƒé‡scoreï¼Œä¿éšœå…ƒç´ valueçš„å”¯ä¸€æ€§ï¼Œå¯ä»¥é€šè¿‡å…ƒç´ valueæ‰¾åˆ°ç›¸åº”çš„scoreå€¼ã€‚<br>è·³è·ƒè¡¨ï¼ˆ<strong>zSkiplist</strong>ï¼‰ï¼šè·³è·ƒè¡¨çš„ç›®çš„åœ¨äºç»™å…ƒç´ valueæ’åºï¼Œæ ¹æ®scoreçš„èŒƒå›´è·å–å…ƒç´ åˆ—è¡¨</p><h3 id="å‘½ä»¤-4"><a href="#å‘½ä»¤-4" class="headerlink" title="å‘½ä»¤"></a>å‘½ä»¤</h3><img src="/img/6834/redis7.jpeg" alt="image-20230926221106241" style="zoom:80%;" /><h3 id="åº”ç”¨-4"><a href="#åº”ç”¨-4" class="headerlink" title="åº”ç”¨"></a>åº”ç”¨</h3><p>æ’è¡Œæ¦œï¼šæœ‰åºé›†åˆç»å…¸ä½¿ç”¨åœºæ™¯ã€‚ä¾‹å¦‚å°è¯´è§†é¢‘ç­‰ç½‘ç«™éœ€è¦å¯¹ç”¨æˆ·ä¸Šä¼ çš„å°è¯´è§†é¢‘åšæ’è¡Œæ¦œï¼Œæ¦œå•å¯ä»¥æŒ‰ç…§ç”¨æˆ·å…³æ³¨æ•°ï¼Œæ›´æ–°æ—¶é—´ï¼Œå­—æ•°ç­‰æ‰“åˆ†ï¼Œåšæ’è¡Œã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Redis </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Redis </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼é”</title>
      <link href="/posts/18358/"/>
      <url>/posts/18358/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>å½“å¤šä¸ªè¿›ç¨‹ä¸åœ¨åŒä¸€ä¸ªç³»ç»Ÿä¸­(æ¯”å¦‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­æ§åˆ¶å…±äº«èµ„æºè®¿é—®)ï¼Œç”¨åˆ†å¸ƒå¼é”æ§åˆ¶å¤šä¸ªè¿›ç¨‹å¯¹èµ„æºçš„è®¿é—®</p></blockquote><p><strong>è®¾è®¡åŸåˆ™ï¼šå®‰å…¨æ€§å’Œæœ‰æ•ˆæ€§</strong></p><p><strong>äº’æ–¥</strong>ï¼ˆå±äºå®‰å…¨æ€§ï¼‰ï¼šåœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œåªæœ‰ä¸€ä¸ªå®¢æˆ·ç«¯å¯ä»¥æŒæœ‰é”ã€‚</p><p><strong>æ— æ­»é”</strong>ï¼ˆå±äºæœ‰æ•ˆæ€§ï¼‰ï¼šå³ä½¿é”å®šèµ„æºçš„å®¢æˆ·ç«¯å´©æºƒæˆ–è¢«åˆ†åŒºï¼Œä¹Ÿæ€»æ˜¯å¯ä»¥è·å¾—é”ï¼›é€šå¸¸é€šè¿‡è¶…æ—¶æœºåˆ¶å®ç°ã€‚</p><p><strong>å®¹é”™æ€§</strong>ï¼ˆå±äºæœ‰æ•ˆæ€§ï¼‰ï¼šåªè¦å¤§å¤šæ•°èŠ‚ç‚¹éƒ½å¯åŠ¨ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥è·å–å’Œé‡Šæ”¾é”</p><h2 id="ğŸåŸºäºæ•°æ®åº“å®ç°"><a href="#ğŸåŸºäºæ•°æ®åº“å®ç°" class="headerlink" title="ğŸåŸºäºæ•°æ®åº“å®ç°"></a>ğŸåŸºäºæ•°æ®åº“å®ç°</h2><h3 id="1-åŸºäºæ•°æ®åº“è¡¨"><a href="#1-åŸºäºæ•°æ®åº“è¡¨" class="headerlink" title="1 åŸºäºæ•°æ®åº“è¡¨"></a>1 åŸºäºæ•°æ®åº“è¡¨</h3><p>ç›´æ¥åˆ›å»ºä¸€å¼ é”è¡¨ï¼Œç„¶åé€šè¿‡æ“ä½œè¯¥è¡¨ä¸­çš„æ•°æ®æ¥å®ç°äº†ã€‚å½“æˆ‘ä»¬æƒ³è¦è·å¾—é”çš„æ—¶å€™ï¼Œå°±å¯ä»¥åœ¨è¯¥è¡¨ä¸­å¢åŠ ä¸€æ¡è®°å½•ï¼Œæƒ³è¦é‡Šæ”¾é”çš„æ—¶å€™å°±åˆ é™¤è¿™æ¡è®°å½•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> database_lock (</span><br><span class="line">`id` <span class="type">BIGINT</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">`resource` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> COMMENT <span class="string">&#x27;é”å®šçš„èµ„æº&#x27;</span>,</span><br><span class="line">`description` <span class="type">varchar</span>(<span class="number">1024</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> &quot;&quot; COMMENT <span class="string">&#x27;æè¿°&#x27;</span>,</span><br><span class="line"><span class="keyword">PRIMARY</span> KEY (id),</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY uiq_idx_resource (resource)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4 COMMENT<span class="operator">=</span><span class="string">&#x27;æ•°æ®åº“åˆ†å¸ƒå¼é”è¡¨&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è·å¾—é”æ—¶ï¼Œæ’å…¥ä¸€æ¡æ•°æ®:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> database_lock(resource, description) <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;lock&#x27;</span>);</span><br></pre></td></tr></table></figure><p>é‡Šæ”¾é”æ—¶ï¼Œåˆ é™¤è¿™æ¡æ•°æ®:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> database_lock <span class="keyword">WHERE</span> resource<span class="operator">=</span><span class="number">1</span>;</span><br></pre></td></tr></table></figure><h3 id="2-åŸºäºæ‚²è§‚é”"><a href="#2-åŸºäºæ‚²è§‚é”" class="headerlink" title="2 åŸºäºæ‚²è§‚é”"></a>2 åŸºäºæ‚²è§‚é”</h3><h4 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h4><ol><li>åœ¨å¯¹ä»»æ„è®°å½•è¿›è¡Œä¿®æ”¹å‰ï¼Œå…ˆå°è¯•ä¸ºè¯¥è®°å½•åŠ ä¸Šæ’ä»–é”ï¼ˆexclusive lockingï¼‰ã€‚</li><li>å¦‚æœåŠ é”å¤±è´¥ï¼Œè¯´æ˜è¯¥è®°å½•æ­£åœ¨è¢«ä¿®æ”¹ï¼Œé‚£ä¹ˆå½“å‰æŸ¥è¯¢å¯èƒ½è¦ç­‰å¾…æˆ–è€…æŠ›å‡ºå¼‚å¸¸ã€‚ </li><li>å¦‚æœæˆåŠŸåŠ é”ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¯¹è®°å½•åšä¿®æ”¹ï¼Œäº‹åŠ¡å®Œæˆåå°±ä¼šè§£é”äº†ã€‚</li><li>å…¶é—´å¦‚æœæœ‰å…¶ä»–å¯¹è¯¥è®°å½•åšä¿®æ”¹æˆ–åŠ æ’ä»–é”çš„æ“ä½œï¼Œéƒ½ä¼šç­‰å¾…æˆ‘ä»¬è§£é”æˆ–æŠ›å‡ºå¼‚å¸¸ã€‚</li></ol><h4 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="number">0.</span>å¼€å§‹äº‹åŠ¡</span><br><span class="line"><span class="keyword">begin</span>;<span class="operator">/</span><span class="keyword">begin</span> work;<span class="operator">/</span><span class="keyword">start</span> transaction; (ä¸‰è€…é€‰ä¸€å°±å¯ä»¥)</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="number">1.</span>æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯,ä½¿ç”¨<span class="keyword">select</span>â€¦<span class="keyword">for</span> <span class="keyword">update</span>çš„æ–¹å¼ï¼Œå¼€å¯æ’ä»–é”</span><br><span class="line"><span class="keyword">select</span> status <span class="keyword">from</span> t_goods <span class="keyword">where</span> id<span class="operator">=</span><span class="number">1</span> <span class="keyword">for</span> <span class="keyword">update</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="number">2.</span>æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_orders (id,goods_id) <span class="keyword">values</span> (<span class="keyword">null</span>,<span class="number">1</span>);</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="number">3.</span>ä¿®æ”¹å•†å“statusä¸º<span class="number">2</span></span><br><span class="line"><span class="keyword">update</span> t_goods <span class="keyword">set</span> status<span class="operator">=</span><span class="number">2</span>;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span><span class="number">4.</span>æäº¤äº‹åŠ¡</span><br><span class="line"><span class="keyword">commit</span>;<span class="operator">/</span><span class="keyword">commit</span> work;</span><br></pre></td></tr></table></figure><h3 id="3-åŸºäºä¹è§‚é”"><a href="#3-åŸºäºä¹è§‚é”" class="headerlink" title="3 åŸºäºä¹è§‚é”"></a>3 åŸºäºä¹è§‚é”</h3><p>ä½¿ç”¨ç‰ˆæœ¬å·æ—¶ï¼Œå¯ä»¥åœ¨æ•°æ®åˆå§‹åŒ–æ—¶æŒ‡å®šä¸€ä¸ªç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å¯¹æ•°æ®çš„æ›´æ–°æ“ä½œéƒ½å¯¹ç‰ˆæœ¬å·æ‰§è¡Œ+1æ“ä½œã€‚å¹¶åˆ¤æ–­å½“å‰ç‰ˆæœ¬å·æ˜¯ä¸æ˜¯è¯¥æ•°æ®çš„æœ€æ–°çš„ç‰ˆæœ¬å·ã€‚</p><h4 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>æŸ¥è¯¢å‡ºå•†å“ä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> (status,status,version) <span class="keyword">from</span> t_goods <span class="keyword">where</span> id<span class="operator">=</span>#&#123;id&#125;</span><br><span class="line"><span class="number">2.</span>æ ¹æ®å•†å“ä¿¡æ¯ç”Ÿæˆè®¢å•</span><br><span class="line"><span class="number">3.</span>ä¿®æ”¹å•†å“statusä¸º<span class="number">2</span></span><br><span class="line"><span class="keyword">update</span> t_goods </span><br><span class="line"><span class="keyword">set</span> status<span class="operator">=</span><span class="number">2</span>,version<span class="operator">=</span>version<span class="operator">+</span><span class="number">1</span></span><br><span class="line"><span class="keyword">where</span> id<span class="operator">=</span>#&#123;id&#125; <span class="keyword">and</span> version<span class="operator">=</span>#&#123;version&#125;;</span><br></pre></td></tr></table></figure><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>å¯¹æ•°æ®åº“ä¾èµ–ï¼Œå¼€é”€å¤§é—®é¢˜ï¼Œè¡Œé”å˜è¡¨é”é—®é¢˜ï¼Œæ— æ³•è§£å†³æ•°æ®åº“å•ç‚¹å’Œå¯é‡å…¥çš„é—®é¢˜</p><h2 id="ğŸåŸºäºrediså®ç°"><a href="#ğŸåŸºäºrediså®ç°" class="headerlink" title="ğŸåŸºäºrediså®ç°"></a>ğŸåŸºäºrediså®ç°</h2><h3 id="1-set-NX-PX-Lua"><a href="#1-set-NX-PX-Lua" class="headerlink" title="1 set NX PX + Lua"></a>1 set NX PX + Lua</h3><h4 id="å‘½ä»¤è¡Œ"><a href="#å‘½ä»¤è¡Œ" class="headerlink" title="å‘½ä»¤è¡Œ"></a>å‘½ä»¤è¡Œ</h4><blockquote><p>å‘½ä»¤ï¼šSET productId:lock 0xx9p03001 NX PX 30000</p></blockquote><p>productIdï¼šç”±è‡ªå·±å®šä¹‰ï¼Œå¯ä»¥æ˜¯ä¸æœ¬æ¬¡ä¸šåŠ¡æœ‰å…³çš„id</p><p>0xx9p03001ï¼šæ˜¯ä¸€ä¸²éšæœºå€¼ï¼Œå¿…é¡»ä¿è¯å…¨å±€å”¯ä¸€</p><p>NXï¼šæŒ‡çš„æ˜¯å½“ä¸”ä»…å½“key(ä¹Ÿå°±æ˜¯æ¡ˆä¾‹ä¸­çš„â€productId:lockâ€)åœ¨Redisä¸­ä¸å­˜åœ¨æ—¶ï¼Œè¿”å›æ‰§è¡ŒæˆåŠŸï¼Œå¦åˆ™æ‰§è¡Œå¤±è´¥</p><p>PX 30000ï¼šæŒ‡çš„æ˜¯åœ¨30ç§’åï¼Œkeyå°†è¢«è‡ªåŠ¨åˆ é™¤</p><h4 id="å®¢æˆ·ç«¯"><a href="#å®¢æˆ·ç«¯" class="headerlink" title="å®¢æˆ·ç«¯"></a>å®¢æˆ·ç«¯</h4><p>ä¼ªä»£ç </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if(ç¼“å­˜ä¸­æœ‰)&#123;</span><br><span class="line">  è¿”å›ç¼“å­˜ä¸­çš„æ•°æ®</span><br><span class="line">&#125;else&#123;</span><br><span class="line">  è·å–åˆ†å¸ƒå¼é”</span><br><span class="line">  if(è·å–é”æˆåŠŸï¼‰&#123;</span><br><span class="line">       try&#123;</span><br><span class="line">         æŸ¥è¯¢æ•°æ®åº“</span><br><span class="line">      &#125;finally&#123;</span><br><span class="line">         é‡Šæ”¾é”</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">lock</span><span class="params">(String key, <span class="type">long</span> expire, <span class="type">int</span> retryTimes, <span class="type">long</span> retryDuration)</span> &#123;</span><br><span class="line">    <span class="comment">// use JedisCommands instead of setIfAbsense</span></span><br><span class="line">    <span class="type">boolean</span> <span class="variable">result</span> <span class="operator">=</span> setRedis(key, expire);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// retry if needed</span></span><br><span class="line">    <span class="keyword">while</span> ((!result) &amp;&amp; retryTimes-- &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;lock failed, retrying...&quot;</span> + retryTimes);</span><br><span class="line">            Thread.sleep(retryDuration);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// use JedisCommands instead of setIfAbsense</span></span><br><span class="line">        result = setRedis(key, expire);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">setRedis</span><span class="params">(String key, <span class="type">long</span> expire)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        RedisCallback&lt;String&gt; redisCallback = connection -&gt; &#123;</span><br><span class="line">            <span class="type">JedisCommands</span> <span class="variable">commands</span> <span class="operator">=</span> (JedisCommands) connection.getNativeConnection();</span><br><span class="line">            <span class="type">String</span> <span class="variable">uuid</span> <span class="operator">=</span> SnowIDUtil.uniqueStr();</span><br><span class="line">            lockFlag.set(uuid);</span><br><span class="line">            <span class="keyword">return</span> commands.set(key, uuid, NX, PX, expire); <span class="comment">// åŠ åˆ†å¸ƒå¼é”</span></span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> redisTemplate.execute(redisCallback);</span><br><span class="line">        <span class="keyword">return</span> !StringUtil.isEmpty(result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;set redis occurred an exception&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é”ï¼šä½¿ç”¨åŸå­æ€§çš„Luaè¯­è¨€</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>, KEYS[<span class="number">1</span>])==ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line"><span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><h3 id="2-Redisson"><a href="#2-Redisson" class="headerlink" title="2 Redisson"></a>2 Redisson</h3><h4 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h4><p>redissonæ‰€æœ‰æŒ‡ä»¤éƒ½é€šè¿‡luaè„šæœ¬æ‰§è¡Œï¼Œä¿è¯äº†æ“ä½œçš„åŸå­æ€§</p><p>redissonè®¾ç½®äº†watchdogçœ‹é—¨ç‹—ï¼Œâ€œçœ‹é—¨ç‹—â€çš„é€»è¾‘ä¿è¯äº†æ²¡æœ‰æ­»é”å‘ç”Ÿ</p><p>redissonæ”¯æŒRedlockçš„å®ç°æ–¹å¼</p><h4 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h4><p><img src="/img/18358/%E5%88%86%E5%B8%83%E5%BC%8F3.png" alt="image-20230925094317807"></p><p><strong>åŠ é”æœºåˆ¶</strong></p><p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–æˆåŠŸ: æ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redisæ•°æ®åº“ã€‚</p><p>çº¿ç¨‹å»è·å–é”ï¼Œè·å–å¤±è´¥: ä¸€ç›´é€šè¿‡whileå¾ªç¯å°è¯•è·å–é”ï¼Œè·å–æˆåŠŸåï¼Œæ‰§è¡Œluaè„šæœ¬ï¼Œä¿å­˜æ•°æ®åˆ°redis</p><p><strong>WatchDog-è‡ªåŠ¨å»¶æœŸ</strong></p><p>æƒ…å†µä¸€ï¼šåœ¨ä¸€ä¸ªåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œå‡å¦‚ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åï¼Œçªç„¶æœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™åœ¨ä¸€å®šæ—¶é—´åè¿™ä¸ªé”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œä¹Ÿå¯ä»¥è®¾ç½®é”çš„æœ‰æ•ˆæ—¶é—´(é»˜è®¤30ç§’ï¼‰ï¼Œè¿™æ ·çš„ç›®çš„ä¸»è¦æ˜¯é˜²æ­¢æ­»é”çš„å‘ç”Ÿ</p><p>æƒ…å†µäºŒï¼šçº¿ç¨‹Aä¸šåŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œå®Œï¼Œæ—¶é—´å°±è¿‡äº†ï¼Œçº¿ç¨‹A è¿˜æƒ³æŒæœ‰é”çš„è¯ï¼Œå°±ä¼šå¯åŠ¨ä¸€ä¸ªwatch dogåå°çº¿ç¨‹ï¼Œä¸æ–­çš„å»¶é•¿é”keyçš„ç”Ÿå­˜æ—¶é—´ã€‚</p><p><strong>luaè„šæœ¬-ä¿è¯åŸå­æ€§</strong></p><p>å¦‚æœä¸šåŠ¡é€»è¾‘å¤æ‚ï¼Œé€šè¿‡å°è£…åœ¨luaè„šæœ¬ä¸­å‘é€ç»™redisï¼Œç”±äºredisæ˜¯å•çº¿ç¨‹çš„ï¼Œè¿™æ ·å°±ä¿è¯è¿™æ®µå¤æ‚ä¸šåŠ¡é€»è¾‘æ‰§è¡Œçš„åŸå­æ€§</p><h4 id="å…·ä½“æ“ä½œ"><a href="#å…·ä½“æ“ä½œ" class="headerlink" title="å…·ä½“æ“ä½œ"></a>å…·ä½“æ“ä½œ</h4><p>ä½¿ç”¨RLockæ“ä½œåˆ†å¸ƒé”ï¼ŒRLockç»§æ‰¿JDKçš„Lockæ¥å£ï¼Œæ‰€ä»¥ä»–æœ‰Lockæ¥å£çš„æ‰€æœ‰ç‰¹æ€§ï¼Œæ¯”å¦‚lockã€unlockã€trylockç­‰ç‰¹æ€§,åŒæ—¶å®ƒè¿˜æœ‰å¾ˆå¤šæ–°ç‰¹æ€§ï¼šå¼ºåˆ¶é”é‡Šæ”¾ï¼Œå¸¦æœ‰æ•ˆæœŸçš„é”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">RLock</span> &#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">//----------------------Lockæ¥å£æ–¹æ³•-----------------------</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ é” é”çš„æœ‰æ•ˆæœŸé»˜è®¤30ç§’</span></span><br><span class="line"><span class="comment">     â€¢å¦‚æœä¸»çº¿ç¨‹æœªé‡Šæ”¾ï¼Œä¸”å½“å‰é”æœªè°ƒç”¨unlockæ–¹æ³•ï¼Œåˆ™è¿›å…¥åˆ°watchDogæœºåˆ¶</span></span><br><span class="line"><span class="comment"> â€¢å¦‚æœä¸»çº¿ç¨‹æœªé‡Šæ”¾ï¼Œä¸”å½“å‰é”è°ƒç”¨unlockæ–¹æ³•ï¼Œåˆ™ç›´æ¥é‡Šæ”¾é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">     <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * åŠ é” å¯ä»¥æ‰‹åŠ¨è®¾ç½®é”çš„æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leaseTime é”æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit      æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">(<span class="type">long</span> leaseTime, TimeUnit unit)</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tryLock()æ–¹æ³•æ˜¯æœ‰è¿”å›å€¼çš„ï¼Œç”¨æ¥å°è¯•è·å–é”ï¼Œ</span></span><br><span class="line"><span class="comment">     * å¦‚æœè·å–æˆåŠŸï¼Œåˆ™è¿”å›trueï¼Œå¦‚æœè·å–å¤±è´¥ï¼ˆå³é”å·²è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰ï¼Œåˆ™è¿”å›false .</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * tryLock(long time, TimeUnit unit)æ–¹æ³•å’ŒtryLock()æ–¹æ³•æ˜¯ç±»ä¼¼çš„ï¼Œ</span></span><br><span class="line"><span class="comment">     * åªä¸è¿‡åŒºåˆ«åœ¨äºè¿™ä¸ªæ–¹æ³•åœ¨æ‹¿ä¸åˆ°é”æ—¶ä¼šç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œ</span></span><br><span class="line"><span class="comment">     * åœ¨æ—¶é—´æœŸé™ä¹‹å†…å¦‚æœè¿˜æ‹¿ä¸åˆ°é”ï¼Œå°±è¿”å›falseã€‚å¦‚æœå¦‚æœä¸€å¼€å§‹æ‹¿åˆ°é”æˆ–è€…åœ¨ç­‰å¾…æœŸé—´å†…æ‹¿åˆ°äº†é”ï¼Œåˆ™è¿”å›trueã€‚</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time ç­‰å¾…æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> time, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * æ¯”ä¸Šé¢å¤šä¸€ä¸ªå‚æ•°ï¼Œå¤šæ·»åŠ ä¸€ä¸ªé”çš„æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> waitTime  ç­‰å¾…æ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> leaseTime é”æœ‰æ•ˆæ—¶é—´</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> unit      æ—¶é—´å•ä½ å°æ—¶ã€åˆ†ã€ç§’ã€æ¯«ç§’ç­‰</span></span><br><span class="line"><span class="comment">     * waitTime å¤§äº leaseTime</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">tryLock</span><span class="params">(<span class="type">long</span> waitTime, <span class="type">long</span> leaseTime, TimeUnit unit)</span> <span class="keyword">throws</span> InterruptedException;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * è§£é”</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åˆ†å¸ƒå¼ç†è®º</title>
      <link href="/posts/27486/"/>
      <url>/posts/27486/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸåˆ†å¸ƒå¼ç³»ç»Ÿ"><a href="#ğŸåˆ†å¸ƒå¼ç³»ç»Ÿ" class="headerlink" title="ğŸåˆ†å¸ƒå¼ç³»ç»Ÿ"></a>ğŸåˆ†å¸ƒå¼ç³»ç»Ÿ</h2><p>åˆ†å¸ƒå¼ç³»ç»Ÿæ˜¯ä¸€ä¸ªç¡¬ä»¶æˆ–è½¯ä»¶ç»„ä»¶åˆ†å¸ƒåœ¨ä¸åŒçš„ç½‘ç»œè®¡ç®—æœºä¸Šï¼Œå½¼æ­¤ä¹‹é—´ä»…ä»…é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡å’Œåè°ƒçš„ç³»ç»Ÿã€‚å³<strong>ä¸€ç¾¤ç‹¬ç«‹è®¡ç®—æœºé›†åˆå…±åŒå¯¹å¤–æä¾›æœåŠ¡ï¼Œä½†æ˜¯å¯¹äºç³»ç»Ÿçš„ç”¨æˆ·æ¥è¯´ï¼Œå°±åƒæ˜¯ä¸€å°è®¡ç®—æœºåœ¨æä¾›æœåŠ¡ä¸€æ ·</strong></p><h3 id="åˆ†å¸ƒæ€§"><a href="#åˆ†å¸ƒæ€§" class="headerlink" title="åˆ†å¸ƒæ€§"></a>åˆ†å¸ƒæ€§</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å¤šå°è®¡ç®—æœºä¹‹é—´åœ¨ç©ºé—´ä½ç½®ä¸Šå¯ä»¥éšæ„åˆ†å¸ƒ</p><h3 id="å¯¹ç­‰æ€§"><a href="#å¯¹ç­‰æ€§" class="headerlink" title="å¯¹ç­‰æ€§"></a>å¯¹ç­‰æ€§</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„è®¡ç®—æœºæ²¡æœ‰ä¸»ï¼ä»ä¹‹åˆ†ï¼Œå³æ²¡æœ‰æ§åˆ¶æ•´ä¸ªç³»ç»Ÿçš„ä¸»æœºï¼Œä¹Ÿæ²¡æœ‰è¢«æ§åˆ¶çš„ä»æœºï¼Œç»„æˆåˆ†å¸ƒå¼ç³»ç»Ÿçš„æ‰€æœ‰è®¡ç®—æœºèŠ‚ç‚¹éƒ½æ˜¯å¯¹ç­‰çš„</p><h3 id="è‡ªæ²»æ€§"><a href="#è‡ªæ²»æ€§" class="headerlink" title="è‡ªæ²»æ€§"></a>è‡ªæ²»æ€§</h3><p>åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å„ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«è‡ªå·±çš„å¤„ç†æœºå’Œå†…å­˜ï¼Œå„è‡ªå…·æœ‰ç‹¬ç«‹çš„å¤„ç†æ•°æ®çš„åŠŸèƒ½</p><h3 id="å¹¶å‘æ€§"><a href="#å¹¶å‘æ€§" class="headerlink" title="å¹¶å‘æ€§"></a>å¹¶å‘æ€§</h3><p>åœ¨ä¸€ä¸ªè®¡ç®—æœºç½‘ç»œä¸­ï¼Œç¨‹åºè¿è¡Œè¿‡ç¨‹çš„å¹¶å‘æ€§æ“ä½œ</p><h2 id="ğŸCAPç†è®º"><a href="#ğŸCAPç†è®º" class="headerlink" title="ğŸCAPç†è®º"></a>ğŸCAPç†è®º</h2><img src="/img/27486/åˆ†å¸ƒå¼1.png" alt="image-20230920222012832" style="zoom: 50%;" /><p><code>ä¸€è‡´æ€§ (Consistency)</code>: ä¸€ä¸ªå†™æ“ä½œè¿”å›æˆåŠŸï¼Œé‚£ä¹ˆä¹‹åçš„è¯»è¯·æ±‚éƒ½å¿…é¡»è¯»åˆ°è¿™ä¸ªæ–°æ•°æ®ï¼›å¦‚æœè¿”å›å¤±è´¥ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯»æ“ä½œéƒ½ä¸èƒ½è¯»åˆ°è¿™ä¸ªæ•°æ®ã€‚<strong>æ‰€æœ‰èŠ‚ç‚¹è®¿é—®åŒä¸€ä»½æœ€æ–°çš„æ•°æ®</strong></p><p><code>å¯ç”¨æ€§ (Availability)</code>: å¯¹æ•°æ®æ›´æ–°å…·å¤‡é«˜å¯ç”¨æ€§ï¼Œè¯·æ±‚èƒ½å¤Ÿ<strong>åŠæ—¶å¤„ç†</strong>ï¼Œä¸ä¼šä¸€ç›´ç­‰å¾…ï¼Œå³ä½¿å‡ºç°èŠ‚ç‚¹å¤±æ•ˆã€‚</p><p><code>åˆ†åŒºå®¹é”™æ€§ (Partition tolerance)</code>: èƒ½å®¹å¿ç½‘ç»œåˆ†åŒºï¼Œåœ¨ç½‘ç»œæ–­å¼€çš„æƒ…å†µä¸‹ï¼Œ<strong>è¢«åˆ†éš”çš„èŠ‚ç‚¹ä»èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡</strong></p><p>ğŸš©CAPç†è®ºä¸‰é€‰äºŒï¼šCã€Aã€Pä¸‰è€…ä¸èƒ½åŒæ—¶æ»¡è¶³ï¼Œ<strong>æœ€å¤šåªèƒ½æ»¡è¶³å…¶ä¸­ä¸¤ä¸ª</strong></p><h2 id="ğŸBASEç†è®º"><a href="#ğŸBASEç†è®º" class="headerlink" title="ğŸBASEç†è®º"></a>ğŸBASEç†è®º</h2><img src="/img/27486/åˆ†å¸ƒå¼2.png" alt="image-20230921090547793" style="zoom:50%;" /><blockquote><p>BASEæ˜¯â€œBasically Available, Soft state, Eventually consistent(åŸºæœ¬å¯ç”¨ã€è½¯çŠ¶æ€ã€æœ€ç»ˆä¸€è‡´æ€§)â€çš„é¦–å­—æ¯ç¼©å†™ï¼ŒBASE ç†è®ºæ˜¯å¯¹ CAP ç†è®ºçš„å»¶ä¼¸ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯å³ä½¿æ— æ³•åšåˆ°å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼ŒCAP çš„ä¸€è‡´æ€§å°±æ˜¯å¼ºä¸€è‡´æ€§ï¼‰ï¼Œä½†åº”ç”¨å¯ä»¥é‡‡ç”¨é€‚åˆçš„æ–¹å¼è¾¾åˆ°æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consitencyï¼‰</p></blockquote><p><code>Basically Availableï¼ˆåŸºæœ¬å¯ç”¨ï¼‰</code>ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°ä¸å¯é¢„çŸ¥æ•…éšœçš„æ—¶å€™ï¼Œå…è®¸<strong>æŸå¤±éƒ¨åˆ†å¯ç”¨æ€§</strong></p><p><code>Soft stateï¼ˆè½¯çŠ¶æ€ï¼‰</code>ï¼šè½¯çŠ¶æ€ä¹Ÿç§°ä¸ºå¼±çŠ¶æ€ï¼Œå’Œç¡¬çŠ¶æ€ç›¸å¯¹ï¼Œæ˜¯æŒ‡å…è®¸ç³»ç»Ÿä¸­çš„æ•°æ®å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œå¹¶è®¤ä¸ºè¯¥ä¸­é—´çŠ¶æ€çš„å­˜åœ¨ä¸ä¼šå½±å“ç³»ç»Ÿçš„æ•´ä½“å¯ç”¨æ€§ï¼Œå³å…è®¸ç³»ç»Ÿåœ¨ä¸åŒèŠ‚ç‚¹çš„æ•°æ®å‰¯æœ¬ä¹‹é—´è¿›è¡Œæ•°æ®åŒæ­¥çš„è¿‡ç¨‹<strong>å­˜åœ¨å»¶æ—¶</strong>ã€‚</p><p><code>Eventually consistentï¼ˆæœ€ç»ˆä¸€è‡´æ€§ï¼‰</code>ï¼šæœ€ç»ˆä¸€è‡´æ€§å¼ºè°ƒçš„æ˜¯ç³»ç»Ÿä¸­æ‰€æœ‰çš„æ•°æ®å‰¯æœ¬ï¼Œåœ¨ç»è¿‡ä¸€æ®µæ—¶é—´çš„åŒæ­¥åï¼Œ<strong>æœ€ç»ˆèƒ½å¤Ÿè¾¾åˆ°ä¸€ä¸ªä¸€è‡´çš„çŠ¶æ€</strong>ã€‚å› æ­¤ï¼Œæœ€ç»ˆä¸€è‡´æ€§çš„æœ¬è´¨æ˜¯éœ€è¦ç³»ç»Ÿä¿è¯æœ€ç»ˆæ•°æ®èƒ½å¤Ÿè¾¾åˆ°ä¸€è‡´ï¼Œè€Œä¸éœ€è¦å®æ—¶ä¿è¯ç³»ç»Ÿæ•°æ®çš„å¼ºä¸€è‡´æ€§</p>]]></content>
      
      
      <categories>
          
          <category> åˆ†å¸ƒå¼ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åˆ†å¸ƒå¼ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLä¼˜åŒ–</title>
      <link href="/posts/43137/"/>
      <url>/posts/43137/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸä¸»é”®ä¼˜åŒ–"><a href="#ğŸä¸»é”®ä¼˜åŒ–" class="headerlink" title="ğŸä¸»é”®ä¼˜åŒ–"></a>ğŸä¸»é”®ä¼˜åŒ–</h2><p>ä¸»é”®é¡ºåºæ’å…¥çš„æ€§èƒ½æ˜¯è¦é«˜äºä¹±åºæ’å…¥çš„</p><h3 id="æ•°æ®ç»„ç»‡æ–¹å¼"><a href="#æ•°æ®ç»„ç»‡æ–¹å¼" class="headerlink" title="æ•°æ®ç»„ç»‡æ–¹å¼"></a>æ•°æ®ç»„ç»‡æ–¹å¼</h3><p>InnoDBå­˜å‚¨å¼•æ“ä¸­ï¼Œè¡¨æ•°æ®éƒ½æ˜¯<strong>æ ¹æ®ä¸»é”®é¡ºåºç»„ç»‡å­˜æ”¾</strong>çš„ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼çš„è¡¨ç§°ä¸ºç´¢å¼•ç»„ç»‡è¡¨</p><img src="/img/43137/SQLä¼˜åŒ–1.png" alt="image-20230918093027151" style="zoom:80%;" /><p>æ•°æ®è¡Œæ˜¯è®°å½•åœ¨é€»è¾‘ç»“æ„ page é¡µä¸­çš„ï¼Œè€Œæ¯ä¸€ä¸ªé¡µçš„å¤§å°æ˜¯å›ºå®šçš„ï¼Œé»˜è®¤16Kã€‚  ä¸€ä¸ªé¡µä¸­æ‰€å­˜å‚¨çš„è¡Œä¹Ÿæ˜¯æœ‰é™çš„ï¼Œå¦‚æœæ’å…¥çš„æ•°æ®è¡Œrowåœ¨è¯¥é¡µå­˜å‚¨ä¸ä¸‹ï¼Œå°†ä¼šå­˜å‚¨åˆ°ä¸‹ä¸€ä¸ªé¡µä¸­ï¼Œé¡µä¸é¡µä¹‹é—´ä¼šé€šè¿‡<strong>æŒ‡é’ˆè¿æ¥</strong></p><img src="/img/43137/SQLä¼˜åŒ–2.png" alt="image-20230918093248803" style="zoom:80%;" /><h3 id="é¡µåˆ†è£‚"><a href="#é¡µåˆ†è£‚" class="headerlink" title="é¡µåˆ†è£‚"></a>é¡µåˆ†è£‚</h3><p>é¡µå¯ä»¥ä¸ºç©ºï¼Œä¹Ÿå¯ä»¥å¡«å……ä¸€åŠï¼Œä¹Ÿå¯ä»¥å¡«å……100%ã€‚æ¯ä¸ªé¡µåŒ…å«äº†2-Nè¡Œæ•°æ®(å¦‚æœä¸€è¡Œæ•°æ®è¿‡å¤§ï¼Œä¼šè¡Œæº¢å‡º)ï¼Œæ ¹æ®ä¸»é”®æ’åˆ—</p><h4 id="1-ä¸»é”®é¡ºåºæ’å…¥"><a href="#1-ä¸»é”®é¡ºåºæ’å…¥" class="headerlink" title="1 ä¸»é”®é¡ºåºæ’å…¥"></a>1 ä¸»é”®é¡ºåºæ’å…¥</h4><p>æ¯é¡µå†™æ»¡åç”³è¯·æ–°é¡µæ’å…¥</p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%963.png" alt="image-20230918093542862"></p><h4 id="2-ä¸»é”®ä¹±åºæ’å…¥"><a href="#2-ä¸»é”®ä¹±åºæ’å…¥" class="headerlink" title="2 ä¸»é”®ä¹±åºæ’å…¥"></a>2 ä¸»é”®ä¹±åºæ’å…¥</h4><p>1ï¼‰1ï¼Œ2é¡µå·²ç»å†™æ»¡</p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%964.png" alt="image-20230918093737894"></p><p>2ï¼‰å†æ’å…¥idä¸º50çš„è®°å½•</p><p>æŒ‰ç…§é¡ºåºï¼Œåº”è¯¥å­˜å‚¨åœ¨47ä¹‹åã€‚ä½†æ˜¯47æ‰€åœ¨çš„1#é¡µï¼Œå·²ç»å†™æ»¡äº†ï¼Œå­˜å‚¨ä¸äº†50å¯¹åº”çš„æ•°æ®äº†ã€‚ é‚£ä¹ˆæ­¤æ—¶ä¼šå¼€è¾Ÿä¸€ä¸ªæ–°çš„3#é¡µã€‚<strong>å°†1#é¡µåä¸€åŠçš„æ•°æ®ï¼Œç§»åŠ¨åˆ°3#é¡µï¼Œç„¶ååœ¨3#é¡µï¼Œæ’å…¥50</strong>ã€‚</p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%965.png" alt="image-20230918094017708"></p><p>é‡æ–°è®¾ç½®é“¾è¡¨æŒ‡é’ˆï¼š</p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%966.png" alt="image-20230918094052329"></p><p>ä»¥ä¸Šå°±æ˜¯â€œé¡µåˆ†è£‚â€ç°è±¡</p><h3 id="é¡µåˆå¹¶"><a href="#é¡µåˆå¹¶" class="headerlink" title="é¡µåˆå¹¶"></a>é¡µåˆå¹¶</h3><p>ç›®å‰æœ‰è¿™äº›æ•°æ®</p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%967.png" alt="image-20230918094229806"></p><p>å½“åˆ é™¤ä¸€è¡Œè®°å½•æ—¶ï¼Œå®é™…ä¸Šè®°å½•å¹¶æ²¡æœ‰è¢«ç‰©ç†åˆ é™¤ï¼Œåªæ˜¯è®°å½•è¢«æ ‡è®°ï¼ˆflagedï¼‰ä¸ºåˆ é™¤å¹¶ä¸”å®ƒçš„ç©ºé—´<strong>å˜å¾—å…è®¸è¢«å…¶ä»–è®°å½•å£°æ˜ä½¿ç”¨</strong></p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%968.png" alt="image-20230918094328029"></p><p>å½“é¡µä¸­åˆ é™¤çš„è®°å½•è¾¾åˆ° MERGE_THRESHOLDï¼ˆé»˜è®¤ä¸ºé¡µçš„50%ï¼‰ï¼ŒInnoDBä¼šå¼€å§‹å¯»æ‰¾æœ€é è¿‘çš„é¡µï¼ˆå‰ æˆ–åï¼‰çœ‹çœ‹æ˜¯å¦å¯ä»¥<strong>å°†ä¸¤ä¸ªé¡µåˆå¹¶ä»¥ä¼˜åŒ–ç©ºé—´ä½¿ç”¨</strong></p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%969.png" alt="image-20230918094418506"></p><p>ä»¥ä¸Šå°±æ˜¯â€œé¡µåˆå¹¶â€ç°è±¡</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>æ»¡è¶³ä¸šåŠ¡éœ€æ±‚çš„æƒ…å†µä¸‹ï¼Œå°½é‡é™ä½ä¸»é”®çš„é•¿åº¦ã€‚</li><li>æ’å…¥æ•°æ®æ—¶ï¼Œå°½é‡é€‰æ‹©é¡ºåºæ’å…¥ï¼Œé€‰æ‹©ä½¿ç”¨AUTO_INCREMENTè‡ªå¢ä¸»é”®ã€‚</li><li>å°½é‡ä¸è¦ä½¿ç”¨UUIDåšä¸»é”®æˆ–è€…æ˜¯å…¶ä»–è‡ªç„¶ä¸»é”®ï¼Œå¦‚èº«ä»½è¯å·ã€‚</li><li>ä¸šåŠ¡æ“ä½œæ—¶ï¼Œé¿å…å¯¹ä¸»é”®çš„ä¿®æ”¹ã€‚</li></ol><h2 id="ğŸorder-byä¼˜åŒ–"><a href="#ğŸorder-byä¼˜åŒ–" class="headerlink" title="ğŸorder byä¼˜åŒ–"></a>ğŸorder byä¼˜åŒ–</h2><h3 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h3><p>æ’åºçš„æ–¹å¼ï¼š</p><blockquote><p>Using filesort : é€šè¿‡è¡¨çš„ç´¢å¼•æˆ–å…¨è¡¨æ‰«æï¼Œè¯»å–æ»¡è¶³æ¡ä»¶çš„æ•°æ®è¡Œï¼Œç„¶ååœ¨æ’åºç¼“å†²åŒºsort bufferä¸­å®Œæˆæ’åºæ“ä½œï¼Œæ‰€æœ‰ä¸æ˜¯é€šè¿‡ç´¢å¼•ç›´æ¥è¿”å›æ’åºç»“æœçš„æ’åºéƒ½å« FileSort æ’åºã€‚</p><p>Using index : é€šè¿‡æœ‰åºç´¢å¼•é¡ºåºæ‰«æç›´æ¥è¿”å›æœ‰åºæ•°æ®ï¼Œè¿™ç§æƒ…å†µå³ä¸º using indexï¼Œä¸éœ€è¦é¢å¤–æ’åºï¼Œæ“ä½œæ•ˆç‡é«˜ã€‚</p></blockquote><p>å¯¹äºä»¥ä¸Šçš„ä¸¤ç§æ’åºæ–¹å¼ï¼ŒUsing indexçš„æ€§èƒ½é«˜ï¼Œè€ŒUsing filesortçš„æ€§èƒ½ä½ï¼Œæˆ‘ä»¬åœ¨ä¼˜åŒ–æ’åºæ“ä½œæ—¶ï¼Œå°½é‡è¦ä¼˜åŒ–ä¸º <strong>Using index</strong></p><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ol><li>æ ¹æ®æ’åºå­—æ®µå»ºç«‹åˆé€‚çš„ç´¢å¼•ï¼Œå¤šå­—æ®µæ’åºæ—¶ï¼Œä¹Ÿéµå¾ª<strong>æœ€å·¦å‰ç¼€æ³•åˆ™</strong>ã€‚</li><li>å°½é‡ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚</li><li>å¤šå­—æ®µæ’åº, ä¸€ä¸ªå‡åºä¸€ä¸ªé™åºï¼Œæ­¤æ—¶éœ€è¦æ³¨æ„è”åˆç´¢å¼•åœ¨åˆ›å»ºæ—¶çš„<strong>è§„åˆ™</strong>ï¼ˆASC&#x2F;DESCï¼‰ã€‚</li></ol><p>â€‹åˆ›å»ºè”åˆç´¢å¼•(age å‡åºæ’åºï¼Œphone å€’åºæ’åº)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_user_age_phone_ad <span class="keyword">on</span> tb_user(age <span class="keyword">asc</span> ,phone <span class="keyword">desc</span>);</span><br></pre></td></tr></table></figure><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%9610.png" alt="image-20230918145133521"></p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%9611.png" alt="image-20230918145158669"></p><p>â€‹4.å¦‚æœä¸å¯é¿å…çš„å‡ºç°filesortï¼Œå¤§æ•°æ®é‡æ’åºæ—¶ï¼Œå¯ä»¥é€‚å½“å¢å¤§æ’åºç¼“å†²åŒºå¤§å°sort_buffer_size(é»˜è®¤256k)ã€‚</p><h2 id="ğŸgroup-byä¼˜åŒ–"><a href="#ğŸgroup-byä¼˜åŒ–" class="headerlink" title="ğŸgroup byä¼˜åŒ–"></a>ğŸgroup byä¼˜åŒ–</h2><ol><li>åœ¨åˆ†ç»„æ“ä½œæ—¶ï¼Œå¯ä»¥é€šè¿‡ç´¢å¼•æ¥æé«˜æ•ˆç‡ã€‚ </li><li>åˆ†ç»„æ“ä½œæ—¶ï¼Œç´¢å¼•çš„ä½¿ç”¨ä¹Ÿæ˜¯æ»¡è¶³æœ€å·¦å‰ç¼€æ³•åˆ™çš„ã€‚</li></ol><h2 id="ğŸlimitä¼˜åŒ–"><a href="#ğŸlimitä¼˜åŒ–" class="headerlink" title="ğŸlimitä¼˜åŒ–"></a>ğŸlimitä¼˜åŒ–</h2><h3 id="é—®é¢˜"><a href="#é—®é¢˜" class="headerlink" title="é—®é¢˜"></a>é—®é¢˜</h3><p>è¶Šå¾€åï¼Œåˆ†é¡µæŸ¥è¯¢æ•ˆç‡è¶Šä½ï¼Œè¿™æ˜¯åˆ†é¡µæŸ¥è¯¢çš„é—®é¢˜ã€‚</p><p>å½“åœ¨è¿›è¡Œåˆ†é¡µæŸ¥è¯¢æ—¶ï¼Œå¦‚æœæ‰§è¡Œ limit 2000000,10 ï¼Œæ­¤æ—¶éœ€è¦MySQLæ’åºå‰2000010 è®°å½•ï¼Œä»…ä»…è¿”å› 2000000 - 2000010 çš„è®°å½•ï¼Œå…¶ä»–è®°å½•ä¸¢å¼ƒï¼ŒæŸ¥è¯¢æ’åºçš„ä»£ä»·éå¸¸å¤§ã€‚</p><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p><strong>è¦†ç›–ç´¢å¼•åŠ å­æŸ¥è¯¢å½¢å¼</strong>è¿›è¡Œä¼˜åŒ–</p><blockquote><p>explain select * from tb_sku t , (select id from tb_sku order by id limit 2000000,10) a where t.id &#x3D; a.id;</p></blockquote><h2 id="ğŸcountä¼˜åŒ–"><a href="#ğŸcountä¼˜åŒ–" class="headerlink" title="ğŸcountä¼˜åŒ–"></a>ğŸcountä¼˜åŒ–</h2><p>count() æ˜¯ä¸€ä¸ªèšåˆå‡½æ•°ï¼Œå¯¹äºè¿”å›çš„ç»“æœé›†ï¼Œä¸€è¡Œè¡Œåœ°åˆ¤æ–­ï¼Œå¦‚æœ count å‡½æ•°çš„å‚æ•°<strong>ä¸æ˜¯ NULLï¼Œç´¯è®¡å€¼å°±åŠ  1</strong>ï¼Œå¦åˆ™ä¸åŠ ï¼Œæœ€å<strong>è¿”å›ç´¯è®¡å€¼</strong></p><p><img src="/img/43137/SQL%E4%BC%98%E5%8C%9612.png" alt="image-20230918150102423"></p><p>æ•ˆç‡æ’åºï¼šcount(å­—æ®µ) &lt; count(ä¸»é”® id) &lt; count(1) â‰ˆ count(âœ³)ï¼Œæ‰€ä»¥å°½ é‡ä½¿ç”¨ count(âœ³)ã€‚</p><h2 id="ğŸupdateä¼˜åŒ–"><a href="#ğŸupdateä¼˜åŒ–" class="headerlink" title="ğŸupdateä¼˜åŒ–"></a>ğŸupdateä¼˜åŒ–</h2><p>whereæ¡ä»¶åé¢å­—æ®µå°½é‡ç”¨ç´¢å¼•å­—æ®µï¼Œå¦åˆ™è¡Œé”ä¼šå‡çº§ä¸ºè¡¨é”</p><p>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹ç´¢å¼•åŠ çš„é”ï¼Œä¸æ˜¯é’ˆå¯¹è®°å½•åŠ çš„é” ,å¹¶ä¸”è¯¥ç´¢å¼•ä¸èƒ½å¤±æ•ˆï¼Œå¦åˆ™ä¼šä»è¡Œé”å‡çº§ä¸ºè¡¨é” ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL-MVCC</title>
      <link href="/posts/59324/"/>
      <url>/posts/59324/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><h3 id="1-å½“å‰è¯»"><a href="#1-å½“å‰è¯»" class="headerlink" title="1 å½“å‰è¯»"></a>1 å½“å‰è¯»</h3><blockquote><p>è¯»å–çš„æ˜¯è®°å½•çš„æœ€æ–°ç‰ˆæœ¬ï¼Œè¯»å–æ—¶è¿˜è¦ä¿è¯å…¶ä»–å¹¶å‘äº‹åŠ¡ä¸èƒ½ä¿®æ”¹å½“å‰è®°å½•ï¼Œä¼šå¯¹è¯»å–çš„è®°å½•è¿›è¡ŒåŠ é”ã€‚</p></blockquote><p>select â€¦ lock in share mode(å…±äº«é”)ï¼Œselect â€¦ for updateã€updateã€insertã€delete(æ’ä»–é”)éƒ½æ˜¯ä¸€ç§å½“å‰è¯»</p><h3 id="2-å¿«ç…§è¯»"><a href="#2-å¿«ç…§è¯»" class="headerlink" title="2 å¿«ç…§è¯»"></a>2 å¿«ç…§è¯»</h3><blockquote><p>ç®€å•çš„selectï¼ˆä¸åŠ é”ï¼‰å°±æ˜¯å¿«ç…§è¯»ï¼Œå¿«ç…§è¯»ï¼Œè¯»å–çš„æ˜¯è®°å½•æ•°æ®çš„å¯è§ç‰ˆæœ¬ï¼Œæœ‰å¯èƒ½æ˜¯å†å²æ•°æ®ï¼Œä¸åŠ é”ï¼Œæ˜¯éé˜»å¡è¯»ã€‚</p></blockquote><p>Read Committedï¼šæ¯æ¬¡selectï¼Œéƒ½ç”Ÿæˆä¸€ä¸ªå¿«ç…§è¯»ã€‚</p><p>Repeatable Readï¼šå¼€å¯äº‹åŠ¡åç¬¬ä¸€ä¸ªselectè¯­å¥æ‰æ˜¯å¿«ç…§è¯»çš„åœ°æ–¹ã€‚</p><p>Serializableï¼šå¿«ç…§è¯»ä¼šé€€åŒ–ä¸ºå½“å‰è¯»ã€‚</p><h3 id="3-MVCC"><a href="#3-MVCC" class="headerlink" title="3 MVCC"></a>3 MVCC</h3><blockquote><p>Multi-Version Concurrency Controlï¼Œå¤šç‰ˆæœ¬å¹¶å‘æ§åˆ¶ã€‚æŒ‡ç»´æŠ¤ä¸€ä¸ªæ•°æ®çš„å¤šä¸ªç‰ˆæœ¬ï¼Œ ä½¿å¾—è¯»å†™æ“ä½œæ²¡æœ‰å†²çªï¼Œå¿«ç…§è¯»ä¸ºMySQLå®ç°MVCCæä¾›äº†ä¸€ä¸ªéé˜»å¡è¯»åŠŸèƒ½ã€‚</p></blockquote><p>MVCCçš„å…·ä½“å®ç°ï¼Œä¾èµ–äºæ•°æ®åº“è®°å½•ä¸­çš„<strong>ä¸‰ä¸ªéšå¼å­—æ®µã€undo logæ—¥å¿—ã€readView</strong></p><h2 id="ğŸéšè—å­—æ®µ"><a href="#ğŸéšè—å­—æ®µ" class="headerlink" title="ğŸéšè—å­—æ®µ"></a>ğŸéšè—å­—æ®µ</h2><p>åˆ›å»ºè¡¨åï¼ŒInnoDBè¿˜ä¼šè‡ªåŠ¨çš„æ·»åŠ ä¸‰ä¸ªéšè—å­—æ®µï¼š</p><p><img src="/img/59324/MVCC1.png" alt="image-20230914152245645"></p><p>å‰ä¸¤ä¸ªå­—æ®µæ˜¯è‚¯å®šä¼šæ·»åŠ çš„ï¼Œ æ˜¯å¦æ·»åŠ æœ€åä¸€ä¸ªå­—æ®µDB_ROW_IDï¼Œå¾—çœ‹å½“å‰è¡¨æœ‰æ²¡æœ‰ä¸»é”®ï¼Œå¦‚æœæœ‰ä¸»é”®ï¼Œåˆ™ä¸ä¼šæ·»åŠ è¯¥éšè—å­—æ®µ</p><h2 id="ğŸundolog"><a href="#ğŸundolog" class="headerlink" title="ğŸundolog"></a>ğŸundolog</h2><h3 id="1-ä»‹ç»"><a href="#1-ä»‹ç»" class="headerlink" title="1 ä»‹ç»"></a>1 ä»‹ç»</h3><p>å›æ»šæ—¥å¿—ï¼Œåœ¨insertã€updateã€deleteçš„æ—¶å€™äº§ç”Ÿçš„ä¾¿äºæ•°æ®å›æ»šçš„æ—¥å¿—ã€‚<br>å½“<strong>insert</strong>çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—åªåœ¨å›æ»šæ—¶éœ€è¦ï¼Œåœ¨äº‹åŠ¡æäº¤åï¼Œå¯è¢«<strong>ç«‹å³åˆ é™¤</strong>ã€‚<br>è€Œ<strong>updateã€delete</strong>çš„æ—¶å€™ï¼Œäº§ç”Ÿçš„undo logæ—¥å¿—ä¸ä»…åœ¨å›æ»šæ—¶éœ€è¦ï¼Œåœ¨å¿«ç…§è¯»æ—¶ä¹Ÿéœ€è¦ï¼Œ<strong>ä¸ä¼šç«‹å³è¢«åˆ é™¤</strong></p><h3 id="2-ç‰ˆæœ¬é“¾"><a href="#2-ç‰ˆæœ¬é“¾" class="headerlink" title="2 ç‰ˆæœ¬é“¾"></a>2 ç‰ˆæœ¬é“¾</h3><p>åˆå§‹æœ‰ä¸€å¼ è¡¨æ ¼</p><img src="/img/59324/MVCC2.png" alt="image-20230914152848234" style="zoom:80%;" /><p>DB_TRX_ID : ä»£è¡¨æœ€è¿‘ä¿®æ”¹äº‹åŠ¡IDï¼Œè®°å½•æ’å…¥è¿™æ¡è®°å½•æˆ–æœ€åä¸€æ¬¡ä¿®æ”¹è¯¥è®°å½•çš„äº‹åŠ¡IDï¼Œæ˜¯è‡ªå¢çš„ã€‚<br>DB_ROLL_PTR ï¼š ç”±äºè¿™æ¡æ•°æ®æ˜¯æ‰æ’å…¥çš„ï¼Œæ²¡æœ‰è¢«æ›´æ–°è¿‡ï¼Œæ‰€ä»¥è¯¥å­—æ®µå€¼ä¸ºnullã€‚</p><p>å‡è®¾æœ‰å››ä¸ªå¹¶å‘äº‹åŠ¡è®¿é—®è¯¥è¡¨</p><p>(1)ç¬¬ä¸€æ­¥</p><p><img src="/img/59324/MVCC3.png" alt="image-20230914153054302"></p><p>å½“äº‹åŠ¡2æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¼šè®°å½•undo logæ—¥å¿—ï¼Œè®°å½•æ•°æ®å˜æ›´ä¹‹å‰çš„æ ·å­; </p><p>ç„¶åæ›´æ–°è®°å½•ï¼Œ å¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆï¼Œå›æ»šæŒ‡é’ˆç”¨æ¥æŒ‡å®šå¦‚æœå‘ç”Ÿå›æ»šï¼Œå›æ»šåˆ°å“ªä¸€ä¸ªç‰ˆæœ¬</p><p><img src="/img/59324/MVCC4.png" alt="image-20230914153149797"></p><p>(2)ç¬¬äºŒæ­¥</p><p><img src="/img/59324/MVCC5.png" alt="image-20230914153222905"></p><p>å½“äº‹åŠ¡3æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—; </p><p>ç„¶åæ›´æ–°è®°å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆ</p><p><img src="/img/59324/MVCC6.png" alt="image-20230914153309216"></p><p>(3)ç¬¬ä¸‰æ­¥</p><p><img src="/img/59324/MVCC7.png" alt="image-20230914153416045"></p><p>å½“äº‹åŠ¡4æ‰§è¡Œç¬¬ä¸€æ¡ä¿®æ”¹è¯­å¥æ—¶ï¼Œä¹Ÿä¼šè®°å½•undo logæ—¥å¿—; </p><p>ç„¶åæ›´æ–°è®°å½•ï¼Œå¹¶ä¸”è®°å½•æœ¬æ¬¡æ“ä½œçš„äº‹åŠ¡IDï¼Œå›æ»šæŒ‡é’ˆ</p><p><img src="/img/59324/MVCC8.png" alt="image-20230914153454702"></p><p>æœ€ç»ˆï¼Œä¸åŒäº‹åŠ¡æˆ–ç›¸åŒäº‹åŠ¡å¯¹åŒä¸€æ¡è®°å½•è¿›è¡Œä¿®æ”¹ï¼Œä¼šå¯¼è‡´è¯¥è®°å½•çš„undo logç”Ÿæˆä¸€æ¡<strong>è®°å½•ç‰ˆæœ¬é“¾è¡¨</strong>ï¼Œé“¾è¡¨çš„å¤´éƒ¨æ˜¯æœ€æ–°çš„æ—§è®°å½•ï¼Œé“¾è¡¨å°¾éƒ¨æ˜¯æœ€æ—©çš„æ—§è®°å½•</p><h2 id="ğŸreadview"><a href="#ğŸreadview" class="headerlink" title="ğŸreadview"></a>ğŸreadview</h2><blockquote><p>ReadViewï¼ˆè¯»è§†å›¾ï¼‰æ˜¯å¿«ç…§è¯»SQLæ‰§è¡Œæ—¶MVCCæå–æ•°æ®çš„ä¾æ®ï¼Œè®°å½•å¹¶ç»´æŠ¤ç³»ç»Ÿå½“å‰æ´»è·ƒçš„äº‹åŠ¡ ï¼ˆæœªæäº¤çš„ï¼‰id</p></blockquote><p>ReadViewä¸­åŒ…å«äº†å››ä¸ªæ ¸å¿ƒå­—æ®µï¼š</p><p><img src="/img/59324/MVCC9.png" alt="image-20230914160018273"></p><p>Readviewä¸­è§„å®šäº†ç‰ˆæœ¬é“¾æ•°æ®çš„è®¿é—®è§„åˆ™ï¼š</p><p>trx_id ä»£è¡¨å½“å‰undologç‰ˆæœ¬é“¾å¯¹åº”äº‹åŠ¡ID</p><p><img src="/img/59324/MVCC10.png" alt="image-20230914160209474"></p><p>ç”ŸæˆReadViewçš„æ—¶æœºä¸åŒï¼š </p><p>READ COMMITTED ï¼šåœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadView </p><p>REPEATABLE READï¼šä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨è¯¥ReadView</p><h2 id="ğŸåŸç†"><a href="#ğŸåŸç†" class="headerlink" title="ğŸåŸç†"></a>ğŸåŸç†</h2><h3 id="RCéš”ç¦»çº§åˆ«"><a href="#RCéš”ç¦»çº§åˆ«" class="headerlink" title="RCéš”ç¦»çº§åˆ«"></a>RCéš”ç¦»çº§åˆ«</h3><p>RCéš”ç¦»çº§åˆ«ä¸‹ï¼Œåœ¨äº‹åŠ¡ä¸­æ¯ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadView</p><p><strong>åˆ†æä¸Šä¾‹äº‹åŠ¡5ï¼š</strong></p><p>åœ¨äº‹åŠ¡5ä¸­ï¼ŒæŸ¥è¯¢äº†ä¸¤æ¬¡idä¸º30çš„è®°å½•ï¼Œç”±äºéš”ç¦»çº§åˆ«ä¸ºRead Committedï¼Œæ‰€ä»¥æ¯ä¸€æ¬¡è¿›è¡Œå¿«ç…§è¯»éƒ½ä¼šç”Ÿæˆä¸€ä¸ªReadViewï¼Œä¸¤æ¬¡ç”Ÿæˆçš„ReadViewå¦‚ä¸‹ï¼š</p><p><img src="/img/59324/MVCC11.png" alt="image-20230914162427358"></p><p>ä¸¤æ¬¡å¿«ç…§è¯»åœ¨è·å–æ•°æ®æ—¶ï¼Œå°±éœ€è¦æ ¹æ®æ‰€ç”Ÿæˆçš„ReadViewä»¥åŠReadViewçš„ç‰ˆæœ¬é“¾è®¿é—®è§„åˆ™ï¼Œåˆ°undologç‰ˆæœ¬é“¾ä¸­åŒ¹é…æ•°æ®ï¼Œæœ€ç»ˆå†³å®šæ­¤æ¬¡å¿«ç…§è¯»è¿”å›çš„æ•°æ®</p><p>1ã€å…ˆæ¥çœ‹ç¬¬ä¸€æ¬¡å¿«ç…§è¯»å…·ä½“çš„è¯»å–è¿‡ç¨‹ï¼š</p><p><img src="/img/59324/MVCC12.png" alt="image-20230914162920984"></p><p>å…ˆåŒ¹é…å·¦ä¾§çš„æ­£å¸¸è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„ trx_idä¸º4ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚ â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><p>å†åŒ¹é…0x00003è¿™æ¡è®°å½•ï¼Œå¯¹åº”çš„trx_idä¸º3ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿ ä¸æ»¡è¶³ ï¼Œéƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><p>å†åŒ¹é…0x00002è¿™æ¡è®°å½•ï¼Œå¯¹åº”çš„trx_idä¸º2ï¼Œä¹Ÿå°±æ˜¯å°†2å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡æ»¡è¶³ <strong>ç»ˆæ­¢åŒ¹é…</strong>ï¼Œæ­¤æ¬¡å¿«ç…§è¯»ï¼Œè¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®ã€‚</p><p>2ã€å†æ¥çœ‹ç¬¬äºŒæ¬¡å¿«ç…§è¯»å…·ä½“çš„è¯»å–è¿‡ç¨‹ï¼š</p><p><img src="/img/59324/MVCC13.png" alt="image-20230915214410722"></p><p>å…ˆåŒ¹é…å·¦ä¾§çš„æ­£å¸¸è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„ trx_idä¸º4ï¼Œä¹Ÿå°±æ˜¯å°†4å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚ â‘ ä¸æ»¡è¶³ â‘¡ä¸æ»¡è¶³ â‘¢ä¸æ»¡è¶³ â‘£ä¹Ÿä¸æ»¡è¶³ ï¼Œ éƒ½ä¸æ»¡è¶³ï¼Œåˆ™ç»§ç»­åŒ¹é…undo logç‰ˆæœ¬é“¾çš„ä¸‹ä¸€æ¡ã€‚</p><p>å†åŒ¹é…0x00003è¿™æ¡è®°å½•ï¼Œè¿™æ¡è®°å½•å¯¹åº”çš„trx_idä¸º3ï¼Œä¹Ÿå°±æ˜¯å°†3å¸¦å…¥å³ä¾§çš„åŒ¹é…è§„åˆ™ä¸­ã€‚â‘ ä¸æ»¡è¶³ â‘¡æ»¡è¶³ ã€‚ç»ˆæ­¢åŒ¹é…ï¼Œæ­¤æ¬¡ å¿«ç…§è¯»ï¼Œè¿”å›çš„æ•°æ®å°±æ˜¯ç‰ˆæœ¬é“¾ä¸­è®°å½•çš„è¿™æ¡æ•°æ®ã€‚</p><h3 id="RRéš”ç¦»çº§åˆ«"><a href="#RRéš”ç¦»çº§åˆ«" class="headerlink" title="RRéš”ç¦»çº§åˆ«"></a>RRéš”ç¦»çº§åˆ«</h3><p>RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œä»…åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡æ‰§è¡Œå¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­å¤ç”¨è¯¥ReadViewã€‚ è€ŒRR æ˜¯å¯é‡å¤è¯»ï¼Œ<strong>åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­ï¼Œæ‰§è¡Œä¸¤æ¬¡ç›¸åŒçš„selectè¯­å¥ï¼ŒæŸ¥è¯¢åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„</strong>ã€‚</p><p><img src="/img/59324/MVCC14.png" alt="image-20230915214939945"></p><p>åœ¨RRéš”ç¦»çº§åˆ«ä¸‹ï¼Œåªæ˜¯åœ¨äº‹åŠ¡ä¸­ç¬¬ä¸€æ¬¡å¿«ç…§è¯»æ—¶ç”ŸæˆReadViewï¼Œåç»­éƒ½æ˜¯å¤ç”¨è¯¥ ReadViewï¼Œé‚£ä¹ˆæ—¢ç„¶ReadViewéƒ½ä¸€æ ·ï¼Œ ReadViewçš„ç‰ˆæœ¬é“¾åŒ¹é…è§„åˆ™ä¹Ÿä¸€æ ·ï¼Œ é‚£ä¹ˆæœ€ç»ˆå¿«ç…§è¯»è¿”å›çš„ç»“æœä¹Ÿæ˜¯ä¸€æ ·çš„</p><h2 id="ğŸæ€»ç»“"><a href="#ğŸæ€»ç»“" class="headerlink" title="ğŸæ€»ç»“"></a>ğŸæ€»ç»“</h2><p>MVCC + é”ï¼Œå®ç°äº†äº‹åŠ¡çš„éš”ç¦»æ€§ã€‚ è€Œä¸€è‡´æ€§åˆ™æ˜¯ç”±redolog ä¸ undologä¿è¯</p><p><img src="/img/59324/MVCC15.png" alt="image-20230915215116732"></p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ConcurrentHashMap</title>
      <link href="/posts/58651/"/>
      <url>/posts/58651/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸConcurrentHashMap1-7"><a href="#ğŸConcurrentHashMap1-7" class="headerlink" title="ğŸConcurrentHashMap1.7"></a>ğŸConcurrentHashMap1.7</h2><h3 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><code>Segment(å¤§æ•°ç»„) + HashEntry(å°æ•°ç»„) + é“¾è¡¨</code>ï¼Œæ¯ä¸ª Segment å¯¹åº”ä¸€æŠŠé”ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®ä¸åŒçš„Segmentï¼Œåˆ™ä¸ä¼šå†²çª</p><h3 id="å¹¶å‘åº¦"><a href="#å¹¶å‘åº¦" class="headerlink" title="å¹¶å‘åº¦"></a>å¹¶å‘åº¦</h3><p><strong>Segment æ•°ç»„å¤§å°å³å¹¶å‘åº¦</strong>ï¼Œå†³å®šäº†åŒä¸€æ—¶åˆ»æœ€å¤šèƒ½æœ‰å¤šå°‘ä¸ªçº¿ç¨‹å¹¶å‘è®¿é—®ã€‚Segment æ•°ç»„<strong>ä¸èƒ½æ‰©å®¹</strong>ï¼Œæ„å‘³ç€å¹¶å‘åº¦åœ¨ ConcurrentHashMap åˆ›å»ºæ—¶å°±å›ºå®šäº†</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p><img src="/img/58651/CHM1.png" alt="image.png"></p><p>clevelä»£è¡¨<strong>å¹¶å‘åº¦</strong>ï¼Œcapacity&#x2F;clevel&#x3D;64&#x2F;8 &#x3D; 8ï¼Œä»£è¡¨<strong>æ¯ä¸ªSegment æ•°ç»„å¤§å°</strong></p><h3 id="ç´¢å¼•è®¡ç®—"><a href="#ç´¢å¼•è®¡ç®—" class="headerlink" title="ç´¢å¼•è®¡ç®—"></a>ç´¢å¼•è®¡ç®—</h3><ul><li>å‡è®¾å¤§æ•°ç»„é•¿åº¦æ˜¯2çš„mæ¬¡æ–¹ï¼Œkey åœ¨å¤§æ•°ç»„å†…çš„ç´¢å¼•æ˜¯ key çš„äºŒæ¬¡ hash å€¼çš„é«˜ m ä½</li><li>å‡è®¾å°æ•°ç»„é•¿åº¦æ˜¯2çš„næ¬¡æ–¹ï¼Œkey åœ¨å°æ•°ç»„å†…çš„ç´¢å¼•æ˜¯ key çš„äºŒæ¬¡ hash å€¼çš„ä½ n ä½</li></ul><h3 id="æ‰©å®¹"><a href="#æ‰©å®¹" class="headerlink" title="æ‰©å®¹"></a>æ‰©å®¹</h3><p>æ¯ä¸ªå°æ•°ç»„çš„æ‰©å®¹ç›¸å¯¹<strong>ç‹¬ç«‹</strong>ï¼Œå°æ•°ç»„åœ¨<strong>è¶…è¿‡</strong>æ‰©å®¹å› å­æ—¶ä¼šè§¦å‘æ‰©å®¹ï¼Œæ¯æ¬¡<strong>æ‰©å®¹ç¿»å€</strong></p><h3 id="Segment-0-åŸå‹"><a href="#Segment-0-åŸå‹" class="headerlink" title="Segment[0] åŸå‹"></a>Segment[0] åŸå‹</h3><p>é¦–æ¬¡åˆ›å»ºå…¶å®ƒå°æ•°ç»„æ—¶ï¼Œä¼š<strong>ä»¥æ­¤åŸå‹ä¸ºä¾æ®</strong>ï¼Œæ•°ç»„é•¿åº¦ï¼Œæ‰©å®¹å› å­éƒ½ä¼šä»¥åŸå‹ä¸ºå‡†ï¼ˆåŸå‹æ¨¡å¼ï¼‰</p><p><img src="/img/58651/CHM2.png" alt="image.png"></p><p>è¿™é‡Œçš„Segment[6]é¦–æ¬¡åˆ›å»ºæŒ‰ç…§Segment[0]çš„æ ‡å‡†ï¼Œå¤§å°ä¸º4</p><h2 id="ğŸConcurrentHashMap1-8"><a href="#ğŸConcurrentHashMap1-8" class="headerlink" title="ğŸConcurrentHashMap1.8"></a>ğŸConcurrentHashMap1.8</h2><h3 id="æ•°æ®ç»“æ„-1"><a href="#æ•°æ®ç»“æ„-1" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h3><p><code>Node æ•°ç»„ + é“¾è¡¨æˆ–çº¢é»‘æ ‘</code>ï¼Œæ•°ç»„çš„<strong>æ¯ä¸ªå¤´èŠ‚ç‚¹ä½œä¸ºé”</strong>ï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®çš„å¤´èŠ‚ç‚¹ä¸åŒï¼Œåˆ™ä¸ä¼šå†²çªã€‚é¦–æ¬¡ç”Ÿæˆå¤´èŠ‚ç‚¹æ—¶å¦‚æœå‘ç”Ÿç«äº‰ï¼Œåˆ©ç”¨ cas è€Œé syncronizedï¼Œè¿›ä¸€æ­¥æå‡æ€§èƒ½</p><h3 id="å¹¶å‘åº¦-1"><a href="#å¹¶å‘åº¦-1" class="headerlink" title="å¹¶å‘åº¦"></a>å¹¶å‘åº¦</h3><p><strong>Nodeæ•°ç»„æœ‰å¤šå¤§</strong>ï¼Œå¹¶å‘åº¦å°±æœ‰å¤šå¤§ï¼Œä¸ 1.7 ä¸åŒï¼Œ<strong>Node æ•°ç»„å¯ä»¥æ‰©å®¹</strong></p><h3 id="æ‰©å®¹æ¡ä»¶"><a href="#æ‰©å®¹æ¡ä»¶" class="headerlink" title="æ‰©å®¹æ¡ä»¶"></a>æ‰©å®¹æ¡ä»¶</h3><p>Node æ•°ç»„æ»¡ <strong>3&#x2F;4</strong> æ—¶å°±ä¼šæ‰©å®¹ï¼Œæ¯æ¬¡<strong>æ‰©å®¹ç¿»å€</strong></p><p><img src="/img/58651/CHM3.png" alt="image-20230913152614695"></p><p>è¿™é‡Œputä¼šç«‹å³æ‰©å®¹ï¼Œå®¹é‡ç¿»å€ä¸º32ï¼š</p><p><img src="/img/58651/CHM4.png" alt="image-20230913152704689"></p><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ul><li>ä¸ 1.7 ç›¸æ¯”æ˜¯<strong>æ‡’æƒ°åˆå§‹åŒ–</strong></li><li>capacity ä»£è¡¨<strong>é¢„ä¼°</strong>çš„å…ƒç´ ä¸ªæ•°ï¼Œcapacity &#x2F; factor æ¥è®¡ç®—å‡ºåˆå§‹æ•°ç»„å¤§å°ï¼Œéœ€è¦è´´è¿‘2^n</li><li>factor åªåœ¨è®¡ç®—åˆå§‹æ•°ç»„å¤§å°æ—¶è¢«ä½¿ç”¨ï¼Œä¹‹å<strong>æ‰©å®¹å›ºå®šä¸º 3&#x2F;4</strong></li><li>è¶…è¿‡æ ‘åŒ–é˜ˆå€¼æ—¶çš„æ‰©å®¹é—®é¢˜ï¼Œå¦‚æœå®¹é‡å·²ç»æ˜¯ 64ï¼Œç›´æ¥æ ‘åŒ–ï¼Œå¦åˆ™åœ¨åŸæ¥å®¹é‡åŸºç¡€ä¸Šåš <strong>3 è½®æ‰©å®¹</strong></li></ul><p><strong>ç¤ºä¾‹</strong></p><p><img src="/img/58651/CHM5.png" alt="image.png"></p><p><strong>é¢„ä¼°</strong>capacity12ä¸ªå…ƒç´ ï¼Œåˆå§‹åŒ–16å·²ç»è¶…è¿‡é˜ˆå€¼ï¼ˆ0.75ï¼‰ï¼Œå› æ­¤åˆå§‹åŒ–æ•°ç»„é•¿åº¦ä¸º32</p><p>å¦‚æœcapacityä¸º11ï¼Œåˆ™åˆå§‹åŒ–æ•°ç»„é•¿åº¦ä¸º16</p><h3 id="æ­£å¸¸æ‰©å®¹"><a href="#æ­£å¸¸æ‰©å®¹" class="headerlink" title="æ­£å¸¸æ‰©å®¹"></a>æ­£å¸¸æ‰©å®¹</h3><p>ä»¥é“¾è¡¨ä¸ºå•ä½<strong>ä»åå‘å‰</strong>è¿ç§»é“¾è¡¨ï¼Œè¿ç§»å®Œæˆçš„å°†æ—§æ•°ç»„å¤´èŠ‚ç‚¹æ›¿æ¢ä¸º <strong>ForwardingNode</strong></p><p><strong>ç¤ºä¾‹</strong></p><p>1.å¼€å§‹æ—¶ï¼Œå…ƒç´ ä¸ªæ•°12ä¸ª&#x3D;16Ã—0.75ï¼Œè§¦å‘æ‰©å®¹</p><img src="/img/58651/CHM6.png" alt="image-20230913153248107" style="zoom:80%;" /><p>2.<strong>ä»åå‘å‰</strong>è¿ç§»é“¾è¡¨ï¼Œè¿ç§»å®Œæˆçš„å°†æ—§æ•°ç»„å¤´èŠ‚ç‚¹æ›¿æ¢ä¸º <strong>ForwardingNode</strong></p><img src="/img/58651/CHM7.png" alt="image-20230913153436375" style="zoom:80%;" /><p>3.é‡æ–°è®¡ç®—ç´¢å¼•</p><img src="/img/58651/CHM8.png" alt="image-20230913153534408" style="zoom:80%;" /><p>4.è¿ç§»å®Œæ¯•</p><img src="/img/58651/CHM9.png" alt="image-20230913153625276" style="zoom:80%;" /><p><strong>æ€»ç»“</strong></p><p>å¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡ 1ï¼Œåˆ™éœ€è¦å¯¹èŠ‚ç‚¹è¿›è¡Œå¤åˆ¶ï¼ˆåˆ›å»ºæ–°èŠ‚ç‚¹ï¼‰ï¼Œæ€•çš„æ˜¯èŠ‚ç‚¹è¿ç§»å next æŒ‡é’ˆæ”¹å˜</p><p>â€‹æ¯”å¦‚ç¤ºä¾‹ä¸­ï¼šåŸæ•°ç»„10å·ä¸‹çš„é“¾è¡¨ï¼Œè½¬ä¸ºæ–°æ•°ç»„ä¸‹çš„10å·å’Œ26å·</p><p>å¦‚æœé“¾è¡¨æœ€åå‡ ä¸ªå…ƒç´ æ‰©å®¹åç´¢å¼•ä¸å˜ï¼Œåˆ™èŠ‚ç‚¹æ— éœ€å¤åˆ¶</p><p>â€‹æ¯”å¦‚ç¤ºä¾‹ä¸­ï¼šæ–°æ•°ç»„ä¸‹çš„26å·é“¾è¡¨çš„5-&gt;6</p><h3 id="å¹¶å‘æ‰©å®¹"><a href="#å¹¶å‘æ‰©å®¹" class="headerlink" title="å¹¶å‘æ‰©å®¹"></a>å¹¶å‘æ‰©å®¹</h3><h4 id="1-å¹¶å‘get"><a href="#1-å¹¶å‘get" class="headerlink" title="1 å¹¶å‘get"></a>1 å¹¶å‘get</h4><p>æ ¹æ®æ˜¯å¦ä¸º <strong>ForwardingNode</strong> æ¥å†³å®šæ˜¯åœ¨æ–°æ•°ç»„æŸ¥æ‰¾è¿˜æ˜¯åœ¨æ—§æ•°ç»„æŸ¥æ‰¾ï¼Œä¸ä¼šé˜»å¡</p><p><strong>ç¤ºä¾‹</strong></p><p><img src="/img/58651/CHM10.png" alt="image-20230913154241353"></p><p>æ­¤æ—¶æ—§çº¿ç¨‹åœ¨è¿ç§»ï¼Œæ–°çº¿ç¨‹get10å·Nodeä¼šè®¿é—®<strong>æ—§æ•°ç»„</strong></p><h4 id="2-å¹¶å‘put"><a href="#2-å¹¶å‘put" class="headerlink" title="2 å¹¶å‘put"></a>2 å¹¶å‘put</h4><p>å¦‚æœ put çš„çº¿ç¨‹ä¸æ‰©å®¹çº¿ç¨‹æ“ä½œçš„é“¾è¡¨æ˜¯<strong>åŒä¸€ä¸ª</strong>ï¼Œput çº¿ç¨‹ä¼šé˜»å¡<br>å¦‚æœ put çš„çº¿ç¨‹æ“ä½œçš„é“¾è¡¨è¿˜æœªè¿ç§»å®Œæˆï¼Œå³å¤´èŠ‚ç‚¹ä¸æ˜¯ ForwardingNodeï¼Œåˆ™å¯ä»¥<strong>ååŠ©æ‰©å®¹</strong><br>å¦‚æœ put çš„çº¿ç¨‹æ“ä½œçš„é“¾è¡¨å·²ç»è¿ç§»å®Œæˆï¼Œå³å¤´ç»“ç‚¹æ˜¯ ForwardingNodeï¼Œåˆ™å¯ä»¥å¹¶å‘æ‰§è¡Œ</p>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLçš„é”</title>
      <link href="/posts/49413/"/>
      <url>/posts/49413/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>æŒ‰ç…§é”çš„ç²’åº¦åˆ†ï¼Œåˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:</p><ol><li>å…¨å±€é”ï¼šé”å®šæ•°æ®åº“ä¸­çš„æ‰€æœ‰è¡¨ã€‚ </li><li>è¡¨çº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚ </li><li>è¡Œçº§é”ï¼šæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚</li></ol><h2 id="ğŸå…¨å±€é”"><a href="#ğŸå…¨å±€é”" class="headerlink" title="ğŸå…¨å±€é”"></a>ğŸå…¨å±€é”</h2><blockquote><p>å…¨å±€é”å°±æ˜¯å¯¹æ•´ä¸ªæ•°æ®åº“å®ä¾‹åŠ é”ï¼ŒåŠ é”åæ•´ä¸ªå®ä¾‹å°±å¤„äº<strong>åªè¯»çŠ¶æ€</strong>ï¼Œåç»­çš„DMLçš„å†™è¯­å¥ï¼ŒDDLè¯­å¥ï¼Œå·²ç»æ›´æ–°æ“ä½œçš„äº‹åŠ¡æäº¤è¯­å¥éƒ½å°†<strong>è¢«é˜»å¡</strong></p></blockquote><p>å…¸å‹çš„ä½¿ç”¨åœºæ™¯æ˜¯åšå…¨åº“çš„é€»è¾‘å¤‡ä»½ï¼Œå¯¹æ‰€æœ‰çš„è¡¨è¿›è¡Œé”å®šï¼Œä»è€Œè·å–ä¸€è‡´æ€§è§†å›¾ï¼Œ<strong>ä¿è¯æ•°æ®çš„å®Œæ•´æ€§</strong>ã€‚</p><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><p>1ï¼‰åŠ é”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flush tables <span class="keyword">with</span> read lock ;</span><br></pre></td></tr></table></figure><p>2ï¼‰æ•°æ®å¤‡ä»½</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysqldump  <span class="operator">-</span>uroot â€“p1234  itcast <span class="operator">&gt;</span> itcast.sql</span><br></pre></td></tr></table></figure><p>3ï¼‰é‡Šæ”¾é”</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unlock tables ;</span><br></pre></td></tr></table></figure><h3 id="ç‰¹ç‚¹"><a href="#ç‰¹ç‚¹" class="headerlink" title="ç‰¹ç‚¹"></a>ç‰¹ç‚¹</h3><ol><li>å¦‚æœåœ¨ä¸»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´éƒ½ä¸èƒ½æ‰§è¡Œæ›´æ–°ï¼Œä¸šåŠ¡åŸºæœ¬ä¸Šå°±å¾—åœæ‘† </li><li>å¦‚æœåœ¨ä»åº“ä¸Šå¤‡ä»½ï¼Œé‚£ä¹ˆåœ¨å¤‡ä»½æœŸé—´ä»åº“ä¸èƒ½æ‰§è¡Œä¸»åº“åŒæ­¥è¿‡æ¥çš„äºŒè¿›åˆ¶æ—¥å¿—ï¼ˆbinlogï¼‰ï¼Œä¼šå¯¼è‡´<strong>ä¸»ä»å»¶è¿Ÿ</strong></li></ol><h2 id="ğŸè¡¨çº§é”"><a href="#ğŸè¡¨çº§é”" class="headerlink" title="ğŸè¡¨çº§é”"></a>ğŸè¡¨çº§é”</h2><blockquote><p>è¡¨çº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½æ•´å¼ è¡¨ã€‚é”å®šç²’åº¦å¤§ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€é«˜ï¼Œå¹¶å‘åº¦æœ€ä½</p></blockquote><p>è¡¨çº§é”ï¼Œä¸»è¦åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»ï¼š</p><ol><li>è¡¨é”</li><li>å…ƒæ•°æ®é”ï¼ˆmeta data lockï¼ŒMDLï¼‰</li><li>æ„å‘é”</li></ol><h3 id="1-è¡¨é”"><a href="#1-è¡¨é”" class="headerlink" title="1 è¡¨é”"></a>1 è¡¨é”</h3><p>åˆ†ä¸ºä¸¤ç±»ï¼š è¡¨å…±äº«è¯»é”ï¼ˆread lockï¼‰å’Œ è¡¨ç‹¬å å†™é”ï¼ˆwrite lockï¼‰</p><h4 id="1-è¯­æ³•"><a href="#1-è¯­æ³•" class="headerlink" title="(1)è¯­æ³•"></a>(1)è¯­æ³•</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">åŠ é”ï¼šlock tables è¡¨å... read<span class="operator">/</span>write </span><br><span class="line"></span><br><span class="line">é‡Šæ”¾é”ï¼šunlock tables <span class="operator">/</span> å®¢æˆ·ç«¯æ–­å¼€è¿æ¥ </span><br></pre></td></tr></table></figure><h4 id="2-è¯»é”"><a href="#2-è¯»é”" class="headerlink" title="(2)è¯»é”"></a>(2)è¯»é”</h4><p><img src="/img/49413/%E8%A1%A8%E7%BA%A7%E8%AF%BB%E9%94%81.png" alt="image-20230910170550651"></p><p>å·¦ä¾§ä¸ºå®¢æˆ·ç«¯ä¸€ï¼Œå¯¹æŒ‡å®šè¡¨åŠ äº†è¯»é”ï¼Œä¸ä¼šå½±å“å³ä¾§å®¢æˆ·ç«¯äºŒçš„è¯»ï¼Œä½†æ˜¯ä¼šé˜»å¡å³ä¾§å®¢æˆ·ç«¯çš„å†™ã€‚</p><h4 id="3-å†™é”"><a href="#3-å†™é”" class="headerlink" title="(3)å†™é”"></a>(3)å†™é”</h4><p><img src="/img/49413/%E8%A1%A8%E7%BA%A7%E5%86%99%E9%94%81.png" alt="image-20230910170718587"></p><p>å·¦ä¾§ä¸ºå®¢æˆ·ç«¯ä¸€ï¼Œå¯¹æŒ‡å®šè¡¨åŠ äº†å†™é”ï¼Œä¼šé˜»å¡å³ä¾§å®¢æˆ·ç«¯çš„è¯»å’Œå†™</p><h4 id="4-ç»“è®º"><a href="#4-ç»“è®º" class="headerlink" title="(4)ç»“è®º"></a>(4)ç»“è®º</h4><p>è¯»é”<strong>ä¸ä¼šé˜»å¡å…¶ä»–å®¢æˆ·ç«¯çš„è¯»</strong>ï¼Œä½†æ˜¯ä¼š<strong>é˜»å¡å†™</strong>ï¼ˆåŒ…æ‹¬è‡ªå·±ï¼‰ã€‚</p><p>å†™é”<strong>æ—¢ä¼šé˜»å¡å…¶ä»–å®¢æˆ·ç«¯çš„è¯»ï¼Œåˆä¼šé˜»å¡å…¶ä»–å®¢æˆ·ç«¯çš„å†™</strong>ã€‚</p><h3 id="2-å…ƒæ•°æ®é”"><a href="#2-å…ƒæ•°æ®é”" class="headerlink" title="2 å…ƒæ•°æ®é”"></a>2 å…ƒæ•°æ®é”</h3><h4 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="(1)æ¦‚è¿°"></a>(1)æ¦‚è¿°</h4><blockquote><p>meta data lock , å…ƒæ•°æ®é”ï¼Œç®€å†™MDLã€‚ </p></blockquote><p>MDLåŠ é”è¿‡ç¨‹æ˜¯<strong>ç³»ç»Ÿè‡ªåŠ¨æ§åˆ¶</strong>ï¼Œæ— éœ€æ˜¾å¼ä½¿ç”¨ï¼Œåœ¨è®¿é—®ä¸€å¼ è¡¨çš„æ—¶å€™ä¼šè‡ªåŠ¨åŠ ä¸Šã€‚MDLé”ä¸»è¦ä½œç”¨æ˜¯ç»´æŠ¤è¡¨å…ƒæ•°æ®çš„æ•°æ®ä¸€è‡´æ€§ï¼Œåœ¨è¡¨ä¸Šæœ‰æ´»åŠ¨äº‹åŠ¡çš„æ—¶å€™ï¼Œä¸å¯ä»¥å¯¹å…ƒæ•°æ®è¿›è¡Œå†™å…¥æ“ä½œã€‚<strong>ä¸ºäº†é¿å…DMLä¸DDLå†²çªï¼Œä¿è¯è¯»å†™çš„æ­£ç¡®æ€§ã€‚</strong><br>å…ƒæ•°æ®ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºå°±æ˜¯ä¸€å¼ <strong>è¡¨çš„è¡¨ç»“æ„</strong>ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸä¸€å¼ è¡¨æ¶‰åŠåˆ°æœªæäº¤çš„äº‹åŠ¡æ—¶ï¼Œæ˜¯ä¸èƒ½å¤Ÿä¿®æ”¹è¿™å¼ è¡¨çš„è¡¨ç»“æ„çš„</p><h4 id="2-è¯­æ³•"><a href="#2-è¯­æ³•" class="headerlink" title="(2)è¯­æ³•"></a>(2)è¯­æ³•</h4><ol><li>å½“å¯¹ä¸€å¼ è¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„æ—¶å€™ï¼ŒåŠ MDLè¯»é”(å…±äº«)ï¼›</li><li>å½“å¯¹è¡¨ç»“æ„è¿›è¡Œå˜æ›´æ“ä½œçš„æ—¶å€™ï¼ŒåŠ MDLå†™é”(æ’ä»–)</li></ol><img src="/img/49413/è¡¨çº§å…ƒæ•°æ®é”.png" alt="image-20230910171525904" style="zoom:80%;" /><h3 id="3-æ„å‘é”"><a href="#3-æ„å‘é”" class="headerlink" title="3 æ„å‘é”"></a>3 æ„å‘é”</h3><h4 id="1-æ¦‚è¿°-1"><a href="#1-æ¦‚è¿°-1" class="headerlink" title="(1)æ¦‚è¿°"></a>(1)æ¦‚è¿°</h4><p>ä¸ºäº†é¿å…DMLåœ¨æ‰§è¡Œæ—¶ï¼ŒåŠ çš„è¡Œé”ä¸è¡¨é”çš„å†²çªï¼Œåœ¨InnoDBä¸­å¼•å…¥äº†æ„å‘é”ï¼Œä½¿å¾—è¡¨é”<strong>ä¸ç”¨æ£€æŸ¥æ¯è¡Œæ•°æ®æ˜¯å¦åŠ é”ï¼Œä½¿ç”¨æ„å‘é”æ¥å‡å°‘è¡¨é”çš„æ£€æŸ¥</strong></p><h4 id="2-ç¤ºä¾‹"><a href="#2-ç¤ºä¾‹" class="headerlink" title="(2)ç¤ºä¾‹"></a>(2)ç¤ºä¾‹</h4><p>é¦–å…ˆå®¢æˆ·ç«¯ä¸€ï¼Œå¼€å¯ä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åæ‰§è¡ŒDMLæ“ä½œï¼Œåœ¨æ‰§è¡ŒDMLè¯­å¥æ—¶ï¼Œä¼šå¯¹æ¶‰åŠåˆ°çš„è¡ŒåŠ è¡Œé”ï¼š</p><img src="/img/49413/è¡¨çº§æ„å‘é”1.png" alt="image-20230910171946046"  /><p>å®¢æˆ·ç«¯äºŒï¼Œæƒ³å¯¹è¿™å¼ è¡¨åŠ è¡¨é”æ—¶ï¼Œä¼šæ£€æŸ¥å½“å‰è¡¨æ˜¯å¦æœ‰å¯¹åº”çš„è¡Œé”ï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ·»åŠ è¡¨é”ï¼Œæ­¤æ—¶å°±ä¼šä»ç¬¬ä¸€è¡Œæ•°æ®ï¼Œæ£€æŸ¥åˆ°æœ€åä¸€è¡Œæ•°æ®ï¼Œæ•ˆç‡è¾ƒä½ï¼š</p><p><img src="/img/49413/%E8%A1%A8%E7%BA%A7%E6%84%8F%E5%90%91%E9%94%812.png" alt="image-20230910172037718"></p><p>æœ‰äº†æ„å‘é”ä¹‹åï¼Œå®¢æˆ·ç«¯ä¸€ï¼Œåœ¨æ‰§è¡ŒDMLæ“ä½œæ—¶ï¼Œä¼šå¯¹æ¶‰åŠçš„è¡ŒåŠ è¡Œé”ï¼ŒåŒæ—¶ä¹Ÿä¼šå¯¹è¯¥è¡¨åŠ ä¸Šæ„å‘é”ï¼š</p><p><img src="/img/49413/%E8%A1%A8%E7%BA%A7%E6%84%8F%E5%90%91%E9%94%813.png" alt="image-20230910172120609"></p><p>å…¶ä»–å®¢æˆ·ç«¯ï¼Œåœ¨å¯¹è¿™å¼ è¡¨åŠ è¡¨é”çš„æ—¶å€™ï¼Œä¼šæ ¹æ®è¯¥è¡¨ä¸Šæ‰€åŠ çš„æ„å‘é”æ¥åˆ¤å®šæ˜¯å¦å¯ä»¥æˆåŠŸåŠ è¡¨é”ï¼Œè€Œä¸ç”¨é€è¡Œåˆ¤æ–­è¡Œé”æƒ…å†µäº†ï¼š</p><p><img src="/img/49413/%E8%A1%A8%E7%BA%A7%E6%84%8F%E5%90%91%E9%94%814.png" alt="image-20230910172204744"></p><h4 id="3-åˆ†ç±»"><a href="#3-åˆ†ç±»" class="headerlink" title="(3)åˆ†ç±»"></a>(3)åˆ†ç±»</h4><ol><li>æ„å‘å…±äº«é”(IS): ç”±è¯­å¥select â€¦ lock in share modeæ·»åŠ  ã€‚ä¸è¡¨é”å…±äº«é”(read)å…¼å®¹ï¼Œä¸è¡¨é”æ’ä»–é”(write)äº’æ–¥ã€‚</li><li>æ„å‘æ’ä»–é”(IX): ç”±insertã€updateã€deleteã€selectâ€¦for updateæ·»åŠ  ã€‚ä¸è¡¨é”å…±äº«é”(read)åŠæ’ä»–é”(write)éƒ½äº’æ–¥ï¼Œæ„å‘é”ä¹‹é—´ä¸ä¼šäº’æ–¥</li></ol><p>ä¸€æ—¦äº‹åŠ¡æäº¤äº†ï¼Œæ„å‘å…±äº«é”ã€æ„å‘æ’ä»–é”ï¼Œéƒ½ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚</p><h2 id="ğŸè¡Œçº§é”"><a href="#ğŸè¡Œçº§é”" class="headerlink" title="ğŸè¡Œçº§é”"></a>ğŸè¡Œçº§é”</h2><blockquote><p>è¡Œçº§é”ï¼Œæ¯æ¬¡æ“ä½œé”ä½å¯¹åº”çš„è¡Œæ•°æ®ã€‚é”å®šç²’åº¦æœ€å°ï¼Œå‘ç”Ÿé”å†²çªçš„æ¦‚ç‡æœ€ä½ï¼Œå¹¶å‘åº¦æœ€é«˜ã€‚</p></blockquote><p>InnoDBçš„æ•°æ®æ˜¯åŸºäºç´¢å¼•ç»„ç»‡çš„ï¼Œè¡Œé”æ˜¯é€šè¿‡å¯¹ç´¢å¼•ä¸Šçš„<strong>ç´¢å¼•é¡¹åŠ é”</strong>æ¥å®ç°çš„ï¼Œè€Œä¸æ˜¯å¯¹è®°å½•åŠ çš„é”ã€‚</p><p>è¡Œçº§é”åˆ†ä¸‰ç±»ï¼š</p><p>1.è¡Œé”ï¼ˆRecord Lockï¼‰ï¼šé”å®šå•ä¸ªè¡Œè®°å½•çš„é”ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡å¯¹æ­¤è¡Œè¿›è¡Œupdateå’Œdeleteã€‚åœ¨RCã€RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒ</p><p><img src="/img/49413/%E8%A1%8C%E9%94%811.png" alt="image-20230911090211230"></p><p>2.é—´éš™é”ï¼ˆGap Lockï¼‰ï¼šé”å®šç´¢å¼•è®°å½•é—´éš™ï¼ˆ<strong>ä¸å«è¯¥è®°å½•</strong>ï¼‰ï¼Œç¡®ä¿ç´¢å¼•è®°å½•é—´éš™ä¸å˜ï¼Œé˜²æ­¢å…¶ä»–äº‹åŠ¡åœ¨è¿™ä¸ªé—´éš™è¿›è¡Œinsertï¼Œäº§ç”Ÿå¹»è¯»ã€‚åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒ</p><p><img src="/img/49413/%E8%A1%8C%E9%94%812.png" alt="image-20230911090320650"></p><p>3.ä¸´é”®é”ï¼ˆNext-Key Lockï¼‰ï¼šè¡Œé”å’Œé—´éš™é”ç»„åˆï¼ŒåŒæ—¶é”ä½æ•°æ®ï¼Œå¹¶é”ä½æ•°æ®å‰é¢çš„é—´éš™Gapã€‚ åœ¨RRéš”ç¦»çº§åˆ«ä¸‹æ”¯æŒ</p><p><img src="/img/49413/%E8%A1%8C%E9%94%813.png" alt="image-20230911090508607"></p><h3 id="1-è¡Œé”"><a href="#1-è¡Œé”" class="headerlink" title="1 è¡Œé”"></a>1 è¡Œé”</h3><h4 id="1-æ¦‚è¿°-2"><a href="#1-æ¦‚è¿°-2" class="headerlink" title="(1)æ¦‚è¿°"></a>(1)æ¦‚è¿°</h4><p>å…±äº«é”ï¼ˆSï¼‰ï¼šå…è®¸ä¸€ä¸ªäº‹åŠ¡å»è¯»ä¸€è¡Œï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„æ’å®ƒé”<br>æ’ä»–é”ï¼ˆXï¼‰ï¼šå…è®¸è·å–æ’ä»–é”çš„äº‹åŠ¡æ›´æ–°æ•°æ®ï¼Œé˜»æ­¢å…¶ä»–äº‹åŠ¡è·å¾—ç›¸åŒæ•°æ®é›†çš„å…±äº«é”å’Œæ’ä»–é”</p><p><img src="/img/49413/%E8%A1%8C%E9%94%814.png" alt="image-20230911091213397"></p><h4 id="2-ç‰¹ç‚¹"><a href="#2-ç‰¹ç‚¹" class="headerlink" title="(2)ç‰¹ç‚¹"></a>(2)ç‰¹ç‚¹</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ <strong>next-key é”</strong>è¿›è¡Œæœç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</p><ul><li>é’ˆå¯¹å”¯ä¸€ç´¢å¼•è¿›è¡Œæ£€ç´¢æ—¶ï¼Œå¯¹å·²å­˜åœ¨çš„è®°å½•è¿›è¡Œç­‰å€¼åŒ¹é…æ—¶ï¼Œå°†ä¼šè‡ªåŠ¨ä¼˜åŒ–ä¸ºè¡Œé”ã€‚</li><li>InnoDBçš„è¡Œé”æ˜¯é’ˆå¯¹äºç´¢å¼•åŠ çš„é”ï¼Œä¸é€šè¿‡ç´¢å¼•æ¡ä»¶æ£€ç´¢æ•°æ®ï¼Œé‚£ä¹ˆInnoDBå°†å¯¹è¡¨ä¸­çš„æ‰€æœ‰è®°å½•åŠ é”ï¼Œæ­¤æ—¶å°±ä¼šå‡çº§ä¸ºè¡¨é”</li></ul><h3 id="2-é—´éš™é”-amp-ä¸´é”®é”"><a href="#2-é—´éš™é”-amp-ä¸´é”®é”" class="headerlink" title="2 é—´éš™é”&amp;ä¸´é”®é”"></a>2 é—´éš™é”&amp;ä¸´é”®é”</h3><h4 id="1-ç‰¹ç‚¹"><a href="#1-ç‰¹ç‚¹" class="headerlink" title="(1)ç‰¹ç‚¹"></a>(1)ç‰¹ç‚¹</h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒInnoDBåœ¨ REPEATABLE READäº‹åŠ¡éš”ç¦»çº§åˆ«è¿è¡Œï¼ŒInnoDBä½¿ç”¨ next-key é”è¿›è¡Œæœ<br>ç´¢å’Œç´¢å¼•æ‰«æï¼Œä»¥é˜²æ­¢å¹»è¯»ã€‚</p><ul><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)ï¼Œç»™ä¸å­˜åœ¨çš„è®°å½•åŠ é”æ—¶, ä¼˜åŒ–ä¸ºé—´éš™é” ã€‚</li><li>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(éå”¯ä¸€æ™®é€šç´¢å¼•)ï¼Œå‘å³éå†æ—¶æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œnext-key lock é€€åŒ–ä¸ºé—´éš™é”ã€‚</li><li>ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)â€“ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢</li></ul><p>é—´éš™é”å”¯ä¸€ç›®çš„æ˜¯<strong>é˜²æ­¢å…¶ä»–äº‹åŠ¡æ’å…¥é—´éš™</strong>ã€‚é—´éš™é”å¯ä»¥å…±å­˜ï¼Œä¸€ä¸ªäº‹åŠ¡é‡‡ç”¨çš„é—´éš™é”ä¸ä¼š é˜»æ­¢å¦ä¸€ä¸ªäº‹åŠ¡åœ¨åŒä¸€é—´éš™ä¸Šé‡‡ç”¨é—´éš™é”</p><h4 id="2-ç¤ºä¾‹-1"><a href="#2-ç¤ºä¾‹-1" class="headerlink" title="(2)ç¤ºä¾‹"></a>(2)ç¤ºä¾‹</h4><p><strong>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)ï¼Œç»™ä¸å­˜åœ¨çš„è®°å½•åŠ é”æ—¶, ä¼˜åŒ–ä¸ºé—´éš™é”</strong></p><p><img src="/img/49413/%E9%97%B4%E9%9A%99%E9%94%811.png" alt="image-20230911092149446"></p><p><strong>ç´¢å¼•ä¸Šçš„ç­‰å€¼æŸ¥è¯¢(éå”¯ä¸€æ™®é€šç´¢å¼•)ï¼Œå‘å³éå†æ—¶æœ€åä¸€ä¸ªå€¼ä¸æ»¡è¶³æŸ¥è¯¢éœ€æ±‚æ—¶ï¼Œnext-key  lock é€€åŒ–ä¸ºé—´éš™é”</strong></p><p><img src="/img/49413/%E9%97%B4%E9%9A%99%E9%94%812.png" alt="image-20230911092425766"></p><p>è¦æ ¹æ®è¿™ä¸ªäºŒçº§ç´¢å¼•æŸ¥è¯¢å€¼ä¸º18çš„æ•°æ®ï¼Œå¹¶åŠ ä¸Šå…±äº«é”ï¼Œåªé”å®š18è¿™ä¸€è¡Œå°±å¯ä»¥äº†å—ï¼Ÿ å¹¶ä¸æ˜¯ï¼Œå› ä¸ºæ˜¯éå”¯ä¸€ç´¢å¼•ï¼Œè¿™ä¸ªç»“æ„ä¸­å¯èƒ½æœ‰å¤šä¸ª18çš„å­˜åœ¨ï¼Œæ‰€ä»¥ï¼Œåœ¨åŠ é”æ—¶ä¼šç»§ç»­å¾€åæ‰¾ï¼Œæ‰¾åˆ°ä¸€ä¸ªä¸æ»¡è¶³æ¡ä»¶çš„å€¼ï¼ˆå½“å‰æ¡ˆä¾‹ä¸­ä¹Ÿ å°±æ˜¯29ï¼‰ã€‚æ­¤æ—¶ä¼šå¯¹18åŠ ä¸´é”®é”ï¼Œå¹¶å¯¹29ä¹‹å‰çš„é—´éš™åŠ é”</p><p><img src="/img/49413/%E9%97%B4%E9%9A%99%E9%94%813.png" alt="image-20230911092701785"></p><p><strong>ç´¢å¼•ä¸Šçš„èŒƒå›´æŸ¥è¯¢(å”¯ä¸€ç´¢å¼•)â€“ä¼šè®¿é—®åˆ°ä¸æ»¡è¶³æ¡ä»¶çš„ç¬¬ä¸€ä¸ªå€¼ä¸ºæ­¢</strong></p><p><img src="/img/49413/%E9%97%B4%E9%9A%99%E9%94%814.png" alt="image-20230911092741310"></p><p>æŸ¥è¯¢çš„æ¡ä»¶ä¸ºid&gt;&#x3D;19ï¼Œå¹¶æ·»åŠ å…±äº«é”ã€‚ æ­¤æ—¶å¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ä¸­ç°æœ‰çš„æ•°æ®ï¼Œå°†æ•°æ®åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š<br>[19](19,25](25,+âˆ]<br>æ‰€ä»¥æ•°æ®åº“æ•°æ®åœ¨åŠ é”æ˜¯ï¼Œå°±æ˜¯å°†19åŠ äº†è¡Œé”ï¼Œ25çš„ä¸´é”®é”ï¼ˆåŒ…å«25åŠ25ä¹‹å‰çš„é—´éš™ï¼‰ï¼Œæ­£æ— ç©·çš„ä¸´é”®é”(æ­£æ— ç©·åŠä¹‹å‰çš„é—´éš™)</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ’åºç®—æ³•</title>
      <link href="/posts/61237/"/>
      <url>/posts/61237/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ€»è§ˆ"><a href="#ğŸæ€»è§ˆ" class="headerlink" title="ğŸæ€»è§ˆ"></a>ğŸæ€»è§ˆ</h2><img src="/img/61237/æ’åº1.png" alt="æ’åº1" style="zoom:80%;" /><p>å¯¹æ•°é˜¶ï¼šå¿«é€Ÿæ’åºã€å †æ’åºå’Œå½’å¹¶æ’åº</p><p>ä¸ç¨³å®šï¼šé€‰æ‹©æ’åºã€å¿«é€Ÿæ’åºã€å¸Œå°”æ’åºã€å †æ’åº</p><h2 id="ğŸå†’æ³¡æ’åº"><a href="#ğŸå†’æ³¡æ’åº" class="headerlink" title="ğŸå†’æ³¡æ’åº"></a>ğŸå†’æ³¡æ’åº</h2><h3 id="æ­¥éª¤"><a href="#æ­¥éª¤" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ª</li><li>å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚è¿™æ­¥åšå®Œåï¼Œæœ€åçš„å…ƒç´ ä¼šæ˜¯æœ€å¤§çš„æ•°</li><li>é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ª</li><li>æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒ</li></ol><p><img src="/img/61237/%E6%8E%92%E5%BA%8F2.png" alt="æ’åº2"></p><h3 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾…åŠ©äº¤æ¢å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">    array[i] = array[j];</span><br><span class="line">    array[j] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">bubble</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">swapped</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;j &lt; a.length-<span class="number">1</span>;j++)&#123;</span><br><span class="line">        swapped = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i &lt; a.length-j-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span>(a[i]&gt;a[i+<span class="number">1</span>])&#123;</span><br><span class="line">            swap(a,i,i+<span class="number">1</span>);</span><br><span class="line">                swapped = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(!swapped)&#123; <span class="comment">//æ²¡æœ‰å‘ç”Ÿäº¤æ¢ï¼Œé€€å‡ºå¾ªç¯</span></span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé€‰æ‹©æ’åº"><a href="#ğŸé€‰æ‹©æ’åº" class="headerlink" title="ğŸé€‰æ‹©æ’åº"></a>ğŸé€‰æ‹©æ’åº</h2><h3 id="æ­¥éª¤-1"><a href="#æ­¥éª¤-1" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>é¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®</li><li>å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</li><li>é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•</li></ol><p><img src="/img/61237/%E6%8E%92%E5%BA%8F3.png" alt="æ’åº3"></p><h3 id="ä»£ç -1"><a href="#ä»£ç -1" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">selection</span><span class="params">(<span class="type">int</span>[] a)</span> &#123;</span><br><span class="line">    <span class="comment">// 1. é€‰æ‹©è½®æ•° a.length - 1</span></span><br><span class="line">    <span class="comment">// 2. äº¤æ¢çš„ç´¢å¼•ä½ç½®(right) åˆå§‹ a.length - 1, æ¯æ¬¡é€’å‡</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> a.length - <span class="number">1</span>; right &gt; <span class="number">0</span> ; right--) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> right;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; right; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] &gt; a[max]) &#123;</span><br><span class="line">                max = i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(max != right) &#123;</span><br><span class="line">            swap(a, max, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸæ’å…¥æ’åº"><a href="#ğŸæ’å…¥æ’åº" class="headerlink" title="ğŸæ’å…¥æ’åº"></a>ğŸæ’å…¥æ’åº</h2><h3 id="æ­¥éª¤-2"><a href="#æ­¥éª¤-2" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><p>1.å°†æ•°ç»„åˆ†ä¸ºä¸¤éƒ¨åˆ† [0 .. low-1]  [low .. a.length-1]</p><ul><li>å·¦è¾¹ [0 .. low-1] æ˜¯å·²æ’åºéƒ¨åˆ†</li><li>å³è¾¹ [low .. a.length-1] æ˜¯æœªæ’åºéƒ¨åˆ†</li></ul><p>2.æ¯æ¬¡ä»æœªæ’åºåŒºåŸŸå–å‡º low ä½ç½®çš„å…ƒç´ , æ’å…¥åˆ°å·²æ’åºåŒºåŸŸ</p><p><img src="/img/61237/%E6%8E%92%E5%BA%8F4.png" alt="æ’åº4"></p><h3 id="ä»£ç -2"><a href="#ä»£ç -2" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> <span class="number">1</span>; low &lt; a.length; low++) &#123;</span><br><span class="line">        <span class="comment">// å°† low ä½ç½®çš„å…ƒç´ æ’å…¥è‡³ [0..low-1] çš„å·²æ’åºåŒºåŸŸ</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[low];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low - <span class="number">1</span>; <span class="comment">// å·²æ’åºåŒºåŸŸæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; t &lt; a[i]) &#123; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">            a[i + <span class="number">1</span>] = a[i]; <span class="comment">// ç©ºå‡ºæ’å…¥ä½ç½®</span></span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">        <span class="keyword">if</span> (i != low - <span class="number">1</span>) &#123;</span><br><span class="line">            a[i + <span class="number">1</span>] = t;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå¸Œå°”æ’åº"><a href="#ğŸå¸Œå°”æ’åº" class="headerlink" title="ğŸå¸Œå°”æ’åº"></a>ğŸå¸Œå°”æ’åº</h2><h3 id="æ­¥éª¤-3"><a href="#æ­¥éª¤-3" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ— t1ï¼Œt2ï¼Œâ€¦â€¦ï¼Œtkï¼Œå…¶ä¸­ ti &gt; tj, tk &#x3D; 1ï¼›</li><li>æŒ‰å¢é‡åºåˆ—ä¸ªæ•° kï¼Œå¯¹åºåˆ—è¿›è¡Œ k è¶Ÿæ’åºï¼›</li><li>æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡ tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸º m çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º 1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚</li></ol><p><img src="/img/61237/%E6%8E%92%E5%BA%8F5.png" alt="æ’åº5"></p><h3 id="ä»£ç -3"><a href="#ä»£ç -3" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">shell</span><span class="params">(<span class="type">int</span>[] a)</span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">gap</span> <span class="operator">=</span> a.length&gt;&gt;<span class="number">1</span>; gap &gt;<span class="number">0</span> ; gap=gap&gt;&gt;<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">low</span> <span class="operator">=</span> gap; low &lt; a.length; low ++) &#123;</span><br><span class="line">            <span class="comment">// å°† low ä½ç½®çš„å…ƒç´ æ’å…¥è‡³ [0..low-1] çš„å·²æ’åºåŒºåŸŸ</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[low];</span><br><span class="line">            <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low - gap; <span class="comment">// å·²æ’åºåŒºåŸŸæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (i &gt;= <span class="number">0</span> &amp;&amp; t &lt; a[i]) &#123; <span class="comment">// æ²¡æœ‰æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">                a[i + gap] = a[i]; <span class="comment">// ç©ºå‡ºæ’å…¥ä½ç½®</span></span><br><span class="line">                i -= gap;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰¾åˆ°æ’å…¥ä½ç½®</span></span><br><span class="line">            <span class="keyword">if</span> (i != low - gap) &#123;</span><br><span class="line">                a[i + gap] = t;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰"><a href="#ğŸå¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰" class="headerlink" title="ğŸå¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰"></a>ğŸå¿«é€Ÿæ’åºï¼ˆé‡è¦ï¼‰</h2><h3 id="æ­¥éª¤-åŒè¾¹å¾ªç¯æ–¹æ¡ˆ"><a href="#æ­¥éª¤-åŒè¾¹å¾ªç¯æ–¹æ¡ˆ" class="headerlink" title="æ­¥éª¤(åŒè¾¹å¾ªç¯æ–¹æ¡ˆ)"></a>æ­¥éª¤(åŒè¾¹å¾ªç¯æ–¹æ¡ˆ)</h3><p>1.é€‰æ‹©æœ€å·¦ä¾§å…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹</p><p>2.j æ‰¾æ¯”åŸºå‡†ç‚¹å°çš„ï¼Œi æ‰¾æ¯”åŸºå‡†ç‚¹å¤§çš„ï¼Œä¸€æ—¦æ‰¾åˆ°ï¼ŒäºŒè€…è¿›è¡Œäº¤æ¢</p><ul><li>i ä»å·¦å‘å³</li><li>j ä»å³å‘å·¦</li></ul><p>3.æœ€ååŸºå‡†ç‚¹ä¸ i äº¤æ¢ï¼Œi å³ä¸ºåŸºå‡†ç‚¹æœ€ç»ˆç´¢å¼•</p><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>i æ‰¾åˆ°æ¯”åŸºå‡†ç‚¹å¤§çš„5åœä¸‹æ¥ï¼Œj æ‰¾åˆ°æ¯”åŸºå‡†ç‚¹å°çš„1åœä¸‹æ¥ï¼ˆåŒ…å«ç­‰äºï¼‰ï¼ŒäºŒè€…äº¤æ¢</p><p><img src="/img/61237/%E5%BF%AB%E6%8E%921.png" alt="å¿«æ’1"></p><p>i æ‰¾åˆ°8ï¼Œj æ‰¾åˆ°3ï¼ŒäºŒè€…äº¤æ¢ï¼Œi æ‰¾åˆ°7ï¼Œj æ‰¾åˆ°2ï¼ŒäºŒè€…äº¤æ¢</p><p><img src="/img/61237/%E5%BF%AB%E6%8E%922.png" alt="å¿«æ’2"></p><p>i &#x3D;&#x3D; jï¼Œé€€å‡ºå¾ªç¯ï¼ŒåŸºå‡†ç‚¹ä¸ i äº¤æ¢</p><p><img src="/img/61237/%E5%BF%AB%E6%8E%923.png" alt="å¿«æ’3"></p><h3 id="ä»£ç -4"><a href="#ä»£ç -4" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= h)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> partition(a,l,h);</span><br><span class="line">    quick(a,l,p-<span class="number">1</span>);</span><br><span class="line">    quick(a,p+<span class="number">1</span>,h);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pv</span> <span class="operator">=</span> a[l]; <span class="comment">//åŸºå‡†ç‚¹å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> h;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">        <span class="comment">// j ä»å³æ‰¾å°çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[j] &gt; pv)&#123;</span><br><span class="line">            j -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// i ä»å·¦æ‰¾å¤§çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[i] &lt;= pv)&#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    swap(a,i,j);   </span><br><span class="line">    &#125;</span><br><span class="line">    swap(a,l,j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><p>åŸºå‡†ç‚¹åœ¨å·¦è¾¹ï¼Œå¹¶ä¸”è¦å…ˆ j å i </p><p>while( i &lt; j &amp;&amp; a[j] &gt; pv ) jâ€“ </p><p>while ( i &lt; j &amp;&amp; a[i] &lt;&#x3D; pv ) i++ </p><h2 id="ğŸå½’å¹¶æ’åº"><a href="#ğŸå½’å¹¶æ’åº" class="headerlink" title="ğŸå½’å¹¶æ’åº"></a>ğŸå½’å¹¶æ’åº</h2><h3 id="æ­¥éª¤-4"><a href="#æ­¥éª¤-4" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>åˆ† - æ¯æ¬¡ä»ä¸­é—´åˆ‡ä¸€åˆ€ï¼Œå¤„ç†çš„æ•°æ®å°‘ä¸€åŠ</li><li>æ²» - å½“æ•°æ®ä»…å‰©ä¸€ä¸ªæ—¶å¯ä»¥è®¤ä¸ºæœ‰åº</li><li>åˆ - ä¸¤ä¸ªæœ‰åºçš„ç»“æœï¼Œå¯ä»¥è¿›è¡Œåˆå¹¶æ’åº</li></ol><p><img src="/img/61237/%E6%8E%92%E5%BA%8F6.png" alt="æ’åº6"></p><h3 id="ä»£ç -5"><a href="#ä»£ç -5" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MergeSortTopDown</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        a1 åŸå§‹æ•°ç»„</span></span><br><span class="line"><span class="comment">        i~iEnd ç¬¬ä¸€ä¸ªæœ‰åºèŒƒå›´</span></span><br><span class="line"><span class="comment">        j~jEnd ç¬¬äºŒä¸ªæœ‰åºèŒƒå›´</span></span><br><span class="line"><span class="comment">        a2 ä¸´æ—¶æ•°ç»„</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] a1, <span class="type">int</span> i, <span class="type">int</span> iEnd, <span class="type">int</span> j, <span class="type">int</span> jEnd, <span class="type">int</span>[] a2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> i;</span><br><span class="line">        <span class="keyword">while</span> (i &lt;= iEnd &amp;&amp; j &lt;= jEnd) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a1[i] &lt; a1[j]) &#123;</span><br><span class="line">                a2[k] = a1[i];</span><br><span class="line">                i++;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                a2[k] = a1[j];</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; iEnd) &#123;</span><br><span class="line">            System.arraycopy(a1, j, a2, k, jEnd - j + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (j &gt; jEnd) &#123;</span><br><span class="line">            System.arraycopy(a1, i, a2, k, iEnd - i + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a1)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] a2 = <span class="keyword">new</span> <span class="title class_">int</span>[a1.length];</span><br><span class="line">        split(a1, <span class="number">0</span>, a1.length - <span class="number">1</span>, a2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">split</span><span class="params">(<span class="type">int</span>[] a1, <span class="type">int</span> left, <span class="type">int</span> right, <span class="type">int</span>[] a2)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] array = Arrays.copyOfRange(a1, left, right + <span class="number">1</span>);</span><br><span class="line"><span class="comment">//        System.out.println(Arrays.toString(array));</span></span><br><span class="line">        <span class="comment">// 2. æ²»</span></span><br><span class="line">        <span class="keyword">if</span> (left == right) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1. åˆ†</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> (left + right) &gt;&gt;&gt; <span class="number">1</span>;</span><br><span class="line">        split(a1, left, m, a2);                 <span class="comment">// left = 0 m = 0  9</span></span><br><span class="line">        split(a1, m + <span class="number">1</span>, right, a2);       <span class="comment">// m+1 = 1 right = 1  3</span></span><br><span class="line">        <span class="comment">// 3. åˆ</span></span><br><span class="line">        merge(a1, left, m, m + <span class="number">1</span>, right, a2);</span><br><span class="line">        System.arraycopy(a2, left, a1, left, right - left + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] a = &#123;<span class="number">9</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">4</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(a));</span><br><span class="line">        sort(a);</span><br><span class="line">        System.out.println(Arrays.toString(a));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå †æ’åº"><a href="#ğŸå †æ’åº" class="headerlink" title="ğŸå †æ’åº"></a>ğŸå †æ’åº</h2><h3 id="è¯´æ˜"><a href="#è¯´æ˜" class="headerlink" title="è¯´æ˜"></a>è¯´æ˜</h3><p>å †é€»è¾‘ä¸Šæ˜¯<strong>å®Œå…¨äºŒå‰æ ‘</strong>ï¼Œå †ä¸­æŸä¸ªèŠ‚ç‚¹çš„å€¼æ€»æ˜¯<strong>ä¸å¤§äºæˆ–ä¸å°äºå…¶çˆ¶èŠ‚ç‚¹</strong>çš„å€¼ï¼›å®ç°ä¸Šå¯ä»¥é€‰æ‹©<strong>æ•°ç»„</strong></p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F1.png" alt="å †æ’åº1"></p><p>å †åŒ–æ­¥éª¤ï¼š</p><ol><li>æ‰¾åˆ°æœ€åä¸€ä¸ªéå¶å­èŠ‚ç‚¹</li><li>ä»åå‘å‰ï¼Œå¯¹æ¯ä¸ªèŠ‚ç‚¹æ‰§è¡Œ<strong>ä¸‹æ½œ</strong></li></ol><p>è§„å¾‹ï¼š</p><ul><li>ä¸€æ£µæ»¡äºŒå‰æ ‘èŠ‚ç‚¹ä¸ªæ•°ä¸º 2^h-1ï¼Œå¦‚ä¸Šä¾‹ä¸­é«˜åº¦ h&#x3D;3 èŠ‚ç‚¹æ•°æ˜¯ 2^3-1&#x3D;7</li><li>éå¶å­èŠ‚ç‚¹èŒƒå›´ä¸º [0, size&#x2F;2-1]</li></ul><h3 id="æ­¥éª¤-5"><a href="#æ­¥éª¤-5" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>å»ºç«‹å¤§é¡¶å †</li><li>æ¯æ¬¡å°†å †é¡¶å…ƒç´ ï¼ˆæœ€å¤§å€¼ï¼‰äº¤æ¢åˆ°æœ«å°¾ï¼Œè°ƒæ•´å †é¡¶å…ƒç´ ï¼Œè®©å®ƒé‡æ–°ç¬¦åˆå¤§é¡¶å †ç‰¹æ€§</li></ol><h3 id="ç¤ºä¾‹-1"><a href="#ç¤ºä¾‹-1" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>å»ºå †<img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F2.png" alt="å †æ’åº2"></p><p>äº¤æ¢ï¼Œä¸‹æ½œè°ƒæ•´</p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F3.png" alt="å †æ’åº3"></p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F4.png" alt="å †æ’åº4"></p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F5.png" alt="å †æ’åº5"></p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F6.png" alt="å †æ’åº6"></p><p><img src="/img/61237/%E5%A0%86%E6%8E%92%E5%BA%8F7.png" alt="å †æ’åº7"></p><h3 id="ä»£ç -6"><a href="#ä»£ç -6" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HeapSort</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a)</span> &#123;</span><br><span class="line">        heapify(a, a.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> a.length - <span class="number">1</span>; right &gt; <span class="number">0</span>; right--) &#123;</span><br><span class="line">            swap(a, <span class="number">0</span>, right);</span><br><span class="line">            down(a, <span class="number">0</span>, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å»ºå † O(n)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">heapify</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="comment">// éå¶å­èŠ‚ç‚¹ä¸æ–­ä¸‹æ½œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> size / <span class="number">2</span> - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            down(array, i, size);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹æ½œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">down</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> parent, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> parent * <span class="number">2</span> + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> left + <span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> parent;</span><br><span class="line">            <span class="keyword">if</span> (left &lt; size &amp;&amp; array[left] &gt; array[max]) &#123;</span><br><span class="line">                max = left;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (right &lt; size &amp;&amp; array[right] &gt; array[max]) &#123;</span><br><span class="line">                max = right;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (max == parent) &#123; <span class="comment">// æ²¡æ‰¾åˆ°æ›´å¤§çš„å­©å­</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            swap(array, max, parent);</span><br><span class="line">            parent = max;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤æ¢</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> a[i];</span><br><span class="line">        a[i] = a[j];</span><br><span class="line">        a[j] = t;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] a = &#123;<span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">5</span>&#125;;</span><br><span class="line">        System.out.println(Arrays.toString(a));</span><br><span class="line">        sort(a);</span><br><span class="line">        System.out.println(Arrays.toString(a));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸè®¡æ•°æ’åº"><a href="#ğŸè®¡æ•°æ’åº" class="headerlink" title="ğŸè®¡æ•°æ’åº"></a>ğŸè®¡æ•°æ’åº</h2><h3 id="æ­¥éª¤-6"><a href="#æ­¥éª¤-6" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>èŠ±O(n)çš„æ—¶é—´æ‰«æä¸€ä¸‹æ•´ä¸ªåºåˆ— Aï¼Œè·å–æœ€å°å€¼ min å’Œæœ€å¤§å€¼ max</li><li>å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´åˆ›å»ºæ–°çš„æ•°ç»„ Bï¼Œé•¿åº¦ä¸º ( max - min + 1)</li><li>æ•°ç»„ B ä¸­ index çš„å…ƒç´ è®°å½•çš„å€¼æ˜¯ A ä¸­æŸå…ƒç´ å‡ºç°çš„æ¬¡æ•°</li><li>æœ€åè¾“å‡ºç›®æ ‡æ•´æ•°åºåˆ—ï¼Œå…·ä½“çš„é€»è¾‘æ˜¯éå†æ•°ç»„ Bï¼Œè¾“å‡ºç›¸åº”å…ƒç´ ä»¥åŠå¯¹åº”çš„ä¸ªæ•°</li></ol><h3 id="ä»£ç -7"><a href="#ä»£ç -7" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> a[<span class="number">0</span>];</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> a[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : a) &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &gt; max) &#123;</span><br><span class="line">            max = i;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (i &lt; min) &#123;</span><br><span class="line">            min = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span>[] counting = <span class="keyword">new</span> <span class="title class_">int</span>[max - min + <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i : a) &#123;</span><br><span class="line">        counting[i - min]++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; counting.length; i++) &#123;</span><br><span class="line">        <span class="keyword">while</span> (counting[i] &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            a[k] = i + min;</span><br><span class="line">            counting[i]--;</span><br><span class="line">            k++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸæ¡¶æ’åº"><a href="#ğŸæ¡¶æ’åº" class="headerlink" title="ğŸæ¡¶æ’åº"></a>ğŸæ¡¶æ’åº</h2><h3 id="æ­¥éª¤-7"><a href="#æ­¥éª¤-7" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>è®¾ç½®å›ºå®šæ•°é‡çš„ç©ºæ¡¶ã€‚</li><li>æŠŠæ•°æ®æ”¾åˆ°å¯¹åº”çš„æ¡¶ä¸­ã€‚</li><li>å¯¹æ¯ä¸ªä¸ä¸ºç©ºçš„æ¡¶ä¸­æ•°æ®è¿›è¡Œæ’åºã€‚</li><li>æ‹¼æ¥ä¸ä¸ºç©ºçš„æ¡¶ä¸­æ•°æ®ï¼Œå¾—åˆ°ç»“æœã€‚</li></ol><h3 id="ä»£ç -8"><a href="#ä»£ç -8" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BucketSortGeneric</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] ages = &#123;<span class="number">20</span>, <span class="number">10</span>, <span class="number">28</span>, <span class="number">66</span>, <span class="number">25</span>, <span class="number">31</span>, <span class="number">67</span>, <span class="number">30</span>, <span class="number">70</span>&#125;; <span class="comment">// å‡è®¾äººç±»å¹´é¾„ 1~99</span></span><br><span class="line">        System.out.println(Arrays.toString(ages));</span><br><span class="line">        sort(ages, <span class="number">20</span>);</span><br><span class="line">        System.out.println(Arrays.toString(ages));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] a, <span class="type">int</span> range)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> a[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> a[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; a.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (a[i] &gt; max) &#123;</span><br><span class="line">                max = a[i];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (a[i] &lt; min) &#123;</span><br><span class="line">                min = a[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 1. å‡†å¤‡æ¡¶</span></span><br><span class="line">        DynamicArray[] buckets = <span class="keyword">new</span> <span class="title class_">DynamicArray</span>[(max - min) / range + <span class="number">1</span>];</span><br><span class="line">        System.out.println(buckets.length);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buckets.length; i++) &#123;</span><br><span class="line">            buckets[i] = <span class="keyword">new</span> <span class="title class_">DynamicArray</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 2. æ”¾å…¥å¹´é¾„æ•°æ®</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> age : a) &#123;</span><br><span class="line">            buckets[(age - min) / range].addLast(age);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (DynamicArray bucket : buckets) &#123;</span><br><span class="line">            <span class="comment">// 3. æ’åºæ¡¶å†…å…ƒç´ </span></span><br><span class="line">            <span class="type">int</span>[] array = bucket.array();</span><br><span class="line">            InsertionSort.sort(array);</span><br><span class="line">            System.out.println(Arrays.toString(array));</span><br><span class="line">            <span class="comment">// 4. æŠŠæ¯ä¸ªæ¡¶æ’åºå¥½çš„å†…å®¹ï¼Œä¾æ¬¡æ”¾å…¥åŸå§‹æ•°ç»„</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> v : array) &#123;</span><br><span class="line">                a[k++] = v;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸåŸºæ•°æ’åº"><a href="#ğŸåŸºæ•°æ’åº" class="headerlink" title="ğŸåŸºæ•°æ’åº"></a>ğŸåŸºæ•°æ’åº</h2><h3 id="æ­¥éª¤-8"><a href="#æ­¥éª¤-8" class="headerlink" title="æ­¥éª¤"></a>æ­¥éª¤</h3><ol><li>å°†æ‰€æœ‰å¾…æ¯”è¾ƒæ•°å€¼ï¼ˆæ­£æ•´æ•°ï¼‰ç»Ÿä¸€ä¸ºåŒæ ·çš„æ•°ä½é•¿åº¦ï¼Œæ•°ä½è¾ƒçŸ­çš„æ•°å‰é¢è¡¥é›¶</li><li>ä»æœ€ä½ä½å¼€å§‹ï¼Œä¾æ¬¡è¿›è¡Œä¸€æ¬¡æ’åº</li><li>ä»æœ€ä½ä½æ’åºä¸€ç›´åˆ°æœ€é«˜ä½æ’åºå®Œæˆä»¥å, æ•°åˆ—å°±å˜æˆä¸€ä¸ªæœ‰åºåºåˆ—</li></ol><h3 id="ä»£ç -9"><a href="#ä»£ç -9" class="headerlink" title="ä»£ç "></a>ä»£ç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RadixSort</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">radixSort</span><span class="params">(String[] a, <span class="type">int</span> length)</span> &#123;</span><br><span class="line">        ArrayList&lt;String&gt;[] buckets = <span class="keyword">new</span> <span class="title class_">ArrayList</span>[<span class="number">128</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; buckets.length; i++) &#123;</span><br><span class="line">            buckets[i] = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> length - <span class="number">1</span>; i &gt;= <span class="number">0</span> ; i--) &#123;</span><br><span class="line">            <span class="keyword">for</span> (String s : a) &#123;</span><br><span class="line">                buckets[s.charAt(i)].add(s);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (ArrayList&lt;String&gt; bucket : buckets) &#123;</span><br><span class="line">                <span class="keyword">for</span> (String s : bucket) &#123;</span><br><span class="line">                    a[k++] = s;</span><br><span class="line">                &#125;</span><br><span class="line">                bucket.clear();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">/*String[] phoneNumbers = new String[10];</span></span><br><span class="line"><span class="comment">        phoneNumbers[0] = &quot;13812345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[1] = &quot;13912345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[2] = &quot;13612345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[3] = &quot;13712345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[4] = &quot;13512345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[5] = &quot;13412345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[6] = &quot;15012345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[7] = &quot;15112345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[8] = &quot;15212345678&quot;;</span></span><br><span class="line"><span class="comment">        phoneNumbers[9] = &quot;15712345678&quot;;*/</span></span><br><span class="line"></span><br><span class="line">        String[] phoneNumbers = <span class="keyword">new</span> <span class="title class_">String</span>[<span class="number">10</span>];</span><br><span class="line">        phoneNumbers[<span class="number">0</span>] = <span class="string">&quot;138&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">1</span>] = <span class="string">&quot;139&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">2</span>] = <span class="string">&quot;136&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">3</span>] = <span class="string">&quot;137&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">4</span>] = <span class="string">&quot;135&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">5</span>] = <span class="string">&quot;134&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">6</span>] = <span class="string">&quot;150&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">7</span>] = <span class="string">&quot;151&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">8</span>] = <span class="string">&quot;152&quot;</span>;</span><br><span class="line">        phoneNumbers[<span class="number">9</span>] = <span class="string">&quot;157&quot;</span>;</span><br><span class="line">        RadixSort.radixSort(phoneNumbers, <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (String phoneNumber : phoneNumbers) &#123;</span><br><span class="line">            System.out.println(phoneNumber);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://mp.weixin.qq.com/s/vn3KiV-ez79FmbZ36SX9lg">åå¤§ç»å…¸æ’åºç®—æ³•åŠ¨ç”»ä¸è§£æï¼Œçœ‹æˆ‘å°±å¤Ÿäº†ï¼ï¼ˆé…ä»£ç å®Œå…¨ç‰ˆï¼‰ (qq.com)</a></p><p><a href="https://www.bilibili.com/video/BV1rv4y1H7o6?p=48&vd_source=4e325d8f935e8f302a35ee035332e67b">åŸºç¡€ç®—æ³•-202-æ’åºç®—æ³•-å†’æ³¡æ’åº_å“”å“©å“”å“©_bilibili</a></p>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç´¢å¼•è¿›é˜¶</title>
      <link href="/posts/13143/"/>
      <url>/posts/13143/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæœ€å·¦å‰ç¼€æ³•åˆ™"><a href="#ğŸæœ€å·¦å‰ç¼€æ³•åˆ™" class="headerlink" title="ğŸæœ€å·¦å‰ç¼€æ³•åˆ™"></a>ğŸæœ€å·¦å‰ç¼€æ³•åˆ™</h2><blockquote><p>å¦‚æœç´¢å¼•äº†å¤šåˆ—ï¼ˆè”åˆç´¢å¼•ï¼‰ï¼Œè¦éµå®ˆæœ€å·¦å‰ç¼€æ³•åˆ™ã€‚æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯æŸ¥è¯¢<strong>ä»ç´¢å¼•çš„æœ€å·¦åˆ—å¼€å§‹ï¼Œ å¹¶ä¸”ä¸è·³è¿‡ç´¢å¼•ä¸­çš„åˆ—</strong>ã€‚å¦‚æœè·³è·ƒæŸä¸€åˆ—ï¼Œç´¢å¼•å°†ä¼š**éƒ¨åˆ†å¤±æ•ˆ(åé¢çš„å­—æ®µç´¢å¼•å¤±æ•ˆ)**ã€‚</p></blockquote><h3 id="ç¤ºä¾‹"><a href="#ç¤ºä¾‹" class="headerlink" title="ç¤ºä¾‹"></a>ç¤ºä¾‹</h3><p>tb_userè¡¨æœ‰ä¸€ä¸ªè”åˆç´¢å¼•ï¼Œè¿™ä¸ªè”åˆç´¢å¼•æ¶‰åŠåˆ°ä¸‰ä¸ªå­—æ®µï¼Œé¡ºåºåˆ†åˆ«ä¸ºï¼šprofessionï¼Œ ageï¼Œstatus</p><p><img src="/img/13143/MySQL%E7%B4%A2%E5%BC%95%E8%BF%9B%E9%98%B61.png" alt="image-20230830224849301"></p><p>æœ€å·¦å‰ç¼€æ³•åˆ™æŒ‡çš„æ˜¯ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæœ€å·¦è¾¹çš„åˆ—ï¼Œä¹Ÿå°±æ˜¯professionå¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™ç´¢å¼•å…¨éƒ¨å¤±æ•ˆã€‚  è€Œä¸”ä¸­é—´ä¸èƒ½è·³è¿‡æŸä¸€åˆ—ï¼Œå¦åˆ™è¯¥åˆ—åé¢çš„å­—æ®µç´¢å¼•å°†å¤±æ•ˆã€‚</p><p>ç”Ÿæ•ˆç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">and</span> age <span class="operator">=</span> <span class="number">31</span>;</span><br></pre></td></tr></table></figure><p>å¤±æ•ˆç¤ºä¾‹ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">and</span> status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a>æ³¨æ„</h3><p>å½“æ‰§è¡Œä»¥ä¸‹SQLè¯­å¥ï¼Œç´¢å¼•<strong>ç”Ÿæ•ˆ</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> age <span class="operator">=</span> <span class="number">31</span> <span class="keyword">and</span>  status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span> <span class="keyword">and</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span>ï¼›</span><br></pre></td></tr></table></figure><p>ğŸš©æœ€å·¦å‰ç¼€æ³•åˆ™ä¸­æŒ‡çš„æœ€å·¦è¾¹çš„åˆ—ï¼Œæ˜¯æŒ‡åœ¨æŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•çš„æœ€å·¦è¾¹çš„å­—æ®µ(å³æ˜¯<strong>ç¬¬ä¸€ä¸ªå­—æ®µ</strong>)å¿…é¡»å­˜åœ¨ï¼Œä¸ç¼–å†™SQLæ—¶ï¼Œ<strong>æ¡ä»¶ç¼–å†™çš„å…ˆåé¡ºåºæ— å…³</strong></p><h2 id="ğŸç´¢å¼•å¤±æ•ˆæƒ…å†µ"><a href="#ğŸç´¢å¼•å¤±æ•ˆæƒ…å†µ" class="headerlink" title="ğŸç´¢å¼•å¤±æ•ˆæƒ…å†µ"></a>ğŸç´¢å¼•å¤±æ•ˆæƒ…å†µ</h2><h3 id="èŒƒå›´æŸ¥è¯¢"><a href="#èŒƒå›´æŸ¥è¯¢" class="headerlink" title="èŒƒå›´æŸ¥è¯¢"></a>èŒƒå›´æŸ¥è¯¢</h3><blockquote><p>è”åˆç´¢å¼•ä¸­ï¼Œå‡ºç°èŒƒå›´æŸ¥è¯¢<code>(&gt;,&lt;)</code>ï¼ŒèŒƒå›´æŸ¥è¯¢<strong>å³ä¾§çš„åˆ—ç´¢å¼•</strong>å¤±æ•ˆ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">and</span> age <span class="operator">&gt;</span> <span class="number">30</span> <span class="keyword">and</span> status </span><br><span class="line"><span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%881.png" alt="image-20230830225756823"></p><p>å½“èŒƒå›´æŸ¥è¯¢ä½¿ç”¨&gt; æˆ– &lt; æ—¶ï¼Œèµ°è”åˆç´¢å¼•äº†ï¼Œä½†æ˜¯ç´¢å¼•çš„é•¿åº¦ä¸º49ï¼ˆä¸å¤Ÿè”åˆç´¢å¼•çš„é•¿åº¦ï¼‰ï¼Œå°±è¯´æ˜èŒƒå›´æŸ¥è¯¢å³è¾¹çš„statuså­—æ®µæ˜¯æ²¡æœ‰èµ°ç´¢å¼•çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥ç¨‹&#x27;</span> <span class="keyword">and</span> age <span class="operator">&gt;=</span> <span class="number">30</span> <span class="keyword">and</span> </span><br><span class="line">status <span class="operator">=</span> <span class="string">&#x27;0&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%882.png" alt="image-20230830225937192"></p><p>èŒƒå›´æŸ¥è¯¢ä½¿ç”¨&gt;&#x3D; æˆ– &lt;&#x3D; æ—¶ï¼Œèµ°è”åˆç´¢å¼•äº†ï¼Œä½†æ˜¯ç´¢å¼•çš„é•¿åº¦ä¸º54ï¼ˆæ­£å¸¸ï¼‰ï¼Œå°±è¯´æ˜æ‰€æœ‰çš„å­—æ®µéƒ½æ˜¯èµ°ç´¢å¼•çš„</p><p><strong>æ€»ç»“ï¼šå°½å¯èƒ½çš„ä½¿ç”¨ç±»ä¼¼äº &gt;&#x3D; æˆ– &lt;&#x3D; è¿™ç±»çš„èŒƒå›´æŸ¥è¯¢ï¼Œè€Œé¿å…ä½¿ç”¨ &gt; æˆ– &lt;</strong></p><h3 id="ç´¢å¼•åˆ—è¿ç®—"><a href="#ç´¢å¼•åˆ—è¿ç®—" class="headerlink" title="ç´¢å¼•åˆ—è¿ç®—"></a>ç´¢å¼•åˆ—è¿ç®—</h3><blockquote><p>åœ¨ç´¢å¼•åˆ—ä¸Šè¿›è¡Œè¿ç®—æ“ä½œï¼Œ ç´¢å¼•å°†å¤±æ•ˆ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">explain  <span class="keyword">select</span>  <span class="operator">*</span>  <span class="keyword">from</span>  tb_user  <span class="keyword">where</span>  <span class="built_in">substring</span>(phone,<span class="number">10</span>,<span class="number">2</span>) <span class="operator">=</span> <span class="string">&#x27;15&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%883.png" alt="image-20230902161053946"></p><p>æ ¹æ®phoneå­—æ®µè¿›è¡Œå‡½æ•°è¿ç®—æ“ä½œä¹‹åï¼Œç´¢å¼•å¤±æ•ˆ</p><h3 id="å­—ç¬¦ä¸²ä¸åŠ å¼•å·"><a href="#å­—ç¬¦ä¸²ä¸åŠ å¼•å·" class="headerlink" title="å­—ç¬¦ä¸²ä¸åŠ å¼•å·"></a>å­—ç¬¦ä¸²ä¸åŠ å¼•å·</h3><blockquote><p>å­—ç¬¦ä¸²ç±»å‹å­—æ®µä½¿ç”¨æ—¶ï¼Œä¸åŠ å¼•å·ï¼Œç´¢å¼•å°†å¤±æ•ˆ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="string">&#x27;17799990015&#x27;</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="number">17799990015</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%884.png" alt="image-20230902161301773"></p><h3 id="æ¨¡ç³ŠæŸ¥è¯¢"><a href="#æ¨¡ç³ŠæŸ¥è¯¢" class="headerlink" title="æ¨¡ç³ŠæŸ¥è¯¢"></a>æ¨¡ç³ŠæŸ¥è¯¢</h3><blockquote><p>å°¾éƒ¨æ¨¡ç³ŠåŒ¹é…ï¼Œç´¢å¼•ä¸ä¼šå¤±æ•ˆã€‚<strong>å¤´éƒ¨æ¨¡ç³ŠåŒ¹é…</strong>ï¼Œç´¢å¼•å¤±æ•ˆ</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">explain  <span class="keyword">select</span>  <span class="operator">*</span>  <span class="keyword">from</span>  tb_user  <span class="keyword">where</span>  profession <span class="keyword">like</span> <span class="string">&#x27;è½¯ä»¶%&#x27;</span>;</span><br><span class="line">explain  <span class="keyword">select</span>  <span class="operator">*</span>  <span class="keyword">from</span>  tb_user  <span class="keyword">where</span>  profession <span class="keyword">like</span> <span class="string">&#x27;%å·¥ç¨‹&#x27;</span>;</span><br><span class="line">explain  <span class="keyword">select</span>  <span class="operator">*</span>  <span class="keyword">from</span>  tb_user  <span class="keyword">where</span>  profession <span class="keyword">like</span> <span class="string">&#x27;%å·¥%&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%885.png" alt="image-20230902161446391"></p><p>åœ¨likeæ¨¡ç³ŠæŸ¥è¯¢ä¸­ï¼Œåœ¨å…³é”®å­—åé¢åŠ %ï¼Œç´¢å¼•å¯ä»¥ç”Ÿæ•ˆã€‚è€Œå¦‚æœåœ¨å…³é”®å­—<strong>å‰é¢åŠ äº†%<strong>ï¼Œç´¢å¼•</strong>å°†ä¼šå¤±æ•ˆ</strong></p><h3 id="orè¿æ¥æ¡ä»¶"><a href="#orè¿æ¥æ¡ä»¶" class="headerlink" title="orè¿æ¥æ¡ä»¶"></a>orè¿æ¥æ¡ä»¶</h3><blockquote><p>ç”¨oråˆ†å‰²å¼€çš„æ¡ä»¶ï¼Œ å¦‚æœorå‰çš„æ¡ä»¶ä¸­çš„åˆ—æœ‰ç´¢å¼•ï¼Œè€Œåé¢çš„åˆ—ä¸­æ²¡æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆæ¶‰åŠçš„ç´¢å¼•<strong>éƒ½ä¸ä¼š</strong>è¢«ç”¨åˆ°</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">10</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">=</span> <span class="string">&#x27;17799990017&#x27;</span> <span class="keyword">or</span> age <span class="operator">=</span> <span class="number">23</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%886.png" alt="image-20230902161651202"></p><p>ç”±äºageæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥å³ä½¿idã€phoneæœ‰ç´¢å¼•ï¼Œç´¢å¼•ä¹Ÿä¼šå¤±æ•ˆ</p><h3 id="æ•°æ®åˆ†å¸ƒå½±å“"><a href="#æ•°æ®åˆ†å¸ƒå½±å“" class="headerlink" title="æ•°æ®åˆ†å¸ƒå½±å“"></a>æ•°æ®åˆ†å¸ƒå½±å“</h3><blockquote><p>å¦‚æœMySQLè¯„ä¼°ä½¿ç”¨ç´¢å¼•æ¯”å…¨è¡¨æ›´æ…¢ï¼Œåˆ™ä¸ä½¿ç”¨ç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">&gt;=</span> <span class="string">&#x27;17799990005&#x27;</span>;</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user <span class="keyword">where</span> phone <span class="operator">&gt;=</span> <span class="string">&#x27;17799990015&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="/img/13143/%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%887.png" alt="image-20230902161847037"></p><p>MySQLåœ¨æŸ¥è¯¢æ—¶ï¼Œä¼šè¯„ä¼°ä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡ä¸èµ°å…¨è¡¨æ‰«æçš„æ•ˆç‡ï¼Œå¦‚æœèµ°å…¨è¡¨æ‰«ææ›´å¿«ï¼Œåˆ™æ”¾å¼ƒç´¢å¼•ï¼Œèµ°å…¨è¡¨æ‰«æ</p><h2 id="ğŸSQLæç¤º"><a href="#ğŸSQLæç¤º" class="headerlink" title="ğŸSQLæç¤º"></a>ğŸSQLæç¤º</h2><blockquote><p>SQLæç¤ºæ˜¯ä¼˜åŒ–æ•°æ®åº“çš„ä¸€ä¸ªé‡è¦æ‰‹æ®µï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯åœ¨SQLè¯­å¥ä¸­åŠ å…¥ä¸€äº›äººä¸ºçš„æç¤ºæ¥è¾¾åˆ°ä¼˜ åŒ–æ“ä½œçš„ç›®çš„</p><p>åœ¨æŸ¥è¯¢çš„æ—¶å€™ï¼Œè‡ªå·±æ¥æŒ‡å®šä½¿ç”¨å“ªä¸ªç´¢å¼•</p></blockquote><h3 id="use-index"><a href="#use-index" class="headerlink" title="use index"></a>use index</h3><blockquote><p>å»ºè®®MySQLä½¿ç”¨å“ªä¸€ä¸ªç´¢å¼•å®Œæˆæ­¤æ¬¡æŸ¥è¯¢ï¼ˆä»…ä»…æ˜¯å»ºè®®ï¼Œmysqlå†…éƒ¨è¿˜ä¼šå†æ¬¡è¿›è¡Œè¯„ä¼°ï¼‰</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user use index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥</span></span><br><span class="line"><span class="string">ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="ignore-index"><a href="#ignore-index" class="headerlink" title="ignore index"></a>ignore index</h3><blockquote><p>å¿½ç•¥æŒ‡å®šçš„ç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user ignore index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥</span></span><br><span class="line"><span class="string">ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="force-index"><a href="#force-index" class="headerlink" title="force index"></a>force index</h3><blockquote><p> å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•</p></blockquote><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">explain <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> tb_user force index(idx_user_pro) <span class="keyword">where</span> profession <span class="operator">=</span> <span class="string">&#x27;è½¯ä»¶å·¥</span></span><br><span class="line"><span class="string">ç¨‹&#x27;</span>;</span><br></pre></td></tr></table></figure><h2 id="ğŸè¦†ç›–ç´¢å¼•"><a href="#ğŸè¦†ç›–ç´¢å¼•" class="headerlink" title="ğŸè¦†ç›–ç´¢å¼•"></a>ğŸè¦†ç›–ç´¢å¼•</h2><blockquote><p>è¦†ç›–ç´¢å¼•æ˜¯æŒ‡ æŸ¥è¯¢ä½¿ç”¨äº†ç´¢å¼•ï¼Œå¹¶ä¸”éœ€è¦è¿”å›çš„åˆ—ï¼Œåœ¨è¯¥ç´¢å¼•ä¸­å·²ç»å…¨éƒ¨èƒ½å¤Ÿæ‰¾åˆ°</p></blockquote><h3 id="ç¤ºä¾‹1"><a href="#ç¤ºä¾‹1" class="headerlink" title="ç¤ºä¾‹1"></a>ç¤ºä¾‹1</h3><h4 id="1-è¡¨ç»“æ„åŠç´¢å¼•ç¤ºæ„å›¾"><a href="#1-è¡¨ç»“æ„åŠç´¢å¼•ç¤ºæ„å›¾" class="headerlink" title="1.è¡¨ç»“æ„åŠç´¢å¼•ç¤ºæ„å›¾"></a>1.è¡¨ç»“æ„åŠç´¢å¼•ç¤ºæ„å›¾</h4><p><img src="/img/13143/%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%951.png" alt="image-20230902162909592"></p><p>è¯´æ˜ï¼šidæ˜¯ä¸»é”®ï¼Œæ˜¯ä¸€ä¸ªèšé›†ç´¢å¼•ã€‚ nameå­—æ®µå»ºç«‹äº†æ™®é€šç´¢å¼•ï¼Œæ˜¯ä¸€ä¸ªäºŒçº§ç´¢å¼•ï¼ˆè¾…åŠ©ç´¢å¼•ï¼‰</p><h4 id="2-æ‰§è¡Œï¼šselect-from-tb-user-where-id-x3D-2"><a href="#2-æ‰§è¡Œï¼šselect-from-tb-user-where-id-x3D-2" class="headerlink" title="2.æ‰§è¡Œï¼šselect * from tb_user where id &#x3D; 2;"></a>2.æ‰§è¡Œï¼šselect * from tb_user where id &#x3D; 2;</h4><p><img src="/img/13143/%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%952.png" alt="image-20230902163019030"></p><p>æ ¹æ®idæŸ¥è¯¢ï¼Œç›´æ¥èµ°èšé›†ç´¢å¼•æŸ¥è¯¢ï¼Œä¸€æ¬¡ç´¢å¼•æ‰«æï¼Œç›´æ¥è¿”å›æ•°æ®ï¼Œæ€§èƒ½é«˜ã€‚</p><h4 id="3-æ‰§è¡Œï¼šselect-id-name-from-tb-user-where-name-x3D-â€˜Armâ€™"><a href="#3-æ‰§è¡Œï¼šselect-id-name-from-tb-user-where-name-x3D-â€˜Armâ€™" class="headerlink" title="3.æ‰§è¡Œï¼šselect id,name from tb_user where name &#x3D; â€˜Armâ€™;"></a>3.æ‰§è¡Œï¼šselect id,name from tb_user where name &#x3D; â€˜Armâ€™;</h4><p><img src="/img/13143/%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%953.png" alt="image-20230902163120038"></p><p>è™½ç„¶æ˜¯æ ¹æ®nameå­—æ®µæŸ¥è¯¢ï¼ŒæŸ¥è¯¢äºŒçº§ç´¢å¼•ï¼Œä½†æ˜¯ç”±äºæŸ¥è¯¢è¿”å›åœ¨å­—æ®µä¸º idï¼Œnameï¼Œåœ¨nameçš„äºŒçº§ç´¢å¼•ä¸­ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯å¯ä»¥ç›´æ¥è·å–åˆ°çš„ï¼Œå› ä¸º<strong>è¦†ç›–ç´¢å¼•</strong>ï¼Œæ‰€ä»¥ä¸éœ€è¦å›è¡¨æŸ¥è¯¢ï¼Œæ€§èƒ½é«˜</p><h4 id="4-æ‰§è¡Œï¼šselect-id-name-gender-from-tb-user-where-name-x3D-â€˜Armâ€™"><a href="#4-æ‰§è¡Œï¼šselect-id-name-gender-from-tb-user-where-name-x3D-â€˜Armâ€™" class="headerlink" title="4.æ‰§è¡Œï¼šselect id,name,gender from tb_user where name &#x3D; â€˜Armâ€™;"></a>4.æ‰§è¡Œï¼šselect id,name,gender from tb_user where name &#x3D; â€˜Armâ€™;</h4><p><img src="/img/13143/%E8%A6%86%E7%9B%96%E7%B4%A2%E5%BC%954.png" alt="image-20230902163234966"></p><p>ç”±äºåœ¨nameçš„äºŒçº§ç´¢å¼•ä¸­ï¼Œä¸åŒ…å«genderï¼Œæ‰€ä»¥ï¼Œéœ€è¦ä¸¤æ¬¡ç´¢å¼•æ‰«æï¼Œä¹Ÿå°±æ˜¯éœ€è¦<strong>å›è¡¨æŸ¥è¯¢</strong>ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒå·®</p><h3 id="ç¤ºä¾‹2"><a href="#ç¤ºä¾‹2" class="headerlink" title="ç¤ºä¾‹2"></a>ç¤ºä¾‹2</h3><p>ä¸€å¼ è¡¨, æœ‰å››ä¸ªå­—æ®µ(id, username, password, status), å¯¹ä»¥ä¸‹SQLè¯­å¥è¿›è¡Œä¼˜åŒ–:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> id,username,password <span class="keyword">from</span> tb_user <span class="keyword">where</span> username <span class="operator">=</span> <span class="string">&#x27;itcast&#x27;</span>;</span><br></pre></td></tr></table></figure><p>è§£æï¼š</p><p>é’ˆå¯¹äº username, passwordå»ºç«‹è”åˆç´¢å¼•, sqlä¸º:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_user_name_pass <span class="keyword">on</span> tb_user(username,password); </span><br></pre></td></tr></table></figure><p>è¿™æ ·é¿å…ä¸Šè¿°çš„SQLè¯­å¥ï¼Œåœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œå‡ºç°å›è¡¨æŸ¥è¯¢</p><p>ğŸš©<strong>æ ¹æ®è¦†ç›–ç´¢å¼•çš„åŸåˆ™ï¼Œåº”å°‘ç”¨select * â€¦;</strong></p><h2 id="ğŸå‰ç¼€ç´¢å¼•"><a href="#ğŸå‰ç¼€ç´¢å¼•" class="headerlink" title="ğŸå‰ç¼€ç´¢å¼•"></a>ğŸå‰ç¼€ç´¢å¼•</h2><blockquote><p>å½“å­—æ®µç±»å‹ä¸ºå­—ç¬¦ä¸²ï¼ˆvarcharï¼Œtextï¼Œlongtextç­‰ï¼‰æ—¶ï¼Œæœ‰æ—¶å€™éœ€è¦ç´¢å¼•å¾ˆé•¿çš„å­—ç¬¦ä¸²ï¼Œè¿™ä¼šè®©ç´¢å¼•å˜å¾—å¾ˆå¤§ï¼ŒæŸ¥è¯¢æ—¶ï¼Œæµªè´¹å¤§é‡çš„ç£ç›˜IOï¼Œ å½±å“æŸ¥è¯¢æ•ˆç‡ã€‚æ­¤æ—¶å¯ä»¥åªå°†å­—ç¬¦ä¸²çš„<strong>ä¸€éƒ¨åˆ†å‰ç¼€å»ºç«‹ç´¢å¼•</strong>ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§èŠ‚çº¦ç´¢å¼•ç©ºé—´ï¼Œä»è€Œæé«˜ç´¢å¼•æ•ˆç‡</p></blockquote><h3 id="è¯­æ³•"><a href="#è¯­æ³•" class="headerlink" title="è¯­æ³•"></a>è¯­æ³•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index  idx_xxxx <span class="keyword">on</span> table_name(<span class="keyword">column</span>(n)) ;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼šä¸ºtb_userè¡¨çš„emailå­—æ®µï¼Œå»ºç«‹é•¿åº¦ä¸º5çš„å‰ç¼€ç´¢å¼•ã€‚</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> index idx_email_5 <span class="keyword">on</span> tb_user(email(<span class="number">5</span>));</span><br></pre></td></tr></table></figure><h3 id="å‰ç¼€é•¿åº¦"><a href="#å‰ç¼€é•¿åº¦" class="headerlink" title="å‰ç¼€é•¿åº¦"></a>å‰ç¼€é•¿åº¦</h3><p>å¯ä»¥æ ¹æ®ç´¢å¼•çš„é€‰æ‹©æ€§æ¥å†³å®šï¼Œè€Œé€‰æ‹©æ€§æ˜¯æŒ‡ä¸é‡å¤çš„ç´¢å¼•å€¼ï¼ˆåŸºæ•°ï¼‰å’Œæ•°æ®è¡¨çš„è®°å½•æ€»æ•°çš„æ¯”å€¼ï¼Œ ç´¢å¼•é€‰æ‹©æ€§è¶Šé«˜åˆ™æŸ¥è¯¢æ•ˆç‡è¶Šé«˜ï¼Œ å”¯ä¸€ç´¢å¼•çš„é€‰æ‹©æ€§æ˜¯1ï¼Œè¿™æ˜¯æœ€å¥½çš„ç´¢å¼•é€‰æ‹©æ€§ï¼Œæ€§èƒ½ä¹Ÿæ˜¯æœ€å¥½çš„</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span>  <span class="built_in">count</span>(<span class="keyword">distinct</span> email) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>)   <span class="keyword">from</span>  tb_user ;</span><br><span class="line"><span class="keyword">select</span>  <span class="built_in">count</span>(<span class="keyword">distinct</span> <span class="built_in">substring</span>(email,<span class="number">1</span>,<span class="number">5</span>)) <span class="operator">/</span> <span class="built_in">count</span>(<span class="operator">*</span>)  <span class="keyword">from</span>  tb_user ;</span><br></pre></td></tr></table></figure><h3 id="å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢æµç¨‹"><a href="#å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢æµç¨‹" class="headerlink" title="å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢æµç¨‹"></a>å‰ç¼€ç´¢å¼•çš„æŸ¥è¯¢æµç¨‹</h3><p><img src="/img/13143/%E5%89%8D%E7%BC%80%E7%B4%A2%E5%BC%95.png" alt="image-20230902164841767"></p><h2 id="ğŸå•åˆ—ç´¢å¼•ä¸è”åˆç´¢å¼•"><a href="#ğŸå•åˆ—ç´¢å¼•ä¸è”åˆç´¢å¼•" class="headerlink" title="ğŸå•åˆ—ç´¢å¼•ä¸è”åˆç´¢å¼•"></a>ğŸå•åˆ—ç´¢å¼•ä¸è”åˆç´¢å¼•</h2><blockquote><p>å•åˆ—ç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åªåŒ…å«å•ä¸ªåˆ—</p><p>è”åˆç´¢å¼•ï¼šå³ä¸€ä¸ªç´¢å¼•åŒ…å«äº†å¤šä¸ªåˆ—</p></blockquote><p>åœ¨ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªæŸ¥è¯¢æ¡ä»¶ï¼Œè€ƒè™‘é’ˆå¯¹äºæŸ¥è¯¢å­—æ®µå»ºç«‹ç´¢å¼•æ—¶ï¼Œå»ºè®®å»ºç«‹è”åˆç´¢å¼•ï¼Œ è€Œéå•åˆ—ç´¢å¼•ã€‚</p><p><img src="/img/13143/%E8%81%94%E5%90%88%E7%B4%A2%E5%BC%95.png" alt="image-20230902165135541"></p><h2 id="ğŸç´¢å¼•è®¾è®¡åŸåˆ™"><a href="#ğŸç´¢å¼•è®¾è®¡åŸåˆ™" class="headerlink" title="ğŸç´¢å¼•è®¾è®¡åŸåˆ™"></a>ğŸç´¢å¼•è®¾è®¡åŸåˆ™</h2><ol><li>é’ˆå¯¹äºæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”<strong>æŸ¥è¯¢æ¯”è¾ƒé¢‘ç¹</strong>çš„è¡¨å»ºç«‹ç´¢å¼•ã€‚</li><li>é’ˆå¯¹äºå¸¸ä½œä¸º<strong>æŸ¥è¯¢æ¡ä»¶ï¼ˆwhereï¼‰ã€æ’åºï¼ˆorder byï¼‰ã€åˆ†ç»„ï¼ˆgroup byï¼‰æ“ä½œçš„å­—æ®µ</strong>å»ºç«‹ç´¢å¼•ã€‚</li><li>å°½é‡é€‰æ‹©<strong>åŒºåˆ†åº¦é«˜çš„åˆ—</strong>ä½œä¸ºç´¢å¼•ï¼Œå°½é‡å»ºç«‹<strong>å”¯ä¸€ç´¢å¼•</strong>ï¼ŒåŒºåˆ†åº¦è¶Šé«˜ï¼Œä½¿ç”¨ç´¢å¼•çš„æ•ˆç‡è¶Šé«˜ã€‚</li><li>å¦‚æœæ˜¯å­—ç¬¦ä¸²ç±»å‹çš„å­—æ®µï¼Œå­—æ®µçš„<strong>é•¿åº¦è¾ƒé•¿</strong>ï¼Œå¯ä»¥é’ˆå¯¹äºå­—æ®µçš„ç‰¹ç‚¹ï¼Œå»ºç«‹<strong>å‰ç¼€ç´¢å¼•</strong>ã€‚</li><li><strong>å°½é‡ä½¿ç”¨è”åˆç´¢å¼•ï¼Œå‡å°‘å•åˆ—ç´¢å¼•</strong>ï¼ŒæŸ¥è¯¢æ—¶ï¼Œè”åˆç´¢å¼•å¾ˆå¤šæ—¶å€™å¯ä»¥è¦†ç›–ç´¢å¼•ï¼ŒèŠ‚çœå­˜å‚¨ç©ºé—´ï¼Œé¿å…å›è¡¨ï¼Œæé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li><li>è¦<strong>æ§åˆ¶ç´¢å¼•çš„æ•°é‡</strong>ï¼Œç´¢å¼•å¹¶ä¸æ˜¯å¤šå¤šç›Šå–„ï¼Œç´¢å¼•è¶Šå¤šï¼Œç»´æŠ¤ç´¢å¼•ç»“æ„çš„ä»£ä»·ä¹Ÿå°±è¶Šå¤§ï¼Œä¼šå½±å“å¢åˆ æ”¹çš„æ•ˆç‡ã€‚</li><li>å¦‚æœç´¢å¼•åˆ—ä¸èƒ½å­˜å‚¨NULLå€¼ï¼Œè¯·åœ¨åˆ›å»ºè¡¨æ—¶ä½¿ç”¨NOT NULLçº¦æŸå®ƒã€‚å½“ä¼˜åŒ–å™¨çŸ¥é“æ¯åˆ—æ˜¯å¦åŒ…å«NULLå€¼æ—¶ï¼Œå®ƒå¯ä»¥æ›´å¥½åœ°ç¡®å®šå“ªä¸ªç´¢å¼•æœ€æœ‰æ•ˆåœ°ç”¨äºæŸ¥è¯¢ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLç´¢å¼•</title>
      <link href="/posts/33592/"/>
      <url>/posts/33592/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸB-Treeã€B-Treeå’ŒHashç´¢å¼•"><a href="#ğŸB-Treeã€B-Treeå’ŒHashç´¢å¼•" class="headerlink" title="ğŸB-Treeã€B+Treeå’ŒHashç´¢å¼•"></a>ğŸB-Treeã€B+Treeå’ŒHashç´¢å¼•</h2><h3 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h3><h4 id="ï¼ˆ1ï¼‰ä»‹ç»"><a href="#ï¼ˆ1ï¼‰ä»‹ç»" class="headerlink" title="ï¼ˆ1ï¼‰ä»‹ç»"></a>ï¼ˆ1ï¼‰ä»‹ç»</h4><blockquote><p>Bæ ‘æ˜¯ä¸€ç§å¤šå‰è·¯å¹³è¡¡æŸ¥æ‰¾æ ‘ï¼Œç›¸å¯¹äºäºŒå‰æ ‘ï¼ŒBæ ‘æ¯ä¸ªèŠ‚ç‚¹å¯ä»¥æœ‰å¤šä¸ªåˆ†æ”¯ï¼Œå³å¤šå‰æ ‘</p></blockquote><p>ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆ<strong>max-degree</strong>ï¼‰ä¸º5(5é˜¶)çš„b-treeä¸ºä¾‹ï¼Œé‚£è¿™ä¸ªBæ ‘æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨4ä¸ª<strong>key</strong>ï¼Œ5 ä¸ª<strong>æŒ‡é’ˆ</strong>ï¼š</p><p><img src="/img/33592/MySQL%E7%B4%A2%E5%BC%951.png" alt="image-20230828230318153"></p><blockquote><p>æ ‘çš„åº¦æ•°æŒ‡çš„æ˜¯ä¸€ä¸ªèŠ‚ç‚¹çš„<strong>å­èŠ‚ç‚¹ä¸ªæ•°</strong></p></blockquote><h4 id="ï¼ˆ2ï¼‰ç¤ºä¾‹"><a href="#ï¼ˆ2ï¼‰ç¤ºä¾‹" class="headerlink" title="ï¼ˆ2ï¼‰ç¤ºä¾‹"></a>ï¼ˆ2ï¼‰ç¤ºä¾‹</h4><p>æ’å…¥ä¸€ç»„æ•°æ®æŸ¥çœ‹B-Treeçš„å˜åŒ–</p><p>1.æ’å…¥4ä¸ªæ•°ï¼š</p><p><img src="/img/33592/B-Tree1.png" alt="image-20230828231128465"></p><p>2.å†æ’å…¥1ä¸ªæ•°ï¼Œè¶…è¿‡æœ€å¤§åº¦æ•°ï¼Œä¸­é—´èŠ‚ç‚¹å‘ä¸Šåˆ†è£‚ï¼š</p><p><img src="/img/33592/B-Tree2.png" alt="image-20230828231356430"></p><p>3.å†æ’å…¥ä¸€äº›æ•°ï¼š</p><p><img src="/img/33592/B-Tree3.png" alt="image-20230828231450353"></p><p>4.å†æ’å…¥1000ï¼Œå³è¾¹ä¸­é—´èŠ‚ç‚¹å‘ä¸Šåˆ†è£‚ï¼š</p><p><img src="/img/33592/B-Tree4.png" alt="image-20230828231614961"></p><p>5.å†æ’å…¥ä¸€äº›æ•°ï¼š</p><p><img src="/img/33592/B-Tree5.png" alt="image-20230828231731241"></p><p>6.æ’å…¥1ä¸ªæ•°245ï¼Œä¸¤æ¬¡å‘ä¸Šåˆ†è£‚ï¼š</p><p><img src="/img/33592/B-Tree6.png" alt="image-20230828231855604"></p><h4 id="ï¼ˆ3ï¼‰æ€»ç»“"><a href="#ï¼ˆ3ï¼‰æ€»ç»“" class="headerlink" title="ï¼ˆ3ï¼‰æ€»ç»“"></a>ï¼ˆ3ï¼‰æ€»ç»“</h4><ul><li>né˜¶çš„Bæ ‘ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šå­˜å‚¨<strong>n-1ä¸ªkey</strong>ï¼Œå¯¹åº”<strong>nä¸ªæŒ‡é’ˆ</strong>ã€‚</li><li>ä¸€æ—¦èŠ‚ç‚¹å­˜å‚¨çš„keyæ•°é‡åˆ°è¾¾nï¼Œå°±ä¼šè£‚å˜ï¼Œ<strong>ä¸­é—´å…ƒç´ å‘ä¸Šåˆ†è£‚</strong>ã€‚</li><li>åœ¨Bæ ‘ä¸­ï¼Œ<strong>éå¶å­èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹</strong>éƒ½ä¼šå­˜æ”¾æ•°æ®ã€‚</li></ul><h3 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h3><h4 id="ï¼ˆ1ï¼‰ä»‹ç»-1"><a href="#ï¼ˆ1ï¼‰ä»‹ç»-1" class="headerlink" title="ï¼ˆ1ï¼‰ä»‹ç»"></a>ï¼ˆ1ï¼‰ä»‹ç»</h4><blockquote><p>B+Treeæ˜¯B-Treeçš„å˜ç§ï¼Œåˆ†ä¸ºéå¶å­èŠ‚ç‚¹å­˜ç´¢å¼•ï¼Œå¶å­èŠ‚ç‚¹å­˜æ•°æ®</p></blockquote><p>ä»¥ä¸€é¢—æœ€å¤§åº¦æ•°ï¼ˆmax-degreeï¼‰ä¸º4ï¼ˆ4é˜¶ï¼‰çš„b+treeä¸ºä¾‹ï¼š</p><p><img src="/img/33592/B+Tree1.png" alt="image-20230828232345768"></p><p>ç»¿è‰²æ¡†æ˜¯ç´¢å¼•éƒ¨åˆ†ï¼Œä»…ä»…èµ·åˆ°<strong>ç´¢å¼•æ•°æ®</strong>çš„ä½œç”¨ï¼Œä¸å­˜å‚¨æ•°æ®ã€‚</p><p>çº¢è‰²æ¡†æ˜¯æ•°æ®å­˜å‚¨éƒ¨åˆ†ï¼Œåœ¨å…¶å¶å­èŠ‚ç‚¹ä¸­è¦<strong>å­˜å‚¨</strong>å…·ä½“çš„æ•°æ®</p><h4 id="ï¼ˆ2ï¼‰ç¤ºä¾‹-1"><a href="#ï¼ˆ2ï¼‰ç¤ºä¾‹-1" class="headerlink" title="ï¼ˆ2ï¼‰ç¤ºä¾‹"></a>ï¼ˆ2ï¼‰ç¤ºä¾‹</h4><p><img src="/img/33592/B+Tree2.png" alt="image-20230828232546423"></p><h4 id="ï¼ˆ3ï¼‰æ€»ç»“-1"><a href="#ï¼ˆ3ï¼‰æ€»ç»“-1" class="headerlink" title="ï¼ˆ3ï¼‰æ€»ç»“"></a>ï¼ˆ3ï¼‰æ€»ç»“</h4><ul><li>æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šå‡ºç°åœ¨<strong>å¶å­èŠ‚ç‚¹</strong>ã€‚ </li><li>å¶å­èŠ‚ç‚¹å½¢æˆä¸€ä¸ª<strong>å•å‘é“¾è¡¨</strong>ã€‚</li><li><strong>éå¶å­èŠ‚ç‚¹</strong>ä»…ä»…èµ·åˆ°<strong>ç´¢å¼•æ•°æ®</strong>ä½œç”¨ï¼Œå…·ä½“çš„<strong>æ•°æ®éƒ½æ˜¯åœ¨å¶å­èŠ‚ç‚¹å­˜æ”¾</strong>çš„ã€‚</li></ul><h4 id="ï¼ˆ4ï¼‰MySQLä¼˜åŒ–"><a href="#ï¼ˆ4ï¼‰MySQLä¼˜åŒ–" class="headerlink" title="ï¼ˆ4ï¼‰MySQLä¼˜åŒ–"></a>ï¼ˆ4ï¼‰MySQLä¼˜åŒ–</h4><p><img src="/img/33592/B+Tree3.png" alt="image-20230828232716047"></p><p>åœ¨åŸB+Treeçš„åŸºç¡€ä¸Šï¼Œå¢åŠ ä¸€ä¸ªæŒ‡å‘ç›¸é‚»å¶å­èŠ‚ç‚¹çš„é“¾è¡¨æŒ‡é’ˆï¼Œå°±å½¢æˆäº†å¸¦æœ‰<strong>åŒå‘æŒ‡é’ˆ</strong>çš„B+Treeï¼Œæé«˜åŒºé—´è®¿é—®çš„æ€§èƒ½ï¼Œåˆ©äºæ’åº</p><h3 id="Hashç´¢å¼•"><a href="#Hashç´¢å¼•" class="headerlink" title="Hashç´¢å¼•"></a>Hashç´¢å¼•</h3><h4 id="ï¼ˆ1ï¼‰ä»‹ç»-2"><a href="#ï¼ˆ1ï¼‰ä»‹ç»-2" class="headerlink" title="ï¼ˆ1ï¼‰ä»‹ç»"></a>ï¼ˆ1ï¼‰ä»‹ç»</h4><blockquote><p>å“ˆå¸Œç´¢å¼•å°±æ˜¯é‡‡ç”¨ä¸€å®šçš„hashç®—æ³•ï¼Œå°†é”®å€¼æ¢ç®—æˆæ–°çš„hashå€¼ï¼Œæ˜ å°„åˆ°å¯¹åº”çš„æ§½ä½ä¸Šï¼Œç„¶åå­˜å‚¨åœ¨ hashè¡¨ä¸­</p></blockquote><p><img src="/img/33592/Hash%E7%B4%A2%E5%BC%95.png" alt="image-20230829160928710"></p><p>å¦‚æœä¸¤ä¸ª(æˆ–å¤šä¸ª)é”®å€¼ï¼Œæ˜ å°„åˆ°ä¸€ä¸ªç›¸åŒçš„æ§½ä½ä¸Šï¼Œå°±äº§ç”Ÿäº†<strong>hashå†²çª</strong>ï¼ˆä¹Ÿç§°ä¸ºhashç¢°æ’ï¼‰ï¼Œé€šè¿‡<strong>é“¾è¡¨</strong>æ¥è§£å†³</p><h4 id="ï¼ˆ2ï¼‰ç‰¹ç‚¹"><a href="#ï¼ˆ2ï¼‰ç‰¹ç‚¹" class="headerlink" title="ï¼ˆ2ï¼‰ç‰¹ç‚¹"></a>ï¼ˆ2ï¼‰ç‰¹ç‚¹</h4><ul><li>Hashç´¢å¼•åªèƒ½ç”¨äºå¯¹ç­‰æ¯”è¾ƒ(&#x3D;ï¼Œin)ï¼Œ<strong>ä¸æ”¯æŒèŒƒå›´æŸ¥è¯¢</strong>ï¼ˆbetweenï¼Œ&gt;ï¼Œ&lt; ï¼Œâ€¦ï¼‰</li><li>æ— æ³•åˆ©ç”¨<strong>ç´¢å¼•</strong>å®Œæˆæ’åºæ“ä½œ</li><li>æŸ¥è¯¢æ•ˆç‡é«˜ï¼Œé€šå¸¸(ä¸å­˜åœ¨hashå†²çªçš„æƒ…å†µ)åªéœ€è¦ä¸€æ¬¡æ£€ç´¢å°±å¯ä»¥äº†ï¼Œæ•ˆç‡é€šå¸¸è¦é«˜äºB+treeç´¢å¼•</li></ul><h4 id="ï¼ˆ3ï¼‰å­˜å‚¨å¼•æ“"><a href="#ï¼ˆ3ï¼‰å­˜å‚¨å¼•æ“" class="headerlink" title="ï¼ˆ3ï¼‰å­˜å‚¨å¼•æ“"></a>ï¼ˆ3ï¼‰å­˜å‚¨å¼•æ“</h4><p>åœ¨MySQLä¸­ï¼Œæ”¯æŒhashç´¢å¼•çš„æ˜¯<strong>Memoryå­˜å‚¨å¼•æ“</strong>ã€‚ è€ŒInnoDBä¸­å…·æœ‰è‡ªé€‚åº”hashåŠŸèƒ½ï¼Œhashç´¢å¼•æ˜¯ InnoDBå­˜å‚¨å¼•æ“æ ¹æ®B+Treeç´¢å¼•åœ¨æŒ‡å®šæ¡ä»¶ä¸‹è‡ªåŠ¨æ„å»ºçš„</p><h3 id="é€‰æ‹©B-Treeçš„åŸå› "><a href="#é€‰æ‹©B-Treeçš„åŸå› " class="headerlink" title="é€‰æ‹©B+Treeçš„åŸå› "></a>é€‰æ‹©B+Treeçš„åŸå› </h3><p>ç›¸å¯¹äºäºŒå‰æ ‘ï¼Œå±‚çº§æ›´å°‘ï¼Œæœç´¢æ•ˆç‡é«˜ï¼› </p><p>å¯¹äºB-treeï¼Œæ— è®ºæ˜¯å¶å­èŠ‚ç‚¹è¿˜æ˜¯éå¶å­èŠ‚ç‚¹ï¼Œéƒ½ä¼šä¿å­˜æ•°æ®ï¼Œè¿™æ ·å¯¼è‡´ä¸€é¡µä¸­å­˜å‚¨çš„é”®å€¼å‡å°‘ï¼ŒæŒ‡é’ˆè·Ÿç€å‡å°‘ï¼Œè¦åŒæ ·ä¿å­˜å¤§é‡æ•°æ®ï¼Œåªèƒ½å¢åŠ æ ‘çš„é«˜åº¦ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ï¼› </p><p>ç›¸å¯¹Hashç´¢å¼•ï¼ŒB+treeæ”¯æŒèŒƒå›´åŒ¹é…åŠæ’åºæ“ä½œï¼›</p><h2 id="ğŸç´¢å¼•åˆ†ç±»"><a href="#ğŸç´¢å¼•åˆ†ç±»" class="headerlink" title="ğŸç´¢å¼•åˆ†ç±»"></a>ğŸç´¢å¼•åˆ†ç±»</h2><h3 id="MySQLæ•°æ®åº“åˆ†ç±»"><a href="#MySQLæ•°æ®åº“åˆ†ç±»" class="headerlink" title="MySQLæ•°æ®åº“åˆ†ç±»"></a>MySQLæ•°æ®åº“åˆ†ç±»</h3><table><thead><tr><th>åˆ†ç±»</th><th>ä»‹ç»</th><th>æ•°é‡</th><th>å…³é”®å­—</th></tr></thead><tbody><tr><td>ä¸»é”®ç´¢å¼•</td><td>é’ˆå¯¹äºè¡¨ä¸­ä¸»é”®åˆ›å»ºçš„ç´¢å¼•</td><td>é»˜è®¤è‡ªåŠ¨åˆ›å»ºï¼Œåªæœ‰ä¸€ä¸ª</td><td>PRIMARY</td></tr><tr><td>å”¯ä¸€ç´¢å¼•</td><td>é¿å…åŒä¸€ä¸ªè¡¨ä¸­æŸæ•°æ®åˆ—ä¸­çš„å€¼é‡å¤</td><td>å¤šä¸ª</td><td>UNIQUE</td></tr><tr><td>å¸¸è§„ç´¢å¼•</td><td>å¿«é€Ÿå®šä½ç‰¹å®šæ•°æ®</td><td>å¤šä¸ª</td><td></td></tr><tr><td>å…¨æ–‡ç´¢å¼•</td><td>å…¨æ–‡ç´¢å¼•æŸ¥æ‰¾çš„æ˜¯æ–‡æœ¬ä¸­çš„å…³é”®è¯ï¼Œè€Œä¸æ˜¯æ¯” è¾ƒç´¢å¼•ä¸­çš„å€¼</td><td>å¤šä¸ª</td><td>FULLTEXT</td></tr></tbody></table><h3 id="InnoDBå­˜å‚¨å¼•æ“åˆ†ç±»"><a href="#InnoDBå­˜å‚¨å¼•æ“åˆ†ç±»" class="headerlink" title="InnoDBå­˜å‚¨å¼•æ“åˆ†ç±»"></a>InnoDBå­˜å‚¨å¼•æ“åˆ†ç±»</h3><h4 id="ï¼ˆ1ï¼‰åˆ†ç±»"><a href="#ï¼ˆ1ï¼‰åˆ†ç±»" class="headerlink" title="ï¼ˆ1ï¼‰åˆ†ç±»"></a>ï¼ˆ1ï¼‰åˆ†ç±»</h4><table><thead><tr><th>åˆ†ç±»</th><th>ä»‹ç»</th><th>æ•°é‡</th></tr></thead><tbody><tr><td>èšé›†ç´¢å¼•(Clustered Index)</td><td>å°†æ•°æ®å­˜å‚¨ä¸ç´¢å¼•æ”¾åˆ°äº†ä¸€å—ï¼Œç´¢å¼•ç»“æ„çš„å¶å­ èŠ‚ç‚¹ä¿å­˜äº†è¡Œæ•°æ®</td><td>å¿…é¡»æœ‰,è€Œä¸”åª æœ‰ä¸€ä¸ª</td></tr><tr><td>äºŒçº§ç´¢å¼•(Secondary Index)</td><td>å°†æ•°æ®ä¸ç´¢å¼•åˆ†å¼€å­˜å‚¨ï¼Œç´¢å¼•ç»“æ„çš„å¶å­èŠ‚ç‚¹å…³ è”çš„æ˜¯å¯¹åº”çš„ä¸»é”®</td><td>å¤šä¸ª</td></tr></tbody></table><h4 id="ï¼ˆ2ï¼‰èšé›†ç´¢å¼•é€‰å–è§„åˆ™"><a href="#ï¼ˆ2ï¼‰èšé›†ç´¢å¼•é€‰å–è§„åˆ™" class="headerlink" title="ï¼ˆ2ï¼‰èšé›†ç´¢å¼•é€‰å–è§„åˆ™"></a>ï¼ˆ2ï¼‰èšé›†ç´¢å¼•é€‰å–è§„åˆ™</h4><ul><li>å¦‚æœå­˜åœ¨ä¸»é”®ï¼Œ<strong>ä¸»é”®</strong>ç´¢å¼•å°±æ˜¯èšé›†ç´¢å¼•ã€‚</li><li>å¦‚æœä¸å­˜åœ¨ä¸»é”®ï¼Œå°†ä½¿ç”¨<strong>ç¬¬ä¸€ä¸ªå”¯ä¸€</strong>ï¼ˆUNIQUEï¼‰ç´¢å¼•ä½œä¸ºèšé›†ç´¢å¼•ã€‚</li><li>å¦‚æœè¡¨æ²¡æœ‰ä¸»é”®ï¼Œæˆ–æ²¡æœ‰åˆé€‚çš„å”¯ä¸€ç´¢å¼•ï¼Œåˆ™InnoDBä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª<strong>rowid</strong>ä½œä¸ºéšè—çš„èšé›†ç´¢å¼•</li></ul><h4 id="ï¼ˆ3ï¼‰å…·ä½“ç»“æ„"><a href="#ï¼ˆ3ï¼‰å…·ä½“ç»“æ„" class="headerlink" title="ï¼ˆ3ï¼‰å…·ä½“ç»“æ„"></a>ï¼ˆ3ï¼‰å…·ä½“ç»“æ„</h4><img src="/img/33592/èšé›†äºŒçº§ç´¢å¼•1.png" alt="image-20230829171222052" style="zoom:80%;" /><ul><li>èšé›†ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸‹æŒ‚çš„æ˜¯è¿™<strong>ä¸€è¡Œçš„æ•°æ®</strong> ã€‚ </li><li>äºŒçº§ç´¢å¼•çš„å¶å­èŠ‚ç‚¹ä¸‹æŒ‚çš„æ˜¯è¯¥å­—æ®µå€¼<strong>å¯¹åº”çš„ä¸»é”®å€¼</strong>ã€‚</li></ul><h4 id="ï¼ˆ4ï¼‰æŸ¥æ‰¾ç¤ºä¾‹"><a href="#ï¼ˆ4ï¼‰æŸ¥æ‰¾ç¤ºä¾‹" class="headerlink" title="ï¼ˆ4ï¼‰æŸ¥æ‰¾ç¤ºä¾‹"></a>ï¼ˆ4ï¼‰æŸ¥æ‰¾ç¤ºä¾‹</h4><img src="/img/33592/èšé›†äºŒçº§ç´¢å¼•2.png" alt="image-20230829171413948" style="zoom:80%;" /><ol><li>æ ¹æ®nameå­—æ®µè¿›è¡ŒæŸ¥è¯¢ï¼Œæ‰€ä»¥å…ˆæ ¹æ®name&#x3D;â€™Armâ€™åˆ°nameå­—æ®µçš„äºŒçº§ç´¢å¼•ä¸­è¿›è¡ŒåŒ¹é…æŸ¥æ‰¾ã€‚ä½†æ˜¯åœ¨äºŒçº§ç´¢å¼•ä¸­åªèƒ½æŸ¥æ‰¾åˆ° Arm å¯¹åº”çš„ä¸»é”®å€¼ 10ã€‚</li><li>ç”±äºæŸ¥è¯¢è¿”å›çš„æ•°æ®æ˜¯*ï¼Œæ‰€ä»¥æ­¤æ—¶ï¼Œè¿˜éœ€è¦æ ¹æ®ä¸»é”®å€¼10ï¼Œåˆ°èšé›†ç´¢å¼•ä¸­æŸ¥æ‰¾10å¯¹åº”çš„è®°å½•ï¼Œæœ€ç»ˆæ‰¾åˆ°10å¯¹åº”çš„è¡Œrowã€‚ </li><li>æœ€ç»ˆæ‹¿åˆ°è¿™ä¸€è¡Œçš„æ•°æ®ï¼Œç›´æ¥è¿”å›å³å¯ã€‚</li></ol><blockquote><p>å›è¡¨æŸ¥è¯¢ï¼š è¿™ç§å…ˆåˆ°äºŒçº§ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®ï¼Œæ‰¾åˆ°ä¸»é”®å€¼ï¼Œç„¶åå†åˆ°èšé›†ç´¢å¼•ä¸­æ ¹æ®ä¸»é”®å€¼ï¼Œè·å– æ•°æ®çš„æ–¹å¼ï¼Œå°±ç§°ä¹‹ä¸ºå›è¡¨æŸ¥è¯¢ã€‚</p></blockquote><h4 id="ï¼ˆ5ï¼‰æ€»ç»“"><a href="#ï¼ˆ5ï¼‰æ€»ç»“" class="headerlink" title="ï¼ˆ5ï¼‰æ€»ç»“"></a>ï¼ˆ5ï¼‰æ€»ç»“</h4><p>èµ°ä¸»é”®ç´¢å¼•çš„æ•ˆç‡é«˜äºèµ°äºŒçº§ç´¢å¼•</p><p>InnoDBä¸»é”®ç´¢å¼•çš„B+treeé«˜åº¦ï¼šæ ‘çš„é«˜åº¦ä¸º3ï¼Œåˆ™å¯ä»¥å­˜å‚¨ 2200w å·¦å³çš„è®°å½•</p><h2 id="ğŸç´¢å¼•è¯­æ³•"><a href="#ğŸç´¢å¼•è¯­æ³•" class="headerlink" title="ğŸç´¢å¼•è¯­æ³•"></a>ğŸç´¢å¼•è¯­æ³•</h2><h3 id="åˆ›å»ºç´¢å¼•"><a href="#åˆ›å»ºç´¢å¼•" class="headerlink" title="åˆ›å»ºç´¢å¼•"></a>åˆ›å»ºç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span>  [ <span class="keyword">UNIQUE</span> <span class="operator">|</span> FULLTEXT ]  INDEX  index_name  <span class="keyword">ON</span>  table_name  ( </span><br><span class="line">index_col_name,... ) ;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥çœ‹ç´¢å¼•"><a href="#æŸ¥çœ‹ç´¢å¼•" class="headerlink" title="æŸ¥çœ‹ç´¢å¼•"></a>æŸ¥çœ‹ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SHOW</span>  INDEX  <span class="keyword">FROM</span>  table_name ;</span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤ç´¢å¼•"><a href="#åˆ é™¤ç´¢å¼•" class="headerlink" title="åˆ é™¤ç´¢å¼•"></a>åˆ é™¤ç´¢å¼•</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span>  INDEX  index_name  <span class="keyword">ON</span>  table_name ;</span><br></pre></td></tr></table></figure><h3 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h3><p>1.phoneæ‰‹æœºå·å­—æ®µçš„å€¼ï¼Œæ˜¯éç©ºï¼Œä¸”å”¯ä¸€çš„ï¼Œä¸ºè¯¥å­—æ®µåˆ›å»ºå”¯ä¸€ç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> INDEX idx_user_phone <span class="keyword">ON</span> tb_user(phone);</span><br></pre></td></tr></table></figure><p>2.ä¸ºprofessionã€ageã€statusåˆ›å»ºè”åˆç´¢å¼•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> INDEX idx_user_pro_age_sta <span class="keyword">ON</span> tb_user(profession,age,status);</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLå­˜å‚¨å¼•æ“</title>
      <link href="/posts/14571/"/>
      <url>/posts/14571/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç®€ä»‹"><a href="#ğŸç®€ä»‹" class="headerlink" title="ğŸç®€ä»‹"></a>ğŸç®€ä»‹</h2><blockquote><p>å­˜å‚¨å¼•æ“å°±æ˜¯å­˜å‚¨æ•°æ®ã€å»ºç«‹ç´¢å¼•ã€æ›´æ–°&#x2F;æŸ¥è¯¢æ•°æ®ç­‰æŠ€æœ¯çš„å®ç°æ–¹å¼ ã€‚å­˜å‚¨å¼•æ“æ˜¯åŸºäºè¡¨çš„ï¼Œè€Œä¸æ˜¯åŸºäºåº“çš„ï¼Œæ‰€ä»¥å­˜å‚¨å¼•æ“ä¹Ÿå¯è¢«ç§°ä¸ºè¡¨ç±»å‹</p></blockquote><p>å»ºè¡¨æ—¶æŒ‡å®šå­˜å‚¨å¼•æ“</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE  è¡¨å(</span><br><span class="line">    å­—æ®µ1  å­—æ®µ1ç±»å‹   [ COMMENT  å­—æ®µ1æ³¨é‡Š ] ,</span><br><span class="line">     ......</span><br><span class="line">    å­—æ®µn  å­—æ®µnç±»å‹   [COMMENT  å­—æ®µnæ³¨é‡Š ] </span><br><span class="line">) ENGINE = INNODB   [ COMMENT  è¡¨æ³¨é‡Š ] ;</span><br></pre></td></tr></table></figure><h2 id="ğŸä¸»è¦åˆ†ç±»"><a href="#ğŸä¸»è¦åˆ†ç±»" class="headerlink" title="ğŸä¸»è¦åˆ†ç±»"></a>ğŸä¸»è¦åˆ†ç±»</h2><h3 id="InnoDB"><a href="#InnoDB" class="headerlink" title="InnoDB"></a>InnoDB</h3><blockquote><p>å…¼é¡¾é«˜å¯é æ€§å’Œé«˜æ€§èƒ½çš„é€šç”¨å­˜å‚¨å¼•æ“ï¼Œ MySQL 5.5 ä¹‹åï¼ŒInnoDBæ˜¯é»˜è®¤çš„å­˜å‚¨å¼•æ“</p></blockquote><h4 id="1-ç‰¹ç‚¹"><a href="#1-ç‰¹ç‚¹" class="headerlink" title="1.ç‰¹ç‚¹"></a>1.ç‰¹ç‚¹</h4><ul><li>DMLæ“ä½œéµå¾ªACIDæ¨¡å‹ï¼Œæ”¯æŒäº‹åŠ¡ï¼› </li><li>è¡Œçº§é”ï¼Œæé«˜å¹¶å‘è®¿é—®æ€§èƒ½ï¼› </li><li>æ”¯æŒå¤–é”®FOREIGN KEYçº¦æŸï¼Œä¿è¯æ•°æ®çš„å®Œæ•´æ€§å’Œæ­£ç¡®æ€§ï¼›</li></ul><h4 id="2-æ–‡ä»¶"><a href="#2-æ–‡ä»¶" class="headerlink" title="2.æ–‡ä»¶"></a>2.æ–‡ä»¶</h4><p>xxx.ibdï¼šxxxä»£è¡¨çš„æ˜¯è¡¨åï¼ŒinnoDBå¼•æ“çš„æ¯å¼ è¡¨éƒ½ä¼šå¯¹åº”è¿™æ ·ä¸€ä¸ªè¡¨ç©ºé—´æ–‡ä»¶ï¼Œå­˜å‚¨è¯¥è¡¨çš„è¡¨ç»“æ„ï¼ˆfrm-æ—©æœŸçš„ ã€sdi-æ–°ç‰ˆçš„ï¼‰ã€æ•°æ®å’Œç´¢å¼•ã€‚</p><h4 id="3-é€»è¾‘å­˜å‚¨ç»“æ„"><a href="#3-é€»è¾‘å­˜å‚¨ç»“æ„" class="headerlink" title="3.é€»è¾‘å­˜å‚¨ç»“æ„"></a>3.é€»è¾‘å­˜å‚¨ç»“æ„</h4><p><img src="/img/14571/mysql%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E.png" alt="image-20230827103143080"></p><p>è¡¨ç©ºé—´: InnoDBå­˜å‚¨å¼•æ“é€»è¾‘ç»“æ„çš„<strong>æœ€é«˜å±‚</strong>ï¼Œibdæ–‡ä»¶å…¶å®å°±æ˜¯è¡¨ç©ºé—´æ–‡ä»¶ï¼Œåœ¨è¡¨ç©ºé—´ä¸­å¯ä»¥<br>åŒ…å«å¤šä¸ªSegmentæ®µã€‚<br>æ®µ : è¡¨ç©ºé—´æ˜¯ç”±å„ä¸ªæ®µç»„æˆçš„ï¼Œ å¸¸è§çš„æ®µæœ‰æ•°æ®æ®µã€ç´¢å¼•æ®µã€å›æ»šæ®µç­‰ã€‚InnoDBä¸­å¯¹äºæ®µçš„ç®¡<br>ç†ï¼Œéƒ½æ˜¯å¼•æ“è‡ªèº«å®Œæˆï¼Œä¸éœ€è¦äººä¸ºå¯¹å…¶æ§åˆ¶ï¼Œä¸€ä¸ªæ®µä¸­åŒ…å«å¤šä¸ªåŒºã€‚<br>åŒº : åŒºæ˜¯è¡¨ç©ºé—´çš„å•å…ƒç»“æ„ï¼Œæ¯ä¸ªåŒºçš„å¤§å°ä¸º<strong>1M</strong>ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œ InnoDBå­˜å‚¨å¼•æ“é¡µå¤§å°ä¸º<br>16Kï¼Œ å³ä¸€ä¸ªåŒºä¸­ä¸€å…±æœ‰<strong>64ä¸ªè¿ç»­çš„é¡µ</strong>ã€‚<br>é¡µ : é¡µæ˜¯ç»„æˆåŒºçš„<strong>æœ€å°å•å…ƒ</strong>ï¼Œé¡µä¹Ÿæ˜¯InnoDB å­˜å‚¨å¼•æ“ç£ç›˜ç®¡ç†çš„æœ€å°å•å…ƒï¼Œæ¯ä¸ªé¡µçš„å¤§å°é»˜<br>è®¤ä¸º <strong>16KB</strong>ã€‚ä¸ºäº†ä¿è¯é¡µçš„è¿ç»­æ€§ï¼ŒInnoDB å­˜å‚¨å¼•æ“æ¯æ¬¡ä»ç£ç›˜ç”³è¯· 4-5 ä¸ªåŒºã€‚<br>è¡Œ : InnoDB å­˜å‚¨å¼•æ“æ˜¯é¢å‘è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´<strong>æ•°æ®æ˜¯æŒ‰è¡Œè¿›è¡Œå­˜æ”¾</strong>çš„ï¼Œåœ¨æ¯ä¸€è¡Œä¸­é™¤äº†å®šä¹‰è¡¨æ—¶<br>æ‰€æŒ‡å®šçš„å­—æ®µä»¥å¤–ï¼Œè¿˜åŒ…å«ä¸¤ä¸ªéšè—å­—æ®µ(åé¢ä¼šè¯¦ç»†ä»‹ç»)ã€‚</p><h3 id="MyISAM"><a href="#MyISAM" class="headerlink" title="MyISAM"></a>MyISAM</h3><blockquote><p>MyISAMæ˜¯MySQLæ—©æœŸçš„é»˜è®¤å­˜å‚¨å¼•æ“</p></blockquote><h4 id="1-ç‰¹ç‚¹-1"><a href="#1-ç‰¹ç‚¹-1" class="headerlink" title="1.ç‰¹ç‚¹"></a>1.ç‰¹ç‚¹</h4><ul><li>ä¸æ”¯æŒäº‹åŠ¡ï¼Œä¸æ”¯æŒå¤–é”®</li><li>æ”¯æŒè¡¨é”ï¼Œä¸æ”¯æŒè¡Œé”</li><li>è®¿é—®é€Ÿåº¦å¿«</li></ul><h4 id="2-æ–‡ä»¶-1"><a href="#2-æ–‡ä»¶-1" class="headerlink" title="2.æ–‡ä»¶"></a>2.æ–‡ä»¶</h4><ul><li>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</li><li>xxx.MYD: å­˜å‚¨æ•°æ®</li><li>xxx.MYI: å­˜å‚¨ç´¢å¼•</li></ul><h3 id="Memory"><a href="#Memory" class="headerlink" title="Memory"></a>Memory</h3><blockquote><p>Memoryå¼•æ“çš„è¡¨æ•°æ®æ—¶å­˜å‚¨åœ¨å†…å­˜ä¸­çš„ï¼Œç”±äºå—åˆ°ç¡¬ä»¶é—®é¢˜ã€æˆ–æ–­ç”µé—®é¢˜çš„å½±å“ï¼Œåªèƒ½å°†è¿™äº›è¡¨ä½œä¸º ä¸´æ—¶è¡¨æˆ–ç¼“å­˜ä½¿ç”¨</p></blockquote><h4 id="1-ç‰¹ç‚¹-2"><a href="#1-ç‰¹ç‚¹-2" class="headerlink" title="1.ç‰¹ç‚¹"></a>1.ç‰¹ç‚¹</h4><ul><li>å†…å­˜å­˜æ”¾</li><li>hashç´¢å¼•ï¼ˆé»˜è®¤ï¼‰</li></ul><h4 id="2-æ–‡ä»¶-2"><a href="#2-æ–‡ä»¶-2" class="headerlink" title="2.æ–‡ä»¶"></a>2.æ–‡ä»¶</h4><p>xxx.sdiï¼šå­˜å‚¨è¡¨ç»“æ„ä¿¡æ¯</p><h2 id="ğŸåŒºåˆ«"><a href="#ğŸåŒºåˆ«" class="headerlink" title="ğŸåŒºåˆ«"></a>ğŸåŒºåˆ«</h2><img src="/img/14571/mysqlå­˜å‚¨å¼•æ“2.png" alt="image-20230827104044780" style="zoom: 67%;" /><p><strong>ï¼ˆé¢è¯•ï¼‰InnoDBå¼•æ“ä¸MyISAMå¼•æ“çš„åŒºåˆ« ?</strong></p><ul><li>InnoDBå¼•æ“æ”¯æŒäº‹åŠ¡, è€ŒMyISAMä¸æ”¯æŒã€‚</li><li>InnoDBå¼•æ“æ”¯æŒè¡Œé”å’Œè¡¨é”, è€ŒMyISAMä»…æ”¯æŒè¡¨é”, ä¸æ”¯æŒè¡Œé”ã€‚</li><li>InnoDBå¼•æ“æ”¯æŒå¤–é”®, è€ŒMyISAMæ˜¯ä¸æ”¯æŒçš„ã€‚</li></ul><p>ï¼ˆ<strong>å¤–é”®äº‹åŠ¡è¡Œçº§é”</strong>ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLåŸºç¡€</title>
      <link href="/posts/39026/"/>
      <url>/posts/39026/</url>
      
        <content type="html"><![CDATA[<p>ä¸»è¦æ€»ç»“MySQLåŸºç¡€éƒ¨åˆ†çš„æ˜“é”™ç‚¹å’Œæ˜“å¿½ç•¥ç‚¹</p><h2 id="ğŸæ•°æ®ç±»å‹"><a href="#ğŸæ•°æ®ç±»å‹" class="headerlink" title="ğŸæ•°æ®ç±»å‹"></a>ğŸæ•°æ®ç±»å‹</h2><p>MySQLä¸­çš„æ•°æ®ç±»å‹ä¸»è¦åˆ†ä¸ºä¸‰ç±»ï¼šæ•°å€¼ç±»å‹ã€å­—ç¬¦ä¸²ç±»å‹ã€æ—¥æœŸæ—¶é—´ç±»å‹</p><h3 id="æ•°å€¼ç±»å‹"><a href="#æ•°å€¼ç±»å‹" class="headerlink" title="æ•°å€¼ç±»å‹"></a>æ•°å€¼ç±»å‹</h3><p><strong>DECIMAL</strong></p><blockquote><p>ä¾èµ–äºM(ç²¾åº¦)å’ŒD(æ ‡åº¦) çš„å€¼</p></blockquote><p>å¦‚decimal(5,2)ï¼Œ5-2&#x3D;3ï¼Œå…¶ä¸­å°æ•°éƒ¨åˆ†ä¸º2ï¼Œå¯¹åº”1ä¸ªå­—èŠ‚ï¼Œæ•´æ•°éƒ¨åˆ†ä¸º3ï¼Œå¯¹åº”2ä¸ªå­—èŠ‚</p><h3 id="å­—ç¬¦ä¸²ç±»å‹"><a href="#å­—ç¬¦ä¸²ç±»å‹" class="headerlink" title="å­—ç¬¦ä¸²ç±»å‹"></a>å­—ç¬¦ä¸²ç±»å‹</h3><p><strong>CHAR&#x2F;VARCHAR</strong></p><blockquote><p>charæ˜¯å®šé•¿å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šé•¿åº¦å¤šé•¿ï¼Œå°±å ç”¨å¤šå°‘ä¸ªå­—ç¬¦ï¼Œå’Œå­—æ®µå€¼çš„é•¿åº¦æ— å…³ ã€‚è€Œvarcharæ˜¯å˜é•¿å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šçš„é•¿åº¦ä¸ºæœ€å¤§å ç”¨é•¿åº¦</p></blockquote><h3 id="æ—¥æœŸæ—¶é—´ç±»å‹"><a href="#æ—¥æœŸæ—¶é—´ç±»å‹" class="headerlink" title="æ—¥æœŸæ—¶é—´ç±»å‹"></a>æ—¥æœŸæ—¶é—´ç±»å‹</h3><table><thead><tr><th align="center">ç±»å‹</th><th align="center">èŒƒå›´</th><th align="center">æ ¼å¼</th><th align="center">æè¿°</th></tr></thead><tbody><tr><td align="center">DATE</td><td align="center">1000-01-01 è‡³ 9999-12-31</td><td align="center">YYYY-MM-DD</td><td align="center">æ—¥æœŸå€¼</td></tr><tr><td align="center">TIME</td><td align="center">-838:59:59 è‡³ 838:59:59</td><td align="center">HH:MM:SS</td><td align="center">æ—¶é—´å€¼</td></tr><tr><td align="center">DATETIME</td><td align="center">1000-01-01 00:00:00 è‡³ <br />9999-12-31 23:59:59</td><td align="center">YYYY-MM-DD HH:MM:SS</td><td align="center">æ··åˆæ—¥æœŸå’Œæ—¶é—´</td></tr></tbody></table><h2 id="ğŸSQL"><a href="#ğŸSQL" class="headerlink" title="ğŸSQL"></a>ğŸSQL</h2><h3 id="æ—¥æœŸæ—¶é—´ç±»å‹çš„æ“ä½œ"><a href="#æ—¥æœŸæ—¶é—´ç±»å‹çš„æ“ä½œ" class="headerlink" title="æ—¥æœŸæ—¶é—´ç±»å‹çš„æ“ä½œ"></a>æ—¥æœŸæ—¶é—´ç±»å‹çš„æ“ä½œ</h3><p>æ’å…¥</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> employee <span class="keyword">values</span>(<span class="number">2</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;å¼ æ— å¿Œ&#x27;</span>,<span class="string">&#x27;ç”·&#x27;</span>,<span class="number">18</span>,<span class="string">&#x27;123456789012345670&#x27;</span>,<span class="string">&#x27;2005-01</span></span><br><span class="line"><span class="string">01&#x27;</span>);</span><br></pre></td></tr></table></figure><p>æ›´æ–°</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> employee <span class="keyword">set</span> entrydate <span class="operator">=</span> <span class="string">&#x27;2008-01-01&#x27;</span>;</span><br></pre></td></tr></table></figure><h3 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h3><h4 id="BETWEEN-â€¦-AND-â€¦"><a href="#BETWEEN-â€¦-AND-â€¦" class="headerlink" title="BETWEEN â€¦ AND â€¦"></a>BETWEEN â€¦ AND â€¦</h4><p>åœ¨æŸä¸ªèŒƒå›´ä¹‹å†…(å«<strong>æœ€å°ã€æœ€å¤§</strong>å€¼)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥è¯¢å¹´é¾„åœ¨<span class="number">15</span>å²(åŒ…å«) åˆ° <span class="number">20</span>å²(åŒ…å«)ä¹‹é—´çš„å‘˜å·¥ä¿¡æ¯</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> age <span class="keyword">between</span> <span class="number">15</span> <span class="keyword">and</span> <span class="number">20</span>;</span><br></pre></td></tr></table></figure><h4 id="åˆ†ç»„æŸ¥è¯¢"><a href="#åˆ†ç»„æŸ¥è¯¢" class="headerlink" title="åˆ†ç»„æŸ¥è¯¢"></a>åˆ†ç»„æŸ¥è¯¢</h4><p>1.è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  å­—æ®µåˆ—è¡¨  <span class="keyword">FROM</span>   è¡¨å  [ <span class="keyword">WHERE</span>   æ¡ä»¶ ]  <span class="keyword">GROUP</span>   <span class="keyword">BY</span>  åˆ†ç»„å­—æ®µå  [ <span class="keyword">HAVING</span>  åˆ†ç»„</span><br><span class="line">åè¿‡æ»¤æ¡ä»¶ ];</span><br></pre></td></tr></table></figure><p>2.whereä¸havingåŒºåˆ«</p><ul><li>æ‰§è¡Œæ—¶æœºä¸åŒï¼šwhereæ˜¯<strong>åˆ†ç»„ä¹‹å‰</strong>è¿›è¡Œè¿‡æ»¤ï¼Œä¸æ»¡è¶³whereæ¡ä»¶ï¼Œä¸å‚ä¸åˆ†ç»„ï¼›è€Œhavingæ˜¯<strong>åˆ†ç»„ä¹‹å</strong>å¯¹ç»“æœè¿›è¡Œè¿‡æ»¤</li><li>åˆ¤æ–­æ¡ä»¶ä¸åŒï¼šwhere<strong>ä¸èƒ½å¯¹èšåˆå‡½æ•°è¿›è¡Œåˆ¤æ–­</strong>ï¼Œè€Œhavingå¯ä»¥</li></ul><p>3.èšåˆå‡½æ•°</p><ul><li>åˆ†ç»„ä¹‹åï¼ŒæŸ¥è¯¢çš„å­—æ®µä¸€èˆ¬ä¸ºèšåˆå‡½æ•°å’Œåˆ†ç»„å­—æ®µï¼ŒæŸ¥è¯¢å…¶ä»–å­—æ®µæ— ä»»ä½•æ„ä¹‰</li><li>æ‰§è¡Œé¡ºåº: where &gt; èšåˆå‡½æ•° &gt; having </li><li>æ”¯æŒå¤šå­—æ®µåˆ†ç»„, å…·ä½“è¯­æ³•ä¸º : group by columnA,columnB</li></ul><h4 id="åˆ†é¡µæŸ¥è¯¢"><a href="#åˆ†é¡µæŸ¥è¯¢" class="headerlink" title="åˆ†é¡µæŸ¥è¯¢"></a>åˆ†é¡µæŸ¥è¯¢</h4><p>1.è¯­æ³•</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span>  å­—æ®µåˆ—è¡¨  <span class="keyword">FROM</span>   è¡¨å  LIMIT  èµ·å§‹ç´¢å¼•, æŸ¥è¯¢è®°å½•æ•° ;</span><br></pre></td></tr></table></figure><p>2.æ³¨æ„äº‹é¡¹<br>èµ·å§‹ç´¢å¼•ä»0å¼€å§‹ï¼Œèµ·å§‹ç´¢å¼• &#x3D; <em><em>ï¼ˆæŸ¥è¯¢é¡µç  - 1ï¼‰</em> æ¯é¡µæ˜¾ç¤ºè®°å½•æ•°</em>*<br>å¦‚æœæŸ¥è¯¢çš„æ˜¯ç¬¬ä¸€é¡µæ•°æ®ï¼Œèµ·å§‹ç´¢å¼•å¯ä»¥çœç•¥ï¼Œç›´æ¥ç®€å†™ä¸º limit 10</p><p>3.ç¤ºä¾‹</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span> æŸ¥è¯¢ç¬¬<span class="number">2</span>é¡µå‘˜å·¥æ•°æ®, æ¯é¡µå±•ç¤º<span class="number">10</span>æ¡è®°å½•,æ³¨æ„èµ·å§‹ç´¢å¼•</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp limit <span class="number">10</span>,<span class="number">10</span>;</span><br></pre></td></tr></table></figure><p>4.æŸ¥è¯¢æ’åå‰å‡ </p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">/</span><span class="operator">/</span>æŸ¥è¯¢æ€§åˆ«ä¸ºç”·ï¼Œä¸”å¹´é¾„åœ¨<span class="number">20</span><span class="number">-40</span> å²(å«)ä»¥å†…çš„å‰<span class="number">5</span>ä¸ªå‘˜å·¥ä¿¡æ¯ï¼Œå¯¹æŸ¥è¯¢çš„ç»“æœæŒ‰å¹´é¾„å‡åºæ’åºï¼Œ</span><br><span class="line">å¹´é¾„ç›¸åŒæŒ‰å…¥èŒæ—¶é—´å‡åºæ’åºã€‚</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> emp <span class="keyword">where</span> gender <span class="operator">=</span> <span class="string">&#x27;ç”·&#x27;</span> <span class="keyword">and</span> age <span class="keyword">between</span> <span class="number">20</span> <span class="keyword">and</span> <span class="number">40</span> <span class="keyword">order</span> <span class="keyword">by</span> age <span class="keyword">asc</span> , </span><br><span class="line">entrydate <span class="keyword">asc</span> limit <span class="number">5</span> ;</span><br></pre></td></tr></table></figure><h4 id="æ‰§è¡Œé¡ºåº"><a href="#æ‰§è¡Œé¡ºåº" class="headerlink" title="æ‰§è¡Œé¡ºåº"></a>æ‰§è¡Œé¡ºåº</h4><p><img src="/img/39026/mysql1.png" alt="image-20230824231550177"></p><h2 id="ğŸçº¦æŸ"><a href="#ğŸçº¦æŸ" class="headerlink" title="ğŸçº¦æŸ"></a>ğŸçº¦æŸ</h2><h3 id="çº¦æŸç±»å‹"><a href="#çº¦æŸç±»å‹" class="headerlink" title="çº¦æŸç±»å‹"></a>çº¦æŸç±»å‹</h3><img src="/img/39026/mysql2.png" alt="image-20230826170040097" style="zoom:80%;" /><p>å»ºè¡¨æ¼”ç¤ºï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tb_user(</span><br><span class="line">id <span class="type">int</span> AUTO_INCREMENT PRIMAEY KEY COMMENT <span class="string">&#x27;ä¸»é”®&#x27;</span>,</span><br><span class="line">name <span class="type">varchar</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">UNIQUE</span> COMMENT <span class="string">&#x27;å§“å&#x27;</span>,</span><br><span class="line">age <span class="type">int</span> <span class="keyword">check</span>(age <span class="operator">&gt;</span> <span class="number">0</span> <span class="operator">&amp;&amp;</span> age <span class="operator">&lt;=</span> <span class="number">120</span>) COMMENT <span class="string">&#x27;å¹´é¾„&#x27;</span>,</span><br><span class="line">status <span class="type">char</span>(<span class="number">1</span>) <span class="keyword">DEFAULT</span> <span class="string">&#x27;1&#x27;</span> COMMENT <span class="string">&#x27;çŠ¶æ€&#x27;</span>,</span><br><span class="line">gender <span class="type">char</span>(<span class="number">1</span>) COMMENT <span class="string">&#x27;æ€§åˆ«&#x27;</span>,</span><br><span class="line">dept_id <span class="type">int</span> COMMENT <span class="string">&#x27;éƒ¨é—¨&#x27;</span>,</span><br><span class="line">    <span class="keyword">FOREIGN</span> KEY(dept_id) <span class="keyword">REFERENCES</span> dept(id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ å¤–é”®"><a href="#æ·»åŠ å¤–é”®" class="headerlink" title="æ·»åŠ å¤–é”®"></a>æ·»åŠ å¤–é”®</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> è¡¨å(</span><br><span class="line">å­—æ®µå    æ•°æ®ç±»å‹,</span><br><span class="line"> ...</span><br><span class="line"> [<span class="keyword">CONSTRAINT</span>]  [å¤–é”®åç§°] <span class="keyword">FOREIGN</span>  KEY (å¤–é”®å­—æ®µå)   <span class="keyword">REFERENCES</span>   ä¸»è¡¨ (ä¸»è¡¨åˆ—å)</span><br><span class="line">);</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span>   <span class="keyword">TABLE</span>  è¡¨å   <span class="keyword">ADD</span>  <span class="keyword">CONSTRAINT</span>   å¤–é”®åç§°   <span class="keyword">FOREIGN</span>   KEY (å¤–é”®å­—æ®µå)  </span><br><span class="line"><span class="keyword">REFERENCES</span>  ä¸»è¡¨ (ä¸»è¡¨åˆ—å) ;</span><br><span class="line"><span class="operator">/</span><span class="operator">/</span> ç¤ºä¾‹</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> emp <span class="keyword">add</span> <span class="keyword">constraint</span> fk_emp_dept_id <span class="keyword">foreign</span> key (dept_id) <span class="keyword">references</span> </span><br><span class="line">dept(id)  <span class="keyword">on</span> <span class="keyword">update</span> cascade <span class="keyword">on</span> <span class="keyword">delete</span> cascade;</span><br></pre></td></tr></table></figure><h2 id="ğŸäº‹åŠ¡"><a href="#ğŸäº‹åŠ¡" class="headerlink" title="ğŸäº‹åŠ¡"></a>ğŸäº‹åŠ¡</h2><h3 id="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID"><a href="#äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID" class="headerlink" title="äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID"></a>äº‹åŠ¡çš„å››å¤§ç‰¹æ€§ACID</h3><p>åŸå­æ€§ï¼ˆAtomicityï¼‰ï¼šäº‹åŠ¡æ˜¯ä¸å¯åˆ†å‰²çš„æœ€å°æ“ä½œå•å…ƒï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ </p><p>ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šäº‹åŠ¡å®Œæˆæ—¶ï¼Œå¿…é¡»ä½¿æ‰€æœ‰çš„æ•°æ®éƒ½ä¿æŒä¸€è‡´çŠ¶æ€ã€‚ </p><p>éš”ç¦»æ€§ï¼ˆIsolationï¼‰ï¼šæ•°æ®åº“ç³»ç»Ÿæä¾›çš„éš”ç¦»æœºåˆ¶ï¼Œä¿è¯äº‹åŠ¡åœ¨ä¸å—å¤–éƒ¨å¹¶å‘æ“ä½œå½±å“çš„ç‹¬ç«‹ç¯å¢ƒä¸‹è¿è¡Œã€‚ </p><p>æŒä¹…æ€§ï¼ˆDurabilityï¼‰ï¼šäº‹åŠ¡ä¸€æ—¦æäº¤æˆ–å›æ»šï¼Œå®ƒå¯¹æ•°æ®åº“ä¸­çš„æ•°æ®çš„æ”¹å˜å°±æ˜¯æ°¸ä¹…çš„ã€‚</p><h3 id="å¹¶å‘äº‹åŠ¡é—®é¢˜"><a href="#å¹¶å‘äº‹åŠ¡é—®é¢˜" class="headerlink" title="å¹¶å‘äº‹åŠ¡é—®é¢˜"></a>å¹¶å‘äº‹åŠ¡é—®é¢˜</h3><h4 id="1-è„è¯»"><a href="#1-è„è¯»" class="headerlink" title="1.è„è¯»"></a>1.è„è¯»</h4><blockquote><p>ä¸€ä¸ªäº‹åŠ¡è¯»åˆ°å¦å¤–ä¸€ä¸ªäº‹åŠ¡è¿˜æ²¡æœ‰æäº¤çš„æ•°æ®ã€‚</p></blockquote><p><img src="/img/39026/%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%981.png" alt="image-20230826174624091"></p><p>Bè¯»å–åˆ°äº†Aæœªæäº¤çš„æ•°æ®</p><h4 id="2-ä¸å¯é‡å¤è¯»"><a href="#2-ä¸å¯é‡å¤è¯»" class="headerlink" title="2.ä¸å¯é‡å¤è¯»"></a>2.ä¸å¯é‡å¤è¯»</h4><blockquote><p>ä¸€ä¸ªäº‹åŠ¡å…ˆåè¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†ä¸¤æ¬¡è¯»å–çš„æ•°æ®ä¸åŒï¼Œç§°ä¹‹ä¸ºä¸å¯é‡å¤è¯»ã€‚</p></blockquote><p><img src="/img/39026/%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%982.png" alt="image-20230826174749208"></p><p>äº‹åŠ¡Aä¸¤æ¬¡è¯»å–åŒä¸€æ¡è®°å½•ï¼Œä½†æ˜¯è¯»å–åˆ°çš„æ•°æ®å´æ˜¯ä¸ä¸€æ ·çš„</p><h4 id="3-å¹»è¯»"><a href="#3-å¹»è¯»" class="headerlink" title="3.å¹»è¯»"></a>3.å¹»è¯»</h4><blockquote><p>ä¸€ä¸ªäº‹åŠ¡æŒ‰ç…§æ¡ä»¶æŸ¥è¯¢æ•°æ®æ—¶ï¼Œæ²¡æœ‰å¯¹åº”çš„æ•°æ®è¡Œï¼Œä½†æ˜¯åœ¨æ’å…¥æ•°æ®æ—¶ï¼Œåˆå‘ç°è¿™è¡Œæ•°æ® å·²ç»å­˜åœ¨ï¼Œå¥½åƒå‡ºç°äº† â€œå¹»å½±â€ã€‚</p></blockquote><p><img src="/img/39026/%E4%BA%8B%E5%8A%A1%E9%97%AE%E9%A2%983.png" alt="image-20230826174853048"></p><h3 id="äº‹åŠ¡éš”ç¦»çº§åˆ«"><a href="#äº‹åŠ¡éš”ç¦»çº§åˆ«" class="headerlink" title="äº‹åŠ¡éš”ç¦»çº§åˆ«"></a>äº‹åŠ¡éš”ç¦»çº§åˆ«</h3><table><thead><tr><th align="center">éš”ç¦»çº§åˆ«</th><th align="center">å­˜åœ¨è„è¯»</th><th align="center">å­˜åœ¨ä¸å¯é‡å¤è¯»</th><th align="center">å­˜åœ¨å¹»è¯»</th></tr></thead><tbody><tr><td align="center">Read uncommitted</td><td align="center">âˆš</td><td align="center">âˆš</td><td align="center">âˆš</td></tr><tr><td align="center">Read committed</td><td align="center">Ã—</td><td align="center">âˆš</td><td align="center">âˆš</td></tr><tr><td align="center">Repeatable Read(é»˜è®¤)</td><td align="center">Ã—</td><td align="center">Ã—</td><td align="center">âˆš</td></tr><tr><td align="center">Serializable</td><td align="center">Ã—</td><td align="center">Ã—</td><td align="center">Ã—</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> MySQL </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BSTç¤ºä¾‹</title>
      <link href="/posts/43338/"/>
      <url>/posts/43338/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸéªŒè¯äºŒå‰æœç´¢æ ‘"><a href="#ğŸéªŒè¯äºŒå‰æœç´¢æ ‘" class="headerlink" title="ğŸéªŒè¯äºŒå‰æœç´¢æ ‘"></a>ğŸéªŒè¯äºŒå‰æœç´¢æ ‘</h2><blockquote><p>ç»™å®šä¸€æ£µæ ‘ï¼ŒéªŒè¯æ˜¯å¦ä¸ºBST</p></blockquote><h3 id="ä¸­åºéé€’å½’"><a href="#ä¸­åºéé€’å½’" class="headerlink" title="ä¸­åºéé€’å½’"></a>ä¸­åºéé€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸­åºéå†çš„ä»£ç æ¡†æ¶</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">long</span> <span class="variable">prev</span> <span class="operator">=</span> Long.MIN_VALUE; <span class="comment">// é˜²æ­¢Integer.MIN_VALUEå¤±æ•ˆ</span></span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (prev &gt;= pop.val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = pop.val;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­åºé€’å½’"><a href="#ä¸­åºé€’å½’" class="headerlink" title="ä¸­åºé€’å½’"></a>ä¸­åºé€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doValid(<span class="keyword">new</span> <span class="title class_">AtomicLong</span>(Long.MIN_VALUE),root);</span><br><span class="line">    <span class="comment">// Longæˆ–longä¸ºå±€éƒ¨å˜é‡ä¸”ä¸å¯å˜</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">doValid</span><span class="params">(AtomicLong prev, TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123; <span class="comment">//å‡ºå£</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">a</span> <span class="operator">=</span> doValid(prev, node.left); <span class="comment">// å·¦</span></span><br><span class="line">    <span class="keyword">if</span> (prev.get() &gt;= node.val) &#123; <span class="comment">// ä¸­</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    prev.set(node.val);</span><br><span class="line">    <span class="type">boolean</span> <span class="variable">b</span> <span class="operator">=</span> doValid(prev, node.right); <span class="comment">// å³</span></span><br><span class="line">    <span class="keyword">return</span> a &amp;&amp; b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸Šä¸‹é™é€’å½’"><a href="#ä¸Šä¸‹é™é€’å½’" class="headerlink" title="ä¸Šä¸‹é™é€’å½’"></a>ä¸Šä¸‹é™é€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è®¾æ¯ä¸ªèŠ‚ç‚¹å¿…é¡»åœ¨ä¸€ä¸ªèŒƒå›´å†…ï¼š(min, max)ï¼Œä¸åŒ…å«è¾¹ç•Œï¼Œè‹¥èŠ‚ç‚¹å€¼è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œåˆ™è¿”å› false</span></span><br><span class="line"><span class="comment">// å¯¹äº node.left èŒƒå›´è‚¯å®šæ˜¯ (min, node.val)</span></span><br><span class="line"><span class="comment">// å¯¹äº node.right èŒƒå›´è‚¯å®šæ˜¯ (node.val, max)</span></span><br><span class="line"><span class="comment">// ä¸€å¼€å§‹ä¸çŸ¥é“ minï¼Œmax åˆ™å– java ä¸­é•¿æ•´æ•°çš„æœ€å°ã€æœ€å¤§å€¼</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidBST</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doValid(node, Long.MIN_VALUE, Long.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">doValid</span><span class="params">(TreeNode node, <span class="type">long</span> min, <span class="type">long</span> max)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.val &lt;= min || node.val &gt;= max) &#123; <span class="comment">// èŠ‚ç‚¹å€¼å¿…é¡»åœ¨èŒƒå›´å†…</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doValid(node.left, min, node.val) &amp;&amp; doValid(node.right, node.val, max);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸæ±‚èŒƒå›´å’Œ"><a href="#ğŸæ±‚èŒƒå›´å’Œ" class="headerlink" title="ğŸæ±‚èŒƒå›´å’Œ"></a>ğŸæ±‚èŒƒå›´å’Œ</h2><blockquote><p>æ±‚BSTä¸­ç»™å®šèŒƒå›´å†…çš„èŠ‚ç‚¹å€¼ä¹‹å’Œ</p></blockquote><h3 id="ä¸­åºé€’å½’-1"><a href="#ä¸­åºé€’å½’-1" class="headerlink" title="ä¸­åºé€’å½’"></a>ä¸­åºé€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rangeSumBST</span><span class="params">(TreeNode node, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(node == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> rangeSumBST(node.left,low,high);</span><br><span class="line">    <span class="type">int</span> b=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span>(node.val&gt;=low &amp;&amp; node.val&lt;=high)&#123;</span><br><span class="line">        b = node.val;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> a + b + rangeSumBST(node.right, low, high);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­åºéé€’å½’-1"><a href="#ä¸­åºéé€’å½’-1" class="headerlink" title="ä¸­åºéé€’å½’"></a>ä¸­åºéé€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rangeSumBST</span><span class="params">(TreeNode node, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">p</span> <span class="operator">=</span> node;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>()&lt;&gt;;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(p!=<span class="literal">null</span> &amp;&amp; !stack.isEmpty())&#123;</span><br><span class="line">        <span class="keyword">if</span>(p!=<span class="literal">null</span>)&#123;</span><br><span class="line">            stack.add(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span>(pop.val &lt; high)&#123;</span><br><span class="line">                <span class="keyword">return</span> sum;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(pop.val &gt;= low)&#123;</span><br><span class="line">                sum += pop.val;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">return</span> sum;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸Šä¸‹é™é€’å½’-1"><a href="#ä¸Šä¸‹é™é€’å½’-1" class="headerlink" title="ä¸Šä¸‹é™é€’å½’"></a>ä¸Šä¸‹é™é€’å½’</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// node.val &lt; low åªéœ€è€ƒè™‘å®ƒå³å­æ ‘çš„ç´¯åŠ ç»“æœ</span></span><br><span class="line"><span class="comment">// node.val &gt; high åªéœ€è€ƒè™‘å®ƒå·¦å­æ ‘çš„ç´¯åŠ ç»“æœ</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">rangeSumBST</span><span class="params">(TreeNode node, <span class="type">int</span> low, <span class="type">int</span> high)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (node.val &lt; low) &#123;</span><br><span class="line">        <span class="keyword">return</span> rangeSumBST(node.right, low, high);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">if</span> (node.val &gt; high) &#123;</span><br><span class="line">        <span class="keyword">return</span> rangeSumBST(node.left, low, high);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node.val + </span><br><span class="line">        rangeSumBST(node.left, low, high) + </span><br><span class="line">        rangeSumBST(node.right, low, high);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸæ ¹æ®å‰åºéå†ç»“æœæ„é€ äºŒå‰æœç´¢æ ‘"><a href="#ğŸæ ¹æ®å‰åºéå†ç»“æœæ„é€ äºŒå‰æœç´¢æ ‘" class="headerlink" title="ğŸæ ¹æ®å‰åºéå†ç»“æœæ„é€ äºŒå‰æœç´¢æ ‘"></a>ğŸæ ¹æ®å‰åºéå†ç»“æœæ„é€ äºŒå‰æœç´¢æ ‘</h2><blockquote><p>ç”±å‰åºéå†ç»“æœå¯ä»¥å”¯ä¸€æ„é€ ä¸€æ£µBST</p></blockquote><h3 id="ç›´æ¥æ’å…¥"><a href="#ç›´æ¥æ’å…¥" class="headerlink" title="ç›´æ¥æ’å…¥"></a>ç›´æ¥æ’å…¥</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">bstFromPreorder</span><span class="params">(<span class="type">int</span>[] preorder)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">root</span> <span class="operator">=</span> insert(<span class="literal">null</span>, preorder[<span class="number">0</span>]);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; preorder.length; i++) &#123;</span><br><span class="line">        insert(root, preorder[i]); <span class="comment">// éå†æ’å…¥</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">insert</span><span class="params">(TreeNode node, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123; <span class="comment">// èŠ‚ç‚¹ä¸ºç©ºæ—¶æ’å…¥</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(val &lt; node.val) &#123;</span><br><span class="line">        node.left = insert(node.left, val);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(node.val &lt; val)&#123;</span><br><span class="line">        node.right = insert(node.right, val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸Šé™æ³•"><a href="#ä¸Šé™æ³•" class="headerlink" title="ä¸Šé™æ³•"></a>ä¸Šé™æ³•</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¾æ¬¡å¤„ç† prevorder ä¸­æ¯ä¸ªå€¼, è¿”å›åˆ›å»ºå¥½çš„èŠ‚ç‚¹æˆ– null ä½œä¸ºä¸Šä¸ªèŠ‚ç‚¹çš„å­©å­</span></span><br><span class="line"><span class="comment">// 1. å¦‚æœè¶…è¿‡ä¸Šé™, è¿”å› null</span></span><br><span class="line"><span class="comment">// 2. å¦‚æœæ²¡è¶…è¿‡ä¸Šé™, åˆ›å»ºèŠ‚ç‚¹, å¹¶å°†å…¶å·¦å³å­©å­è®¾ç½®å®Œæ•´åè¿”å›</span></span><br><span class="line"><span class="comment">// i++ éœ€è¦æ”¾åœ¨è®¾ç½®å·¦å³å­©å­ä¹‹å‰ï¼Œæ„æ€æ˜¯ä»å‰©ä¸‹çš„å…ƒç´ ä¸­æŒ‘é€‰å·¦å³å­©å­</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">bstFromPreorder</span><span class="params">(<span class="type">int</span>[] preorder)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> insert(preorder, Integer.MAX_VALUE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="keyword">private</span> TreeNode <span class="title function_">insert</span><span class="params">(<span class="type">int</span>[] preorder, <span class="type">int</span> max)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (i == preorder.length) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">val</span> <span class="operator">=</span> preorder[i];</span><br><span class="line">    System.out.println(val + String.format(<span class="string">&quot;[%d]&quot;</span>, max));</span><br><span class="line">    <span class="keyword">if</span> (val &gt; max) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TreeNode</span>(val);</span><br><span class="line">    i++;</span><br><span class="line">    node.left = insert(preorder, node.val); </span><br><span class="line">    node.right = insert(preorder, max);     </span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸäºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#ğŸäºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="ğŸäºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a>ğŸäºŒå‰æœç´¢æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¦ç‚¹ï¼šè‹¥ pï¼Œq åœ¨ ancestor çš„ä¸¤ä¾§ï¼Œåˆ™ ancestor å°±æ˜¯å®ƒä»¬çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</span></span><br><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root, TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">ancestor</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (ancestor.val &gt; p.val &amp;&amp; ancestor.val &gt; q.val || </span><br><span class="line">           ancestor.val &lt; p.val &amp;&amp; ancestor.val &lt; q.val) &#123; <span class="comment">// p,qéƒ½å°äºæˆ–å¤§äºå½“å‰èŠ‚ç‚¹ï¼ˆåœ¨ä¸€ä¾§ï¼‰</span></span><br><span class="line">        <span class="keyword">if</span> (ancestor.val &gt; p.val) &#123;</span><br><span class="line">            ancestor = ancestor.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            ancestor = ancestor.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> ancestor;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>äºŒå‰æ ‘</title>
      <link href="/posts/41107/"/>
      <url>/posts/41107/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°"><a href="#ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°" class="headerlink" title="ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°"></a>ğŸäºŒå‰æ ‘éé€’å½’éå†å®ç°</h2><h3 id="ç»Ÿä¸€å†™æ³•"><a href="#ç»Ÿä¸€å†™æ³•" class="headerlink" title="ç»Ÿä¸€å†™æ³•"></a>ç»Ÿä¸€å†™æ³•</h3><img src="/img/41107/Sorted_binary_tree_ALL_RGB.svg.png" alt="Sorted_binary_tree_ALL_RGB.svg" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root; <span class="comment">// ä»£è¡¨å½“å‰èŠ‚ç‚¹</span></span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// æœ€è¿‘ä¸€æ¬¡å¼¹æ ˆçš„å…ƒç´ </span></span><br><span class="line"><span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        colorPrintln(<span class="string">&quot;å‰: &quot;</span> + curr.val, <span class="number">31</span>);</span><br><span class="line">        stack.push(curr); <span class="comment">// å‹å…¥æ ˆï¼Œä¸ºäº†è®°ä½å›æ¥çš„è·¯</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¯ä»¥ä¸å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¤„ç†å®Œæˆ, å¯¹ä¸­åºæ¥è¯´, æ— éœ€æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            colorPrintln(<span class="string">&quot;å: &quot;</span> + pop.val, <span class="number">34</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å³å­æ ‘å¾…å¤„ç†, å¯¹ä¸­åºæ¥è¯´, è¦åœ¨å³å­æ ‘å¤„ç†ä¹‹å‰æ‰“å°</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            colorPrintln(<span class="string">&quot;ä¸­: &quot;</span> + peek.val, <span class="number">36</span>);</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">colorPrintln</span><span class="params">(String origin, <span class="type">int</span> color)</span> &#123;</span><br><span class="line">    System.out.printf(<span class="string">&quot;\033[%dm%s\033[0m%n&quot;</span>, color, origin);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰åºéå†"><a href="#å‰åºéå†" class="headerlink" title="å‰åºéå†"></a>å‰åºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        System.out.println(curr); <span class="comment">// å‰åºåœ¨æ­¤å¤„ç†</span></span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä¸­åºéå†"><a href="#ä¸­åºéå†" class="headerlink" title="ä¸­åºéå†"></a>ä¸­åºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        System.out.println(pop); <span class="comment">// ä¸­åºåœ¨æ­¤å¤„ç†</span></span><br><span class="line">        curr = pop.right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ååºéå†"><a href="#ååºéå†" class="headerlink" title="ååºéå†"></a>ååºéå†</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">LinkedListStack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedListStack</span>&lt;&gt;();</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line"><span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (!stack.isEmpty() || curr != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">        stack.push(curr);</span><br><span class="line">        curr = curr.left;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">        <span class="keyword">if</span> (peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">            pop = stack.pop();</span><br><span class="line">            System.out.println(pop);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            curr = peek.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦"><a href="#ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦" class="headerlink" title="ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦"></a>ç¤ºä¾‹é¢˜ç›®ï¼šäºŒå‰æ ‘æœ€å¤§æ·±åº¦</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. å¾—åˆ°å·¦å­æ ‘æ·±åº¦, å¾—åˆ°å³å­æ ‘æ·±åº¦, äºŒè€…æœ€å¤§è€…åŠ ä¸€, å°±æ˜¯æœ¬èŠ‚ç‚¹æ·±åº¦</span></span><br><span class="line"><span class="comment">    2. å› ä¸ºéœ€è¦å…ˆå¾—åˆ°å·¦å³å­æ ‘æ·±åº¦, å¾ˆæ˜¾ç„¶æ˜¯ååºéå†å…¸å‹åº”ç”¨</span></span><br><span class="line"><span class="comment">    3. å…³äºæ·±åº¦çš„å®šä¹‰ï¼šä»æ ¹å‡ºå‘, ç¦»æ ¹æœ€è¿œçš„èŠ‚ç‚¹æ€»è¾¹æ•°,</span></span><br><span class="line"><span class="comment">        æ³¨æ„: åŠ›æ‰£é‡Œçš„æ·±åº¦å®šä¹‰è¦å¤šä¸€</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        æ·±åº¦2         æ·±åº¦3         æ·±åº¦1</span></span><br><span class="line"><span class="comment">        1            1            1</span></span><br><span class="line"><span class="comment">       / \          / \</span></span><br><span class="line"><span class="comment">      2   3        2   3</span></span><br><span class="line"><span class="comment">                        \</span></span><br><span class="line"><span class="comment">                         4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">// éåŠ›æ‰£é¢˜ç›®æ”¹ä¸ºè¿”å› -1</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">d1</span> <span class="operator">=</span> maxDepth(node.left);</span><br><span class="line">    <span class="type">int</span> <span class="variable">d2</span> <span class="operator">=</span> maxDepth(node.right);</span><br><span class="line">    <span class="keyword">return</span> Integer.max(d1, d2) + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€è·¯ï¼š</span></span><br><span class="line"><span class="comment">    1. ä½¿ç”¨éé€’å½’ååºéå†, æ ˆçš„æœ€å¤§é«˜åº¦å³ä¸ºæœ€å¤§æ·±åº¦</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">curr</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">TreeNode</span> <span class="variable">pop</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> (curr != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (curr != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(curr);</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> stack.size();</span><br><span class="line">            <span class="keyword">if</span> (size &gt; max) &#123;</span><br><span class="line">                max = size;</span><br><span class="line">            &#125;</span><br><span class="line">            curr = curr.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">peek</span> <span class="operator">=</span> stack.peek();</span><br><span class="line">            <span class="keyword">if</span>(peek.right == <span class="literal">null</span> || peek.right == pop) &#123;</span><br><span class="line">                pop = stack.pop();</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                curr = peek.right;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> max;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸäºŒå‰æœç´¢æ ‘"><a href="#ğŸäºŒå‰æœç´¢æ ‘" class="headerlink" title="ğŸäºŒå‰æœç´¢æ ‘"></a>ğŸäºŒå‰æœç´¢æ ‘</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><blockquote><p>äºŒå‰æœç´¢æ ‘ï¼ˆä¹Ÿç§°äºŒå‰æ’åºæ ‘ï¼‰æ˜¯ç¬¦åˆä¸‹é¢ç‰¹å¾çš„äºŒå‰æ ‘ï¼š</p><ol><li>æ ‘èŠ‚ç‚¹å¢åŠ  key å±æ€§ï¼Œç”¨æ¥æ¯”è¾ƒè°å¤§è°å°ï¼Œkey ä¸å¯ä»¥é‡å¤</li><li>å¯¹äºä»»æ„ä¸€ä¸ªæ ‘èŠ‚ç‚¹ï¼Œå®ƒçš„ key æ¯”å·¦å­æ ‘çš„ <strong>key éƒ½å¤§</strong>ï¼ŒåŒæ—¶ä¹Ÿæ¯”å³å­æ ‘çš„ <strong>key éƒ½å°</strong></li></ol></blockquote><img src="/img/41107/BST1.png" alt="BST1" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">BSTNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> key; <span class="comment">// è‹¥å¸Œæœ›ä»»æ„ç±»å‹ä½œä¸º key, åˆ™åç»­å¯ä»¥å°†å…¶è®¾è®¡ä¸º Comparable æ¥å£</span></span><br><span class="line">    Object value;</span><br><span class="line">    BSTNode left;</span><br><span class="line">    BSTNode right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BSTNode</span><span class="params">(<span class="type">int</span> key, Object value, BSTNode left, BSTNode right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.key = key;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æŸ¥æ‰¾"><a href="#æŸ¥æ‰¾" class="headerlink" title="æŸ¥æ‰¾"></a>æŸ¥æ‰¾</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doGet(root, key);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> Object <span class="title function_">doGet</span><span class="params">(BSTNode node, <span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>; <span class="comment">// æ²¡æ‰¾åˆ°</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">        <span class="keyword">return</span> doGet(node.left, key); <span class="comment">// å‘å·¦æ‰¾</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">        <span class="keyword">return</span> doGet(node.right, key); <span class="comment">// å‘å³æ‰¾</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> node.value; <span class="comment">// æ‰¾åˆ°äº†</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> node.value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰¾æœ€å°"><a href="#æ‰¾æœ€å°" class="headerlink" title="æ‰¾æœ€å°"></a>æ‰¾æœ€å°</h3><blockquote><p>æ ‘çš„æœ€å·¦ä¾§å³ä¸ºæœ€å°å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">min</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doMin(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doMin</span><span class="params">(BSTNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å·¦è¾¹å·²èµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="literal">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doMin(node.left);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">min</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="comment">// å·¦è¾¹æœªèµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">while</span> (p.left != <span class="literal">null</span>) &#123;</span><br><span class="line">        p = p.left;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ‰¾æœ€å¤§"><a href="#æ‰¾æœ€å¤§" class="headerlink" title="æ‰¾æœ€å¤§"></a>æ‰¾æœ€å¤§</h3><blockquote><p>æ ‘çš„æœ€å³ä¾§å³ä¸ºæœ€å¤§å€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doMax(root);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doMax</span><span class="params">(BSTNode node)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å³è¾¹å·²èµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">if</span> (node.left == <span class="literal">null</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> node.value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> doMin(node.right);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éé€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">max</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="comment">// å³è¾¹æœªèµ°åˆ°å¤´</span></span><br><span class="line">    <span class="keyword">while</span> (p.right != <span class="literal">null</span>) &#123;</span><br><span class="line">        p = p.right;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> p.value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–°å¢èŠ‚ç‚¹"><a href="#æ–°å¢èŠ‚ç‚¹" class="headerlink" title="æ–°å¢èŠ‚ç‚¹"></a>æ–°å¢èŠ‚ç‚¹</h3><blockquote><ul><li>è‹¥æ‰¾åˆ° keyï¼Œæ›´æ–°æ‰¾åˆ°èŠ‚ç‚¹çš„å€¼</li><li>è‹¥æ²¡æ‰¾åˆ° keyï¼Œåˆ›å»ºå¹¶è¿”å›æ–°èŠ‚ç‚¹</li></ul></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€’å½’å®ç°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    root = doPut(root, key, value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> BSTNode <span class="title function_">doPut</span><span class="params">(BSTNode node, <span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (node == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">        node.left = doPut(node.left, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">        node.right = doPut(node.right, key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        node.value = value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> node;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿”å›çš„æ–°èŠ‚ç‚¹ï¼Œä½œä¸ºä¸Šæ¬¡é€’å½’æ—¶ node çš„å·¦å­©å­æˆ–å³å­©å­</span></span><br><span class="line"><span class="comment">// ç¼ºç‚¹æ˜¯ï¼Œä¼šæœ‰å¾ˆå¤šä¸å¿…è¦çš„èµ‹å€¼æ“ä½œ</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, Object value)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">node</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="literal">null</span>; <span class="comment">// è®°ä½çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">while</span> (node != <span class="literal">null</span>) &#123;</span><br><span class="line">        parent = node;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; node.key) &#123;</span><br><span class="line">            node = node.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (node.key &lt; key) &#123;</span><br><span class="line">            node = node.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 1. key å­˜åœ¨åˆ™æ›´æ–°</span></span><br><span class="line">            node.value = value;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 2. key ä¸å­˜åœ¨åˆ™æ–°å¢</span></span><br><span class="line">    <span class="keyword">if</span> (parent == <span class="literal">null</span>) &#123;</span><br><span class="line">        root = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (key &lt; parent.key) &#123;</span><br><span class="line">        parent.left = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        parent.right = <span class="keyword">new</span> <span class="title class_">BSTNode</span>(key, value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸš©å‰é©±åç»§"><a href="#ğŸš©å‰é©±åç»§" class="headerlink" title="ğŸš©å‰é©±åç»§"></a>ğŸš©å‰é©±åç»§</h3><h4 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><blockquote><p>ä¸€ä¸ªèŠ‚ç‚¹çš„å‰é©±ï¼ˆå‰ä»»ï¼‰èŠ‚ç‚¹æ˜¯æŒ‡æ¯”å®ƒå°çš„èŠ‚ç‚¹ä¸­ï¼Œ<strong>æœ€å¤§çš„</strong>é‚£ä¸ª</p><p>ä¸€ä¸ªèŠ‚ç‚¹çš„åç»§ï¼ˆåä»»ï¼‰èŠ‚ç‚¹æ˜¯æŒ‡æ¯”å®ƒå¤§çš„èŠ‚ç‚¹ä¸­ï¼Œ<strong>æœ€å°çš„</strong>é‚£ä¸ª</p></blockquote><img src="/img/41107/BST2.png" alt="BST2" style="zoom:80%;" /><p>ä¾‹å¦‚ï¼š</p><p>1 æ²¡æœ‰å‰é©±ï¼Œåç»§æ˜¯ 2</p><p>2 å‰é©±æ˜¯ 1ï¼Œåç»§æ˜¯ 3</p><p>3 å‰é©±æ˜¯ 2ï¼Œåç»§æ˜¯ 4</p><hr><p>é«˜æ•ˆ<strong>æ‰¾å‰é©±</strong>åˆ†æˆ 2 ç§æƒ…å†µï¼š</p><p>èŠ‚ç‚¹æœ‰å·¦å­æ ‘ï¼Œæ­¤æ—¶å‰é©±èŠ‚ç‚¹å°±æ˜¯å·¦å­æ ‘çš„æœ€å¤§å€¼ï¼Œå›¾ä¸­å±äºè¿™ç§æƒ…å†µçš„æœ‰</p><ul><li>2 çš„å‰é©±æ˜¯1</li><li>4 çš„å‰é©±æ˜¯ 3</li><li>6 çš„å‰é©±æ˜¯ 5</li><li>7 çš„å‰é©±æ˜¯ 6</li></ul><p>èŠ‚ç‚¹æ²¡æœ‰å·¦å­æ ‘ï¼Œè‹¥ç¦»å®ƒæœ€è¿‘çš„ç¥–å…ˆ<strong>è‡ªä»å·¦è€Œæ¥</strong>ï¼Œæ­¤ç¥–å…ˆå³ä¸ºå‰é©±ï¼Œå¦‚</p><ul><li>3 çš„ç¥–å…ˆ 2 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 2</li><li>5 çš„ç¥–å…ˆ 4 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 4</li><li>8 çš„ç¥–å…ˆ 7 è‡ªå·¦è€Œæ¥ï¼Œå‰é©± 7</li><li>1 æ²¡æœ‰è¿™æ ·çš„ç¥–å…ˆï¼Œå‰é©± null</li></ul><p>é«˜æ•ˆ<strong>æ‰¾åç»§</strong>åˆ†æˆ 2 ç§æƒ…å†µï¼š</p><p>èŠ‚ç‚¹æœ‰å³å­æ ‘ï¼Œæ­¤æ—¶åç»§èŠ‚ç‚¹å³ä¸ºå³å­æ ‘çš„æœ€å°å€¼ï¼Œå¦‚</p><ul><li>2 çš„åç»§ 3</li><li>3 çš„åç»§ 4</li><li>5 çš„åç»§ 6</li><li>7 çš„åç»§ 8</li></ul><p>èŠ‚ç‚¹æ²¡æœ‰å³å­æ ‘ï¼Œè‹¥ç¦»å®ƒæœ€è¿‘çš„ç¥–å…ˆè‡ªä»å³è€Œæ¥ï¼Œæ­¤ç¥–å…ˆå³ä¸ºåç»§ï¼Œå¦‚</p><ul><li>1 çš„ç¥–å…ˆ 2 è‡ªå³è€Œæ¥ï¼Œåç»§ 2</li><li>4 çš„ç¥–å…ˆ 5 è‡ªå³è€Œæ¥ï¼Œåç»§ 5</li><li>6 çš„ç¥–å…ˆ 7 è‡ªå³è€Œæ¥ï¼Œåç»§ 7</li><li>8 æ²¡æœ‰è¿™æ ·çš„ç¥–å…ˆï¼Œåç»§ null</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">predecessor</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">ancestorFromLeft</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; p.key) &#123;</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.key &lt; key) &#123;</span><br><span class="line">            ancestorFromLeft = p; <span class="comment">// è®°å½•è‡ªä»å·¦è€Œæ¥çš„ç¥–å…ˆ</span></span><br><span class="line">            p = p.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ1 - æœ‰å·¦å­©å­</span></span><br><span class="line">    <span class="keyword">if</span> (p.left != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> max(p.left);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ2 - æœ‰ç¥–å…ˆè‡ªå·¦è€Œæ¥</span></span><br><span class="line">    <span class="keyword">return</span> ancestorFromLeft != <span class="literal">null</span> ? ancestorFromLeft.value : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">successor</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">ancestorFromRight</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key &lt; p.key) &#123;</span><br><span class="line">            ancestorFromRight = p;</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.key &lt; key) &#123;</span><br><span class="line">            p = p.right;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (p == <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ1 - æœ‰å³å­©å­</span></span><br><span class="line">    <span class="keyword">if</span> (p.right != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> min(p.right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æƒ…å†µ2 - æœ‰ç¥–å…ˆè‡ªå³è€Œæ¥</span></span><br><span class="line">    <span class="keyword">return</span> ancestorFromRight != <span class="literal">null</span> ? ancestorFromRight.value : <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾å°äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸­åºéå†çš„åŸºæœ¬æ¡†æ¶</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">less</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &lt; key) &#123; <span class="comment">// æ»¡è¶³æ¡ä»¶åŠ å…¥</span></span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123; <span class="comment">// ä¸æ»¡è¶³å¯ä»¥ç›´æ¥é€€å‡º</span></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾å¤§äºç›®æ ‡çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·Ÿå°äºåä¹‹</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">greater</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt; key) &#123;</span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æŸ¥æ‰¾è¾ƒå¤§å€¼éœ€è¦å…ˆéå†å®Œè¾ƒå°å€¼ï¼Œå¯æ”¹é€ æˆ<strong>åå‘ä¸­åºéå†</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">greater</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.right; <span class="comment">// è®°å½•å³è¾¹è·¯çº¿</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt; key) &#123;</span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.left;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹"><a href="#æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹" class="headerlink" title="æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹"></a>æ‰¾æŸä¸ªèŒƒå›´ä¹‹é—´çš„æ‰€æœ‰èŠ‚ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å’Œæ‰¾å°äºç±»ä¼¼</span></span><br><span class="line"><span class="keyword">public</span> List&lt;Object&gt; <span class="title function_">between</span><span class="params">(<span class="type">int</span> key1, <span class="type">int</span> key2)</span> &#123;</span><br><span class="line">    ArrayList&lt;Object&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="type">BSTNode</span> <span class="variable">p</span> <span class="operator">=</span> root;</span><br><span class="line">    LinkedList&lt;BSTNode&gt; stack = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="literal">null</span> || !stack.isEmpty()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            stack.push(p);</span><br><span class="line">            p = p.left;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">BSTNode</span> <span class="variable">pop</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            <span class="keyword">if</span> (pop.key &gt;= key1 &amp;&amp; pop.key &lt;= key2) &#123; <span class="comment">// å¤šåŠ ä¸€ä¸ªåˆ¤æ–­æ¡ä»¶</span></span><br><span class="line">                result.add(pop.value);</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (pop.key &gt; key2) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            p = pop.right;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¼˜ç‚¹ï¼š</p><ol><li>å¦‚æœæ¯ä¸ªèŠ‚ç‚¹çš„å·¦å­æ ‘å’Œå³å­æ ‘çš„å¤§å°å·®è·ä¸è¶…è¿‡1ï¼Œå¯ä»¥ä¿è¯æœç´¢æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯ **O(log n)**ï¼Œæ•ˆç‡é«˜ã€‚</li><li>æ’å…¥ã€åˆ é™¤ç»“ç‚¹ç­‰æ“ä½œä¹Ÿæ¯”è¾ƒå®¹æ˜“å®ç°ï¼Œæ•ˆç‡ä¹Ÿæ¯”è¾ƒé«˜ã€‚</li><li>å¯¹äº<strong>æœ‰åºæ•°æ®</strong>çš„æŸ¥è¯¢å’Œå¤„ç†ï¼ŒäºŒå‰æŸ¥æ‰¾æ ‘éå¸¸é€‚ç”¨ï¼Œå¯ä»¥ä½¿ç”¨ä¸­åºéå†å¾—åˆ°æœ‰åºåºåˆ—ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å¦‚æœè¾“å…¥çš„æ•°æ®æ˜¯æœ‰åºæˆ–è€…è¿‘ä¼¼æœ‰åºçš„ï¼Œå°±ä¼šå‡ºç°æåº¦ä¸å¹³è¡¡çš„æƒ…å†µï¼Œå¯èƒ½å¯¼è‡´æœç´¢æ•ˆç‡ä¸‹é™ï¼Œæ—¶é—´å¤æ‚åº¦é€€åŒ–æˆO(n)ã€‚</li><li>å¯¹äºé¢‘ç¹åœ°æ’å…¥ã€åˆ é™¤æ“ä½œï¼Œéœ€è¦ç»´æŠ¤å¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œä¾‹å¦‚çº¢é»‘æ ‘ã€AVL æ ‘ç­‰ï¼Œå¦åˆ™æœç´¢æ•ˆç‡ä¹Ÿä¼šä¸‹é™ã€‚</li><li>å¯¹äºå­˜åœ¨å¤§é‡é‡å¤æ•°æ®çš„æƒ…å†µï¼Œéœ€è¦åšç›¸åº”çš„å¤„ç†ï¼Œå¦åˆ™ä¼šå¯¼è‡´æ ‘çš„æ·±åº¦å¢åŠ ï¼Œæœç´¢æ•ˆç‡ä¸‹é™ã€‚</li><li>å¯¹äºç»“ç‚¹è¿‡å¤šçš„æƒ…å†µï¼Œç”±äºæ ‘çš„ç©ºé—´å¼€é”€è¾ƒå¤§ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜æ¶ˆè€—è¿‡å¤§ï¼Œä¸é€‚åˆå¯¹å†…å­˜è¦æ±‚é«˜çš„åœºæ™¯ã€‚</li></ol>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HashMap</title>
      <link href="/posts/23369/"/>
      <url>/posts/23369/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸPUTä¸æ‰©å®¹æœºåˆ¶"><a href="#ğŸPUTä¸æ‰©å®¹æœºåˆ¶" class="headerlink" title="ğŸPUTä¸æ‰©å®¹æœºåˆ¶"></a>ğŸPUTä¸æ‰©å®¹æœºåˆ¶</h2><img src="/img/23369/hashmap1.png" alt="hashmap1" style="zoom:80%;" /><h3 id="put-æµç¨‹"><a href="#put-æµç¨‹" class="headerlink" title="put æµç¨‹"></a>put æµç¨‹</h3><ol><li><p>HashMap æ˜¯æ‡’æƒ°åˆ›å»ºæ•°ç»„çš„ï¼Œ<strong>é¦–æ¬¡ä½¿ç”¨æ‰åˆ›å»ºæ•°ç»„</strong></p></li><li><p>è®¡ç®—ç´¢å¼•ï¼ˆæ¡¶ä¸‹æ ‡ï¼‰</p></li><li><p>å¦‚æœæ¡¶ä¸‹æ ‡è¿˜æ²¡äººå ç”¨ï¼Œåˆ›å»ºNodeå ä½è¿”å›</p></li><li><p>å¦‚æœæ¡¶ä¸‹æ ‡å·²ç»æœ‰äººå ç”¨ </p></li><li><p>å·²ç»æ˜¯ TreeNodeï¼Œèµ°çº¢é»‘æ ‘çš„æ·»åŠ æˆ–æ›´æ–°é€»è¾‘</p></li><li><p>æ˜¯æ™®é€š Nodeï¼Œèµ°é“¾è¡¨çš„æ·»åŠ æˆ–æ›´æ–°é€»è¾‘ï¼›å¦‚æœé“¾è¡¨é•¿åº¦è¶…è¿‡æ ‘åŒ–é˜ˆå€¼ï¼ˆæ•°ç»„æ€»å®¹é‡64ï¼Œ<strong>é“¾è¡¨é•¿åº¦8</strong>ï¼‰ï¼Œèµ°æ ‘åŒ–é€»è¾‘</p></li></ol><p>â€‹7.è¿”å›å‰æ£€æŸ¥å®¹é‡æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼ˆ<strong>æ€»é•¿åº¦*æ‰©å®¹å› å­0.75</strong>ï¼‰ï¼Œä¸€æ—¦è¶…è¿‡è¿›è¡Œæ‰©å®¹ï¼ˆ<strong>æ•°ç»„*2</strong>ï¼‰</p><h3 id="æºç "><a href="#æºç " class="headerlink" title="æºç "></a>æºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="literal">false</span>, <span class="literal">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¬¬å››ä¸ªå‚æ•° onlyIfAbsent å¦‚æœæ˜¯ trueï¼Œé‚£ä¹ˆåªæœ‰åœ¨ä¸å­˜åœ¨è¯¥ key æ—¶æ‰ä¼šè¿›è¡Œ put æ“ä½œ</span></span><br><span class="line"><span class="comment">// ç¬¬äº”ä¸ªå‚æ•° evict è¿™é‡Œä¸å…³å¿ƒ</span></span><br><span class="line"><span class="keyword">final</span> V <span class="title function_">putVal</span><span class="params">(<span class="type">int</span> hash, K key, V value, <span class="type">boolean</span> onlyIfAbsent,</span></span><br><span class="line"><span class="params">               <span class="type">boolean</span> evict)</span> &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="type">int</span> n, i;</span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ put å€¼çš„æ—¶å€™ï¼Œä¼šè§¦å‘ä¸‹é¢çš„ resize()ï¼Œç±»ä¼¼ java7 çš„ç¬¬ä¸€æ¬¡ put ä¹Ÿè¦åˆå§‹åŒ–æ•°ç»„é•¿åº¦</span></span><br><span class="line">    <span class="comment">// ç¬¬ä¸€æ¬¡ resize å’Œåç»­çš„æ‰©å®¹æœ‰äº›ä¸ä¸€æ ·ï¼Œå› ä¸ºè¿™æ¬¡æ˜¯æ•°ç»„ä» null åˆå§‹åŒ–åˆ°é»˜è®¤çš„ 16 æˆ–è‡ªå®šä¹‰çš„åˆå§‹å®¹é‡</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="literal">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°å…·ä½“çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¦‚æœæ­¤ä½ç½®æ²¡æœ‰å€¼ï¼Œé‚£ä¹ˆç›´æ¥åˆå§‹åŒ–ä¸€ä¸‹ Node å¹¶æ”¾ç½®åœ¨è¿™ä¸ªä½ç½®å°±å¯ä»¥äº†</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="literal">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span> &#123;<span class="comment">// æ•°ç»„è¯¥ä½ç½®æœ‰æ•°æ®</span></span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// é¦–å…ˆï¼Œåˆ¤æ–­è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªæ•°æ®å’Œæˆ‘ä»¬è¦æ’å…¥çš„æ•°æ®ï¼Œkey æ˜¯ä¸æ˜¯&quot;ç›¸ç­‰&quot;ï¼Œå¦‚æœæ˜¯ï¼Œå–å‡ºè¿™ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥èŠ‚ç‚¹æ˜¯ä»£è¡¨çº¢é»‘æ ‘çš„èŠ‚ç‚¹ï¼Œè°ƒç”¨çº¢é»‘æ ‘çš„æ’å€¼æ–¹æ³•ï¼Œä¸å±•å¼€</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="built_in">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// åˆ°è¿™é‡Œï¼Œè¯´æ˜æ•°ç»„è¯¥ä½ç½®ä¸Šæ˜¯ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">binCount</span> <span class="operator">=</span> <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">// æ’å…¥åˆ°é“¾è¡¨çš„æœ€åé¢(Java7 æ˜¯æ’å…¥åˆ°é“¾è¡¨çš„æœ€å‰é¢)</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="literal">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="literal">null</span>);</span><br><span class="line">                    <span class="comment">// TREEIFY_THRESHOLD ä¸º 8ï¼Œæ‰€ä»¥ï¼Œå¦‚æœæ–°æ’å…¥çš„å€¼æ˜¯é“¾è¡¨ä¸­çš„ç¬¬ 8 ä¸ª</span></span><br><span class="line">                    <span class="comment">// ä¼šè§¦å‘ä¸‹é¢çš„ treeifyBinï¼Œä¹Ÿå°±æ˜¯å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// å¦‚æœåœ¨è¯¥é“¾è¡¨ä¸­æ‰¾åˆ°äº†&quot;ç›¸ç­‰&quot;çš„ key(== æˆ– equals)</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="literal">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="comment">// æ­¤æ—¶ breakï¼Œé‚£ä¹ˆ e ä¸ºé“¾è¡¨ä¸­[ä¸è¦æ’å…¥çš„æ–°å€¼çš„ key &quot;ç›¸ç­‰&quot;]çš„ node</span></span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// e!=null è¯´æ˜å­˜åœ¨æ—§å€¼çš„keyä¸è¦æ’å…¥çš„key&quot;ç›¸ç­‰&quot;</span></span><br><span class="line">        <span class="comment">// å¯¹äºæˆ‘ä»¬åˆ†æçš„putæ“ä½œï¼Œä¸‹é¢è¿™ä¸ª if å…¶å®å°±æ˜¯è¿›è¡Œ &quot;å€¼è¦†ç›–&quot;ï¼Œç„¶åè¿”å›æ—§å€¼</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">V</span> <span class="variable">oldValue</span> <span class="operator">=</span> e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="literal">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// å¦‚æœ HashMap ç”±äºæ–°æ’å…¥è¿™ä¸ªå€¼å¯¼è‡´ size å·²ç»è¶…è¿‡äº†é˜ˆå€¼ï¼Œéœ€è¦è¿›è¡Œæ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="1-7-ä¸-1-8-çš„åŒºåˆ«"><a href="#1-7-ä¸-1-8-çš„åŒºåˆ«" class="headerlink" title="1.7 ä¸ 1.8 çš„åŒºåˆ«"></a><strong>1.7 ä¸ 1.8 çš„åŒºåˆ«</strong></h3><ol><li>é“¾è¡¨æ’å…¥èŠ‚ç‚¹æ—¶ï¼Œ1.7 æ˜¯<strong>å¤´æ’æ³•</strong>ï¼Œ1.8 æ˜¯<strong>å°¾æ’æ³•</strong> </li><li>1.7 æ˜¯å¤§äºç­‰äºé˜ˆå€¼<strong>ä¸”æ²¡æœ‰ç©ºä½</strong>æ—¶æ‰æ‰©å®¹ï¼Œè€Œ 1.8 æ˜¯å¤§äºé˜ˆå€¼å°±æ‰©å®¹ </li><li>1.8 åœ¨æ‰©å®¹è®¡ç®— Node ç´¢å¼•æ—¶ï¼Œä¼šä¼˜åŒ–</li></ol><h3 id="æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯-0-75f"><a href="#æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯-0-75f" class="headerlink" title="æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯ 0.75f"></a><strong>æ‰©å®¹ï¼ˆåŠ è½½ï¼‰å› å­ä¸ºä½•é»˜è®¤æ˜¯ 0.75f</strong></h3><ol><li><strong>åœ¨ç©ºé—´å ç”¨ä¸æŸ¥è¯¢æ—¶é—´ä¹‹é—´å–å¾—è¾ƒå¥½çš„æƒè¡¡</strong></li><li>å¤§äºè¿™ä¸ªå€¼ï¼Œç©ºé—´èŠ‚çœäº†ï¼Œä½†é“¾è¡¨å°±ä¼šæ¯”è¾ƒé•¿å½±å“æ€§èƒ½</li><li>å°äºè¿™ä¸ªå€¼ï¼Œå†²çªå‡å°‘äº†ï¼Œä½†æ‰©å®¹å°±ä¼šæ›´é¢‘ç¹ï¼Œç©ºé—´å ç”¨ä¹Ÿæ›´å¤š</li></ol><h2 id="ğŸæ ‘åŒ–ä¸é€€åŒ–"><a href="#ğŸæ ‘åŒ–ä¸é€€åŒ–" class="headerlink" title="ğŸæ ‘åŒ–ä¸é€€åŒ–"></a>ğŸæ ‘åŒ–ä¸é€€åŒ–</h2><h3 id="æ ‘åŒ–æ„ä¹‰"><a href="#æ ‘åŒ–æ„ä¹‰" class="headerlink" title="æ ‘åŒ–æ„ä¹‰"></a><strong>æ ‘åŒ–æ„ä¹‰</strong></h3><ul><li>çº¢é»‘æ ‘ç”¨ä»¥é¿å…Dosæ”»å‡»ï¼Œé˜²æ­¢é“¾è¡¨è¿‡é•¿å¯¼è‡´æ€§èƒ½ä¸‹é™ï¼Œ<strong>æ ‘åŒ–åº”å½“æ˜¯å¶ç„¶æƒ…å†µ</strong>ï¼Œæ˜¯ä¿åº•ç­–ç•¥</li><li>hash è¡¨çš„æŸ¥æ‰¾ã€æ›´æ–°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ **O(1)**ï¼Œè€Œçº¢é»‘æ ‘çš„æŸ¥æ‰¾ï¼Œæ›´æ–°çš„æ—¶é—´å¤æ‚åº¦æ˜¯ <strong>O(log2â¡n )<strong>ï¼ŒTreeNode ï¼ˆçº¢é»‘æ ‘çš„æƒ…å†µï¼‰</strong>å ç”¨ç©ºé—´ä¹Ÿæ¯”æ™®é€š Node çš„å¤§</strong>ï¼Œå¦‚éå¿…è¦ï¼Œå°½é‡è¿˜æ˜¯ä½¿ç”¨é“¾è¡¨</li><li>hash å€¼å¦‚æœè¶³å¤Ÿéšæœºï¼Œåˆ™åœ¨ hash è¡¨å†…æŒ‰æ³Šæ¾åˆ†å¸ƒï¼Œåœ¨<strong>è´Ÿè½½å› å­ 0.75</strong> çš„æƒ…å†µä¸‹ï¼Œé•¿åº¦è¶…è¿‡ 8 çš„é“¾è¡¨å‡ºç°æ¦‚ç‡æ˜¯ 0.00000006ï¼Œ<strong>æ ‘åŒ–é˜ˆå€¼é€‰æ‹© 8</strong> å°±æ˜¯ä¸ºäº†è®©æ ‘åŒ–å‡ ç‡è¶³å¤Ÿå°ï¼ˆè´Ÿè½½å› å­ï¼šå½“å“ˆå¸Œè¡¨ä¸­å…ƒç´ æ•°é‡è¶…è¿‡ <strong>æ€»é•¿åº¦*è´Ÿè½½å› å­</strong> è¿›è¡Œæ‰©å®¹ï¼Œ<strong>æ‰©å®¹æ•°ç»„é•¿åº¦ä¸ºåŸæ¥çš„2å€</strong>ï¼‰</li></ul><h3 id="æ ‘åŒ–è§„åˆ™"><a href="#æ ‘åŒ–è§„åˆ™" class="headerlink" title="æ ‘åŒ–è§„åˆ™"></a><strong>æ ‘åŒ–è§„åˆ™</strong></h3><ul><li>å½“é“¾è¡¨é•¿åº¦è¶…è¿‡<strong>æ ‘åŒ–é˜ˆå€¼ 8</strong> æ—¶ï¼Œå…ˆå°è¯•æ‰©å®¹æ¥å‡å°‘é“¾è¡¨é•¿åº¦ï¼Œå¦‚æœæ•°ç»„å®¹é‡å·²ç»**&gt;&#x3D;64**ï¼Œæ‰ä¼šè¿›è¡Œæ ‘åŒ–</li></ul><h3 id="é€€åŒ–è§„åˆ™"><a href="#é€€åŒ–è§„åˆ™" class="headerlink" title="é€€åŒ–è§„åˆ™"></a><strong>é€€åŒ–è§„åˆ™</strong></h3><ul><li>æƒ…å†µ1ï¼šåœ¨æ‰©å®¹æ—¶æˆ–è€…æ‹†åˆ†æ ‘æ—¶ï¼Œæ ‘å…ƒç´ ä¸ªæ•° <strong>&lt;&#x3D; 6</strong> åˆ™ä¼šé€€åŒ–é“¾è¡¨</li><li>æƒ…å†µ2ï¼šremove æ ‘èŠ‚ç‚¹æ—¶ï¼Œè‹¥ rootã€root.leftã€root.rightã€root.left.left æœ‰ä¸€ä¸ªä¸º null ï¼Œä¹Ÿä¼šé€€åŒ–ä¸ºé“¾è¡¨</li></ul><h2 id="ğŸç´¢å¼•è®¡ç®—"><a href="#ğŸç´¢å¼•è®¡ç®—" class="headerlink" title="ğŸç´¢å¼•è®¡ç®—"></a>ğŸç´¢å¼•è®¡ç®—</h2><h3 id="ç´¢å¼•è®¡ç®—æ–¹æ³•"><a href="#ç´¢å¼•è®¡ç®—æ–¹æ³•" class="headerlink" title="ç´¢å¼•è®¡ç®—æ–¹æ³•"></a><strong>ç´¢å¼•è®¡ç®—æ–¹æ³•</strong></h3><ol><li>é¦–å…ˆï¼Œè®¡ç®—å¯¹è±¡çš„ hashCode</li><li>å†è¿›è¡Œè°ƒç”¨ HashMap çš„ hash() æ–¹æ³•è¿›è¡Œ<strong>äºŒæ¬¡å“ˆå¸Œ</strong></li></ol><p>â€‹äºŒæ¬¡ hash() æ˜¯ä¸ºäº†ç»¼åˆé«˜ä½æ•°æ®ï¼Œè®©å“ˆå¸Œåˆ†å¸ƒæ›´ä¸ºå‡åŒ€</p><p>   3.æœ€å <strong>&amp; (capacity â€“ 1)</strong> å¾—åˆ°ç´¢å¼•</p><h3 id="hashCode"><a href="#hashCode" class="headerlink" title="hashCode()"></a>hashCode()</h3><h4 id="Object-hashCode"><a href="#Object-hashCode" class="headerlink" title="Object.hashCode()"></a>Object.hashCode()</h4><ul><li>Object çš„ hashCode æ–¹æ³•é»˜è®¤æ˜¯ç”Ÿæˆéšæœºæ•°ä½œä¸º hash å€¼ï¼ˆä¼šç¼“å­˜åœ¨å¯¹è±¡å¤´å½“ä¸­ï¼‰</li><li>ç¼ºç‚¹æ˜¯åŒ…å«ç›¸åŒ<strong>å€¼</strong>çš„ä¸åŒå¯¹è±¡ï¼Œä»–ä»¬çš„ hashCode ä¸ä¸€æ ·ï¼Œä¸èƒ½å¤Ÿç”¨ hash å€¼æ¥åæ˜ å¯¹è±¡çš„<strong>å€¼</strong>ç‰¹å¾ï¼Œå› æ­¤è¯¸å¤šå­ç±»éƒ½ä¼šé‡å†™ hashCode æ–¹æ³•</li></ul><h4 id="String-hashCode"><a href="#String-hashCode" class="headerlink" title="String.hashCode()"></a>String.hashCode()</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> <span class="string">&quot;bac&quot;</span>;                     </span><br><span class="line">    <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);         </span><br><span class="line"></span><br><span class="line">    System.out.println(s1.hashCode());</span><br><span class="line">    System.out.println(s2.hashCode());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŸåˆ™ï¼šå€¼ç›¸åŒçš„å­—ç¬¦ä¸²ç”Ÿæˆç›¸åŒçš„ hash ç , å°½é‡è®©å€¼ä¸åŒçš„å­—ç¬¦ä¸²ç”Ÿæˆä¸åŒçš„ hash ç </span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    å¯¹äº abc  a * 100 + b * 10 + c</span></span><br><span class="line"><span class="comment">    å¯¹äº bac  b * 100 + a * 10 + c</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s1.length(); i++) &#123;</span><br><span class="line">        <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s1.charAt(i);</span><br><span class="line">        System.out.println((<span class="type">int</span>) c);</span><br><span class="line">        <span class="comment">// (a*10 + b)*10 + c  ==&gt;  a*100 + b*10 + c  2^5</span></span><br><span class="line">        hash = (hash &lt;&lt; <span class="number">5</span>) - hash + c;</span><br><span class="line">        <span class="comment">// ç»éªŒè¡¨æ˜å¦‚æœæ¯æ¬¡ä¹˜çš„æ˜¯è¾ƒå¤§è´¨æ•°ï¼Œå¯ä»¥æœ‰æ›´å¥½åœ°é™ä½ hash å†²çªï¼Œå› æ­¤æ”¹ã€ä¹˜ 10ã€‘ä¸ºã€ä¹˜ 31ã€‘</span></span><br><span class="line"><span class="comment">// ã€ä¹˜ 31ã€‘å¯ä»¥ç­‰ä»·ä¸ºã€ä¹˜ 32 - hashã€‘ï¼Œè¿›ä¸€æ­¥å¯ä»¥è½¬ä¸ºæ›´é«˜æ•ˆåœ°ã€å·¦ç§»5ä½ - hashã€‘</span></span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(hash);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯-2-çš„-n-æ¬¡å¹‚"><a href="#æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯-2-çš„-n-æ¬¡å¹‚" class="headerlink" title="æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯ 2 çš„ n æ¬¡å¹‚"></a><strong>æ•°ç»„å®¹é‡ä¸ºä½•æ˜¯ 2 çš„ n æ¬¡å¹‚</strong></h3><ol><li>è®¡ç®—ç´¢å¼•æ—¶æ•ˆç‡æ›´é«˜ï¼šå¦‚æœæ˜¯ 2 çš„ n æ¬¡å¹‚å¯ä»¥<strong>ä½¿ç”¨ä½ä¸è¿ç®—ä»£æ›¿å–æ¨¡</strong></li><li>æ‰©å®¹æ—¶é‡æ–°è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´é«˜ï¼š hash &amp; oldCap &#x3D;&#x3D; 0 çš„å…ƒç´ ç•™åœ¨åŸæ¥ä½ç½® ï¼Œå¦åˆ™æ–°ä½ç½® &#x3D; æ—§ä½ç½® + oldCap</li></ol><h3 id="æ³¨æ„"><a href="#æ³¨æ„" class="headerlink" title="æ³¨æ„"></a><strong>æ³¨æ„</strong></h3><ul><li>äºŒæ¬¡ hash æ˜¯ä¸ºäº†é…åˆ <strong>å®¹é‡æ˜¯ 2 çš„ n æ¬¡å¹‚</strong> è¿™ä¸€è®¾è®¡å‰æï¼Œå¦‚æœ hash è¡¨çš„å®¹é‡ä¸æ˜¯ 2 çš„ n æ¬¡å¹‚ï¼Œåˆ™ä¸å¿…äºŒæ¬¡ hash</li><li><strong>å®¹é‡æ˜¯ 2 çš„ n æ¬¡å¹‚</strong> è¿™ä¸€è®¾è®¡è®¡ç®—ç´¢å¼•æ•ˆç‡æ›´å¥½ï¼Œä½† hash çš„åˆ†æ•£æ€§å°±ä¸å¥½ï¼Œéœ€è¦äºŒæ¬¡ hash æ¥ä½œä¸ºè¡¥å¿ï¼Œæ²¡æœ‰é‡‡ç”¨è¿™ä¸€è®¾è®¡çš„å…¸å‹ä¾‹å­æ˜¯ HashTable</li></ul><h2 id="ğŸkeyçš„è®¾è®¡è¦æ±‚"><a href="#ğŸkeyçš„è®¾è®¡è¦æ±‚" class="headerlink" title="ğŸkeyçš„è®¾è®¡è¦æ±‚"></a>ğŸkeyçš„è®¾è®¡è¦æ±‚</h2><ol><li>HashMap çš„ key <strong>å¯ä»¥ä¸º null</strong>ï¼Œä½† Map çš„å…¶ä»–å®ç°åˆ™ä¸ç„¶</li><li>ä½œä¸º key çš„å¯¹è±¡ï¼Œå¿…é¡»å®ç° hashCode å’Œ equalsï¼Œå¹¶ä¸” key çš„å†…å®¹<strong>ä¸èƒ½ä¿®æ”¹</strong>ï¼ˆä¸å¯å˜ï¼‰ï¼›å¦‚æœ key å¯å˜ï¼Œä¾‹å¦‚ä¿®æ”¹äº† å¯¹è±¡çš„ageå±æ€§ï¼Œä¼šå¯¼è‡´å†æ¬¡æŸ¥è¯¢æ—¶æŸ¥è¯¢ä¸åˆ°</li><li>key çš„ hashCode åº”è¯¥æœ‰è‰¯å¥½çš„æ•£åˆ—æ€§</li></ol><h2 id="ğŸHashMapå®ç°ç¤ºä¾‹"><a href="#ğŸHashMapå®ç°ç¤ºä¾‹" class="headerlink" title="ğŸHashMapå®ç°ç¤ºä¾‹"></a>ğŸHashMapå®ç°ç¤ºä¾‹</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashTable</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> &#123;</span><br><span class="line">        <span class="type">int</span> hash; <span class="comment">// å“ˆå¸Œç </span></span><br><span class="line">        Object key; <span class="comment">// é”®</span></span><br><span class="line">        Object value; <span class="comment">// å€¼</span></span><br><span class="line">        Entry next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(<span class="type">int</span> hash, Object key, Object value)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.hash = hash;</span><br><span class="line">            <span class="built_in">this</span>.key = key;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Entry[] table = <span class="keyword">new</span> <span class="title class_">Entry</span>[<span class="number">16</span>]; <span class="comment">// åˆå§‹å®¹é‡16(2çš„næ¬¡å¹‚)</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>; <span class="comment">// å…ƒç´ ä¸ªæ•°</span></span><br><span class="line">    <span class="type">float</span> <span class="variable">loadFactor</span> <span class="operator">=</span> <span class="number">0.75f</span>; <span class="comment">// 12 é˜ˆå€¼</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">threshold</span> <span class="operator">=</span> (<span class="type">int</span>) (loadFactor * table.length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* æ±‚æ¨¡è¿ç®—æ›¿æ¢ä¸ºä½è¿ç®—</span></span><br><span class="line"><span class="comment">        - å‰æï¼šæ•°ç»„é•¿åº¦æ˜¯ 2 çš„ n æ¬¡æ–¹</span></span><br><span class="line"><span class="comment">        - hash % æ•°ç»„é•¿åº¦ ç­‰ä»·äº hash &amp; (æ•°ç»„é•¿åº¦-1)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® hash ç è·å– value</span></span><br><span class="line">    Object <span class="title function_">get</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123; <span class="comment">// éå†é“¾è¡¨</span></span><br><span class="line">            <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                <span class="keyword">return</span> p.value;</span><br><span class="line">            &#125;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘ hash è¡¨å­˜å…¥æ–° key valueï¼Œå¦‚æœ key é‡å¤ï¼Œåˆ™æ›´æ–° value</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> hash, Object key, Object value)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">// 1. idx å¤„æœ‰ç©ºä½, ç›´æ¥æ–°å¢</span></span><br><span class="line">            table[idx] = <span class="keyword">new</span> <span class="title class_">Entry</span>(hash, key, value);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 2. idx å¤„æ— ç©ºä½, æ²¿é“¾è¡¨æŸ¥æ‰¾ æœ‰é‡å¤keyæ›´æ–°ï¼Œå¦åˆ™æ–°å¢</span></span><br><span class="line">            <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">            <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                    p.value = value; <span class="comment">// æ›´æ–°</span></span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (p.next == <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                p = p.next;</span><br><span class="line">            &#125;</span><br><span class="line">            p.next = <span class="keyword">new</span> <span class="title class_">Entry</span>(hash, key, value); <span class="comment">// æ–°å¢</span></span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; threshold) &#123;</span><br><span class="line">            resize();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ•°ç»„æ‰©å®¹2å€</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">resize</span><span class="params">()</span> &#123;</span><br><span class="line">        Entry[] newTable = <span class="keyword">new</span> <span class="title class_">Entry</span>[table.length &lt;&lt; <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; table.length; i++) &#123;</span><br><span class="line">            <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[i]; <span class="comment">// æ‹¿åˆ°æ¯ä¸ªé“¾è¡¨å¤´</span></span><br><span class="line">            <span class="keyword">if</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                æ‹†åˆ†é“¾è¡¨ï¼Œç§»åŠ¨åˆ°æ–°æ•°ç»„ï¼Œæ‹†åˆ†è§„å¾‹ï¼ˆå‰æï¼šæ•°ç»„é•¿åº¦ä¸º2çš„næ¬¡å¹‚ï¼‰</span></span><br><span class="line"><span class="comment">                * ä¸€ä¸ªé“¾è¡¨æœ€å¤šæ‹†æˆä¸¤ä¸ª</span></span><br><span class="line"><span class="comment">                * hash &amp; table.length == 0 çš„ä¸€ç»„</span></span><br><span class="line"><span class="comment">                * hash &amp; table.length != 0 çš„ä¸€ç»„</span></span><br><span class="line"><span class="comment">                                          p</span></span><br><span class="line"><span class="comment">                0-&gt;8-&gt;16-&gt;24-&gt;32-&gt;40-&gt;48-&gt;null</span></span><br><span class="line"><span class="comment">                            a</span></span><br><span class="line"><span class="comment">                0-&gt;16-&gt;32-&gt;48-&gt;null</span></span><br><span class="line"><span class="comment">                        b</span></span><br><span class="line"><span class="comment">                8-&gt;24-&gt;40-&gt;null</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">                <span class="type">Entry</span> <span class="variable">a</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">b</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">aHead</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="type">Entry</span> <span class="variable">bHead</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="keyword">if</span> ((p.hash &amp; table.length) == <span class="number">0</span>) &#123;</span><br><span class="line">                        <span class="keyword">if</span> (a != <span class="literal">null</span>) &#123;</span><br><span class="line">                            a.next = p;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            aHead = p;</span><br><span class="line">                        &#125;</span><br><span class="line">                        a = p; <span class="comment">// åˆ†é…åˆ°a</span></span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">                            b.next = p;</span><br><span class="line">                        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                            bHead = p;</span><br><span class="line">                        &#125;</span><br><span class="line">                        b = p; <span class="comment">// åˆ†é…åˆ°b</span></span><br><span class="line">                    &#125;</span><br><span class="line">                    p = p.next;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// è§„å¾‹ï¼š a é“¾è¡¨ä¿æŒç´¢å¼•ä½ç½®ä¸å˜ï¼Œb é“¾è¡¨ç´¢å¼•ä½ç½®+table.length</span></span><br><span class="line">                <span class="keyword">if</span> (a != <span class="literal">null</span>) &#123;</span><br><span class="line">                    a.next = <span class="literal">null</span>;</span><br><span class="line">                    newTable[i] = aHead;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (b != <span class="literal">null</span>) &#123;</span><br><span class="line">                    b.next = <span class="literal">null</span>;</span><br><span class="line">                    newTable[i + table.length] = bHead;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        table = newTable;</span><br><span class="line">        threshold = (<span class="type">int</span>) (loadFactor * table.length);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ ¹æ® hash ç åˆ é™¤ï¼Œè¿”å›åˆ é™¤çš„ value</span></span><br><span class="line">    Object <span class="title function_">remove</span><span class="params">(<span class="type">int</span> hash, Object key)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">idx</span> <span class="operator">=</span> hash &amp; (table.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (table[idx] == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">p</span> <span class="operator">=</span> table[idx];</span><br><span class="line">        <span class="type">Entry</span> <span class="variable">prev</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (p.key.equals(key)) &#123;</span><br><span class="line">                <span class="comment">// æ‰¾åˆ°äº†, åˆ é™¤</span></span><br><span class="line">                <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123; <span class="comment">// é“¾è¡¨å¤´</span></span><br><span class="line">                    table[idx] = p.next;</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123; <span class="comment">// éé“¾è¡¨å¤´</span></span><br><span class="line">                    prev.next = p.next;</span><br><span class="line">                &#125;</span><br><span class="line">                size--;</span><br><span class="line">                <span class="keyword">return</span> p.value;</span><br><span class="line">            &#125;</span><br><span class="line">            prev = p;</span><br><span class="line">            p = p.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸå…³é”®æ•°"><a href="#ğŸå…³é”®æ•°" class="headerlink" title="ğŸå…³é”®æ•°"></a>ğŸå…³é”®æ•°</h2><p>æ‰©å®¹å› å­ï¼š<strong>0.75</strong></p><p>æ ‘åŒ–é˜ˆå€¼ï¼šæ•°ç»„&gt;&#x3D;<strong>64</strong>,é“¾è¡¨&gt;&#x3D;<strong>8</strong></p><p>æ•°ç»„æ‰©å®¹å€æ•°ï¼š<strong>2</strong></p><p>æ•°ç»„é•¿åº¦æœ€ä½³ï¼š<strong>2çš„næ¬¡å¹‚</strong></p><h2 id="ğŸHashMapæ“ä½œ"><a href="#ğŸHashMapæ“ä½œ" class="headerlink" title="ğŸHashMapæ“ä½œ"></a>ğŸHashMapæ“ä½œ</h2><h3 id="éå†HashMap"><a href="#éå†HashMap" class="headerlink" title="éå†HashMap"></a>éå†HashMap</h3><h4 id="1-ForEachå¾ªç¯"><a href="#1-ForEachå¾ªç¯" class="headerlink" title="1.ForEachå¾ªç¯"></a>1.ForEachå¾ªç¯</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Iterating entries using a For Each loop</span></span><br><span class="line">    <span class="keyword">for</span> (Map.Entry&lt;Integer, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Key = &quot;</span> + entry.getKey() + <span class="string">&quot;, Value = &quot;</span> + entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-ForEachè¿­ä»£é”®å€¼å¯¹"><a href="#2-ForEachè¿­ä»£é”®å€¼å¯¹" class="headerlink" title="2.ForEachè¿­ä»£é”®å€¼å¯¹"></a>2.ForEachè¿­ä»£é”®å€¼å¯¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿­ä»£é”®</span></span><br><span class="line">    <span class="keyword">for</span> (Integer key : map.keySet()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Key = &quot;</span> + key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿­ä»£å€¼</span></span><br><span class="line">    <span class="keyword">for</span> (Integer value : map.values()) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Value = &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="3-å¸¦æ³›å‹çš„è¿­ä»£å™¨"><a href="#3-å¸¦æ³›å‹çš„è¿­ä»£å™¨" class="headerlink" title="3.å¸¦æ³›å‹çš„è¿­ä»£å™¨"></a>3.å¸¦æ³›å‹çš„è¿­ä»£å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    Iterator&lt;Map.Entry&lt;Integer, Integer&gt;&gt; entries = map.entrySet().iterator();</span><br><span class="line">    <span class="keyword">while</span> (entries.hasNext()) &#123;</span><br><span class="line">        Map.Entry&lt;Integer, Integer&gt; entry = entries.next();</span><br><span class="line">        System.out.println(<span class="string">&quot;Key = &quot;</span> + entry.getKey() + <span class="string">&quot;, Value = &quot;</span> + entry.getValue());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="4-ä¸å¸¦æ³›å‹çš„è¿­ä»£å™¨"><a href="#4-ä¸å¸¦æ³›å‹çš„è¿­ä»£å™¨" class="headerlink" title="4.ä¸å¸¦æ³›å‹çš„è¿­ä»£å™¨"></a>4.ä¸å¸¦æ³›å‹çš„è¿­ä»£å™¨</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">Map</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashMap</span>();</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">    Iterator&lt;Map.Entry&gt; entries = map.entrySet().iterator();</span><br><span class="line">    <span class="keyword">while</span> (entries.hasNext()) &#123;</span><br><span class="line">        Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry) entries.next();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">key</span> <span class="operator">=</span> (Integer) entry.getKey();</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">value</span> <span class="operator">=</span> (Integer) entry.getValue();</span><br><span class="line">        System.out.println(<span class="string">&quot;Key = &quot;</span> + key + <span class="string">&quot;, Value = &quot;</span> + value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-Java8-Lambdaè¡¨è¾¾å¼"><a href="#5-Java8-Lambdaè¡¨è¾¾å¼" class="headerlink" title="5.Java8 Lambdaè¡¨è¾¾å¼"></a>5.Java8 Lambdaè¡¨è¾¾å¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;Integer, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Integer, Integer&gt;();</span><br><span class="line">    map.put(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">    map.put(<span class="number">2</span>, <span class="number">20</span>);</span><br><span class="line">    map.forEach((k, v) -&gt; System.out.println(<span class="string">&quot;key: &quot;</span> + k + <span class="string">&quot; value:&quot;</span> + v));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ’åºHashMap"><a href="#æ’åºHashMap" class="headerlink" title="æ’åºHashMap"></a>æ’åºHashMap</h3><h4 id="1-ä½¿ç”¨TreeMap"><a href="#1-ä½¿ç”¨TreeMap" class="headerlink" title="1.ä½¿ç”¨TreeMap"></a>1.ä½¿ç”¨TreeMap</h4><blockquote><p>å®ç°TreeMapçš„é»˜è®¤é€»è¾‘æ˜¯æœ‰åºçš„ï¼Œæ’å…¥åˆ°TreeMapçš„æ•°æ®ä¼šæŒ‰ç…§Keyæ’åº</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">TreeMap&lt;String, Integer&gt; sorted = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;(map);</span><br><span class="line">System.out.println(sorted);</span><br></pre></td></tr></table></figure><h4 id="2-ä½¿ç”¨TreeSet"><a href="#2-ä½¿ç”¨TreeSet" class="headerlink" title="2.ä½¿ç”¨TreeSet"></a>2.ä½¿ç”¨TreeSet</h4><blockquote><p>å»é‡åŠŸèƒ½</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SortedSet&lt;Integer&gt;  valueSorted = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(map.values());</span><br><span class="line">æˆ–è€…</span><br><span class="line">SortedSet&lt;String&gt; keySorted = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;(map.keySet());</span><br></pre></td></tr></table></figure><h4 id="3-ä½¿ç”¨ArrayList"><a href="#3-ä½¿ç”¨ArrayList" class="headerlink" title="3.ä½¿ç”¨ArrayList"></a>3.ä½¿ç”¨ArrayList</h4><blockquote><p>ArrayListåªèƒ½æŒ‰ç…§Keyæˆ–è€…Valueæ’åºï¼Œä»…æ’åºkeyæˆ–è€…value</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; sorted = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.keySet());</span><br><span class="line">Collections.sort(sorted);</span><br><span class="line"> </span><br><span class="line">List&lt;String&gt; sorted = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(map.values());</span><br><span class="line">Collections.sort(sorted);</span><br></pre></td></tr></table></figure><h4 id="4-ä½¿ç”¨Lambdaså’ŒStreams"><a href="#4-ä½¿ç”¨Lambdaså’ŒStreams" class="headerlink" title="4.ä½¿ç”¨Lambdaså’ŒStreams"></a>4.ä½¿ç”¨Lambdaså’ŒStreams</h4><h5 id="å‰ç½®å‡†å¤‡"><a href="#å‰ç½®å‡†å¤‡" class="headerlink" title="å‰ç½®å‡†å¤‡"></a>å‰ç½®å‡†å¤‡</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">     </span><br><span class="line">    Student(Integer id, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[id=&quot;</span>+id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">HashMap&lt;Integer, Student&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">map.put(<span class="number">1003</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1003</span>, <span class="string">&quot;Sam&quot;</span>));</span><br><span class="line">map.put(<span class="number">1005</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1005</span>, <span class="string">&quot;Joseph&quot;</span>));</span><br><span class="line">map.put(<span class="number">1001</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1001</span>, <span class="string">&quot;Kate&quot;</span>));</span><br><span class="line">map.put(<span class="number">1002</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1002</span>, <span class="string">&quot;Miranda&quot;</span>));</span><br><span class="line">map.put(<span class="number">1004</span>, <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="number">1004</span>, <span class="string">&quot;Peter&quot;</span>));</span><br></pre></td></tr></table></figure><h5 id="æ ¹æ®keyæ’åº"><a href="#æ ¹æ®keyæ’åº" class="headerlink" title="æ ¹æ®keyæ’åº"></a>æ ¹æ®keyæ’åº</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Student&gt; sortedMap = map.entrySet()</span><br><span class="line">                                  .stream()</span><br><span class="line">                                  .sorted(Map.Entry.comparingByKey())</span><br><span class="line">                                  .collect(Collectors</span><br><span class="line">                                    .toMap(Map.Entry::getKey,</span><br><span class="line">                                           Map.Entry::getValue,</span><br><span class="line">                                           (e1, e2) -&gt; e1,</span><br><span class="line">                                           LinkedHashMap::<span class="keyword">new</span>))</span><br><span class="line">    </span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line">&#123;<span class="number">1001</span>=[id=<span class="number">1001</span>, name=Kate], <span class="number">1002</span>=[id=<span class="number">1002</span>, name=Miranda], <span class="number">1003</span>=[id=<span class="number">1003</span>, name=Sam], <span class="number">1004</span>=[id=<span class="number">1004</span>, name=Peter], <span class="number">1005</span>=[id=<span class="number">1005</span>, name=Joseph]&#125;</span><br></pre></td></tr></table></figure><h5 id="æ ¹æ®valueæ’åº"><a href="#æ ¹æ®valueæ’åº" class="headerlink" title="æ ¹æ®valueæ’åº"></a>æ ¹æ®valueæ’åº</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Student&gt; sortedMap = map.entrySet()</span><br><span class="line">              .stream()</span><br><span class="line">              .sorted(Map.Entry.comparingByValue())</span><br><span class="line">               .collect(Collectors</span><br><span class="line">                          .toMap(Map.Entry::getKey,</span><br><span class="line">                                 Map.Entry::getValue,</span><br><span class="line">                                 (e1, e2) -&gt; e1,</span><br><span class="line">                                 LinkedHashMap::<span class="keyword">new</span>));</span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line">&#123;<span class="number">1005</span>=[id=<span class="number">1005</span>, name=Joseph], <span class="number">1001</span>=[id=<span class="number">1001</span>, name=Kate], <span class="number">1002</span>=[id=<span class="number">1002</span>, name=Miranda], <span class="number">1004</span>=[id=<span class="number">1004</span>, name=Peter], <span class="number">1003</span>=[id=<span class="number">1003</span>, name=Sam]&#125;</span><br></pre></td></tr></table></figure><p>æ­¤æ—¶å¯¹è±¡éœ€è¦å®ç°æ¯”è¾ƒå™¨æ¥å£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Student&gt;&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    Student(Integer id, String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;[id=&quot;</span>+id + <span class="string">&quot;, name=&quot;</span> + name + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Student o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.name.compareTo(o.name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h5 id="é€†åº"><a href="#é€†åº" class="headerlink" title="é€†åº"></a>é€†åº</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;Integer, Student&gt; sortedMap = map.entrySet()</span><br><span class="line">              .stream()</span><br><span class="line">              .sorted(Collections.reverseOrder(Map.Entry.comparingByKey()))</span><br><span class="line">               .collect(Collectors</span><br><span class="line">                          .toMap(Map.Entry::getKey,</span><br><span class="line">                                 Map.Entry::getValue,</span><br><span class="line">                                 (e1, e2) -&gt; e1,</span><br><span class="line">                                 LinkedHashMap::<span class="keyword">new</span>));</span><br><span class="line"><span class="comment">// ç»“æœ</span></span><br><span class="line">&#123;<span class="number">1005</span>=[id=<span class="number">1005</span>, name=Joseph], <span class="number">1004</span>=[id=<span class="number">1004</span>, name=Peter], <span class="number">1003</span>=[id=<span class="number">1003</span>, name=Sam], <span class="number">1002</span>=[id=<span class="number">1002</span>, name=Miranda], <span class="number">1001</span>=[id=<span class="number">1001</span>, name=Kate]&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>List</title>
      <link href="/posts/51030/"/>
      <url>/posts/51030/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸArrayList"><a href="#ğŸArrayList" class="headerlink" title="ğŸArrayList"></a>ğŸArrayList</h2><h3 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>ArrayListæ˜¯åŸºäºåŠ¨æ€æ•°ç»„å®ç°ï¼Œå¯ä»¥<strong>éšæœº</strong>è®¿é—®</p><h3 id="æ˜“æ··æ–¹æ³•"><a href="#æ˜“æ··æ–¹æ³•" class="headerlink" title="æ˜“æ··æ–¹æ³•"></a>æ˜“æ··æ–¹æ³•</h3><h4 id="size"><a href="#size" class="headerlink" title="size()"></a>size()</h4><blockquote><p>è¿”å›æ•°ç»„ä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œæ³¨æ„åŒºåˆ«æ•°ç»„çš„lengthå’ŒStringçš„length()</p></blockquote><p>å¸¸ç”¨äºè¿­ä»£å…ƒç´ ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; sites = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">sites.add(<span class="string">&quot;Google&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Runoob&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Weibo&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; sites.size(); i++) &#123;</span><br><span class="line">System.out.println(sites.get(i));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ’åº"><a href="#æ’åº" class="headerlink" title="æ’åº"></a>æ’åº</h4><p>Collections ç±»æä¾›çš„ sort() æ–¹æ³•å¯ä»¥å¯¹å­—ç¬¦æˆ–æ•°å­—åˆ—è¡¨è¿›è¡Œæ’åº</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; sites = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line">sites.add(<span class="string">&quot;Taobao&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Wiki&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Runoob&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Weibo&quot;</span>);</span><br><span class="line">sites.add(<span class="string">&quot;Google&quot;</span>);</span><br><span class="line">Collections.sort(sites);  <span class="comment">// å­—æ¯æ’åº</span></span><br><span class="line"><span class="keyword">for</span> (String i : sites) &#123;</span><br><span class="line">System.out.println(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡º</span></span><br><span class="line">Google</span><br><span class="line">Runoob</span><br><span class="line">Taobao</span><br><span class="line">Weibo</span><br><span class="line">Wiki</span><br></pre></td></tr></table></figure><h3 id="ğŸš©æ‰©å®¹æœºåˆ¶"><a href="#ğŸš©æ‰©å®¹æœºåˆ¶" class="headerlink" title="ğŸš©æ‰©å®¹æœºåˆ¶"></a>ğŸš©æ‰©å®¹æœºåˆ¶</h3><ol><li>ArrayList() ä¼šä½¿ç”¨<strong>é•¿åº¦ä¸ºé›¶</strong>çš„æ•°ç»„ </li><li>ArrayList(int initialCapacity) ä¼šä½¿ç”¨æŒ‡å®šå®¹é‡çš„æ•°ç»„ </li><li>public ArrayList(Collection&lt;? extends E&gt; c) ä¼šä½¿ç”¨ c çš„å¤§å°ä½œä¸ºæ•°ç»„å®¹é‡ </li><li><strong>add(Object o)é¦–æ¬¡æ‰©å®¹ä¸º10ï¼Œå†æ¬¡æ‰©å®¹ä¸ºä¸Šæ¬¡å®¹é‡çš„1.5å€</strong></li><li>addAll(Collection c)æ²¡æœ‰å…ƒç´ æ—¶ï¼Œæ‰©å®¹ä¸ºMath.max(10,å®é™…å…ƒç´ ä¸ªæ•°)ï¼Œæœ‰å…ƒç´ æ—¶ä¸ºMath.max(åŸå®¹é‡1.5å€,å®é™…å…ƒç´ ä¸ªæ•°)</li></ol><h2 id="ğŸLinkedList"><a href="#ğŸLinkedList" class="headerlink" title="ğŸLinkedList"></a>ğŸLinkedList</h2><h3 id="æ¦‚è¿°-1"><a href="#æ¦‚è¿°-1" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h3><p>åŸºäº<strong>åŒå‘é“¾è¡¨</strong>å®ç°ï¼Œåªèƒ½<strong>é¡ºåºè®¿é—®</strong>ï¼Œå¯ä»¥å¿«é€Ÿåœ°åœ¨é“¾è¡¨ä¸­é—´æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚LinkedList è¿˜å¯ä»¥ç”¨ä½œ<strong>æ ˆã€é˜Ÿåˆ—å’ŒåŒå‘é˜Ÿåˆ—</strong>.</p><h3 id="æ˜“æ··æ–¹æ³•-1"><a href="#æ˜“æ··æ–¹æ³•-1" class="headerlink" title="æ˜“æ··æ–¹æ³•"></a>æ˜“æ··æ–¹æ³•</h3><h4 id="getFirst-getLast"><a href="#getFirst-getLast" class="headerlink" title="getFirst(), getLast()"></a>getFirst(), getLast()</h4><p>è·å–ç¬¬ä¸€ä¸ªå…ƒç´ å’Œè·å–æœ€åä¸€ä¸ªå…ƒç´ </p><h4 id="removeFirst-removeLast-remove-e-remove-index"><a href="#removeFirst-removeLast-remove-e-remove-index" class="headerlink" title="removeFirst(), removeLast(), remove(e), remove(index)"></a>removeFirst(), removeLast(), remove(e), remove(index)</h4><p>åˆ é™¤ç³»åˆ—æ–¹æ³•</p><h3 id="ğŸš©åŒºåˆ«ArrayList"><a href="#ğŸš©åŒºåˆ«ArrayList" class="headerlink" title="ğŸš©åŒºåˆ«ArrayList"></a>ğŸš©åŒºåˆ«ArrayList</h3><table><thead><tr><th></th><th align="center">ArrayList</th><th align="center">LinkedList</th></tr></thead><tbody><tr><td>ç»“æ„</td><td align="center">åŠ¨æ€æ•°ç»„</td><td align="center">åŒå‘é“¾è¡¨</td></tr><tr><td>è®¿é—®</td><td align="center">éšæœºè®¿é—®</td><td align="center">é¡ºåºè®¿é—®</td></tr><tr><td>æ’å…¥åˆ é™¤</td><td align="center">ä¸€èˆ¬æ€§èƒ½ä½</td><td align="center">ä¸€èˆ¬æ€§èƒ½é«˜</td></tr><tr><td>å†…å­˜å ç”¨</td><td align="center">ä½</td><td align="center">é«˜</td></tr><tr><td>é€‚ç”¨æƒ…å†µ</td><td align="center">é¢‘ç¹è®¿é—®åˆ—è¡¨ä¸­çš„æŸä¸€ä¸ªå…ƒç´ ï¼Œåªéœ€è¦åœ¨åˆ—è¡¨æœ«å°¾è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œ</td><td align="center">éœ€è¦é€šè¿‡å¾ªç¯è¿­ä»£æ¥è®¿é—®åˆ—è¡¨ä¸­çš„æŸäº›å…ƒç´ ï¼Œéœ€è¦é¢‘ç¹çš„åœ¨åˆ—è¡¨å¼€å¤´ã€ä¸­é—´ã€æœ«å°¾ç­‰ä½ç½®è¿›è¡Œæ·»åŠ å’Œåˆ é™¤å…ƒç´ æ“ä½œ</td></tr></tbody></table><h2 id="ğŸé“¾è¡¨æ‰©å±•"><a href="#ğŸé“¾è¡¨æ‰©å±•" class="headerlink" title="ğŸé“¾è¡¨æ‰©å±•"></a>ğŸé“¾è¡¨æ‰©å±•</h2><h3 id="å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"><a href="#å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°" class="headerlink" title="å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"></a>å•å‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SinglyLinkedListSentinel</span> &#123;</span><br><span class="line">    <span class="comment">// å“¨å…µ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Node</span> <span class="variable">head</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(Integer.MIN_VALUE, <span class="literal">null</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ ¹æ®ç´¢å¼•è·å–èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">curr</span> <span class="operator">=</span> <span class="built_in">this</span>.head; curr != <span class="literal">null</span>; curr = curr.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> curr;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findLast</span><span class="params">()</span> &#123;</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">for</span> (curr = <span class="built_in">this</span>.head; curr.next != <span class="literal">null</span>; ) &#123;</span><br><span class="line">            curr = curr.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> curr;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// åŠ å…¥åˆ°æœ€å</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">last</span> <span class="operator">=</span> findLast();</span><br><span class="line">        last.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="literal">null</span>); <span class="comment">// æœ€åä¸€ä¸ªèŠ‚ç‚¹æŒ‡å‘æ–°èŠ‚ç‚¹</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ’å…¥åˆ°ç´¢å¼•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, prev.next);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ ¹æ®ç´¢å¼•åˆ é™¤</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">// index ä¼ å…¥ 0 æ—¶ï¼Œè¿”å›çš„æ˜¯å“¨å…µ</span></span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        Node curr;</span><br><span class="line">        <span class="keyword">if</span> (prev != <span class="literal">null</span> &amp;&amp; (curr = prev.next) != <span class="literal">null</span>) &#123;</span><br><span class="line">            prev.next = curr.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// åŠ å…¥åˆ°å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.head.next = <span class="keyword">new</span> <span class="title class_">Node</span>(value, <span class="built_in">this</span>.head.next);</span><br><span class="line">        <span class="comment">// ä¹Ÿå¯ä»¥è§†ä¸º insert çš„ç‰¹ä¾‹, å³ insert(0, value);</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"><a href="#åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°" class="headerlink" title="åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°"></a>åŒå‘é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DoublyLinkedListSentinel</span> <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;Integer&gt; &#123;</span><br><span class="line"><span class="comment">// é»˜è®¤å¸¦æœ‰ä¸€ä¸ªå¤´èŠ‚ç‚¹å’Œä¸€ä¸ªå°¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node head;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node tail;</span><br><span class="line"><span class="comment">// æ„é€ æ–¹æ³•ï¼šå¤´å°¾äº’ç›¸æŒ‡å‘</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DoublyLinkedListSentinel</span><span class="params">()</span> &#123;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">666</span>, <span class="literal">null</span>);</span><br><span class="line">        tail = <span class="keyword">new</span> <span class="title class_">Node</span>(<span class="literal">null</span>, <span class="number">888</span>, <span class="literal">null</span>);</span><br><span class="line">        head.next = tail;</span><br><span class="line">        tail.prev = head;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ ¹æ®ç´¢å¼•æŸ¥æ‰¾èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> Node <span class="title function_">findNode</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head; p != tail; p = p.next, i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ åˆ°å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addFirst</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        insert(<span class="number">0</span>, value);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å¤´éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        remove(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ åˆ°å°¾éƒ¨ï¼ˆå°¾èŠ‚ç‚¹ä¹‹å‰ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addLast</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">added</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, tail);</span><br><span class="line">        prev.next = added;</span><br><span class="line">        tail.prev = added;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å°¾éƒ¨</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> tail.prev;</span><br><span class="line">        <span class="keyword">if</span> (removed == head) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> removed.prev;</span><br><span class="line">        prev.next = tail;</span><br><span class="line">        tail.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ’å…¥åˆ°æŒ‡å®šä½ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">insert</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>); <span class="comment">// æŸ¥æ‰¾åˆ°å‰èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">inserted</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Node</span>(prev, value, next);</span><br><span class="line">        prev.next = inserted;</span><br><span class="line">        next.prev = inserted;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤æŒ‡å®šç´¢å¼•èŠ‚ç‚¹</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">prev</span> <span class="operator">=</span> findNode(index - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (prev == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">removed</span> <span class="operator">=</span> prev.next;</span><br><span class="line">        <span class="keyword">if</span> (removed == tail) &#123;</span><br><span class="line">            <span class="keyword">throw</span> illegalIndex(index);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">next</span> <span class="operator">=</span> removed.next;</span><br><span class="line">        prev.next = next;</span><br><span class="line">        next.prev = prev;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> IllegalArgumentException <span class="title function_">illegalIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(</span><br><span class="line">                String.format(<span class="string">&quot;index [%d] ä¸åˆæ³•%n&quot;</span>, index));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡å†™è¿­ä»£å™¨</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;Integer&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;Integer&gt;() &#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">p</span> <span class="operator">=</span> head.next;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != tail;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> Integer <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span> &#123;</span><br><span class="line">        Node prev; <span class="comment">// å‰æŒ‡é’ˆ</span></span><br><span class="line">        <span class="type">int</span> value;</span><br><span class="line">        Node next; <span class="comment">// åæŒ‡é’ˆ</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node prev, <span class="type">int</span> value, Node next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—"><a href="#å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—" class="headerlink" title="å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—"></a>å•å‘ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°é˜Ÿåˆ—</h3><p>åˆå§‹æ—¶ï¼š</p><img src="/img/51030/listByLink1.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—1" style="zoom:80%;" /><p>æ’å…¥ç¤ºä¾‹ï¼š</p><img src="/img/51030/listByLink2.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—2" style="zoom:80%;" /><img src="/img/51030/listByLink3.png" alt="é“¾è¡¨å®ç°é˜Ÿåˆ—3" style="zoom:80%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListQueue</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Queue</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// å¤´æŒ‡é’ˆæŒ‡å‘å“¨å…µ</span></span><br><span class="line">    <span class="keyword">private</span> Node&lt;E&gt; tail = head; <span class="comment">// å°¾æŒ‡é’ˆæŒ‡å‘æœ€åä¸€ä¸ª</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">capacity</span> <span class="operator">=</span> Integer.MAX_VALUE; <span class="comment">// å®¹é‡</span></span><br><span class="line"></span><br><span class="line">    &#123;</span><br><span class="line">        tail.next = head; <span class="comment">// åˆå§‹å°¾å¾ªç¯æŒ‡å‘å¤´</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListQueue</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å°¾éƒ¨åŠ å…¥èŠ‚ç‚¹ï¼ˆå…¥é˜Ÿï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offer</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; added = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head);</span><br><span class="line">        tail.next = added;</span><br><span class="line">        tail = added; <span class="comment">// å°¾æŒ‡é’ˆå§‹ç»ˆæŒ‡å‘æœ€åä¸€ä¸ª</span></span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é˜Ÿåˆ—å¤´éƒ¨åˆ é™¤èŠ‚ç‚¹ï¼ˆå‡ºé˜Ÿï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">poll</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        <span class="keyword">if</span> (first == tail) &#123;</span><br><span class="line">            tail = head;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">   <span class="comment">// è¿”å›é˜Ÿå¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ¤ç©º</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head == tail;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ¤æ»¡</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// é‡å†™è¿­ä»£</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next; <span class="comment">// åˆå§‹åœ¨çœŸå®çš„ç¬¬ä¸€ä¸ªèŠ‚ç‚¹</span></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != head;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ"><a href="#é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ" class="headerlink" title="é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ"></a>é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°æ ˆ</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListStack</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Stack</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// å‡ºå…¥æ ˆä»…åœ¨é“¾è¡¨å¤´æ“ä½œ</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Node&lt;E&gt; head = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>); <span class="comment">// å“¨å…µ</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListStack</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å…¥æ ˆï¼Œæ’å…¥é“¾è¡¨å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">push</span><span class="params">(E value)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head.next = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(value, head.next);</span><br><span class="line">        size++;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å‡ºæ ˆï¼Œåˆ é™¤é“¾è¡¨å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; first = head.next;</span><br><span class="line">        head.next = first.next;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> first.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›é“¾è¡¨å¤´çš„å€¼</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> head.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> head.next == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = head.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—"><a href="#ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—" class="headerlink" title="ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—"></a>ç¯å½¢é“¾è¡¨ï¼ˆå¸¦å“¨å…µï¼‰å®ç°åŒç«¯é˜Ÿåˆ—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å…³é”®ç‚¹ï¼šæ‰¾åˆ°å¾…æ“ä½œèŠ‚ç‚¹åœ¨é“¾è¡¨ä¸­çš„å‰åèŠ‚ç‚¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListDeque</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Deque</span>&lt;E&gt;, Iterable&lt;E&gt; &#123;</span><br><span class="line"><span class="comment">// åŠ å…¥å¤´éƒ¨ï¼ˆå“¨å…µçš„åä¸€ä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerFirst</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel.next; <span class="comment">// å</span></span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åŠ å…¥å°¾éƒ¨ï¼ˆå“¨å…µçš„å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">offerLast</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isFull()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        Node&lt;E&gt; a = sentinel.prev; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel; <span class="comment">// å</span></span><br><span class="line">        Node&lt;E&gt; offered = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(a, e, b);</span><br><span class="line">        a.next = offered;</span><br><span class="line">        b.prev = offered;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å¤´</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; a = sentinel; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; polled = sentinel.next;</span><br><span class="line">        Node&lt;E&gt; b = polled.next; <span class="comment">// å</span></span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// åˆ é™¤å°¾</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">pollLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Node&lt;E&gt; polled = sentinel.prev;</span><br><span class="line">        Node&lt;E&gt; a = polled.prev; <span class="comment">// å‰</span></span><br><span class="line">        Node&lt;E&gt; b = sentinel; <span class="comment">// å</span></span><br><span class="line">        a.next = b;</span><br><span class="line">        b.prev = a;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">return</span> polled.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›å¤´ï¼ˆå“¨å…µçš„åä¸€ä¸ªï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekFirst</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.next.value;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¿”å›å°¾ï¼ˆå“¨å…µçš„å‰ä¸€ä¸ªï¼‰</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> E <span class="title function_">peekLast</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sentinel.prev.value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isEmpty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isFull</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size == capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;E&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Iterator</span>&lt;E&gt;() &#123;</span><br><span class="line">            Node&lt;E&gt; p = sentinel.next;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p != sentinel;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="keyword">public</span> E <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">                <span class="type">E</span> <span class="variable">value</span> <span class="operator">=</span> p.value;</span><br><span class="line">                p = p.next;</span><br><span class="line">                <span class="keyword">return</span> value;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å†…éƒ¨èŠ‚ç‚¹ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Node</span>&lt;E&gt; &#123;</span><br><span class="line">        Node&lt;E&gt; prev;</span><br><span class="line">        E value;</span><br><span class="line">        Node&lt;E&gt; next;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">Node</span><span class="params">(Node&lt;E&gt; prev, E value, Node&lt;E&gt; next)</span> &#123;</span><br><span class="line">            <span class="built_in">this</span>.prev = prev;</span><br><span class="line">            <span class="built_in">this</span>.value = value;</span><br><span class="line">            <span class="built_in">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Node&lt;E&gt; sentinel = <span class="keyword">new</span> <span class="title class_">Node</span>&lt;&gt;(<span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">    <span class="type">int</span> capacity;</span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LinkedListDeque</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        sentinel.next = sentinel;</span><br><span class="line">        sentinel.prev = sentinel;</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> æ•°æ®ç»“æ„ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCå›æ”¶ç­–ç•¥ä¸GCå™¨</title>
      <link href="/posts/46450/"/>
      <url>/posts/46450/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå›æ”¶ç­–ç•¥"><a href="#ğŸå›æ”¶ç­–ç•¥" class="headerlink" title="ğŸå›æ”¶ç­–ç•¥"></a>ğŸå›æ”¶ç­–ç•¥</h2><p>æ ¹æ® GC çš„è§„æ¨¡å¯ä»¥åˆ†æˆ <strong>Minor GC</strong>ï¼Œ<strong>Major GC</strong>ï¼Œ<strong>Mixed GC</strong>ï¼Œ<strong>Full GC</strong></p><p>Minor GCï¼ˆYoung GCï¼‰:åªæ˜¯æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†ï¼Œæš‚åœæ—¶é—´çŸ­</p><p>Major GCï¼ˆOld GCï¼‰:åªæ˜¯è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œåªæœ‰ CMSæ”¶é›†å™¨ ä¼šæœ‰</p><p>Mixed GCï¼šæ–°ç”Ÿä»£ + è€å¹´ä»£éƒ¨åˆ†åŒºåŸŸçš„åƒåœ¾å›æ”¶ï¼Œ<strong>G1æ”¶é›†å™¨</strong>ç‰¹æœ‰</p><p>Full GCï¼šæ–°ç”Ÿä»£ + è€å¹´ä»£<strong>å®Œæ•´</strong>åƒåœ¾å›æ”¶ï¼Œæš‚åœæ—¶é—´é•¿ï¼Œ<strong>åº”å°½åŠ›é¿å…</strong></p><h2 id="ğŸåƒåœ¾æ”¶é›†å™¨"><a href="#ğŸåƒåœ¾æ”¶é›†å™¨" class="headerlink" title="ğŸåƒåœ¾æ”¶é›†å™¨"></a>ğŸåƒåœ¾æ”¶é›†å™¨</h2><h3 id="Parallel-GC"><a href="#Parallel-GC" class="headerlink" title="Parallel GC"></a>Parallel GC</h3><ul><li>eden å†…å­˜ä¸è¶³å‘ç”Ÿ Minor GCï¼Œé‡‡ç”¨æ ‡è®°å¤åˆ¶ç®—æ³•ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ </li><li>old å†…å­˜ä¸è¶³å‘ç”Ÿ Full GCï¼Œé‡‡ç”¨æ ‡è®°æ•´ç†ç®—æ³•ï¼Œéœ€è¦æš‚åœç”¨æˆ·çº¿ç¨‹ </li><li><strong>æ³¨é‡ååé‡</strong></li></ul><h3 id="ConcurrentMarkSweep-GC"><a href="#ConcurrentMarkSweep-GC" class="headerlink" title="ConcurrentMarkSweep GC"></a>ConcurrentMarkSweep GC</h3><ul><li><p>å®ƒæ˜¯å·¥ä½œåœ¨ old è€å¹´ä»£ï¼Œæ”¯æŒ<strong>å¹¶å‘æ ‡è®°</strong>çš„ä¸€æ¬¾å›æ”¶å™¨ï¼Œé‡‡ç”¨<strong>å¹¶å‘æ¸…é™¤</strong>ç®—æ³• </p></li><li><ul><li>å¹¶å‘æ ‡è®°æ—¶ä¸éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</li><li>é‡æ–°æ ‡è®°æ—¶ä»éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</li></ul></li><li><p>å¦‚æœå¹¶å‘å¤±è´¥ï¼ˆå³å›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GC </p></li><li><p><strong>æ³¨é‡å“åº”æ—¶é—´</strong></p></li></ul><h3 id="ğŸš©G1-GC"><a href="#ğŸš©G1-GC" class="headerlink" title="ğŸš©G1 GC"></a>ğŸš©G1 GC</h3><h4 id="æ¦‚è¿°"><a href="#æ¦‚è¿°" class="headerlink" title="æ¦‚è¿°"></a>æ¦‚è¿°</h4><ul><li><strong>å“åº”æ—¶é—´ä¸ååé‡å…¼é¡¾</strong></li><li>åˆ’åˆ†æˆå¤šä¸ªåŒºåŸŸï¼Œæ¯ä¸ªåŒºåŸŸéƒ½å¯ä»¥å……å½“ edenï¼Œsurvivorï¼Œoldï¼Œ humongousï¼Œå…¶ä¸­ humongous ä¸“ä¸ºå¤§å¯¹è±¡å‡†å¤‡</li><li>åˆ†æˆä¸‰ä¸ªé˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</li><li>å¦‚æœå¹¶å‘å¤±è´¥ï¼ˆå³å›æ”¶é€Ÿåº¦èµ¶ä¸ä¸Šåˆ›å»ºæ–°å¯¹è±¡é€Ÿåº¦ï¼‰ï¼Œä¼šè§¦å‘ Full GC</li></ul><h4 id="å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶"><a href="#å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶" class="headerlink" title="å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶"></a>å›æ”¶é˜¶æ®µï¼šæ–°ç”Ÿä»£å›æ”¶</h4><p>1.åˆå§‹æ—¶ï¼Œæ‰€æœ‰åŒºåŸŸéƒ½å¤„äºç©ºé—²çŠ¶æ€</p><img src="/img/46450/G1-1.png" alt="G1-1" style="zoom: 67%;" /><p>2.åˆ›å»ºäº†ä¸€äº›å¯¹è±¡ï¼ŒæŒ‘å‡ºä¸€äº›ç©ºé—²åŒºåŸŸä½œä¸ºä¼Šç”¸å›­åŒºå­˜å‚¨è¿™äº›å¯¹è±¡</p><img src="/img/46450/G1-2.png" alt="G1-2" style="zoom: 67%;" /><p>3.å½“ä¼Šç”¸å›­éœ€è¦åƒåœ¾å›æ”¶æ—¶ï¼ŒæŒ‘å‡ºä¸€ä¸ªç©ºé—²åŒºåŸŸä½œä¸ºå¹¸å­˜åŒºï¼Œç”¨<strong>å¤åˆ¶ç®—æ³•</strong>å¤åˆ¶å­˜æ´»å¯¹è±¡ï¼Œéœ€è¦<strong>æš‚åœç”¨æˆ·çº¿ç¨‹</strong></p><img src="/img/46450/G1-3.png" alt="G1-3" style="zoom:67%;" /><p>4.å¤åˆ¶å®Œæˆï¼Œå°†ä¹‹å‰çš„ä¼Šç”¸å›­å†…å­˜é‡Šæ”¾</p><img src="/img/46450/G1-4.png" alt="G1-4" style="zoom:67%;" /><p>5.éšç€æ—¶é—´æµé€ï¼Œä¼Šç”¸å›­çš„å†…å­˜åˆæœ‰ä¸è¶³</p><img src="/img/46450/G1-5.png" alt="G1-5" style="zoom:67%;" /><p>6.å°†ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºä¸­çš„å­˜æ´»å¯¹è±¡ï¼Œé‡‡ç”¨<strong>å¤åˆ¶ç®—æ³•</strong>ï¼Œå¤åˆ¶åˆ°æ–°çš„å¹¸å­˜åŒºï¼Œå…¶ä¸­è¾ƒè€å¯¹è±¡æ™‹å‡è‡³<strong>è€å¹´ä»£</strong></p><img src="/img/46450/G1-6.png" alt="G1-6" style="zoom:67%;" /><p>7.é‡Šæ”¾ä¼Šç”¸å›­ä»¥åŠä¹‹å‰å¹¸å­˜åŒºçš„å†…å­˜</p><img src="/img/46450/G1-7.png" alt="G1-7" style="zoom:67%;" /><h4 id="å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†"><a href="#å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†" class="headerlink" title="å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†"></a>å›æ”¶é˜¶æ®µï¼šå¹¶å‘æ ‡è®°ä¸æ··åˆæ”¶é›†</h4><p>1.å½“è€å¹´ä»£å ç”¨å†…å­˜è¶…è¿‡é˜ˆå€¼åï¼Œè§¦å‘å¹¶å‘æ ‡è®°ï¼Œè¿™æ—¶<strong>æ— éœ€æš‚åœç”¨æˆ·çº¿ç¨‹</strong></p><img src="/img/46450/G1-8.png" alt="G1-8" style="zoom:67%;" /><p>2.å¹¶å‘æ ‡è®°ä¹‹åï¼Œä¼šæœ‰é‡æ–°æ ‡è®°é˜¶æ®µè§£å†³æ¼æ ‡é—®é¢˜ï¼Œæ­¤æ—¶éœ€è¦<strong>æš‚åœç”¨æˆ·çº¿ç¨‹</strong>ã€‚è¿™äº›éƒ½å®Œæˆåå°±çŸ¥é“è€å¹´ä»£æœ‰å“ªäº›å­˜æ´»å¯¹è±¡ï¼Œéšåè¿›å…¥æ··åˆæ”¶é›†é˜¶æ®µã€‚æ­¤æ—¶ä¸ä¼šå¯¹æ‰€æœ‰è€å¹´ä»£åŒºåŸŸè¿›è¡Œå›æ”¶ï¼Œè€Œæ˜¯æ ¹æ®<strong>æš‚åœæ—¶é—´ç›®æ ‡ä¼˜å…ˆå›æ”¶ä»·å€¼é«˜</strong>ï¼ˆå­˜æ´»å¯¹è±¡å°‘ï¼‰çš„åŒºåŸŸï¼ˆè¿™ä¹Ÿæ˜¯ Gabage First åç§°çš„ç”±æ¥ï¼‰ã€‚</p><img src="/img/46450/G1-9.png" alt="G1-9" style="zoom:67%;" /><p>3.æ··åˆæ”¶é›†é˜¶æ®µä¸­ï¼Œå‚ä¸å¤åˆ¶çš„æœ‰ edenã€survivorã€oldï¼Œä¸‹å›¾æ˜¾ç¤ºäº†ä¼Šç”¸å›­å’Œå¹¸å­˜åŒºçš„å­˜æ´»å¯¹è±¡å¤åˆ¶</p><img src="/img/46450/G1-10.png" alt="G1-10" style="zoom:67%;" /><p>4.è€å¹´ä»£å’Œå¹¸å­˜åŒºæ™‹å‡çš„å­˜æ´»å¯¹è±¡çš„å¤åˆ¶</p><img src="/img/46450/G1-11.png" alt="G1-11" style="zoom:67%;" /><p>5.å¤åˆ¶å®Œæˆï¼Œå†…å­˜å¾—åˆ°é‡Šæ”¾ã€‚è¿›å…¥ä¸‹ä¸€è½®çš„æ–°ç”Ÿä»£å›æ”¶ã€å¹¶å‘æ ‡è®°ã€æ··åˆæ”¶é›†</p><img src="/img/46450/G1-12.png" alt="G1-12" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCå›æ”¶ç®—æ³•</title>
      <link href="/posts/64310/"/>
      <url>/posts/64310/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ ‡è®°æ¸…é™¤æ³•"><a href="#ğŸæ ‡è®°æ¸…é™¤æ³•" class="headerlink" title="ğŸæ ‡è®°æ¸…é™¤æ³•"></a>ğŸæ ‡è®°æ¸…é™¤æ³•</h2><h4 id="æ­¥éª¤ï¼š"><a href="#æ­¥éª¤ï¼š" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>æ‰¾åˆ° GC Root å¯¹è±¡ï¼Œå³é‚£äº›<strong>ä¸€å®šä¸ä¼šè¢«å›æ”¶çš„å¯¹è±¡</strong>ï¼Œå¦‚æ­£æ‰§è¡Œæ–¹æ³•å†…å±€éƒ¨å˜é‡å¼•ç”¨çš„å¯¹è±¡ã€é™æ€å˜é‡å¼•ç”¨çš„å¯¹è±¡</li><li>æ ‡è®°é˜¶æ®µï¼šæ²¿ç€ GC Root å¯¹è±¡çš„å¼•ç”¨é“¾æ‰¾ï¼Œç›´æ¥æˆ–é—´æ¥å¼•ç”¨åˆ°çš„å¯¹è±¡åŠ ä¸Šæ ‡è®°</li><li>æ¸…é™¤é˜¶æ®µï¼šé‡Šæ”¾<strong>æœªåŠ æ ‡è®°</strong>çš„å¯¹è±¡å ç”¨çš„å†…å­˜</li></ol><img src="/img/64310/GC1.png" alt="GC1" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³»</li><li>æ¸…é™¤é€Ÿåº¦ä¸å†…å­˜å¤§å°æˆçº¿æ€§å…³ç³»</li><li>ç¼ºç‚¹æ˜¯ä¼šäº§ç”Ÿ<strong>å†…å­˜ç¢ç‰‡</strong></li></ul><h2 id="ğŸæ ‡è®°æ•´ç†æ³•"><a href="#ğŸæ ‡è®°æ•´ç†æ³•" class="headerlink" title="ğŸæ ‡è®°æ•´ç†æ³•"></a>ğŸæ ‡è®°æ•´ç†æ³•</h2><h4 id="æ­¥éª¤ï¼š-1"><a href="#æ­¥éª¤ï¼š-1" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>å‰é¢çš„æ ‡è®°é˜¶æ®µã€æ¸…ç†é˜¶æ®µä¸æ ‡è®°æ¸…é™¤æ³•ç±»ä¼¼</li><li>å¤šäº†ä¸€æ­¥<strong>æ•´ç†</strong>çš„åŠ¨ä½œï¼Œå°†å­˜æ´»å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œå¯ä»¥<strong>é¿å…å†…å­˜ç¢ç‰‡</strong>äº§ç”Ÿ</li></ol><img src="/img/64310/GC2.png" alt="GC2" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š-1"><a href="#ç‰¹ç‚¹ï¼š-1" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³» </li><li>æ¸…é™¤ä¸æ•´ç†é€Ÿåº¦ä¸å†…å­˜å¤§å°æˆçº¿æ€§å…³ç³» </li><li>ç¼ºç‚¹æ˜¯æ€§èƒ½ä¸Š<strong>è¾ƒæ…¢</strong></li></ul><h2 id="ğŸæ ‡è®°å¤åˆ¶æ³•"><a href="#ğŸæ ‡è®°å¤åˆ¶æ³•" class="headerlink" title="ğŸæ ‡è®°å¤åˆ¶æ³•"></a>ğŸæ ‡è®°å¤åˆ¶æ³•</h2><h4 id="æ­¥éª¤ï¼š-2"><a href="#æ­¥éª¤ï¼š-2" class="headerlink" title="æ­¥éª¤ï¼š"></a>æ­¥éª¤ï¼š</h4><ol><li>å°†æ•´ä¸ªå†…å­˜åˆ†æˆä¸¤ä¸ªå¤§å°ç›¸ç­‰çš„åŒºåŸŸï¼Œfrom å’Œ toï¼Œå…¶ä¸­ <strong>to æ€»æ˜¯å¤„äºç©ºé—²</strong>ï¼Œ<strong>from å­˜å‚¨æ–°åˆ›å»ºçš„å¯¹è±¡</strong></li><li>æ ‡è®°é˜¶æ®µä¸å‰é¢çš„ç®—æ³•ç±»ä¼¼</li><li>åœ¨æ‰¾å‡ºå­˜æ´»å¯¹è±¡åï¼Œä¼šå°†å®ƒä»¬ä» from å¤åˆ¶åˆ° to åŒºåŸŸï¼Œå¤åˆ¶çš„è¿‡ç¨‹ä¸­è‡ªç„¶å®Œæˆäº†ç¢ç‰‡æ•´ç†</li><li>å¤åˆ¶å®Œæˆåï¼Œ<strong>äº¤æ¢</strong> from å’Œ to çš„ä½ç½®å³å¯</li></ol><img src="/img/64310/GC3.png" alt="GC3" style="zoom:80%;" /><h4 id="ç‰¹ç‚¹ï¼š-2"><a href="#ç‰¹ç‚¹ï¼š-2" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a>ç‰¹ç‚¹ï¼š</h4><ul><li>æ ‡è®°ä¸å¤åˆ¶é€Ÿåº¦ä¸å­˜æ´»å¯¹è±¡æˆçº¿æ€§å…³ç³»</li><li>ç¼ºç‚¹æ˜¯ä¼šå ç”¨æˆå€çš„ç©ºé—´</li></ul><h2 id="ğŸåˆ†ä»£å›æ”¶æ€æƒ³"><a href="#ğŸåˆ†ä»£å›æ”¶æ€æƒ³" class="headerlink" title="ğŸåˆ†ä»£å›æ”¶æ€æƒ³"></a>ğŸåˆ†ä»£å›æ”¶æ€æƒ³</h2><blockquote><p>æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œä¸åŒå—é‡‡ç”¨é€‚å½“çš„æ”¶é›†ç®—æ³•</p><ul><li>æ–°ç”Ÿä»£ä½¿ç”¨: æ ‡è®°å¤åˆ¶æ³•</li><li>è€å¹´ä»£ä½¿ç”¨: æ ‡è®°æ¸…é™¤æ³• æˆ–è€… æ ‡è®°æ•´ç†æ³•</li></ul></blockquote><p>1.ä¼Šç”¸å›­edenï¼Œæœ€åˆå¯¹è±¡éƒ½åˆ†é…åˆ°è¿™é‡Œï¼Œä¸å¹¸å­˜åŒº survivorï¼ˆåˆ†æˆ from å’Œ toï¼‰åˆç§°æ–°ç”Ÿä»£</p><img src="/img/64310/åˆ†ä»£1.png" alt="åˆ†ä»£1" style="zoom:80%;" /><p>2.å½“ä¼Šç”¸å›­å†…å­˜ä¸è¶³ï¼Œæ ‡è®°ä¼Šç”¸å›­ä¸ fromï¼ˆç°é˜¶æ®µæ²¡æœ‰ï¼‰çš„å­˜æ´»å¯¹è±¡ï¼ˆè¿™é‡Œä¸º6ï¼‰</p><img src="/img/64310/åˆ†ä»£2.png" alt="åˆ†ä»£2" style="zoom:80%;" /><p>3.å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ° to ä¸­ï¼Œå¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ from å†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</p><img src="/img/64310/åˆ†ä»£3.png" alt="åˆ†ä»£3" style="zoom:80%;" /><p>4.å°† from å’Œ to äº¤æ¢ä½ç½®</p><img src="/img/64310/åˆ†ä»£4.png" alt="åˆ†ä»£4" style="zoom:80%;" /><p>5.ç»è¿‡ä¸€æ®µæ—¶é—´åä¼Šç”¸å›­çš„å†…å­˜åˆå‡ºç°ä¸è¶³</p><img src="/img/64310/åˆ†ä»£5.png" alt="åˆ†ä»£5" style="zoom:80%;" /><p>6.æ ‡è®°ä¼Šç”¸å›­ä¸ fromä¸­çš„å­˜æ´»å¯¹è±¡</p><img src="/img/64310/åˆ†ä»£6.png" alt="åˆ†ä»£6" style="zoom:80%;" /><p>7.å°†å­˜æ´»å¯¹è±¡é‡‡ç”¨å¤åˆ¶ç®—æ³•å¤åˆ¶åˆ° to ä¸­</p><img src="/img/64310/åˆ†ä»£7.png" alt="åˆ†ä»£7" style="zoom:80%;" /><p>8.å¤åˆ¶å®Œæ¯•åï¼Œä¼Šç”¸å›­å’Œ from å†…å­˜éƒ½å¾—åˆ°é‡Šæ”¾</p><img src="/img/64310/åˆ†ä»£8.png" alt="åˆ†ä»£8" style="zoom:80%;" /><p>9.å°† from å’Œ to äº¤æ¢ä½ç½®ï¼ˆä¿è¯toåŒºä¸ºç©ºï¼‰</p><img src="/img/64310/åˆ†ä»£9.png" alt="åˆ†ä»£9" style="zoom:80%;" /><p>10.è€å¹´ä»£ oldï¼Œå½“å¹¸å­˜åŒºå¯¹è±¡ç†¬è¿‡å‡ æ¬¡å›æ”¶ï¼ˆæœ€å¤š<strong>15</strong>æ¬¡ï¼‰ï¼Œæ™‹å‡åˆ°è€å¹´ä»£ï¼ˆå¹¸å­˜åŒºå†…å­˜ä¸è¶³æˆ–å¤§å¯¹è±¡ä¼šå¯¼è‡´æå‰æ™‹å‡ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¼•ç”¨ç±»å‹</title>
      <link href="/posts/40363/"/>
      <url>/posts/40363/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå¼ºå¼•ç”¨"><a href="#ğŸå¼ºå¼•ç”¨" class="headerlink" title="ğŸå¼ºå¼•ç”¨"></a>ğŸå¼ºå¼•ç”¨</h2><blockquote><p>æ™®é€šå˜é‡èµ‹å€¼å³ä¸ºå¼ºå¼•ç”¨ï¼Œå¦‚ A a &#x3D; new A();</p></blockquote><p>é€šè¿‡ GC Root çš„å¼•ç”¨é“¾ï¼Œå¦‚æœå¼ºå¼•ç”¨ä¸åˆ°è¯¥å¯¹è±¡ï¼Œè¯¥å¯¹è±¡æ‰èƒ½è¢«å›æ”¶</p><img src="/img/40363/GCå¼•ç”¨1.png" alt="GCå¼•ç”¨1" style="zoom: 80%;" /><p>ğŸˆ<strong>GC Root</strong></p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><h2 id="ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"><a href="#ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰" class="headerlink" title="ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰"></a>ğŸè½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</h2><blockquote><p>ä½¿ç”¨ SoftReference ç±»æ¥åˆ›å»ºè½¯å¼•ç”¨ï¼ŒSoftReference a &#x3D; new SoftReference(new A());</p></blockquote><ul><li>å¦‚æœä»…æœ‰è½¯å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œ<strong>é¦–æ¬¡</strong>åƒåœ¾å›æ”¶ä¸ä¼šå›æ”¶è¯¥å¯¹è±¡ï¼Œå¦‚æœ<strong>å†…å­˜ä»ä¸è¶³</strong>ï¼Œå†æ¬¡å›æ”¶æ—¶æ‰ä¼šé‡Šæ”¾å¯¹è±¡ </li><li>è½¯å¼•ç”¨è‡ªèº«éœ€è¦é…åˆ<strong>å¼•ç”¨é˜Ÿåˆ—</strong>æ¥é‡Šæ”¾ </li><li>å…¸å‹ä¾‹å­æ˜¯åå°„æ•°æ®</li></ul><img src="/img/40363/GCå¼•ç”¨2.png" alt="GCå¼•ç”¨2" style="zoom:80%;" /><h2 id="ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰"><a href="#ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰" class="headerlink" title="ğŸå¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰"></a>ğŸå¼±å¼•ç”¨ï¼ˆ<strong>WeakReference</strong>ï¼‰</h2><blockquote><p>ä½¿ç”¨ WeakReference ç±»æ¥å®ç°å¼±å¼•ç”¨ï¼ŒWeakReference a &#x3D; new WeakReference(new A());</p></blockquote><ul><li>å¦‚æœä»…æœ‰å¼±å¼•ç”¨å¼•ç”¨è¯¥å¯¹è±¡æ—¶ï¼Œ<strong>åªè¦å‘ç”Ÿ</strong>åƒåœ¾å›æ”¶ï¼Œ<strong>å°±ä¼šé‡Šæ”¾</strong>è¯¥å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåªèƒ½å­˜æ´»åˆ°ä¸‹ä¸€æ¬¡åƒåœ¾å›æ”¶å‘ç”Ÿä¹‹å‰</li><li>å¼±å¼•ç”¨è‡ªèº«éœ€è¦é…åˆ<strong>å¼•ç”¨é˜Ÿåˆ—</strong>æ¥é‡Šæ”¾</li><li>å…¸å‹ä¾‹å­æ˜¯ ThreadLocalMap ä¸­çš„ <strong>Entry</strong> å¯¹è±¡</li></ul><img src="/img/40363/GCå¼•ç”¨3.png" alt="GCå¼•ç”¨3" style="zoom:80%;" /><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestWeakReference</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyWeakMap</span> <span class="variable">map</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyWeakMap</span>();</span><br><span class="line">        map.put(<span class="number">0</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;a&quot;</span>), <span class="string">&quot;1&quot;</span>);</span><br><span class="line">        map.put(<span class="number">1</span>, <span class="string">&quot;b&quot;</span>, <span class="string">&quot;2&quot;</span>);</span><br><span class="line">        map.put(<span class="number">2</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;c&quot;</span>), <span class="string">&quot;3&quot;</span>);</span><br><span class="line">        map.put(<span class="number">3</span>, <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;d&quot;</span>), <span class="string">&quot;4&quot;</span>);</span><br><span class="line">        System.out.println(map);<span class="comment">// è¾“å‡º:[a:1,b:2,c:3,d:4]</span></span><br><span class="line"></span><br><span class="line">        System.gc();</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;b&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;c&quot;</span>));</span><br><span class="line">        System.out.println(map.get(<span class="string">&quot;d&quot;</span>));</span><br><span class="line">        System.out.println(map);<span class="comment">// è¾“å‡º:[null:1,null:2,null:3,null:4]</span></span><br><span class="line">        map.clean();</span><br><span class="line">        System.out.println(map); <span class="comment">// è¾“å‡º:[b:2]</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ¨¡æ‹Ÿ ThreadLocalMap çš„å†…å­˜æ³„æ¼é—®é¢˜ä»¥åŠä¸€ç§è§£å†³æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyWeakMap</span> &#123;</span><br><span class="line">        <span class="keyword">static</span> ReferenceQueue&lt;Object&gt; queue = <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Entry</span> <span class="keyword">extends</span> <span class="title class_">WeakReference</span>&lt;String&gt; &#123;</span><br><span class="line">            String value;</span><br><span class="line">            <span class="keyword">public</span> <span class="title function_">Entry</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">                <span class="built_in">super</span>(key, queue); <span class="comment">// keyä¸ºå¼±å¼•ç”¨</span></span><br><span class="line">                <span class="built_in">this</span>.value = value; <span class="comment">// valueä¸ºå¼ºå¼•ç”¨</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">clean</span><span class="params">()</span> &#123;</span><br><span class="line">            Object ref;</span><br><span class="line">            <span class="keyword">while</span> ((ref = queue.poll()) != <span class="literal">null</span>) &#123;</span><br><span class="line">                System.out.println(ref);</span><br><span class="line">                <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; table.length; i++) &#123;</span><br><span class="line">                    <span class="keyword">if</span>(table[i] == ref) &#123;</span><br><span class="line">                        table[i] = <span class="literal">null</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Entry[] table = <span class="keyword">new</span> <span class="title class_">Entry</span>[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> index, String key, String value)</span> &#123;</span><br><span class="line">            table[index] = <span class="keyword">new</span> <span class="title class_">Entry</span>(key, value);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">            <span class="keyword">for</span> (Entry entry : table) &#123;</span><br><span class="line">                <span class="keyword">if</span> (entry != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> entry.get();</span><br><span class="line">                    <span class="keyword">if</span> (k != <span class="literal">null</span> &amp;&amp; k.equals(key)) &#123;</span><br><span class="line">                        <span class="keyword">return</span> entry.value;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            sb.append(<span class="string">&quot;[&quot;</span>);</span><br><span class="line">            <span class="keyword">for</span> (Entry entry : table) &#123;</span><br><span class="line">                <span class="keyword">if</span> (entry != <span class="literal">null</span>) &#123;</span><br><span class="line">                    <span class="type">String</span> <span class="variable">k</span> <span class="operator">=</span> entry.get();</span><br><span class="line">                    sb.append(k).append(<span class="string">&quot;:&quot;</span>).append(entry.value).append(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (sb.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                sb.deleteCharAt(sb.length() - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            sb.append(<span class="string">&quot;]&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"><a href="#ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰" class="headerlink" title="ğŸè™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰"></a>ğŸè™šå¼•ç”¨ï¼ˆ<strong>PhantomReference</strong>ï¼‰</h2><blockquote><p>ä½¿ç”¨PhantomReferenceç±»å®ç°è™šå¼•ç”¨ï¼ŒPhantomReference a &#x3D; new PhantomReference(new A(), referenceQueue);</p></blockquote><ul><li>å¿…é¡»<strong>é…åˆå¼•ç”¨é˜Ÿåˆ—</strong>ä¸€èµ·ä½¿ç”¨ï¼Œå½“è™šå¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«å›æ”¶æ—¶ï¼Œç”± Reference Handler çº¿ç¨‹å°†è™šå¼•ç”¨å¯¹è±¡å…¥é˜Ÿï¼Œè¿™æ ·å°±å¯ä»¥çŸ¥é“å“ªäº›å¯¹è±¡è¢«å›æ”¶ï¼Œä»è€Œå¯¹å®ƒä»¬å…³è”çš„èµ„æºåšè¿›ä¸€æ­¥å¤„ç†</li><li>æ— æ³•é€šè¿‡è™šå¼•ç”¨å–å¾—ä¸€ä¸ªå¯¹è±¡</li><li>ä¸ºä¸€ä¸ªå¯¹è±¡è®¾ç½®è™šå¼•ç”¨å…³è”çš„å”¯ä¸€ç›®çš„å°±æ˜¯èƒ½åœ¨è¿™ä¸ªå¯¹è±¡è¢«<strong>å›æ”¶æ—¶æ”¶åˆ°ä¸€ä¸ªç³»ç»Ÿé€šçŸ¥</strong></li><li>å…¸å‹ä¾‹å­æ˜¯ Cleaner é‡Šæ”¾ DirectByteBuffer å…³è”çš„ç›´æ¥å†…å­˜</li></ul><img src="/img/40363/GCå¼•ç”¨4.png" alt="GCå¼•ç”¨4" style="zoom:80%;" /><hr><p> <strong>æ€»ç»“</strong>ï¼šå¼º-æ— æ³•æ”¶ï¼Œå¼±-ç¢°å°±æ”¶ï¼Œè½¯-äºŒæ¬¡æ”¶ï¼Œè™š-é€šçŸ¥æ”¶</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JavaåŸºç¡€ </tag>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GCåˆ¤æ–­æ— ç”¨å¯¹è±¡</title>
      <link href="/posts/26437/"/>
      <url>/posts/26437/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collectionï¼‰ï¼Œç›®çš„åœ¨äºå®ç°æ— ç”¨å¯¹è±¡å†…å­˜è‡ªåŠ¨é‡Šæ”¾ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€åŠ å¿«åˆ†é…é€Ÿåº¦</p></blockquote><ul><li>å›æ”¶åŒºåŸŸæ˜¯<strong>å †å†…å­˜</strong>ï¼Œä¸åŒ…æ‹¬è™šæ‹Ÿæœºæ ˆ</li><li>åˆ¤æ–­æ— ç”¨å¯¹è±¡ï¼Œä½¿ç”¨<strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼Œ<strong>ä¸‰è‰²æ ‡è®°æ³•</strong>æ ‡è®°å­˜æ´»å¯¹è±¡ï¼Œå›æ”¶æœªæ ‡è®°å¯¹è±¡</li><li>GC å…·ä½“çš„å®ç°ç§°ä¸º<strong>åƒåœ¾å›æ”¶å™¨</strong></li><li>GC å¤§éƒ½é‡‡ç”¨äº†<strong>åˆ†ä»£å›æ”¶æ€æƒ³</strong></li></ul><h2 id="ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡"><a href="#ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡" class="headerlink" title="ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡"></a>ğŸåˆ¤æ–­æ— ç”¨å¯¹è±¡</h2><h3 id="1-å¯è¾¾æ€§åˆ†æç®—æ³•"><a href="#1-å¯è¾¾æ€§åˆ†æç®—æ³•" class="headerlink" title="1.å¯è¾¾æ€§åˆ†æç®—æ³•"></a>1.å¯è¾¾æ€§åˆ†æç®—æ³•</h3><blockquote><p>é€šè¿‡ <strong>GC Roots</strong> ä½œä¸ºèµ·å§‹ç‚¹è¿›è¡Œæœç´¢ï¼Œèƒ½å¤Ÿåˆ°è¾¾åˆ°çš„å¯¹è±¡éƒ½æ˜¯å­˜æ´»çš„ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å¯è¢«å›æ”¶</p></blockquote><p>GC Roots ä¸€èˆ¬åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>è™šæ‹Ÿæœºæ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æœ¬åœ°æ–¹æ³•æ ˆä¸­å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</li></ul><img src="/img/26437/GC1.png" alt="GC1"  /><h3 id="2-å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰"><a href="#2-å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰" class="headerlink" title="2.å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰"></a>2.å¹¶å‘æ ‡è®°ç®—æ³•ï¼ˆä¸‰è‰²æ ‡è®°æ³•ï¼‰</h3><h4 id="åŸºç¡€æè¿°"><a href="#åŸºç¡€æè¿°" class="headerlink" title="åŸºç¡€æè¿°"></a>åŸºç¡€æè¿°</h4><p>ç”¨ä¸‰ç§é¢œè‰²è®°å½•å¯¹è±¡çš„æ ‡è®°çŠ¶æ€</p><ul><li>é»‘è‰² â€“ å·²æ ‡è®°</li><li>ç°è‰² â€“ æ ‡è®°ä¸­</li><li>ç™½è‰² â€“ è¿˜æœªæ ‡è®°</li></ul><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>1.èµ·å§‹çš„ä¸‰ä¸ªå¯¹è±¡è¿˜æœªå¤„ç†å®Œæˆï¼Œç”¨ç°è‰²è¡¨ç¤º</p><img src="/img/26437/GC2.png" alt="GC2" style="zoom:67%;" /><p>2.è¯¥å¯¹è±¡çš„å¼•ç”¨å·²ç»å¤„ç†å®Œæˆï¼Œç”¨é»‘è‰²è¡¨ç¤ºï¼Œé»‘è‰²å¼•ç”¨çš„å¯¹è±¡å˜ä¸ºç°è‰²</p><img src="/img/26437/GC3.png" alt="GC3" style="zoom:67%;" /><p>3.æ²¿ç€å¼•ç”¨é“¾éƒ½æ ‡è®°ä¸€é</p><img src="/img/26437/GC4.png" alt="GC4" style="zoom:67%;" /><p>4.æœ€åæœªæ ‡è®°çš„ç™½è‰²å¯¹è±¡ï¼Œå³ä¸º<strong>åƒåœ¾</strong></p><img src="/img/26437/GC5.png" alt="GC5" style="zoom:67%;" /><h4 id="å¹¶å‘æ¼æ ‡é—®é¢˜"><a href="#å¹¶å‘æ¼æ ‡é—®é¢˜" class="headerlink" title="å¹¶å‘æ¼æ ‡é—®é¢˜"></a>å¹¶å‘æ¼æ ‡é—®é¢˜</h4><p>æ¯”è¾ƒå…ˆè¿›çš„åƒåœ¾å›æ”¶å™¨éƒ½æ”¯æŒ<strong>å¹¶å‘</strong>æ ‡è®°ï¼Œå³åœ¨æ ‡è®°è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹ä»ç„¶èƒ½å·¥ä½œã€‚ä½†è¿™æ ·å¸¦æ¥ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼Œå¦‚æœç”¨æˆ·çº¿ç¨‹ä¿®æ”¹äº†å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±å­˜åœ¨<strong>æ¼æ ‡é—®é¢˜</strong>ã€‚</p><p><strong>ç¤ºä¾‹</strong>ï¼š</p><p>1.å¦‚å›¾æ‰€ç¤ºæ ‡è®°å·¥ä½œå°šæœªå®Œæˆ</p><img src="/img/26437/GC6.png" alt="GC6" style="zoom:67%;" /><p>2.ç”¨æˆ·çº¿ç¨‹åŒæ—¶åœ¨å·¥ä½œï¼Œæ–­å¼€äº†ç¬¬ä¸€å±‚ 3ã€4 ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´çš„å¼•ç”¨ï¼Œè¿™æ—¶å¯¹äºæ­£åœ¨å¤„ç† 3 å·å¯¹è±¡çš„åƒåœ¾å›æ”¶çº¿ç¨‹æ¥è®²ï¼Œå®ƒä¼šå°† 4 å·å¯¹è±¡å½“åšæ˜¯ç™½è‰²åƒåœ¾</p><img src="/img/26437/GC7.png" alt="GC7" style="zoom:67%;" /><p>3.ä½†å¦‚æœå…¶ä»–ç”¨æˆ·çº¿ç¨‹åˆå»ºç«‹äº† 2ã€4 ä¸¤ä¸ªå¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™æ—¶å› ä¸º 2 å·å¯¹è±¡æ˜¯é»‘è‰²å·²å¤„ç†å¯¹è±¡äº†ï¼Œå› æ­¤åƒåœ¾å›æ”¶çº¿ç¨‹ä¸ä¼šå¯Ÿè§‰åˆ°è¿™ä¸ªå¼•ç”¨å…³ç³»çš„å˜åŒ–ï¼Œä»è€Œäº§ç”Ÿäº†æ¼æ ‡</p><img src="/img/26437/GC8.png" alt="GC8" style="zoom:67%;" /><p>4.å¦‚æœç”¨æˆ·çº¿ç¨‹è®©é»‘è‰²å¯¹è±¡å¼•ç”¨äº†ä¸€ä¸ªæ–°å¢å¯¹è±¡ï¼Œä¸€æ ·ä¼šå­˜åœ¨æ¼æ ‡é—®é¢˜</p><img src="/img/26437/GC9.png" alt="GC9" style="zoom:67%;" /><p><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼š</p><p>1.Incremental Updateï¼ˆå¢é‡æ›´æ–°æ³•ï¼ŒCMS åƒåœ¾å›æ”¶å™¨é‡‡ç”¨ï¼‰</p><p>â€‹æ€è·¯æ˜¯æ‹¦æˆªæ¯æ¬¡èµ‹å€¼åŠ¨ä½œï¼Œåªè¦èµ‹å€¼å‘ç”Ÿï¼Œè¢«èµ‹å€¼çš„å¯¹è±¡å°±ä¼šè¢«è®°å½•ä¸‹æ¥ï¼Œåœ¨é‡æ–°æ ‡è®°é˜¶æ®µå†ç¡®è®¤ä¸€é</p><p>2.Snapshot At The Beginningï¼ˆSATB åŸå§‹å¿«ç…§æ³•ï¼ŒG1 åƒåœ¾å›æ”¶å™¨é‡‡ç”¨ï¼‰</p><p>â€‹æ€è·¯ä¹Ÿæ˜¯æ‹¦æˆªæ¯æ¬¡èµ‹å€¼åŠ¨ä½œï¼Œä¸è¿‡è®°å½•çš„å¯¹è±¡ä¸åŒï¼Œä¹Ÿéœ€è¦åœ¨é‡æ–°æ ‡è®°é˜¶æ®µå¯¹è¿™äº›å¯¹è±¡äºŒæ¬¡å¤„ç†</p><p>â€‹æ–°åŠ å¯¹è±¡ä¼šè¢«è®°å½•ï¼Œè¢«åˆ é™¤å¼•ç”¨å…³ç³»çš„å¯¹è±¡ä¹Ÿè¢«è®°å½•</p><h3 id="3-æ–¹æ³•åŒºå›æ”¶"><a href="#3-æ–¹æ³•åŒºå›æ”¶" class="headerlink" title="3.æ–¹æ³•åŒºå›æ”¶"></a>3.æ–¹æ³•åŒºå›æ”¶</h3><blockquote><p>æ–¹æ³•åŒºä¸»è¦å­˜æ”¾æ°¸ä¹…ä»£å¯¹è±¡ï¼Œè€Œæ°¸ä¹…ä»£å¯¹è±¡çš„å›æ”¶ç‡æ¯”æ–°ç”Ÿä»£ä½å¾ˆå¤šï¼Œå› æ­¤åœ¨æ–¹æ³•åŒºä¸Šè¿›è¡Œå›æ”¶æ€§ä»·æ¯”ä¸é«˜</p></blockquote><p>ä¸»è¦æ˜¯å¯¹å¸¸é‡æ± çš„å›æ”¶å’Œå¯¹ç±»çš„å¸è½½ã€‚</p><p>ç±»çš„å¸è½½æ¡ä»¶å¾ˆå¤šï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼ˆä¸ä¸€å®šå›æ”¶ï¼‰ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹</li><li>åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶</li><li>è¯¥ç±»å¯¹åº”çš„ Class å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œä¹Ÿå°±æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»æ–¹æ³•</li></ul><h3 id="4-finalize"><a href="#4-finalize" class="headerlink" title="4.finalize()"></a>4.finalize()</h3><blockquote><p>finalize() ç”¨æ¥åšå…³é—­å¤–éƒ¨èµ„æºç­‰å·¥ä½œã€‚è¯¥æ–¹æ³•è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œä¸ç¡®å®šæ€§å¤§ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼Œå› æ­¤æœ€å¥½ä¸è¦ä½¿ç”¨ã€‚</p></blockquote><p>å½“ä¸€ä¸ªå¯¹è±¡å¯è¢«å›æ”¶æ—¶ï¼Œå¦‚æœéœ€è¦æ‰§è¡Œè¯¥å¯¹è±¡çš„ finalize() æ–¹æ³•ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½é€šè¿‡åœ¨è¯¥æ–¹æ³•ä¸­è®©å¯¹è±¡é‡æ–°è¢«å¼•ç”¨ï¼Œä»è€Œå®ç°è‡ªæ•‘ã€‚è‡ªæ•‘åªèƒ½è¿›è¡Œä¸€æ¬¡ï¼Œå¦‚æœå›æ”¶çš„å¯¹è±¡ä¹‹å‰è°ƒç”¨äº† finalize() æ–¹æ³•è‡ªæ•‘ï¼Œåé¢å›æ”¶æ—¶ä¸ä¼šè°ƒç”¨ finalize() æ–¹æ³•ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JVMå†…å­˜ç»“æ„</title>
      <link href="/posts/27692/"/>
      <url>/posts/27692/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>JVM å†…å­˜å¸ƒå±€è§„å®šäº† Java åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å†…å­˜ç”³è¯·ã€åˆ†é…ã€ç®¡ç†çš„ç­–ç•¥ï¼Œä¿è¯äº† JVM çš„é«˜æ•ˆç¨³å®šè¿è¡Œã€‚</p></blockquote><p>æ•´ä½“å¸ƒå±€å¦‚ä¸‹æ‰€ç¤ºï¼š</p><img src="/img/27692/JVM1.png" alt="JVM1" style="zoom:67%;" /><p>JVMå†…å­˜ç»“æ„ä¸­æœ‰5ä¸ªæ¯”è¾ƒé‡è¦çš„åŒºåŸŸï¼šç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †å’Œæ–¹æ³•åŒº</p><h2 id="ğŸç¨‹åºè®¡æ•°å™¨"><a href="#ğŸç¨‹åºè®¡æ•°å™¨" class="headerlink" title="ğŸç¨‹åºè®¡æ•°å™¨"></a>ğŸç¨‹åºè®¡æ•°å™¨</h2><blockquote><p>ç¨‹åºè®¡æ•°å¯„å­˜å™¨ï¼ˆ<strong>Program Counter Register</strong>ï¼‰ï¼Œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„<strong>è¡Œå·æŒ‡ç¤ºå™¨</strong>ã€‚æ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„ã€‚</p></blockquote><p>ç¨‹åºè®¡æ•°å™¨ç”¨æ¥å­˜å‚¨æŒ‡å‘ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå³<strong>å°†è¦æ‰§è¡Œ</strong>çš„æŒ‡ä»¤ä»£ç ã€‚ç”±æ‰§è¡Œå¼•æ“è¯»å–ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</p><img src="/img/27692/JVM2.jpg" alt="JVM2" style="zoom:67%;" /><h2 id="ğŸè™šæ‹Ÿæœºæ ˆ"><a href="#ğŸè™šæ‹Ÿæœºæ ˆ" class="headerlink" title="ğŸè™šæ‹Ÿæœºæ ˆ"></a>ğŸè™šæ‹Ÿæœºæ ˆ</h2><blockquote><p>ä¸»ç®¡ Java <strong>ç¨‹åº</strong>çš„è¿è¡Œï¼Œå®ƒä¿å­˜æ–¹æ³•çš„<strong>å±€éƒ¨å˜é‡</strong>ã€<strong>éƒ¨åˆ†ç»“æœ</strong>ï¼Œå¹¶å‚ä¸æ–¹æ³•çš„è°ƒç”¨å’Œè¿”å›</p></blockquote><h3 id="1-æ¦‚è¿°"><a href="#1-æ¦‚è¿°" class="headerlink" title="1.æ¦‚è¿°"></a>1.æ¦‚è¿°</h3><h4 id="ç‰¹ç‚¹ï¼š"><a href="#ç‰¹ç‚¹ï¼š" class="headerlink" title="ç‰¹ç‚¹ï¼š"></a><strong>ç‰¹ç‚¹ï¼š</strong></h4><ul><li>JVM ç›´æ¥å¯¹è™šæ‹Ÿæœºæ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼šæ¯ä¸ªæ–¹æ³•æ‰§è¡Œï¼Œä¼´éšç€<strong>å…¥æ ˆ</strong>ï¼ˆè¿›æ ˆ&#x2F;å‹æ ˆï¼‰ï¼Œæ–¹æ³•æ‰§è¡Œç»“æŸ<strong>å‡ºæ ˆ</strong></li><li><strong>æ ˆä¸å­˜åœ¨åƒåœ¾å›æ”¶é—®é¢˜</strong></li></ul><h4 id="å¼‚å¸¸ï¼š"><a href="#å¼‚å¸¸ï¼š" class="headerlink" title="å¼‚å¸¸ï¼š"></a><strong>å¼‚å¸¸ï¼š</strong></h4><p><strong>Javaè™šæ‹Ÿæœºæ ˆçš„å¤§å°æ˜¯åŠ¨æ€çš„æˆ–è€…æ˜¯å›ºå®šä¸å˜çš„</strong></p><p>é‡‡ç”¨å›ºå®šå¤§å°çš„ Java è™šæ‹Ÿæœºæ ˆï¼Œé‚£æ¯ä¸ªçº¿ç¨‹çš„ Java è™šæ‹Ÿæœºæ ˆå®¹é‡å¯ä»¥åœ¨çº¿ç¨‹åˆ›å»ºçš„æ—¶å€™ç‹¬ç«‹é€‰å®šã€‚å¦‚æœçº¿ç¨‹è¯·æ±‚åˆ†é…çš„æ ˆå®¹é‡è¶…è¿‡ Java è™šæ‹Ÿæœºæ ˆå…è®¸çš„æœ€å¤§å®¹é‡ï¼ŒJava è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª <strong>StackOverflowError</strong> å¼‚å¸¸</p><p>é‡‡ç”¨åŠ¨æ€æ‰©å±•çš„Java è™šæ‹Ÿæœºæ ˆï¼Œå¹¶ä¸”åœ¨å°è¯•æ‰©å±•çš„æ—¶å€™æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæˆ–è€…åœ¨åˆ›å»ºæ–°çš„çº¿ç¨‹æ—¶æ²¡æœ‰è¶³å¤Ÿçš„å†…å­˜å»åˆ›å»ºå¯¹åº”çš„è™šæ‹Ÿæœºæ ˆï¼Œé‚£ Java è™šæ‹Ÿæœºå°†ä¼šæŠ›å‡ºä¸€ä¸ª<strong>OutOfMemoryError</strong>å¼‚å¸¸</p><h4 id="è°ƒä¼˜ï¼š"><a href="#è°ƒä¼˜ï¼š" class="headerlink" title="è°ƒä¼˜ï¼š"></a>è°ƒä¼˜ï¼š</h4><p>é€šè¿‡å‚æ•°<code>-Xss</code>æ¥è®¾ç½®çº¿ç¨‹çš„æœ€å¤§æ ˆç©ºé—´ï¼Œæ ˆçš„å¤§å°ç›´æ¥å†³å®šäº†å‡½æ•°è°ƒç”¨çš„æœ€å¤§å¯è¾¾æ·±åº¦</p><h3 id="2-æ ˆå¸§"><a href="#2-æ ˆå¸§" class="headerlink" title="2.æ ˆå¸§"></a>2.æ ˆå¸§</h3><blockquote><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„æ ˆï¼Œæ ˆä¸­çš„æ•°æ®éƒ½æ˜¯ä»¥<strong>æ ˆå¸§ï¼ˆStack Frameï¼‰</strong>çš„æ ¼å¼å­˜åœ¨</p></blockquote><ul><li>åœ¨è¿™ä¸ªçº¿ç¨‹ä¸Šæ­£åœ¨æ‰§è¡Œçš„æ¯ä¸ªæ–¹æ³•éƒ½å„è‡ªæœ‰å¯¹åº”çš„ä¸€ä¸ªæ ˆå¸§</li><li>æ ˆå¸§æ˜¯ä¸€ä¸ªå†…å­˜åŒºå—ï¼Œæ˜¯ä¸€ä¸ªæ•°æ®é›†ï¼Œç»´ç³»ç€æ–¹æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­çš„å„ç§æ•°æ®ä¿¡æ¯</li></ul><h3 id="3-è¿è¡ŒåŸç†"><a href="#3-è¿è¡ŒåŸç†" class="headerlink" title="3.è¿è¡ŒåŸç†"></a>3.è¿è¡ŒåŸç†</h3><p>JVM ç›´æ¥å¯¹ Java æ ˆçš„æ“ä½œåªæœ‰ä¸¤ä¸ªï¼Œå¯¹æ ˆå¸§çš„<strong>å‹æ ˆ</strong>å’Œ<strong>å‡ºæ ˆ</strong>ï¼Œéµå¾ªâ€œå…ˆè¿›åå‡ºâ€åŸåˆ™</p><p>åœ¨ä¸€æ¡æ´»åŠ¨çº¿ç¨‹ä¸­ï¼Œä¸€ä¸ªæ—¶é—´ç‚¹ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ªæ´»åŠ¨çš„æ ˆå¸§ã€‚å³åªæœ‰å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ–¹æ³•çš„æ ˆå¸§ï¼ˆ<strong>æ ˆé¡¶æ ˆå¸§</strong>ï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªæ ˆå¸§è¢«ç§°ä¸º<strong>å½“å‰æ ˆå¸§</strong>ï¼ˆCurrent Frameï¼‰ï¼Œä¸å½“å‰æ ˆå¸§å¯¹åº”çš„æ–¹æ³•å°±æ˜¯<strong>å½“å‰æ–¹æ³•</strong>ï¼ˆCurrent Methodï¼‰ï¼Œå®šä¹‰è¿™ä¸ªæ–¹æ³•çš„ç±»å°±æ˜¯<strong>å½“å‰ç±»</strong>ï¼ˆCurrent Classï¼‰</p><p>æ‰§è¡Œå¼•æ“è¿è¡Œçš„æ‰€æœ‰å­—èŠ‚ç æŒ‡ä»¤åªé’ˆå¯¹å½“å‰æ ˆå¸§è¿›è¡Œæ“ä½œ</p><p>å¦‚æœåœ¨è¯¥æ–¹æ³•ä¸­è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œå¯¹åº”çš„<strong>æ–°çš„æ ˆå¸§</strong>ä¼šè¢«åˆ›å»ºå‡ºæ¥ï¼Œæ”¾åœ¨æ ˆçš„é¡¶ç«¯ï¼Œç§°ä¸ºæ–°çš„å½“å‰æ ˆå¸§</p><p>ä¸åŒçº¿ç¨‹ä¸­æ‰€åŒ…å«çš„<strong>æ ˆå¸§æ˜¯ä¸å…è®¸å­˜åœ¨ç›¸äº’å¼•ç”¨</strong>çš„ï¼Œå³ä¸å¯èƒ½åœ¨ä¸€ä¸ªæ ˆå¸§ä¸­å¼•ç”¨å¦å¤–ä¸€ä¸ªçº¿ç¨‹çš„æ ˆå¸§</p><p>å¦‚æœå½“å‰æ–¹æ³•è°ƒç”¨äº†å…¶ä»–æ–¹æ³•ï¼Œæ–¹æ³•è¿”å›ä¹‹é™…ï¼Œå½“å‰æ ˆå¸§ä¼šä¼ å›æ­¤æ–¹æ³•çš„æ‰§è¡Œç»“æœç»™å‰ä¸€ä¸ªæ ˆå¸§ï¼Œæ¥ç€ï¼Œè™šæ‹Ÿæœºä¼šä¸¢å¼ƒå½“å‰æ ˆå¸§ï¼Œä½¿å¾—å‰ä¸€ä¸ªæ ˆå¸§é‡æ–°æˆä¸ºå½“å‰æ ˆå¸§</p><p>Java æ–¹æ³•æœ‰ä¸¤ç§è¿”å›å‡½æ•°çš„æ–¹å¼ï¼Œä¸€ç§æ˜¯æ­£å¸¸çš„å‡½æ•°è¿”å›ï¼Œä½¿ç”¨ return æŒ‡ä»¤ï¼Œå¦ä¸€ç§æ˜¯æŠ›å‡ºå¼‚å¸¸ï¼Œä¸ç®¡ç”¨å“ªç§æ–¹å¼ï¼Œéƒ½ä¼šå¯¼è‡´æ ˆå¸§è¢«å¼¹å‡º</p><img src="/img/27692/JVM3.jpg" alt="JVM3" style="zoom:67%;" /><h3 id="4-æ ˆå¸§å†…éƒ¨ç»“æ„"><a href="#4-æ ˆå¸§å†…éƒ¨ç»“æ„" class="headerlink" title="4.æ ˆå¸§å†…éƒ¨ç»“æ„"></a>4.æ ˆå¸§å†…éƒ¨ç»“æ„</h3><p><strong>æ ˆå¸§</strong>ï¼ˆStack Frameï¼‰ä¸­å­˜å‚¨ç€å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰ã€æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰(æˆ–è¡¨è¾¾å¼æ ˆ)ã€åŠ¨æ€é“¾æ¥ï¼ˆDynamic Linkingï¼‰ã€æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ã€é™„åŠ ä¿¡æ¯ã€‚</p><img src="/img/27692/JVM4.jpg" alt="JVM4" style="zoom:67%;" /><h4 id="å±€éƒ¨å˜é‡è¡¨"><a href="#å±€éƒ¨å˜é‡è¡¨" class="headerlink" title="å±€éƒ¨å˜é‡è¡¨"></a>å±€éƒ¨å˜é‡è¡¨</h4><p>ä¸»è¦ç”¨äºå­˜å‚¨æ–¹æ³•å‚æ•°å’Œå®šä¹‰åœ¨æ–¹æ³•ä½“å†…çš„å±€éƒ¨å˜é‡</p><h4 id="æ“ä½œæ•°æ ˆ"><a href="#æ“ä½œæ•°æ ˆ" class="headerlink" title="æ“ä½œæ•°æ ˆ"></a>æ“ä½œæ•°æ ˆ</h4><p>ä¸»è¦ç”¨äºä¿å­˜è®¡ç®—è¿‡ç¨‹çš„ä¸­é—´ç»“æœï¼ŒåŒæ—¶ä½œä¸ºè®¡ç®—è¿‡ç¨‹ä¸­å˜é‡ä¸´æ—¶çš„å­˜å‚¨ç©ºé—´</p><h4 id="åŠ¨æ€é“¾æ¥"><a href="#åŠ¨æ€é“¾æ¥" class="headerlink" title="åŠ¨æ€é“¾æ¥"></a>åŠ¨æ€é“¾æ¥</h4><p>æŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„æ–¹æ³•å¼•ç”¨</p><h4 id="æ–¹æ³•è¿”å›åœ°å€"><a href="#æ–¹æ³•è¿”å›åœ°å€" class="headerlink" title="æ–¹æ³•è¿”å›åœ°å€"></a>æ–¹æ³•è¿”å›åœ°å€</h4><p>ç”¨æ¥å­˜æ”¾è°ƒç”¨è¯¥æ–¹æ³•çš„ PC å¯„å­˜å™¨çš„å€¼ã€‚</p><p>ä¸€ä¸ªæ–¹æ³•çš„ç»“æŸï¼Œæœ‰ä¸¤ç§æ–¹å¼ï¼š</p><ul><li>æ­£å¸¸æ‰§è¡Œå®Œæˆ</li><li>å‡ºç°æœªå¤„ç†çš„å¼‚å¸¸ï¼Œéæ­£å¸¸é€€å‡º</li></ul><h2 id="ğŸæœ¬åœ°æ–¹æ³•æ ˆ"><a href="#ğŸæœ¬åœ°æ–¹æ³•æ ˆ" class="headerlink" title="ğŸæœ¬åœ°æ–¹æ³•æ ˆ"></a>ğŸæœ¬åœ°æ–¹æ³•æ ˆ</h2><h3 id="1-æœ¬åœ°æ–¹æ³•"><a href="#1-æœ¬åœ°æ–¹æ³•" class="headerlink" title="1.æœ¬åœ°æ–¹æ³•"></a>1.æœ¬åœ°æ–¹æ³•</h3><blockquote><p>ä¸€ä¸ª Native Method å°±æ˜¯ä¸€ä¸ª Java è°ƒç”¨é Java ä»£ç çš„æ¥å£</p></blockquote><p>æ¯”å¦‚Javaåº”ç”¨ä¸Javaç¯å¢ƒå¤–äº¤äº’ã€ä¸æ“ä½œç³»ç»Ÿäº¤äº’</p><h3 id="2-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰"><a href="#2-æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative-Method-Stackï¼‰" class="headerlink" title="2.æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰"></a>2.æœ¬åœ°æ–¹æ³•æ ˆï¼ˆNative Method Stackï¼‰</h3><blockquote><p>Java è™šæ‹Ÿæœºæ ˆç”¨äºç®¡ç† Java æ–¹æ³•çš„è°ƒç”¨ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆç”¨äºç®¡ç†<strong>æœ¬åœ°æ–¹æ³•</strong>çš„è°ƒç”¨ï¼Œä¹Ÿæ˜¯<strong>çº¿ç¨‹ç§æœ‰</strong>çš„</p></blockquote><h2 id="ğŸå †"><a href="#ğŸå †" class="headerlink" title="ğŸå †"></a>ğŸå †</h2><blockquote><p><strong>æ ˆæ˜¯è¿è¡Œæ—¶çš„å•ä½ï¼Œè€Œå †æ˜¯å­˜å‚¨çš„å•ä½</strong>ã€‚</p><p>æ ˆè§£å†³ç¨‹åºçš„è¿è¡Œé—®é¢˜ï¼Œå³ç¨‹åºå¦‚ä½•æ‰§è¡Œï¼Œæˆ–è€…è¯´å¦‚ä½•å¤„ç†æ•°æ®ã€‚å †è§£å†³çš„æ˜¯æ•°æ®å­˜å‚¨çš„é—®é¢˜ï¼Œå³æ•°æ®æ€ä¹ˆæ”¾ã€æ”¾åœ¨å“ªã€‚</p></blockquote><h3 id="1-å†…å­˜åˆ’åˆ†"><a href="#1-å†…å­˜åˆ’åˆ†" class="headerlink" title="1.å†…å­˜åˆ’åˆ†"></a>1.å†…å­˜åˆ’åˆ†</h3><blockquote><p>Java å †æ˜¯ Java è™šæ‹Ÿæœºç®¡ç†çš„å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚æ­¤å†…å­˜åŒºåŸŸçš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹ä»¥åŠæ•°æ®éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜</p></blockquote><h4 id="å¹´è½»ä»£-Young-Generation"><a href="#å¹´è½»ä»£-Young-Generation" class="headerlink" title="å¹´è½»ä»£ (Young Generation)"></a><strong>å¹´è½»ä»£ (Young Generation)</strong></h4><p>å¹´è½»ä»£æ˜¯æ‰€æœ‰æ–°å¯¹è±¡åˆ›å»ºçš„åœ°æ–¹ã€‚å½“å¡«å……å¹´è½»ä»£æ—¶ï¼Œæ‰§è¡Œåƒåœ¾æ”¶é›†ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç§°ä¸º <strong>Minor GC</strong>ã€‚å¹´è½»ä¸€ä»£è¢«åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†â€”â€”ä¼Šç”¸å›­ï¼ˆ<strong>Eden Memory</strong>ï¼‰å’Œä¸¤ä¸ªå¹¸å­˜åŒºï¼ˆ<strong>Survivor Memory</strong>ï¼Œè¢«ç§°ä¸ºfrom&#x2F;toæˆ–s0&#x2F;s1ï¼‰ï¼Œé»˜è®¤æ¯”ä¾‹æ˜¯<code>8:1:1</code></p><ul><li>å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡éƒ½ä½äº Eden å†…å­˜ç©ºé—´ä¸­</li><li>å½“ Eden ç©ºé—´è¢«å¯¹è±¡å¡«å……æ—¶ï¼Œæ‰§è¡Œ<strong>Minor GC</strong>ï¼Œå¹¶å°†æ‰€æœ‰å¹¸å­˜è€…å¯¹è±¡ç§»åŠ¨åˆ°ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ä¸­</li><li>Minor GC æ£€æŸ¥å¹¸å­˜è€…å¯¹è±¡ï¼Œå¹¶å°†å®ƒä»¬ç§»åŠ¨åˆ°å¦ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´ã€‚æ‰€ä»¥æ¯æ¬¡ï¼Œ<strong>ä¸€ä¸ªå¹¸å­˜è€…ç©ºé—´æ€»æ˜¯ç©ºçš„</strong></li><li>ç»è¿‡å¤šæ¬¡ GC å¾ªç¯åå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡è¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚é€šå¸¸ï¼Œè¿™æ˜¯é€šè¿‡è®¾ç½®å¹´è½»ä¸€ä»£å¯¹è±¡çš„å¹´é¾„é˜ˆå€¼æ¥å®ç°çš„ï¼Œç„¶åä»–ä»¬æ‰æœ‰èµ„æ ¼æå‡åˆ°è€ä¸€ä»£</li></ul><h4 id="è€å¹´ä»£-Old-Generation"><a href="#è€å¹´ä»£-Old-Generation" class="headerlink" title="è€å¹´ä»£(Old Generation)"></a><strong>è€å¹´ä»£(Old Generation)</strong></h4><p>æ—§çš„ä¸€ä»£å†…å­˜åŒ…å«é‚£äº›ç»è¿‡è®¸å¤šè½®å°å‹ GC åä»ç„¶å­˜æ´»çš„å¯¹è±¡ã€‚é€šå¸¸ï¼Œåƒåœ¾æ”¶é›†æ˜¯åœ¨è€å¹´ä»£å†…å­˜æ»¡æ—¶æ‰§è¡Œçš„ã€‚è€å¹´ä»£åƒåœ¾æ”¶é›†ç§°ä¸ºä¸»GCï¼ˆ<strong>Major GC</strong>ï¼‰ï¼Œé€šå¸¸éœ€è¦æ›´é•¿çš„æ—¶é—´ã€‚</p><p><strong>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£</strong>ï¼ˆå¤§å¯¹è±¡æ˜¯æŒ‡éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼‰ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯é¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ªSurvivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´</p><h3 id="2-å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ"></a>2.å¯¹è±¡åœ¨å †ä¸­çš„ç”Ÿå‘½å‘¨æœŸ</h3><p>åœ¨ JVM å†…å­˜æ¨¡å‹çš„å †ä¸­ï¼Œå †è¢«åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ </p><ul><li>æ–°ç”Ÿä»£åˆè¢«è¿›ä¸€æ­¥åˆ’åˆ†ä¸º <strong>EdenåŒº</strong> å’Œ <strong>SurvivoråŒº</strong>ï¼ŒSurvivor åŒºç”± <strong>From Survivor</strong> å’Œ <strong>To Survivor</strong> ç»„æˆ</li></ul><p>å½“åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯¹è±¡ä¼šè¢«ä¼˜å…ˆåˆ†é…åˆ°æ–°ç”Ÿä»£çš„ Eden åŒº </p><ul><li>æ­¤æ—¶ JVM ä¼šç»™å¯¹è±¡å®šä¹‰ä¸€ä¸ª<strong>å¯¹è±¡å¹´è½»è®¡æ•°å™¨</strong>ï¼ˆ<code>-XX:MaxTenuringThreshold</code>ï¼‰</li></ul><p>å½“ Eden ç©ºé—´ä¸è¶³æ—¶ï¼ŒJVM å°†æ‰§è¡Œæ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ </p><ul><li>JVM ä¼šæŠŠå­˜æ´»çš„å¯¹è±¡è½¬ç§»åˆ° Survivor ä¸­ï¼Œå¹¶ä¸”å¯¹è±¡å¹´é¾„ +1</li><li>å¯¹è±¡åœ¨ Survivor ä¸­åŒæ ·ä¹Ÿä¼šç»å† Minor GCï¼Œæ¯ç»å†ä¸€æ¬¡ Minor GCï¼Œå¯¹è±¡å¹´é¾„éƒ½ä¼š+1</li></ul><p>å¦‚æœåˆ†é…çš„å¯¹è±¡è¶…è¿‡äº†<code>-XX:PetenureSizeThreshold</code>ï¼Œå¯¹è±¡ä¼šç›´æ¥è¢«åˆ†é…åˆ°è€å¹´ä»£</p><h3 id="3-å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"><a href="#3-å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹" class="headerlink" title="3.å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹"></a>3.å¯¹è±¡çš„åˆ†é…è¿‡ç¨‹</h3><ol><li>new çš„å¯¹è±¡(å¹´è½»ä»£)å…ˆæ”¾åœ¨ä¼Šç”¸å›­åŒºï¼Œæ­¤åŒºæœ‰å¤§å°é™åˆ¶</li><li>å½“ä¼Šç”¸å›­çš„ç©ºé—´<strong>å¡«æ»¡</strong>æ—¶ï¼Œç¨‹åºåˆéœ€è¦åˆ›å»ºå¯¹è±¡ï¼ŒJVM çš„åƒåœ¾å›æ”¶å™¨å°†å¯¹ä¼Šç”¸å›­åŒºè¿›è¡Œåƒåœ¾å›æ”¶ï¼ˆMinor GCï¼‰ï¼Œå°†ä¼Šç”¸å›­åŒºä¸­çš„<strong>ä¸å†è¢«å…¶ä»–å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡</strong>è¿›è¡Œé”€æ¯ã€‚å†åŠ è½½æ–°çš„å¯¹è±¡æ”¾åˆ°ä¼Šç”¸å›­åŒº</li><li>ç„¶åå°†ä¼Šç”¸å›­ä¸­çš„å‰©ä½™å¯¹è±¡ç§»åŠ¨åˆ°å¹¸å­˜è€… 0 åŒº</li><li>å¦‚æœå†æ¬¡è§¦å‘åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¸Šæ¬¡å¹¸å­˜ä¸‹æ¥çš„æ”¾åˆ°å¹¸å­˜è€… 0 åŒºï¼Œå¦‚æœæ²¡æœ‰å›æ”¶ï¼Œå°±ä¼šæ”¾åˆ°å¹¸å­˜è€… 1 åŒº</li><li>å¦‚æœå†æ¬¡ç»å†åƒåœ¾å›æ”¶ï¼Œæ­¤æ—¶ä¼šé‡æ–°æ”¾å›å¹¸å­˜è€… 0 åŒºï¼Œæ¥ç€å†å»å¹¸å­˜è€… 1 åŒº</li><li>é»˜è®¤ <strong>15</strong> æ¬¡å›æ”¶æ ‡è®°æ‰ä¼šå»è€å¹´ä»£</li><li>å½“è€å¹´ä»£å†…å­˜ä¸è¶³æ—¶ï¼Œå†æ¬¡è§¦å‘ Major GCï¼Œè¿›è¡Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†</li><li>è‹¥è€å¹´ä»£æ‰§è¡Œäº† Major GC ä¹‹åå‘ç°ä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM å¼‚å¸¸</li></ol><h2 id="ğŸæ–¹æ³•åŒº"><a href="#ğŸæ–¹æ³•åŒº" class="headerlink" title="ğŸæ–¹æ³•åŒº"></a>ğŸæ–¹æ³•åŒº</h2><blockquote><p>æ–¹æ³•åŒºç”¨äºå­˜å‚¨<strong>ç±»</strong>ä¿¡æ¯ã€<strong>å¸¸é‡æ± </strong>ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜ç­‰</p></blockquote><h3 id="1-æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´"><a href="#1-æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´" class="headerlink" title="1.æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´"></a>1.æ°¸ä¹…ä»£å’Œå…ƒç©ºé—´</h3><p><strong>æ°¸ä¹…ä»£</strong>ï¼ˆPermGenï¼‰æ˜¯ Hotspot è™šæ‹Ÿæœºç‰¹æœ‰çš„æ¦‚å¿µï¼Œ Java8 çš„æ—¶å€™åˆè¢«<strong>å…ƒç©ºé—´</strong>å–ä»£äº†ï¼Œæ°¸ä¹…ä»£å’Œå…ƒç©ºé—´éƒ½å¯ä»¥ç†è§£ä¸ºæ–¹æ³•åŒºçš„<strong>è½åœ°å®ç°</strong></p><ul><li>æ°¸ä¹…ä»£æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å®ç°ï¼ˆ1.8 ä¹‹å‰ï¼‰</li><li>å…ƒç©ºé—´æ˜¯ Hotspot è™šæ‹Ÿæœºå¯¹ JVM è§„èŒƒçš„å¦ä¸€ç§å®ç°ï¼ˆ1.8 ä»¥åï¼‰ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜ä½œä¸ºè¿™äº›ä¿¡æ¯çš„å­˜å‚¨ç©ºé—´</li></ul><h3 id="2-æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’"><a href="#2-æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’" class="headerlink" title="2.æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’"></a>2.æ ˆã€å †ã€æ–¹æ³•åŒºäº¤äº’</h3><img src="/img/27692/JVM5.png" alt="JVM5" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> JVM </category>
          
      </categories>
      
      
        <tags>
            
            <tag> JVM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springäº‹åŠ¡å¤±æ•ˆ</title>
      <link href="/posts/6750/"/>
      <url>/posts/6750/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°"><a href="#ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°" class="headerlink" title="ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°"></a>ğŸSpringäº‹åŠ¡å¤±æ•ˆæ¦‚è¿°</h2><p>åœ¨Springä¸­è¦å¼€å¯äº‹åŠ¡ç®¡ç†ï¼Œä¸€èˆ¬åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨<code>@EnableTransactionManagement</code>æ³¨è§£ï¼Œåœ¨éœ€è¦äº‹åŠ¡ç®¡ç†çš„æ–¹æ³•ä¸ŠåŠ <code>@Transactional</code>æ³¨è§£ï¼Œä½†æœ‰æ—¶æ³¨è§£ä¹Ÿä¼šå¤±æ•ˆã€‚ä»¥ä¸‹å°±æ˜¯å¸¸è§çš„Springäº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯</p><p>å‰ç½®è¯´æ˜ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‰ç½®é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;classpath:jdbc.properties&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;day04.tx.app.service&quot;)</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;day04.tx.app.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ConfigurationProperties(&quot;jdbc&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSource <span class="title function_">dataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DataSourceInitializer <span class="title function_">dataSourceInitializer</span><span class="params">(DataSource dataSource, DatabasePopulator populator)</span> &#123;</span><br><span class="line">        <span class="type">DataSourceInitializer</span> <span class="variable">dataSourceInitializer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DataSourceInitializer</span>();</span><br><span class="line">        dataSourceInitializer.setDataSource(dataSource);</span><br><span class="line">        dataSourceInitializer.setDatabasePopulator(populator);</span><br><span class="line">        <span class="keyword">return</span> dataSourceInitializer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> DatabasePopulator <span class="title function_">databasePopulator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ResourceDatabasePopulator</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;account.sql&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> SqlSessionFactoryBean <span class="title function_">sqlSessionFactory</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="type">SqlSessionFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SqlSessionFactoryBean</span>();</span><br><span class="line">        factoryBean.setDataSource(dataSource);</span><br><span class="line">        <span class="keyword">return</span> factoryBean;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> PlatformTransactionManager <span class="title function_">transactionManager</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">DataSourceTransactionManager</span>(dataSource);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// @Bean</span></span><br><span class="line">    <span class="comment">// //åªè¦ beanFactory çš„ allowBeanDefinitionOverriding==true, å³ä½¿ç³»ç»Ÿçš„ @Bean å®šä¹‰æ²¡æœ‰ @ConditionalOnMissingBean æ¡ä»¶ï¼Œä¹Ÿä¼šè¢«æˆ‘ä»¬çš„åŒå @Bean è¦†ç›–æ‰</span></span><br><span class="line">    <span class="comment">// public TransactionAttributeSource transactionAttributeSource() &#123;</span></span><br><span class="line">    <span class="comment">//     return new AnnotationTransactionAttributeSource(false);</span></span><br><span class="line">    <span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(AppConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Service1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service1.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ1-æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸"><a href="#ğŸ1-æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸" class="headerlink" title="ğŸ1.æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸"></a>ğŸ1.æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span> <span class="comment">// è§£æ³•ï¼šåŠ å…¥rollbackForé…ç½®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>); <span class="comment">//è¯»å–æ–‡ä»¶å¼‚å¸¸</span></span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šSpring é»˜è®¤åªä¼š<strong>å›æ»šéæ£€æŸ¥å¼‚å¸¸</strong><br>è§£æ³•ï¼šé…ç½® rollbackFor å±æ€§<br>    @Transactional(rollbackFor &#x3D; Exception.class)</p><h2 id="ğŸ2-ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸"><a href="#ğŸ2-ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸" class="headerlink" title="ğŸ2.ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸"></a>ğŸ2.ä¸šåŠ¡æ–¹æ³•å†…è‡ªå·±å¤„ç†ï¼ˆtry-catchï¼‰å¼‚å¸¸</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ–¹æ³•è‡ªå·±å¤„ç†å¼‚å¸¸</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service2</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span>  &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">            <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">                accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">                accountMapper.update(to, amount);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (FileNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="comment">// throw new RuntimeException(e); // è§£æ³•ä¸€</span></span><br><span class="line">            <span class="comment">// TransactionInterceptor.currentTransactionStatus().setRollbackOnly(); //è§£æ³•äºŒ</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šäº‹åŠ¡é€šçŸ¥åªæœ‰æ‰åˆ°äº†ç›®æ ‡æŠ›å‡ºçš„å¼‚å¸¸ï¼Œæ‰èƒ½è¿›è¡Œåç»­çš„å›æ»šå¤„ç†ï¼Œå¦‚æœç›®æ ‡<strong>è‡ªå·±å¤„ç†æ‰å¼‚å¸¸ï¼Œäº‹åŠ¡é€šçŸ¥æ— æ³•çŸ¥æ‚‰</strong><br>è§£æ³•1ï¼šå¼‚å¸¸åŸæ ·æŠ›å‡º<br>    åœ¨ catch å—æ·»åŠ  throw new RuntimeException(e);<br>è§£æ³•2ï¼šæ‰‹åŠ¨è®¾ç½® TransactionStatus.setRollbackOnly()<br>    åœ¨ catch å—æ·»åŠ  TransactionInterceptor.currentTransactionStatus().setRollbackOnly();</p><h2 id="ğŸ3-AOPåˆ‡é¢é¡ºåº"><a href="#ğŸ3-AOPåˆ‡é¢é¡ºåº" class="headerlink" title="ğŸ3.AOPåˆ‡é¢é¡ºåº"></a>ğŸ3.AOPåˆ‡é¢é¡ºåº</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»å‡½æ•°+åˆ‡é¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService3</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(MyAspect.class);</span><br><span class="line">        context.registerBean(AppConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Service3</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service3.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Aspect</span></span><br><span class="line">    <span class="meta">@Order(Ordered.LOWEST_PRECEDENCE - 1)</span> <span class="comment">// è§£æ³•ä¸‰ï¼šè°ƒæ•´åˆ‡é¢é¡ºåº</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyAspect</span> &#123;</span><br><span class="line">        <span class="meta">@Around(&quot;execution(* transfer(..))&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;log:&#123;&#125;&quot;</span>, pjp.getTarget());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> pjp.proceed();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸šåŠ¡æ–¹æ³•</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service3</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;aaa&quot;</span>);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šäº‹åŠ¡åˆ‡é¢ä¼˜å…ˆçº§æœ€ä½ï¼Œä½†å¦‚æœè‡ªå®šä¹‰çš„åˆ‡é¢ä¼˜å…ˆçº§å’Œå…¶ä¸€æ ·ï¼Œåˆ™è¿˜æ˜¯è‡ªå®šä¹‰åˆ‡é¢åœ¨å†…å±‚ï¼Œè¿™æ—¶è‹¥è‡ªå®šä¹‰åˆ‡é¢æ²¡æœ‰æ­£ç¡®æŠ›å‡ºå¼‚å¸¸ï¼ˆå¼‚å¸¸å‘ä¸ŠæŠ›å‡ºï¼Œäº‹åŠ¡éœ€è¦æ•è·ï¼‰<br>è§£æ³•1ã€2ï¼šåŒæƒ…å†µ2 ä¸­çš„è§£æ³•:1ã€2<br>è§£æ³•3ï¼š</p><p>â€‹è°ƒæ•´åˆ‡é¢é¡ºåºï¼Œåœ¨ MyAspect ä¸Šæ·»åŠ  @Order(Ordered.LOWEST_PRECEDENCE - 1) ï¼ˆä¸æ¨èï¼‰</p><h2 id="ğŸ4-é-public-æ–¹æ³•"><a href="#ğŸ4-é-public-æ–¹æ³•" class="headerlink" title="ğŸ4.é public æ–¹æ³•"></a>ğŸ4.é public æ–¹æ³•</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service4</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="comment">// æ¼”ç¤ºï¼šè¿™é‡Œépublicæ–¹æ³•</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼šSpring ä¸ºæ–¹æ³•åˆ›å»ºä»£ç†ã€æ·»åŠ äº‹åŠ¡é€šçŸ¥ã€å‰ææ¡ä»¶éƒ½æ˜¯<strong>è¯¥æ–¹æ³•æ˜¯ public</strong> çš„<br>è§£æ³•1ï¼šæ”¹ä¸º public æ–¹æ³•<br>è§£æ³•2ï¼šæ·»åŠ  bean é…ç½®åˆ°é…ç½®ç±»å¦‚ä¸‹ï¼ˆä¸æ¨èï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ·»åŠ é…ç½®ç±»</span></span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> TransactionAttributeSource <span class="title function_">transactionAttributeSource</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">AnnotationTransactionAttributeSource</span>(<span class="literal">false</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ5-çˆ¶å­å®¹å™¨å¯¼è‡´"><a href="#ğŸ5-çˆ¶å­å®¹å™¨å¯¼è‡´" class="headerlink" title="ğŸ5.çˆ¶å­å®¹å™¨å¯¼è‡´"></a>ğŸ5.çˆ¶å­å®¹å™¨å¯¼è‡´</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Serviceç±»</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service5</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Controllerç±»</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AccountController</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> Service5 service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        service.transfer(from, to, amount);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°-çˆ¶å­å®¹å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestService5</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">parent</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(parent.getDefaultListableBeanFactory());</span><br><span class="line">        ConfigurationPropertiesBindingPostProcessor.register(parent.getDefaultListableBeanFactory());</span><br><span class="line">        parent.registerBean(AppConfig.class);</span><br><span class="line">        parent.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">child</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(child.getDefaultListableBeanFactory());</span><br><span class="line">        child.setParent(parent);</span><br><span class="line">        child.registerBean(WebConfig.class);</span><br><span class="line">        child.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">AccountController</span> <span class="variable">bean</span> <span class="operator">=</span> child.getBean(AccountController.class);</span><br><span class="line">        bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// Webé…ç½®ç±»</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;day04.tx.app.controller&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨é…ç½®äº†çˆ¶å­å®¹å™¨ï¼ŒWebConfig å¯¹åº”å­å®¹å™¨ï¼ŒAppConfig å¯¹åº”çˆ¶å®¹å™¨ï¼Œå‘ç°äº‹åŠ¡å¤±æ•ˆ</p><p>åŸå› ï¼šå­å®¹å™¨æ‰«æèŒƒå›´è¿‡å¤§ï¼ŒæŠŠæœªåŠ äº‹åŠ¡é…ç½®çš„ service æ‰«æè¿›æ¥<br>è§£æ³•1ï¼šå„æ‰«æå„çš„<br>è§£æ³•2ï¼šä¸è¦ç”¨çˆ¶å­å®¹å™¨ï¼Œæ‰€æœ‰ bean æ”¾åœ¨åŒä¸€å®¹å™¨ï¼ˆæ¯”è¾ƒä¼ ç»Ÿçš„åšæ³•ï¼‰</p><h2 id="ğŸ6-è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"><a href="#ğŸ6-è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ" class="headerlink" title="ğŸ6.è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ"></a>ğŸ6.è°ƒç”¨æœ¬ç±»æ–¹æ³•å¯¼è‡´ä¼ æ’­è¡Œä¸ºå¤±æ•ˆ</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        bar(); <span class="comment">// è°ƒç”¨æœ¬ç±»æ–¹æ³•</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸå› ï¼š<strong>æœ¬ç±»æ–¹æ³•è°ƒç”¨ä¸ç»è¿‡ä»£ç†</strong>ï¼Œå› æ­¤æ— æ³•å¢å¼º<br>è§£æ³•1ï¼šä¾èµ–æ³¨å…¥è‡ªå·±ï¼ˆä»£ç†ï¼‰æ¥è°ƒç”¨<br>è§£æ³•2ï¼šé€šè¿‡ AopContext æ‹¿åˆ°ä»£ç†å¯¹è±¡ï¼Œæ¥è°ƒç”¨<br>è§£æ³•3ï¼šé€šè¿‡ CTWï¼ŒLTW å®ç°åŠŸèƒ½å¢å¼º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Service6 proxy; <span class="comment">// è§£æ³•1ï¼šæœ¬è´¨ä¸Šæ˜¯ä¸€ç§å¾ªç¯ä¾èµ–</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">System.out.println(proxy.getClass());</span><br><span class="line">proxy.bar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦åœ¨ AppConfig ä¸Šæ·»åŠ  @EnableAspectJAutoProxy(exposeProxy = true)</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service6</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRED, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        ((Service6) AopContext.currentProxy()).bar(); <span class="comment">// è§£æ³•2</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW, rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">bar</span><span class="params">()</span> <span class="keyword">throws</span> FileNotFoundException &#123;</span><br><span class="line">        LoggerUtils.get().debug(<span class="string">&quot;bar&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ7-Transactional-æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º"><a href="#ğŸ7-Transactional-æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º" class="headerlink" title="ğŸ7.@Transactional æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º"></a>ğŸ7.@Transactional æ²¡æœ‰ä¿è¯åŸå­è¡Œä¸º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service7</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Service7.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        logger.debug(<span class="string">&quot;æ›´æ–°å‰æŸ¥è¯¢ä½™é¢ä¸º: &#123;&#125;&quot;</span>, fromBalance);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBalance</span><span class="params">(<span class="type">int</span> accountNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountMapper.findBalanceBy(accountNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šä»£ç é—®é¢˜ï¼šå‡è®¾ from ä½™é¢ä¸º 1000ï¼Œä¸¤ä¸ªçº¿ç¨‹éƒ½æ¥è½¬è´¦ 1000ï¼Œå¯èƒ½ä¼šå‡ºç°æ‰£å‡ä¸º<strong>è´Ÿæ•°</strong>çš„æƒ…å†µ</p><p>åŸå› ï¼šäº‹åŠ¡çš„åŸå­æ€§ä»…æ¶µç›– insertã€updateã€deleteã€select â€¦ for update è¯­å¥ï¼Œ<strong>select æ–¹æ³•</strong>å¹¶ä¸é˜»å¡</p><img src="/img/6750/transactional1.png" alt="transactional1" style="zoom:67%;" /><p>å¦‚ä¸Šï¼šçº¢è‰²çº¿ç¨‹å’Œè“è‰²çº¿ç¨‹çš„æŸ¥è¯¢éƒ½å‘ç”Ÿåœ¨æ‰£å‡ä¹‹å‰ï¼Œéƒ½ä»¥ä¸ºè‡ªå·±æœ‰è¶³å¤Ÿçš„ä½™é¢åšæ‰£å‡</p><p>ä¸€ç§è§£æ³•ï¼ˆæ— æ•ˆï¼‰ï¼šå°è¯•åŠ synchronizedé”</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Service7</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> LoggerFactory.getLogger(Service7.class);</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> AccountMapper accountMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">transfer</span><span class="params">(<span class="type">int</span> from, <span class="type">int</span> to, <span class="type">int</span> amount)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">fromBalance</span> <span class="operator">=</span> accountMapper.findBalanceBy(from);</span><br><span class="line">        logger.debug(<span class="string">&quot;æ›´æ–°å‰æŸ¥è¯¢ä½™é¢ä¸º: &#123;&#125;&quot;</span>, fromBalance);</span><br><span class="line">        <span class="keyword">if</span> (fromBalance - amount &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            accountMapper.update(from, -<span class="number">1</span> * amount);</span><br><span class="line">            accountMapper.update(to, amount);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBalance</span><span class="params">(<span class="type">int</span> accountNo)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> accountMapper.findBalanceBy(accountNo);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ— æ•ˆåŸå› ï¼šsynchronized ä¿è¯çš„ä»…æ˜¯<strong>ç›®æ ‡æ–¹æ³•çš„åŸå­æ€§</strong>ï¼Œç¯ç»•ç›®æ ‡æ–¹æ³•çš„è¿˜æœ‰ <strong>commit</strong> ç­‰æ“ä½œï¼Œå®ƒä»¬å¹¶æœªå¤„äº sync å—å†…</p><img src="/img/6750/transactional2.png" alt="transactional2" style="zoom:67%;" /><p>å¦‚ä¸Šå›¾ï¼šè“è‰²çº¿ç¨‹çš„æŸ¥è¯¢åªè¦åœ¨çº¢è‰²çº¿ç¨‹æäº¤ä¹‹å‰æ‰§è¡Œï¼Œé‚£ä¹ˆä¾ç„¶ä¼šæŸ¥è¯¢åˆ°æœ‰ 1000 è¶³å¤Ÿä½™é¢æ¥è½¬è´¦</p><hr><p>è§£æ³•1ï¼šsynchronized èŒƒå›´æ‰©å¤§è‡³ä»£ç†æ–¹æ³•è°ƒç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">    AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">    ConfigurationPropertiesBindingPostProcessor.register(context.getDefaultListableBeanFactory());</span><br><span class="line">    context.registerBean(AppConfig.class);</span><br><span class="line">    context.refresh();</span><br><span class="line"></span><br><span class="line">    <span class="type">Service7</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Service7.class);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyThread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123; <span class="comment">//synchronized èŒƒå›´æ‰©å¤§</span></span><br><span class="line">            bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;, <span class="string">&quot;t1&quot;</span>, <span class="string">&quot;boldMagenta&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">MyThread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            bean.transfer(<span class="number">1</span>, <span class="number">2</span>, <span class="number">1000</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;, <span class="string">&quot;t2&quot;</span>, <span class="string">&quot;boldBlue&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    latch.await();</span><br><span class="line">    System.out.println(bean.findBalance(<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æ³•2ï¼šä½¿ç”¨ select â€¦ for update æ›¿æ¢ selectï¼ˆæ•°æ®åº“å±‚é¢ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select balance from account where accountNo=#&#123;accountNo&#125; for update&quot;)</span> <span class="comment">// æ›¿æ¢</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">findBalanceBy</span><span class="params">(<span class="type">int</span> accountNo)</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springè®¾è®¡æ¨¡å¼</title>
      <link href="/posts/52990/"/>
      <url>/posts/52990/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSingleton"><a href="#ğŸSingleton" class="headerlink" title="ğŸSingleton"></a>ğŸSingleton</h2><blockquote><p><em>Ensure a class only has one instance, and provide a global point of access to it</em></p></blockquote><p>Spring ä¸­çš„ singleton bean å¹¶éå®ç°äº†å•ä¾‹æ¨¡å¼ï¼Œsingleton bean åªèƒ½ä¿è¯<strong>æ¯ä¸ªå®¹å™¨å†…ï¼Œç›¸åŒ id çš„ bean å•å®ä¾‹</strong></p><p>Springä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.transaction.TransactionDefinition#withDefaults</li><li>org.springframework.aop.TruePointcut#INSTANCE</li><li>org.springframework.aop.interceptor.ExposeInvocationInterceptor#ADVISOR</li><li>org.springframework.core.annotation.AnnotationAwareOrderComparator#INSTANCE</li><li>org.springframework.core.OrderComparator#INSTANCE</li></ul><h2 id="ğŸBuilder"><a href="#ğŸBuilder" class="headerlink" title="ğŸBuilder"></a>ğŸBuilder</h2><blockquote><p><em>Separate the construction of a complex object from its representation so that the same construction process can create different representations</em></p></blockquote><p>ä¸»è¦äº®ç‚¹æœ‰ä¸‰å¤„ï¼š</p><ul><li>è¾ƒä¸ºçµæ´»çš„æ„å»ºäº§å“å¯¹è±¡ </li><li>åœ¨ä¸æ‰§è¡Œæœ€å build æ–¹æ³•å‰ï¼Œäº§å“å¯¹è±¡éƒ½ä¸å¯ç”¨ </li><li>æ„å»ºè¿‡ç¨‹é‡‡ç”¨é“¾å¼è°ƒç”¨</li></ul><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.beans.factory.support.BeanDefinitionBuilder </li><li>org.springframework.web.util.UriComponentsBuilder </li><li>org.springframework.http.ResponseEntity.HeadersBuilder </li><li>org.springframework.http.ResponseEntity.BodyBuilder</li></ul><h2 id="ğŸFactory-Method"><a href="#ğŸFactory-Method" class="headerlink" title="ğŸFactory Method"></a>ğŸFactory Method</h2><blockquote><p><em>Define an interface for creating an object, but let subclasses decide which class to instantiate. Factory Method lets a class defer instantiation to subclasses</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>Spring ä¸­çš„ ApplicationContext ä¸ BeanFactory ä¸­çš„ getBean éƒ½å¯ä»¥è§†ä¸ºå·¥å‚æ–¹æ³•ï¼ˆéšè—äº† bean ï¼ˆäº§å“ï¼‰çš„åˆ›å»ºè¿‡ç¨‹å’Œå…·ä½“å®ç°ï¼‰</li><li>org.springframework.beans.factory.FactoryBean </li><li>@Bean æ ‡æ³¨çš„é™æ€æ–¹æ³•åŠå®ä¾‹æ–¹æ³•  </li><li>ObjectFactory åŠ ObjectProviderï¼Œæ¨è¿Ÿ bean åˆ›å»ºï¼Œè§£å†³å¾ªç¯ä¾èµ–åŠå•ä¾‹æ³¨å…¥å¤šä¾‹ç­‰é—®é¢˜</li></ul><h2 id="ğŸAdapter"><a href="#ğŸAdapter" class="headerlink" title="ğŸAdapter"></a>ğŸAdapter</h2><blockquote><p><em>Convert the interface of a class into another interface clients expect. Adapter lets classes work together that couldnâ€™t otherwise because of incompatible interfaces</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li><p>org.springframework.web.servlet.HandlerAdapter â€“ å› ä¸ºæ§åˆ¶å™¨å®ç°æœ‰å„ç§å„æ ·ï¼Œæ¯”å¦‚æœ‰</p></li><li><ul><li><p><strong>@RequestMapping</strong> æ ‡æ³¨çš„æ§åˆ¶å™¨å®ç°</p></li><li><p>ä¼ ç»Ÿçš„åŸºäº Controller æ¥å£ï¼ˆé @Controlleræ³¨è§£ï¼‰çš„å®ç°</p></li><li><p>è¾ƒæ–°çš„åŸºäº RouterFunction æ¥å£çš„å®ç°</p><p>å®ƒä»¬çš„å¤„ç†æ–¹æ³•éƒ½ä¸ä¸€æ ·ï¼Œä¸ºäº†ç»Ÿä¸€è°ƒç”¨ï¼Œå¿…é¡»é€‚é…ä¸º HandlerAdapter æ¥å£</p></li></ul></li><li><p>org.springframework.beans.factory.support.DisposableBeanAdapter â€“ å› ä¸ºé”€æ¯æ–¹æ³•å¤šç§å¤šæ ·ï¼Œå› æ­¤éƒ½è¦é€‚é…ä¸º DisposableBean æ¥ç»Ÿä¸€è°ƒç”¨é”€æ¯æ–¹æ³•</p></li></ul><h2 id="ğŸComposite"><a href="#ğŸComposite" class="headerlink" title="ğŸComposite"></a>ğŸComposite</h2><blockquote><p><em>Compose objects into tree structures to represent part-whole hierarchies. Composite lets clients treat individual objects and compositions of objects uniformly</em></p></blockquote><p>composite å¯¹è±¡çš„ä½œç”¨æ˜¯ï¼Œå°†<strong>åˆ†æ•£çš„è°ƒç”¨é›†ä¸­èµ·æ¥ï¼Œç»Ÿä¸€è°ƒç”¨å…¥å£</strong>ï¼Œå®ƒçš„ç‰¹å¾æ˜¯ï¼Œä¸å…·ä½“å¹²æ´»çš„å®ç°å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œå½“è°ƒç”¨ composite å¯¹è±¡çš„æ¥å£æ–¹æ³•æ—¶ï¼Œå…¶å®æ˜¯<strong>å§”æ‰˜å…·ä½“å¹²æ´»çš„å®ç°</strong>æ¥å®Œæˆ</p><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.web.method.support.HandlerMethodArgumentResolverComposite</li><li>org.springframework.web.method.support.HandlerMethodReturnValueHandlerComposite</li><li>org.springframework.web.servlet.handler.HandlerExceptionResolverComposite</li><li>org.springframework.web.servlet.view.ViewResolverComposite</li></ul><h2 id="ğŸDecorator"><a href="#ğŸDecorator" class="headerlink" title="ğŸDecorator"></a>ğŸDecorator</h2><blockquote><p><em>Attach additional responsibilities to an object dynamically. Decorators provide a flexible alternative to subclassing for extending functionality</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š<br>    org.springframework.web.util.ContentCachingRequestWrapper</p><h2 id="ğŸProxy"><a href="#ğŸProxy" class="headerlink" title="ğŸProxy"></a>ğŸProxy</h2><blockquote><p><em>Provide a surrogate or placeholder for another object to control access to it</em></p></blockquote><p>è£…é¥°å™¨æ¨¡å¼æ³¨é‡çš„æ˜¯<strong>åŠŸèƒ½å¢å¼º</strong>ï¼Œé¿å…å­ç±»ç»§æ‰¿æ–¹å¼è¿›è¡ŒåŠŸèƒ½æ‰©å±•ï¼Œè€Œä»£ç†æ¨¡å¼<strong>æ›´æ³¨é‡æ§åˆ¶ç›®æ ‡çš„è®¿é—®ï¼ˆç¯ç»•é€šçŸ¥ç­‰ï¼‰</strong></p><p>Spring ä¸­çš„ä½“ç°ï¼ˆAOPï¼‰ï¼š</p><ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li><li>org.springframework.aop.framework.ObjenesisCglibAopProxy</li></ul><h2 id="ğŸChain-of-Responsibility"><a href="#ğŸChain-of-Responsibility" class="headerlink" title="ğŸChain of Responsibility"></a>ğŸChain of Responsibility</h2><blockquote><p><em>Avoid coupling the sender of a request to its receiver by giving more than one object a chance to handle the request. Chain the receiving objects and pass the request along the chain until an object handles it</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼ˆæ‹¦æˆªå™¨ï¼‰ï¼š<br>    org.springframework.web.servlet.<strong>HandlerInterceptor</strong></p><h2 id="ğŸObserver"><a href="#ğŸObserver" class="headerlink" title="ğŸObserver"></a>ğŸObserver</h2><blockquote><p><em>Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.context.<strong>ApplicationListener</strong></li><li>org.springframework.context.event.ApplicationEventMulticaster</li><li>org.springframework.context.ApplicationEvent</li></ul><h2 id="ğŸStrategy"><a href="#ğŸStrategy" class="headerlink" title="ğŸStrategy"></a>ğŸStrategy</h2><blockquote><p><em>Define a family of algorithms, encapsulate each one, and make them interchangeable. Strategy lets the algorithm vary independently from clients that use it</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>org.springframework.beans.factory.support.InstantiationStrategy</li><li>org.springframework.core.annotation.MergedAnnotations.SearchStrategy</li><li>org.springframework.boot.autoconfigure.condition.SearchStrategy</li></ul><h2 id="ğŸTemplate-Method"><a href="#ğŸTemplate-Method" class="headerlink" title="ğŸTemplate Method"></a>ğŸTemplate Method</h2><blockquote><p><em>Define the skeleton of an algorithm in an operation, deferring some steps to subclasses. Template Method lets subclasses redefine certain steps of an algorithm without changing the algorithmâ€™s structure</em></p></blockquote><p>Spring ä¸­çš„ä½“ç°ï¼š</p><ul><li>å¤§éƒ¨åˆ†ä»¥ Template å‘½åçš„ç±»ï¼Œå¦‚ JdbcTemplateï¼ŒTransactionTemplate</li><li>å¾ˆå¤šä»¥ Abstract å‘½åçš„ç±»ï¼Œå¦‚ AbstractApplicationContext</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springæ³¨è§£</title>
      <link href="/posts/5399/"/>
      <url>/posts/5399/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸSpringå¸¸è§æ³¨è§£"><a href="#ğŸSpringå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringå¸¸è§æ³¨è§£"></a>ğŸSpringå¸¸è§æ³¨è§£</h2><h3 id="ç»„ä»¶æ‰«æä¸é…ç½®ç±»"><a href="#ç»„ä»¶æ‰«æä¸é…ç½®ç±»" class="headerlink" title="ç»„ä»¶æ‰«æä¸é…ç½®ç±»"></a>ç»„ä»¶æ‰«æä¸é…ç½®ç±»</h3><p>@Component : æ ‡è¯†ç»„ä»¶,æ²¡æœ‰æ˜ç¡®çš„è§’è‰²</p><p>@Service : åœ¨ä¸šåŠ¡é€»è¾‘å±‚(serviceå±‚)ä½¿ç”¨</p><p>@Repository : åœ¨æ•°æ®è®¿é—®å±‚(daoå±‚)ä½¿ç”¨</p><p>@Controller : åœ¨æ§åˆ¶å±‚(controller)ä½¿ç”¨</p><hr><p>@ComponentScan : è‡ªåŠ¨æ‰«æåŒ…åä¸‹æ‰€æœ‰ä½¿ç”¨ @Component @Service  @Repository @Controller çš„ç±»,å¹¶æ³¨å†Œä¸ºBean</p><p>@Conditional : ç»„ä»¶æ‰«ææ—¶è¿›è¡Œ<strong>æ¡ä»¶è£…é…</strong></p><hr><p>@Configuration : å£°æ˜å½“å‰ç±»æ˜¯ä¸ª<strong>é…ç½®ç±»</strong>ï¼Œç›¸å½“äºä¸€ä¸ªSpringé…ç½®çš„xmlæ–‡ä»¶</p><ul><li>é…ç½®ç±»å…¶å®ç›¸å½“äºä¸€ä¸ªå·¥å‚, æ ‡æ³¨ @Bean æ³¨è§£çš„æ–¹æ³•ç›¸å½“äº<strong>å·¥å‚æ–¹æ³•</strong> </li><li>@Bean  ä¸æ”¯æŒ<strong>æ–¹æ³•é‡è½½</strong>, å¦‚æœæœ‰å¤šä¸ªé‡è½½æ–¹æ³•, ä»…æœ‰ä¸€ä¸ªèƒ½å…¥é€‰ä¸ºå·¥å‚æ–¹æ³• </li><li>@Configuration  é»˜è®¤ä¼šä¸ºæ ‡æ³¨çš„ç±»ç”Ÿæˆä»£ç†, å…¶ç›®çš„æ˜¯ä¿è¯ @Bean  æ–¹æ³•ç›¸äº’è°ƒç”¨æ—¶, ä»ç„¶èƒ½ä¿è¯å…¶å•ä¾‹ç‰¹æ€§ </li><li>@Configuration  ä¸­å¦‚æœå«æœ‰ BeanFactory åå¤„ç†å™¨, åˆ™å®ä¾‹å·¥å‚æ–¹æ³•ä¼šå¯¼è‡´ MyConfig æå‰åˆ›å»º, é€ æˆå…¶ä¾èµ–æ³¨å…¥å¤±è´¥ï¼Œè§£å†³æ–¹æ³•æ˜¯æ”¹ç”¨é™æ€å·¥å‚æ–¹æ³•æˆ–ç›´æ¥ä¸º @Bean  çš„æ–¹æ³•å‚æ•°ä¾èµ–æ³¨å…¥, é’ˆå¯¹ Mapper æ‰«æå¯ä»¥æ”¹ç”¨æ³¨è§£æ–¹å¼</li></ul><p>@Bean : æ³¨è§£åœ¨æ–¹æ³•ä¸Š,å£°æ˜å½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ªBean</p><p>@Import</p><p><strong>å››ç§ç”¨æ³•</strong></p><ul><li>å¼•å…¥å•ä¸ª bean</li><li>å¼•å…¥ä¸€ä¸ªé…ç½®ç±»</li><li>é€šè¿‡ Selector å¼•å…¥å¤šä¸ªç±»</li><li>é€šè¿‡ beanDefinition æ³¨å†Œå™¨</li></ul><p><strong>è§£æè§„åˆ™</strong> </p><ul><li>åŒä¸€é…ç½®ç±»ä¸­, @Import  å…ˆè§£æ  @Bean  åè§£æ<br>åŒåå®šä¹‰, é»˜è®¤åé¢è§£æçš„ä¼šè¦†ç›–å‰é¢è§£æçš„</li><li>ä¸å…è®¸è¦†ç›–çš„æƒ…å†µä¸‹, è®© MyConfig(ä¸»é…ç½®ç±») çš„é…ç½®ä¼˜å…ˆ:é‡‡ç”¨ DeferredImportSelectorï¼Œå› ä¸ºå®ƒæœ€åå·¥ä½œ, å¯ä»¥ç®€å•è®¤ä¸ºå…ˆè§£æ @Bean, å† @Import</li></ul><hr><p>@Lazy</p><ul><li>åŠ åœ¨ç±»ä¸Šï¼Œè¡¨ç¤ºæ­¤ç±»å»¶è¿Ÿå®ä¾‹åŒ–ã€åˆå§‹åŒ–</li><li>åŠ åœ¨æ–¹æ³•å‚æ•°ä¸Šï¼Œæ­¤å‚æ•°ä¼šä»¥ä»£ç†æ–¹å¼æ³¨å…¥</li></ul><p>@PropertySource : è¯»å–Propertiesæ–‡ä»¶ï¼Œå°†é”®å€¼ä¿¡æ¯åŠ å…¥åˆ°Environment</p><h3 id="ä¾èµ–æ³¨å…¥"><a href="#ä¾èµ–æ³¨å…¥" class="headerlink" title="ä¾èµ–æ³¨å…¥"></a><strong>ä¾èµ–æ³¨å…¥</strong></h3><p>@Autowired : åŠ åœ¨æˆå‘˜å˜é‡æˆ–æ–¹æ³•ä¸Šå®Œæˆä¾èµ–æ³¨å…¥</p><p>@Qualifier : å¤šä¸ªBeançš„ç±»å‹ç›¸åŒï¼Œæ ¹æ®<strong>åå­—</strong>è¿›ä¸€æ­¥åŒºåˆ†</p><p>@Value : å€¼æ³¨å…¥</p><h3 id="äº‹åŠ¡æ³¨è§£"><a href="#äº‹åŠ¡æ³¨è§£" class="headerlink" title="äº‹åŠ¡æ³¨è§£"></a><strong>äº‹åŠ¡æ³¨è§£</strong></h3><p>@EnableTransactionManagementï¼Œä¼šé¢å¤–åŠ è½½ 4 ä¸ª bean</p><ul><li>BeanFactoryTransactionAttributeSourceAdvisor äº‹åŠ¡åˆ‡é¢ç±»</li><li>TransactionAttributeSource ç”¨æ¥è§£æäº‹åŠ¡å±æ€§</li><li>TransactionInterceptor äº‹åŠ¡æ‹¦æˆªå™¨</li><li>TransactionalEventListenerFactory äº‹åŠ¡ç›‘å¬å™¨å·¥å‚</li></ul><p>@Transactional : æ–¹æ³•æˆ–ç±»ä¸Šå¼€å¯äº‹åŠ¡ç®¡ç†</p><h3 id="æ ¸å¿ƒ"><a href="#æ ¸å¿ƒ" class="headerlink" title="æ ¸å¿ƒ"></a><strong>æ ¸å¿ƒ</strong></h3><p>@Order : æ§åˆ¶Beançš„æ‰§è¡Œé¡ºåº</p><h3 id="åˆ‡é¢"><a href="#åˆ‡é¢" class="headerlink" title="åˆ‡é¢"></a><strong>åˆ‡é¢</strong></h3><p>@EnableAspectJAutoProxy : å¼€å¯Spring å¯¹è¿™ä¸ªåˆ‡é¢(Aspect)çš„æ”¯æŒ</p><ul><li>ä¼šåŠ è½½ AnnotationAwareAspectJAutoProxyCreatorï¼Œå®ƒæ˜¯ä¸€ä¸ª bean åå¤„ç†å™¨ï¼Œç”¨æ¥åˆ›å»ºä»£ç†</li><li>å¦‚æœæ²¡æœ‰é…ç½® @EnableAspectJAutoProxyï¼Œåˆéœ€è¦ç”¨åˆ°ä»£ç†ï¼ˆå¦‚äº‹åŠ¡ï¼‰åˆ™ä¼šä½¿ç”¨ InfrastructureAdvisorAutoProxyCreator è¿™ä¸ª bean åå¤„ç†å™¨</li></ul><h2 id="ğŸSpringMVCå¸¸è§æ³¨è§£"><a href="#ğŸSpringMVCå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringMVCå¸¸è§æ³¨è§£"></a>ğŸSpringMVCå¸¸è§æ³¨è§£</h2><h3 id="mvc-mapping"><a href="#mvc-mapping" class="headerlink" title="mvc mapping"></a><strong>mvc mapping</strong></h3><p>@RequestMapping : <strong>åŒ¹é…è¯·æ±‚</strong>ï¼ŒåŠ è½½ç±»ä¸Šç»Ÿä¸€è¯·æ±‚çš„å‰ç¼€ï¼Œå¯ä»¥æ´¾ç”Ÿå¤šä¸ªæ³¨è§£å¦‚ @GetMapping ç­‰</p><h3 id="mvc-rest"><a href="#mvc-rest" class="headerlink" title="mvc rest"></a><strong>mvc rest</strong></h3><p>@RequestBody : å¤„ç†è¯·æ±‚ä½“ä¸­çš„<strong>JSONæ•°æ®</strong>ï¼Œå°†JSONæ•°æ®è½¬ä¸ºJavaå¯¹è±¡</p><p>@ResponseBody : ä¸RequestBodyç›¸åï¼ŒJavaå¯¹è±¡è½¬ä¸ºJSONæ•°æ®ï¼Œå¤„ç†å“åº”ä½“ï¼Œç»„åˆ @Controller &#x3D;&gt; @RestController</p><p>@ResponseStatus : æ§åˆ¶å“åº”çš„çŠ¶æ€ç </p><h3 id="mvc-ç»Ÿä¸€å¤„ç†"><a href="#mvc-ç»Ÿä¸€å¤„ç†" class="headerlink" title="mvc ç»Ÿä¸€å¤„ç†"></a><strong>mvc ç»Ÿä¸€å¤„ç†</strong></h3><p>@ControllerAdvice : ç»„åˆ @ResponseBody &#x3D;&gt; @RestControllerAdvice</p><p>@ExceptionHandler : å¤„ç†å¼‚å¸¸</p><h3 id="mvc-å‚æ•°"><a href="#mvc-å‚æ•°" class="headerlink" title="mvc å‚æ•°"></a><strong>mvc å‚æ•°</strong></h3><p>@PathVariable : è·å–è¯·æ±‚è·¯å¾„ä¸­çš„å‚æ•°å€¼</p><h2 id="ğŸSpringBootå¸¸è§æ³¨è§£"><a href="#ğŸSpringBootå¸¸è§æ³¨è§£" class="headerlink" title="ğŸSpringBootå¸¸è§æ³¨è§£"></a>ğŸSpringBootå¸¸è§æ³¨è§£</h2><h3 id="boot-auto"><a href="#boot-auto" class="headerlink" title="boot auto"></a>boot auto</h3><p>@SpringBootApplication : å¼€å¯<strong>è‡ªåŠ¨é…ç½®</strong>ï¼Œä»¥ä¸‹ä¸¤ä¸ªæ³¨è§£+@ComponentScan</p><ul><li>@EnableAutoConfiguration</li><li>@SpringBootConfiguration</li></ul><h3 id="boot-condition"><a href="#boot-condition" class="headerlink" title="boot condition"></a>boot condition</h3><p>@ConditionalOnClass : classpath ä¸‹å­˜åœ¨æŸä¸ª class æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><p>@ConditionalOnMissingBean : beanFactory å†…ä¸å­˜åœ¨æŸä¸ª bean æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><p>@ConditionalOnProperty : é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨æŸä¸ª propertyï¼ˆé”®ã€å€¼ï¼‰æ—¶ï¼Œæ¡ä»¶æ‰æˆç«‹</p><h3 id="boot-properties"><a href="#boot-properties" class="headerlink" title="boot properties"></a>boot properties</h3><p>@ConfigurationProperties : ä¼šå°†å½“å‰ bean çš„å±æ€§ä¸é…ç½®æ–‡ä»¶ä¸­çš„é”®å€¼è¿›è¡Œç»‘å®š<br>@EnableConfigurationProperties : ä¼šæ·»åŠ ä¸¤ä¸ªè¾ƒä¸ºé‡è¦çš„ bean </p><ul><li>ConfigurationPropertiesBindingPostProcessorï¼Œbean åå¤„ç†å™¨ï¼Œåœ¨ bean åˆå§‹åŒ–å‰è°ƒç”¨ä¸‹é¢çš„ binder</li><li>ConfigurationPropertiesBinderï¼ŒçœŸæ­£æ‰§è¡Œç»‘å®šæ“ä½œ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBootè‡ªåŠ¨é…ç½®</title>
      <link href="/posts/3992/"/>
      <url>/posts/3992/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>SpringBootçš„è‡ªåŠ¨é…ç½®ï¼Œä»å¯åŠ¨ç±»ä¸Šçš„<code>@SpringBootApplication</code>æ³¨è§£å¼€å§‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoconfigurationApplication</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">SpringApplication.run(AutoconfigurationApplication.class, args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>@SpringBootApplication</code> æ˜¯ä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œä¸»è¦ç”±<code>@SpringBootConfiguration</code> ã€ <code>@ComponentScan</code>å’Œ<code>@EnableAutoConfiguration</code> ç»„æˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@SpringBootConfiguration</span></span><br><span class="line"><span class="meta">@EnableAutoConfiguration</span></span><br><span class="line"><span class="meta">@ComponentScan(excludeFilters = &#123; @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),</span></span><br><span class="line"><span class="meta">      @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootApplication &#123;&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-SpringBootConfiguration"><a href="#ğŸ-SpringBootConfiguration" class="headerlink" title="ğŸ@SpringBootConfiguration"></a>ğŸ@SpringBootConfiguration</h2><blockquote><p>è¿™ä¸ªæ³¨è§£å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª@Configuration</p></blockquote><p><code>@SpringBootConfiguration</code> ä¸æ™®é€š <code>@Configuration</code>  ç›¸æ¯”ï¼Œå”¯ä¸€åŒºåˆ«æ˜¯å‰è€…è¦æ±‚æ•´ä¸ª app ä¸­<strong>åªå‡ºç°ä¸€æ¬¡</strong> </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// ä¹Ÿæ˜¯ä¸€ä¸ªé…ç½®ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> SpringBootConfiguration &#123;</span><br><span class="line">    <span class="meta">@AliasFor(</span></span><br><span class="line"><span class="meta">        annotation = Configuration.class</span></span><br><span class="line"><span class="meta">    )</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">proxyBeanMethods</span><span class="params">()</span> <span class="keyword">default</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-ComponentScan"><a href="#ğŸ-ComponentScan" class="headerlink" title="ğŸ@ComponentScan"></a>ğŸ@ComponentScan</h2><blockquote><p>è¿™ä¸ªæ³¨è§£çš„ä½œç”¨æ˜¯æ‰«æå½“å‰åŒ…åŠå…¶å­åŒ…</p></blockquote><p>æœ‰ä¸€ä¸ªæ¯”è¾ƒé‡è¦çš„é…ç½®æ˜¯<strong>excludeFilters</strong>ï¼Œç”¨æ¥åœ¨ç»„ä»¶æ‰«ææ—¶è¿›è¡Œæ’é™¤ï¼Œä¹Ÿä¼šæ’é™¤è‡ªåŠ¨é…ç½®ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestExcludeFilter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(MyConfig.class);</span><br><span class="line">        context.registerBean(MyFilter.class); </span><br><span class="line">        context.refresh();</span><br><span class="line">        <span class="keyword">for</span> (String name : context.getBeanDefinitionNames()) &#123;</span><br><span class="line">            System.out.println(name); <span class="comment">//åªæœ‰bean2</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="meta">@ComponentScan(basePackages = &#123;&quot;day04.boot.sub&quot;&#125;,</span></span><br><span class="line"><span class="meta">            excludeFilters = &#123; @ComponentScan.Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class)&#125;)</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…åˆ @ComponentScan ä½¿ç”¨, å¯¹æ‰«æåˆ°çš„å…ƒæ•°æ®è¿›è¡Œè¿‡æ»¤, è¿”å› true è¡¨ç¤ºè¿‡æ»¤æ‰, false è¡¨ç¤ºä¿ç•™</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">extends</span> <span class="title class_">TypeExcludeFilter</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">match</span><span class="params">(MetadataReader metadataReader, MetadataReaderFactory metadataReaderFactory)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">className</span> <span class="operator">=</span> metadataReader.getClassMetadata().getClassName();</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, className);</span><br><span class="line">            <span class="keyword">if</span> (className.equals(Bean1.class.getName())) &#123; <span class="comment">// Bean1è¿›è¡Œè¿‡æ»¤</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ-EnableAutoConfiguration"><a href="#ğŸ-EnableAutoConfiguration" class="headerlink" title="ğŸ@EnableAutoConfiguration"></a>ğŸ@EnableAutoConfiguration</h2><blockquote><p>è¿›è¡Œè‡ªåŠ¨è£…é…çš„æ³¨è§£</p></blockquote><p>ä¹Ÿä¸»è¦åŒ…æ‹¬ä¸¤ä¸ªæ³¨è§£</p><p>@AutoConfigurationPackage â€“ ç”¨æ¥è®°ä½æ‰«æçš„èµ·å§‹åŒ…<br>@Import(AutoConfigurationImportSelector.class) ç”¨æ¥åŠ è½½ META-INF&#x2F;spring.factories ä¸­çš„è‡ªåŠ¨é…ç½®ç±»</p><p>æºç </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@AutoConfigurationPackage</span></span><br><span class="line"><span class="meta">@Import(&#123;AutoConfigurationImportSelector.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> EnableAutoConfiguration &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">ENABLED_OVERRIDE_PROPERTY</span> <span class="operator">=</span> <span class="string">&quot;spring.boot.enableautoconfiguration&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Class&lt;?&gt;[] exclude() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    String[] excludeName() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line"><span class="comment">//        context.getEnvironment().getPropertySources().addLast(new ResourcePropertySource(&quot;application.properties&quot;));</span></span><br><span class="line">        context.registerBean(MyConfig.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(AutoConfigurationPackages.get(context.getDefaultListableBeanFactory()));</span></span><br><span class="line"><span class="comment">// æ‰“å°å½“å‰åŒ…</span></span><br><span class="line">        <span class="keyword">for</span> (String name : context.getBeanDefinitionNames()) &#123;</span><br><span class="line">            System.out.println(name);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//        System.out.println(SpringFactoriesLoader.loadFactoryNames(EnableAutoConfiguration.class, EnableAutoConfiguration.class.getClassLoader()).stream()</span></span><br><span class="line"><span class="comment">//                .filter(name -&gt; !name.equals(OtherConfig.class.getName())).map(name -&gt; &quot;\&quot;&quot; + name + &quot;\&quot;&quot;).collect(Collectors.joining(&quot;,&quot;,&quot;&#123;&quot;,&quot;&#125;&quot;)));</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//    @AutoConfigurationPackage  //ç”¨æ¥è®°ä½æ‰«æçš„èµ·å§‹åŒ…</span></span><br><span class="line">    <span class="meta">@EnableAutoConfiguration(excludeName = &#123;&quot;org.springframework.boot.autoconfigure.admin.SpringApplicationAdminJmxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.aop.AopAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.batch.BatchAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.cache.CacheAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.ConfigurationPropertiesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.LifecycleAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.MessageSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.context.PropertyPlaceholderAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.couchbase.CouchbaseAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.dao.PersistenceExceptionTranslationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.cassandra.CassandraRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.couchbase.CouchbaseRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ElasticsearchRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.elasticsearch.ReactiveElasticsearchRestClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.jdbc.JdbcRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.jpa.JpaRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.ldap.LdapRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.mongo.MongoRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jReactiveRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.neo4j.Neo4jRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.r2dbc.R2dbcDataAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.r2dbc.R2dbcRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.redis.RedisRepositoriesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.rest.RepositoryRestMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.data.web.SpringDataWebAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.elasticsearch.ElasticsearchRestClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.flyway.FlywayAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.freemarker.FreeMarkerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.groovy.template.GroovyTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.gson.GsonAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.h2.H2ConsoleAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hateoas.HypermediaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hazelcast.HazelcastAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.hazelcast.HazelcastJpaDependencyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.http.HttpMessageConvertersAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.http.codec.CodecsAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.influx.InfluxDbAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.info.ProjectInfoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.integration.IntegrationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jackson.JacksonAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.JdbcTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.JndiDataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.XADataSourceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jdbc.DataSourceTransactionManagerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.JmsAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jmx.JmxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.JndiConnectionFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.activemq.ActiveMQAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jms.artemis.ArtemisAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jersey.JerseyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jooq.JooqAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.jsonb.JsonbAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.kafka.KafkaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.availability.ApplicationAvailabilityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.ldap.embedded.EmbeddedLdapAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.ldap.LdapAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.liquibase.LiquibaseAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mail.MailSenderAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mail.MailSenderValidatorAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.embedded.EmbeddedMongoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mongo.MongoReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.mustache.MustacheAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.neo4j.Neo4jAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.netty.NettyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.quartz.QuartzAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.r2dbc.R2dbcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.r2dbc.R2dbcTransactionManagerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketMessagingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketRequesterAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.rsocket.RSocketStrategiesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.SecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.UserDetailsServiceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.servlet.SecurityFilterAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.reactive.ReactiveSecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.reactive.ReactiveUserDetailsServiceAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.rsocket.RSocketSecurityAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.saml2.Saml2RelyingPartyAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.sendgrid.SendGridAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.session.SessionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.client.servlet.OAuth2ClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.client.reactive.ReactiveOAuth2ClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.resource.servlet.OAuth2ResourceServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.security.oauth2.resource.reactive.ReactiveOAuth2ResourceServerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.solr.SolrAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.sql.init.SqlInitializationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.task.TaskExecutionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.task.TaskSchedulingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.thymeleaf.ThymeleafAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.transaction.TransactionAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.transaction.jta.JtaAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.validation.ValidationAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.client.RestTemplateAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.embedded.EmbeddedWebServerFactoryCustomizerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.HttpHandlerAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.ReactiveWebServerFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.WebFluxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.error.ErrorWebFluxAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.function.client.ClientHttpConnectorAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.reactive.function.client.WebClientAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.DispatcherServletAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.ServletWebServerFactoryAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.HttpEncodingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.MultipartAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.web.servlet.WebMvcAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.reactive.WebSocketReactiveAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.servlet.WebSocketServletAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.websocket.servlet.WebSocketMessagingAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.webservices.WebServicesAutoConfiguration&quot;, &quot;org.springframework.boot.autoconfigure.webservices.client.WebServiceTemplateAutoConfiguration&quot;, &quot;org.mybatis.spring.boot.autoconfigure.MybatisLanguageDriverAutoConfiguration&quot;, &quot;org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration&quot;&#125;)</span></span><br><span class="line"><span class="comment">//    @Import(OtherConfig.class) // ä¸ä½¿ç”¨ @Import  ç›´æ¥å¼•å…¥è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyConfig</span> &#123; <span class="comment">// ä¸»é…ç½®</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean1 <span class="title function_">bean1</span><span class="params">()</span> &#123; <span class="comment">// åŠ è½½ä¸»é…ç½®ä¸­çš„bean1è€Œä¸åŠ è½½ä»å±é…ç½®ä¸­çš„</span></span><br><span class="line">            System.out.println(<span class="string">&quot;MyConfig bean1()&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Configuration</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">OtherConfig</span> &#123; <span class="comment">// ä»å±é…ç½®(è‡ªåŠ¨é…ç½®ã€é»˜è®¤é…ç½®)</span></span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">        <span class="keyword">public</span> Bean1 <span class="title function_">bean1</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;OtherConfig bean1()&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean1</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean2 <span class="title function_">bean2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean2</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ä¸ä½¿ç”¨ @Import  ç›´æ¥å¼•å…¥è‡ªåŠ¨é…ç½®ç±»çš„åŸå› </p><ul><li>è¿™è®©ä¸»é…ç½®ç±»å’Œè‡ªåŠ¨é…ç½®ç±»å˜æˆäº†<strong>å¼ºè€¦åˆ</strong>ï¼Œä¸»é…ç½®ç±»ä¸åº”è¯¥çŸ¥é“æœ‰å“ªäº›ä»å±é…ç½®</li><li>ç›´æ¥ç”¨ @Import(è‡ªåŠ¨é…ç½®ç±».class)ï¼Œå¼•å…¥çš„é…ç½®è§£æä¼˜å…ˆçº§è¾ƒé«˜ï¼Œè‡ªåŠ¨é…ç½®ç±»çš„è§£æåº”è¯¥åœ¨ä¸»é…ç½®æ²¡æä¾›æ—¶ä½œä¸º<strong>é»˜è®¤é…ç½®</strong></li></ul><p>è€Œé‡‡ç”¨äº† @Import(AutoConfigurationImportSelector.class)</p><ul><li>ç”± AutoConfigurationImportSelector.class å»è¯»å– META-INF&#x2F;spring.factories ä¸­çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå®ç°äº†å¼±è€¦åˆ</li><li>å¦å¤– AutoConfigurationImportSelector.class å®ç°äº† DeferredImportSelector æ¥å£ï¼Œè®©è‡ªåŠ¨é…ç½®çš„è§£ææ™šäºä¸»é…ç½®çš„è§£æ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringMVCæ‰§è¡Œæµç¨‹</title>
      <link href="/posts/20834/"/>
      <url>/posts/20834/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><blockquote><p>Spring MVCæ˜¯Springåœ¨Spring Container Coreå’ŒAOPç­‰æŠ€æœ¯åŸºç¡€ä¸Šï¼Œéµå¾ªWeb MVCçš„è§„èŒƒæ¨å‡ºçš„webå¼€å‘æ¡†æ¶ï¼Œä¸ºäº†ç®€åŒ–Javaæ ˆçš„webå¼€å‘</p></blockquote><p>SpringMVCçš„æ ¸å¿ƒæ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><img src="/img/20834/spring-mvc-1.png" alt="spring-mvc-1" style="zoom:67%;" /><ol><li><strong>ã€å‘é€è¯·æ±‚ã€‘è¯·æ±‚â€”â€”&gt;DispatcherServlet</strong>ï¼Œå‰ç«¯æ§åˆ¶å™¨æ”¶åˆ°è¯·æ±‚åè‡ªå·±ä¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯å§”æ‰˜ç»™å…¶ä»–çš„è§£æå™¨è¿›è¡Œå¤„ç†ï¼Œä½œä¸ºç»Ÿä¸€è®¿é—®ç‚¹ï¼Œè¿›è¡Œå…¨å±€çš„æµç¨‹æ§åˆ¶ï¼›</li><li><strong>ã€æ˜ å°„å¤„ç†å™¨ã€‘DispatcherServletâ€”â€”&gt;HandlerMapping</strong>ï¼Œ HandlerMapping å°†ä¼šæŠŠè¯·æ±‚æ˜ å°„ä¸º <strong>HandlerExecutionChain</strong> å¯¹è±¡ï¼ˆåŒ…å«ä¸€ä¸ªHandler å¤„ç†å™¨ï¼ˆé¡µé¢æ§åˆ¶å™¨ï¼‰å¯¹è±¡ã€å¤šä¸ªHandlerInterceptor æ‹¦æˆªå™¨ï¼‰å¯¹è±¡ï¼Œé€šè¿‡è¿™ç§<strong>ç­–ç•¥æ¨¡å¼</strong>ï¼Œå¾ˆå®¹æ˜“æ·»åŠ æ–°çš„æ˜ å°„ç­–ç•¥ï¼›</li><li><strong>ã€å¤„ç†å™¨é€‚é…ã€‘DispatcherServletâ€”â€”&gt;HandlerAdapter</strong>ï¼ŒHandlerAdapter å°†ä¼šæŠŠå¤„ç†å™¨åŒ…è£…ä¸ºé€‚é…å™¨ï¼Œä»è€Œæ”¯æŒå¤šç§ç±»å‹çš„å¤„ç†å™¨ï¼Œ å³é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„åº”ç”¨ï¼Œä»è€Œå¾ˆå®¹æ˜“æ”¯æŒå¾ˆå¤šç±»å‹çš„å¤„ç†å™¨ï¼›</li><li><strong>ã€è°ƒç”¨å¤„ç†å™¨ã€‘HandlerAdapterâ€”â€”&gt;å¤„ç†å™¨åŠŸèƒ½å¤„ç†æ–¹æ³•çš„è°ƒç”¨</strong>ï¼ŒHandlerAdapter å°†ä¼šæ ¹æ®é€‚é…çš„ç»“æœè°ƒç”¨çœŸæ­£çš„å¤„ç†å™¨çš„åŠŸèƒ½å¤„ç†æ–¹æ³•ï¼Œå®ŒæˆåŠŸèƒ½å¤„ç†ï¼Œå¹¶è¿”å›ä¸€ä¸ªModelAndView å¯¹è±¡ï¼ˆåŒ…å«æ¨¡å‹æ•°æ®ã€é€»è¾‘è§†å›¾åï¼‰ï¼›</li><li><strong>ã€è§†å›¾è§£æã€‘ModelAndView çš„é€»è¾‘è§†å›¾åâ€”â€”&gt; ViewResolver</strong>ï¼ŒViewResolver å°†æŠŠé€»è¾‘è§†å›¾åè§£æä¸ºå…·ä½“çš„Viewï¼Œé€šè¿‡è¿™ç§ç­–ç•¥æ¨¡å¼ï¼Œå¾ˆå®¹æ˜“æ›´æ¢å…¶ä»–è§†å›¾æŠ€æœ¯ï¼›</li><li><strong>ã€è§†å›¾æ¸²æŸ“ã€‘Viewâ€”â€”&gt;æ¸²æŸ“</strong>ï¼ŒViewä¼šæ ¹æ®ä¼ è¿›æ¥çš„Modelæ¨¡å‹æ•°æ®è¿›è¡Œæ¸²æŸ“ï¼Œæ­¤å¤„çš„Modelå®é™…æ˜¯ä¸€ä¸ªMapæ•°æ®ç»“æ„ï¼Œå› æ­¤å¾ˆå®¹æ˜“æ”¯æŒå…¶ä»–è§†å›¾æŠ€æœ¯ï¼›</li><li><strong>ã€è¿”å›å“åº”ã€‘è¿”å›æ§åˆ¶æƒç»™DispatcherServlet</strong>ï¼Œç”±DispatcherServlet è¿”å›å“åº”ç»™ç”¨æˆ·ï¼Œåˆ°æ­¤ä¸€ä¸ªæµç¨‹ç»“æŸã€‚</li></ol><p>å…¶å®æ•´ä¸ªçš„æ‰§è¡Œæµç¨‹ä¹Ÿå¯ä»¥åˆ’åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œ<strong>åˆå§‹åŒ–ã€åŒ¹é…å’Œè°ƒç”¨</strong>ä¸‰ä¸ªé˜¶æ®µï¼Œä¸‹é¢åˆ†åˆ«è¯´æ˜</p><h2 id="ğŸåˆå§‹åŒ–é˜¶æ®µ"><a href="#ğŸåˆå§‹åŒ–é˜¶æ®µ" class="headerlink" title="ğŸåˆå§‹åŒ–é˜¶æ®µ"></a>ğŸåˆå§‹åŒ–é˜¶æ®µ</h2><ol><li>åœ¨ Web å®¹å™¨ç¬¬ä¸€æ¬¡ç”¨åˆ° <strong>DispatcherServlet</strong> çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºå…¶å¯¹è±¡å¹¶æ‰§è¡Œ init æ–¹æ³• </li><li><strong>init</strong> æ–¹æ³•å†…ä¼šåˆ›å»º Spring Web å®¹å™¨ï¼Œå¹¶è°ƒç”¨å®¹å™¨ <strong>refresh</strong> æ–¹æ³• </li><li>refresh è¿‡ç¨‹ä¸­ä¼šåˆ›å»ºå¹¶åˆå§‹åŒ– SpringMVC ä¸­çš„é‡è¦ç»„ä»¶ï¼Œ ä¾‹å¦‚ MultipartResolverï¼ŒHandlerMappingï¼ŒHandlerAdapterï¼ŒHandlerExceptionResolverã€ViewResolver ç­‰ </li><li>å®¹å™¨åˆå§‹åŒ–åï¼Œä¼šå°†ä¸Šä¸€æ­¥åˆå§‹åŒ–å¥½çš„é‡è¦ç»„ä»¶ï¼Œèµ‹å€¼ç»™ DispatcherServlet çš„æˆå‘˜å˜é‡ï¼Œç•™å¾…åç”¨</li></ol><img src="/img/20834/spring-mvc-2.png" alt="spring-mvc-2" style="zoom:67%;" /><h2 id="ğŸåŒ¹é…é˜¶æ®µ"><a href="#ğŸåŒ¹é…é˜¶æ®µ" class="headerlink" title="ğŸåŒ¹é…é˜¶æ®µ"></a>ğŸåŒ¹é…é˜¶æ®µ</h2><ol><li>ç”¨æˆ·å‘é€çš„è¯·æ±‚ç»Ÿä¸€åˆ°è¾¾å‰ç«¯æ§åˆ¶å™¨ DispatcherServlet </li><li>DispatcherServlet éå†æ‰€æœ‰ HandlerMapping ï¼Œæ‰¾åˆ°ä¸è·¯å¾„åŒ¹é…çš„å¤„ç†å™¨<br>   â‘  HandlerMapping æœ‰å¤šä¸ªï¼Œæ¯ä¸ª HandlerMapping ä¼šè¿”å›ä¸åŒçš„å¤„ç†å™¨å¯¹è±¡ï¼Œè°å…ˆåŒ¹é…ï¼Œè¿”å›è°çš„å¤„ç†å™¨ã€‚å…¶ä¸­èƒ½è¯†åˆ« <strong>@RequestMapping  çš„ä¼˜å…ˆçº§æœ€é«˜</strong><br>   â‘¡ å¯¹åº” @RequestMapping  çš„å¤„ç†å™¨æ˜¯ HandlerMethodï¼Œå®ƒåŒ…å«äº†æ§åˆ¶å™¨å¯¹è±¡å’Œæ§åˆ¶å™¨æ–¹æ³•ä¿¡æ¯<br>   â‘¢ å…¶ä¸­è·¯å¾„ä¸å¤„ç†å™¨çš„æ˜ å°„å…³ç³»åœ¨ HandlerMapping åˆå§‹åŒ–æ—¶å°±ä¼šå»ºç«‹å¥½</li></ol><img src="/img/20834/spring-mvc-3.png" alt="spring-mvc-3" style="zoom:67%;" /><ol start="3"><li>å°†HandlerMethodè¿åŒåŒ¹é…åˆ°çš„<strong>æ‹¦æˆªå™¨</strong>ï¼Œç”Ÿæˆ<strong>è°ƒç”¨é“¾å¯¹è±¡</strong>HandlerExecutionChainè¿”å›</li></ol><img src="/img/20834/spring-mvc-4.png" alt="img" style="zoom:67%;" /><ol start="4"><li>éå†HandlerAdapterå¤„ç†å™¨é€‚é…å™¨ï¼Œæ‰¾åˆ°èƒ½å¤„ç†HandlerMethodçš„<strong>é€‚é…å™¨å¯¹è±¡</strong>ï¼Œå¼€å§‹è°ƒç”¨</li></ol><img src="/img/20834/spring-mvc-5.png" alt="img" style="zoom:67%;" /><h2 id="ğŸè°ƒç”¨é˜¶æ®µ"><a href="#ğŸè°ƒç”¨é˜¶æ®µ" class="headerlink" title="ğŸè°ƒç”¨é˜¶æ®µ"></a>ğŸè°ƒç”¨é˜¶æ®µ</h2><ol><li>æ‰§è¡Œæ‹¦æˆªå™¨ <strong>preHandle</strong>(æŒ‰ç…§æ‹¦æˆªå™¨çš„<strong>æ­£å‘</strong>é¡ºåº)</li></ol><img src="/img/20834/spring-mvc-6.png" alt="img" style="zoom:67%;" /><ol start="2"><li>ç”± HandlerAdapter è°ƒç”¨ HandlerMethod</li></ol><p>â€‹â‘  è°ƒç”¨å‰å¤„ç†ä¸åŒç±»å‹çš„å‚æ•°</p><p>â€‹â‘¡ è°ƒç”¨åå¤„ç†ä¸åŒç±»å‹çš„è¿”å›å€¼</p><img src="/img/20834/spring-mvc-7.png" alt="img" style="zoom:67%;" /><ol start="3"><li>ç¬¬ 2 æ­¥æ²¡æœ‰å¼‚å¸¸</li></ol><p>â€‹â‘  è¿”å› ModelAndView</p><p>â€‹â‘¡ æ‰§è¡Œæ‹¦æˆªå™¨ <strong>postHandle</strong> æ–¹æ³•(æŒ‰ç…§æ‹¦æˆªå™¨çš„<strong>åå‘</strong>é¡ºåº)</p><p>â€‹â‘¢ è§£æè§†å›¾ï¼Œå¾—åˆ° View å¯¹è±¡ï¼Œè¿›è¡Œè§†å›¾æ¸²æŸ“</p><img src="/img/20834/spring-mvc-8.png" alt="img" style="zoom:67%;" /><ol start="4"><li>ç¬¬ 2 æ­¥æœ‰å¼‚å¸¸ï¼Œè¿›å…¥ HandlerExceptionResolver å¼‚å¸¸å¤„ç†æµç¨‹</li></ol><img src="/img/20834/spring-mvc-9.png" alt="img" style="zoom:67%;" /><ol start="5"><li><p>æœ€åéƒ½ä¼šæ‰§è¡Œæ‹¦æˆªå™¨çš„ <strong>afterCompletion</strong> æ–¹æ³• </p></li><li><p>å¦‚æœæ§åˆ¶å™¨æ–¹æ³•æ ‡æ³¨äº† <strong>@ResponseBody</strong>  æ³¨è§£ï¼Œåˆ™åœ¨ç¬¬ 2 æ­¥ï¼Œå°±ä¼šç”Ÿæˆ <strong>json ç»“æœ</strong>ï¼Œå¹¶æ ‡è®° ModelAndView å·²å¤„ç†ï¼Œè¿™æ ·å°±ä¸ä¼šæ‰§è¡Œç¬¬ 3 æ­¥çš„è§†å›¾æ¸²æŸ“</p></li></ol>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringMVC </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>beançš„ç”Ÿå‘½å‘¨æœŸ</title>
      <link href="/posts/22025/"/>
      <url>/posts/22025/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸæ¦‚è¿°"><a href="#ğŸæ¦‚è¿°" class="headerlink" title="ğŸæ¦‚è¿°"></a>ğŸæ¦‚è¿°</h2><p>Bean çš„ç”Ÿå‘½å‘¨æœŸä»è°ƒç”¨ beanFactory çš„ getBean å¼€å§‹ï¼Œåˆ°è¿™ä¸ª bean è¢«é”€æ¯ï¼Œå¯ä»¥æ€»ç»“ä¸ºä»¥ä¸‹ä¸ƒä¸ªé˜¶æ®µï¼š</p><ol><li>å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜</li><li>å¤„ç†çˆ¶å­å®¹å™¨</li><li>å¤„ç† dependsOn</li><li>é€‰æ‹© scope ç­–ç•¥</li><li><strong>åˆ›å»º bean</strong></li><li>ç±»å‹è½¬æ¢å¤„ç†</li><li><strong>é”€æ¯ bean</strong></li></ol><p>å¯¹åº”çš„æºä»£ç å¦‚ä¸‹(ä¸»è¦çœ‹æ³¨é‡Š)ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å‚æ•°typeCheckOnlyï¼šbeanå®ä¾‹æ˜¯å¦åŒ…å«ä¸€ä¸ªç±»å‹æ£€æŸ¥</span></span><br><span class="line"><span class="keyword">protected</span> &lt;T&gt; T <span class="title function_">doGetBean</span><span class="params">(</span></span><br><span class="line"><span class="params">String name, <span class="meta">@Nullable</span> Class&lt;T&gt; requiredType, <span class="meta">@Nullable</span> Object[] args, <span class="type">boolean</span> typeCheckOnly)</span></span><br><span class="line"><span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// (1.å¤„ç†åç§°)è§£æbeançš„çœŸæ­£nameï¼Œå¦‚æœbeanæ˜¯å·¥å‚ç±»ï¼Œnameå‰ç¼€ä¼šåŠ &amp;ï¼Œéœ€è¦å»æ‰</span></span><br><span class="line">  <span class="type">String</span> <span class="variable">beanName</span> <span class="operator">=</span> transformedBeanName(name);</span><br><span class="line">  Object beanInstance;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Eagerly check singleton cache for manually registered singletons.</span></span><br><span class="line">  <span class="type">Object</span> <span class="variable">sharedInstance</span> <span class="operator">=</span> getSingleton(beanName);</span><br><span class="line">  <span class="keyword">if</span> (sharedInstance != <span class="literal">null</span> &amp;&amp; args == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// (1.æ£€æŸ¥ç¼“å­˜)æ— å‚å•ä¾‹ä»ç¼“å­˜ä¸­è·å–</span></span><br><span class="line">    beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, <span class="literal">null</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœbeanå®ä¾‹è¿˜åœ¨åˆ›å»ºä¸­ï¼Œåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">if</span> (isPrototypeCurrentlyInCreation(beanName)) &#123;</span><br><span class="line">      <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCurrentlyInCreationException</span>(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// (2.å¤„ç†çˆ¶å­å®¹å™¨)å¦‚æœ bean definition å­˜åœ¨äºçˆ¶çš„beanå·¥å‚ä¸­ï¼Œå§”æ´¾ç»™çˆ¶Beanå·¥å‚è·å–</span></span><br><span class="line">    <span class="type">BeanFactory</span> <span class="variable">parentBeanFactory</span> <span class="operator">=</span> getParentBeanFactory();</span><br><span class="line">    <span class="keyword">if</span> (parentBeanFactory != <span class="literal">null</span> &amp;&amp; !containsBeanDefinition(beanName)) &#123;</span><br><span class="line">      <span class="comment">// Not found -&gt; check parent.</span></span><br><span class="line">      <span class="type">String</span> <span class="variable">nameToLookup</span> <span class="operator">=</span> originalBeanName(name);</span><br><span class="line">      <span class="keyword">if</span> (parentBeanFactory <span class="keyword">instanceof</span> AbstractBeanFactory) &#123;</span><br><span class="line">        <span class="keyword">return</span> ((AbstractBeanFactory) parentBeanFactory).doGetBean(</span><br><span class="line">            nameToLookup, requiredType, args, typeCheckOnly);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (args != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// Delegation to parent with explicit args.</span></span><br><span class="line">        <span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup, args);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// No args -&gt; delegate to standard getBean method.</span></span><br><span class="line">        <span class="keyword">return</span> parentBeanFactory.getBean(nameToLookup, requiredType);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (T) parentBeanFactory.getBean(nameToLookup);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!typeCheckOnly) &#123;</span><br><span class="line">      <span class="comment">// å°†å½“å‰beanå®ä¾‹æ”¾å…¥alreadyCreatedé›†åˆé‡Œï¼Œæ ‡è¯†è¿™ä¸ªbeanå‡†å¤‡åˆ›å»ºäº†</span></span><br><span class="line">      markBeanAsCreated(beanName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="type">StartupStep</span> <span class="variable">beanCreation</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.beans.instantiate&quot;</span>)</span><br><span class="line">        .tag(<span class="string">&quot;beanName&quot;</span>, name);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (requiredType != <span class="literal">null</span>) &#123;</span><br><span class="line">        beanCreation.tag(<span class="string">&quot;beanType&quot;</span>, requiredType::toString);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="type">RootBeanDefinition</span> <span class="variable">mbd</span> <span class="operator">=</span> getMergedLocalBeanDefinition(beanName);</span><br><span class="line">      checkMergedBeanDefinition(mbd, beanName, args);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// (3.å¤„ç†dependsOn)ç¡®ä¿å®ƒçš„ä¾èµ–ä¹Ÿè¢«åˆå§‹åŒ–äº†.</span></span><br><span class="line">      String[] dependsOn = mbd.getDependsOn();</span><br><span class="line">      <span class="keyword">if</span> (dependsOn != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (String dep : dependsOn) &#123;</span><br><span class="line">          <span class="keyword">if</span> (isDependent(beanName, dep)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                <span class="string">&quot;Circular depends-on relationship between &#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; and &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          registerDependentBean(dep, beanName);</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            getBean(dep); <span class="comment">// åˆå§‹åŒ–å®ƒä¾èµ–çš„Bean</span></span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">catch</span> (NoSuchBeanDefinitionException ex) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">BeanCreationException</span>(mbd.getResourceDescription(), beanName,</span><br><span class="line">                <span class="string">&quot;&#x27;&quot;</span> + beanName + <span class="string">&quot;&#x27; depends on missing bean &#x27;&quot;</span> + dep + <span class="string">&quot;&#x27;&quot;</span>, ex);</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">// åˆ›å»ºBeanå®ä¾‹ï¼šå•ä¾‹</span></span><br><span class="line">      <span class="keyword">if</span> (mbd.isSingleton()) &#123;</span><br><span class="line">        sharedInstance = getSingleton(beanName, () -&gt; &#123;</span><br><span class="line">          <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// çœŸæ­£åˆ›å»ºbeançš„æ–¹æ³•</span></span><br><span class="line">            <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">          &#125;</span><br><span class="line">          <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="comment">// Explicitly remove instance from singleton cache: It might have been put there</span></span><br><span class="line">            <span class="comment">// eagerly by the creation process, to allow for circular reference resolution.</span></span><br><span class="line">            <span class="comment">// Also remove any beans that received a temporary reference to the bean.</span></span><br><span class="line">            destroySingleton(beanName);</span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        beanInstance = getObjectForBeanInstance(sharedInstance, name, beanName, mbd);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// (5.åˆ›å»ºBean)åˆ›å»ºBeanå®ä¾‹ï¼šåŸå‹</span></span><br><span class="line">      <span class="keyword">else</span> <span class="keyword">if</span> (mbd.isPrototype()) &#123;</span><br><span class="line">        <span class="comment">// It&#x27;s a prototype -&gt; create a new instance.</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">prototypeInstance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          beforePrototypeCreation(beanName);</span><br><span class="line">          prototypeInstance = createBean(beanName, mbd, args);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">          afterPrototypeCreation(beanName);</span><br><span class="line">        &#125;</span><br><span class="line">        beanInstance = getObjectForBeanInstance(prototypeInstance, name, beanName, mbd);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// (4.é€‰æ‹©scopeç­–ç•¥)åˆ›å»ºBeanå®ä¾‹ï¼šæ ¹æ®beançš„scopeåˆ›å»º</span></span><br><span class="line">      <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">scopeName</span> <span class="operator">=</span> mbd.getScope();</span><br><span class="line">        <span class="keyword">if</span> (!StringUtils.hasLength(scopeName)) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No scope name defined for bean Â´&quot;</span> + beanName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">Scope</span> <span class="variable">scope</span> <span class="operator">=</span> <span class="built_in">this</span>.scopes.get(scopeName);</span><br><span class="line">        <span class="keyword">if</span> (scope == <span class="literal">null</span>) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalStateException</span>(<span class="string">&quot;No Scope registered for scope name &#x27;&quot;</span> + scopeName + <span class="string">&quot;&#x27;&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="type">Object</span> <span class="variable">scopedInstance</span> <span class="operator">=</span> scope.get(beanName, () -&gt; &#123;</span><br><span class="line">            beforePrototypeCreation(beanName);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">              <span class="keyword">return</span> createBean(beanName, mbd, args);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">finally</span> &#123;</span><br><span class="line">              afterPrototypeCreation(beanName);</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;);</span><br><span class="line">          beanInstance = getObjectForBeanInstance(scopedInstance, name, beanName, mbd);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">catch</span> (IllegalStateException ex) &#123;</span><br><span class="line">          <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">ScopeNotActiveException</span>(beanName, scopeName, ex);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">      beanCreation.tag(<span class="string">&quot;exception&quot;</span>, ex.getClass().toString());</span><br><span class="line">      beanCreation.tag(<span class="string">&quot;message&quot;</span>, String.valueOf(ex.getMessage()));</span><br><span class="line">      cleanupAfterBeanCreationFailure(beanName);</span><br><span class="line">      <span class="keyword">throw</span> ex;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">finally</span> &#123;</span><br><span class="line">      beanCreation.end();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> adaptBeanInstance(name, beanInstance, requiredType);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé˜¶æ®µ1-å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜"><a href="#ğŸé˜¶æ®µ1-å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜" class="headerlink" title="ğŸé˜¶æ®µ1  å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜"></a>ğŸé˜¶æ®µ1  å¤„ç†åç§°ï¼Œæ£€æŸ¥ç¼“å­˜</h2><p>è¿™ä¸€æ­¥ä¼šå¤„ç†åˆ«åï¼Œå°†<strong>åˆ«åè§£æä¸ºå®é™…åç§°</strong></p><p>å¯¹ FactoryBean ä¹Ÿä¼šç‰¹æ®Šå¤„ç†ï¼Œå¦‚æœä»¥ <strong>&amp;</strong> å¼€å¤´è¡¨ç¤ºè¦è·å– FactoryBean æœ¬èº«ï¼Œå¦åˆ™è¡¨ç¤ºè¦è·å–å…¶äº§å“</p><p>è¿™é‡Œé’ˆå¯¹å•ä¾‹å¯¹è±¡ä¼šæ£€æŸ¥<strong>ä¸€çº§ã€äºŒçº§ã€ä¸‰çº§</strong>ç¼“å­˜</p><ul><li>singletonFactories ä¸‰çº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹å·¥å‚</strong>å¯¹è±¡</li><li>earlySingletonObjects äºŒçº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹å·¥å‚çš„äº§å“</strong>å¯¹è±¡ï¼Œå¦‚æœå‘ç”Ÿå¾ªç¯ä¾èµ–ï¼Œäº§å“æ˜¯<strong>ä»£ç†</strong>ï¼›æ— å¾ªç¯ä¾èµ–ï¼Œäº§å“æ˜¯<strong>åŸå§‹å¯¹è±¡</strong></li><li>singletonObjects ä¸€çº§ç¼“å­˜ï¼Œå­˜æ”¾<strong>å•ä¾‹æˆå“</strong>å¯¹è±¡</li></ul><h2 id="ğŸé˜¶æ®µ2-å¤„ç†çˆ¶å­å®¹å™¨"><a href="#ğŸé˜¶æ®µ2-å¤„ç†çˆ¶å­å®¹å™¨" class="headerlink" title="ğŸé˜¶æ®µ2  å¤„ç†çˆ¶å­å®¹å™¨"></a>ğŸé˜¶æ®µ2  å¤„ç†çˆ¶å­å®¹å™¨</h2><p>å¦‚æœå½“å‰å®¹å™¨æ ¹æ®åå­—æ‰¾ä¸åˆ°è¿™ä¸ª beanï¼Œæ­¤æ—¶è‹¥çˆ¶å®¹å™¨å­˜åœ¨ï¼Œåˆ™<strong>æ‰§è¡Œçˆ¶å®¹å™¨</strong>çš„ getBean æµç¨‹</p><p>çˆ¶å­å®¹å™¨çš„ bean åç§°å¯ä»¥é‡å¤</p><h2 id="ğŸé˜¶æ®µ3-å¤„ç†-dependsOn"><a href="#ğŸé˜¶æ®µ3-å¤„ç†-dependsOn" class="headerlink" title="ğŸé˜¶æ®µ3  å¤„ç† dependsOn"></a>ğŸé˜¶æ®µ3  å¤„ç† dependsOn</h2><p>å¦‚æœå½“å‰ bean æœ‰é€šè¿‡ dependsOn æŒ‡å®šäº†<strong>éæ˜¾å¼ä¾èµ–</strong>çš„ beanï¼Œè¿™ä¸€æ­¥ä¼šæå‰åˆ›å»ºè¿™äº›dependsOn çš„ bean</p><blockquote><p>æ‰€è°“éæ˜¾å¼ä¾èµ–ï¼Œå°±æ˜¯æŒ‡ä¸¤ä¸ª bean ä¹‹é—´ä¸å­˜åœ¨ç›´æ¥ä¾èµ–å…³ç³»ï¼Œä½†éœ€è¦æ§åˆ¶å®ƒä»¬çš„<strong>åˆ›å»ºå…ˆåé¡ºåº</strong></p></blockquote><h2 id="ğŸé˜¶æ®µ4-é€‰æ‹©-scope-ç­–ç•¥"><a href="#ğŸé˜¶æ®µ4-é€‰æ‹©-scope-ç­–ç•¥" class="headerlink" title="ğŸé˜¶æ®µ4  é€‰æ‹© scope ç­–ç•¥"></a>ğŸé˜¶æ®µ4  é€‰æ‹© scope ç­–ç•¥</h2><p>scopeç†è§£ä¸ºä»xxxèŒƒå›´æ‰¾åˆ°è¿™ä¸ªbean</p><ul><li>singleton scopeè¡¨ç¤ºä»å•ä¾‹æ± èŒƒå›´å†…è·å–beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå¹¶æ”¾å…¥å•ä¾‹æ± </li><li>propotype scopeè¡¨ç¤ºä»ä¸ç¼“å­˜beanï¼Œæ¯æ¬¡éƒ½åˆ›å»ºæ–°çš„bean</li><li>request scopeè¡¨ç¤ºä»requestå¯¹è±¡èŒƒå›´å†…è·å–beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™åˆ›å»ºå¹¶æ”¾å…¥request</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestScope</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        testRequestScope();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// å•ä¾‹ bean ä» refresh è¢«åˆ›å»º, åˆ° close è¢«é”€æ¯, BeanFactory ä¼šè®°å½•å“ªäº› bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testSingletonScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class);</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh(); <span class="comment">// getBean</span></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾“å‡ºï¼šinit destroy</span></span><br><span class="line">    <span class="comment">// å¤šä¾‹ bean ä»é¦–æ¬¡ getBean è¢«åˆ›å»º, åˆ°è°ƒç”¨ BeanFactory çš„ destroyBean è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testPrototypeScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setScope(<span class="string">&quot;prototype&quot;</span>));</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="type">Bean1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Bean1.class);</span><br><span class="line">        <span class="comment">// æ²¡è°è®°å½•è¯¥ bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•, éœ€è¦æˆ‘ä»¬è‡ªè¡Œè°ƒç”¨</span></span><br><span class="line">        context.getDefaultListableBeanFactory().destroyBean(bean);</span><br><span class="line"></span><br><span class="line">        context.close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è¾“å‡ºï¼šinit destroy</span></span><br><span class="line">    <span class="comment">// request bean ä»é¦–æ¬¡ getBean è¢«åˆ›å»º, åˆ° request ç»“æŸå‰è¢«é”€æ¯</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">testRequestScope</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.getDefaultListableBeanFactory().registerScope(<span class="string">&quot;request&quot;</span>, <span class="keyword">new</span> <span class="title class_">RequestScope</span>());</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setScope(<span class="string">&quot;request&quot;</span>));</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        context.refresh();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="type">MockHttpServletRequest</span> <span class="variable">request</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MockHttpServletRequest</span>();</span><br><span class="line">                <span class="comment">// æ¯ä¸ª webRequest å¯¹è±¡ä¼šè®°å½•å“ªäº› bean è¦è°ƒç”¨é”€æ¯æ–¹æ³•</span></span><br><span class="line">                <span class="type">ServletWebRequest</span> <span class="variable">webRequest</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletWebRequest</span>(request);</span><br><span class="line">                RequestContextHolder.setRequestAttributes(webRequest);</span><br><span class="line"></span><br><span class="line">                <span class="type">Bean1</span> <span class="variable">bean</span> <span class="operator">=</span> context.getBean(Bean1.class);</span><br><span class="line">                LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, bean);</span><br><span class="line">                LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, request.getAttribute(<span class="string">&quot;bean1&quot;</span>));</span><br><span class="line"></span><br><span class="line">                <span class="comment">// request è¯·æ±‚ç»“æŸå‰è°ƒç”¨è¿™äº›é”€æ¯æ–¹æ³•</span></span><br><span class="line">                webRequest.requestCompleted();</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼šä¸¤ä¸ªçº¿ç¨‹çš„init destroy</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125; - init&quot;</span>, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PreDestroy</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">            LoggerUtils.get().debug(<span class="string">&quot;&#123;&#125; - destroy&quot;</span>, <span class="built_in">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸé˜¶æ®µ5-åˆ›å»ºbean"><a href="#ğŸé˜¶æ®µ5-åˆ›å»ºbean" class="headerlink" title="ğŸé˜¶æ®µ5  åˆ›å»ºbean"></a>ğŸé˜¶æ®µ5  åˆ›å»ºbean</h2><img src="/img/22025/bean1.png" alt="img" style="zoom:67%;" /><h3 id="5-1-åˆ›å»º-bean-å®ä¾‹"><a href="#5-1-åˆ›å»º-bean-å®ä¾‹" class="headerlink" title="5.1 åˆ›å»º bean å®ä¾‹"></a>5.1 åˆ›å»º bean å®ä¾‹</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td>æœ‰è‡ªå®šä¹‰ TargetSource çš„æƒ…å†µ</td><td>ç”± AnnotationAwareAspectJAutoProxyCreator åˆ›å»ºä»£ç†è¿”å›</td></tr><tr><td>Supplier æ–¹å¼åˆ›å»º bean å®ä¾‹</td><td>ä¸º Spring 5.0 æ–°å¢åŠŸèƒ½ï¼Œæ–¹ä¾¿ç¼–ç¨‹æ–¹å¼åˆ›å»º  bean  å®ä¾‹</td></tr><tr><td>FactoryMethod æ–¹å¼  åˆ›å»º bean  å®ä¾‹</td><td>â‘  åˆ†æˆé™æ€å·¥å‚ä¸å®ä¾‹å·¥å‚ï¼›â‘¡ å·¥å‚æ–¹æ³•è‹¥æœ‰å‚æ•°ï¼Œéœ€è¦å¯¹å·¥å‚æ–¹æ³•å‚æ•°è¿›è¡Œè§£æï¼Œåˆ©ç”¨  resolveDependencyï¼›â‘¢ å¦‚æœæœ‰å¤šä¸ªå·¥å‚æ–¹æ³•å€™é€‰è€…ï¼Œè¿˜è¦è¿›ä¸€æ­¥æŒ‰æƒé‡ç­›é€‰</td></tr><tr><td><strong>AutowiredAnnotationBeanPostProcessor</strong></td><td>â‘  ä¼˜å…ˆé€‰æ‹©å¸¦ <strong>@Autowired</strong> æ³¨è§£çš„æ„é€ ï¼›â‘¡ è‹¥æœ‰å”¯ä¸€çš„å¸¦å‚æ„é€ ï¼Œä¹Ÿä¼šå…¥é€‰</td></tr><tr><td>mbd.getPreferredConstructors</td><td>é€‰æ‹©æ‰€æœ‰å…¬å…±æ„é€ ï¼Œè¿™äº›æ„é€ ä¹‹é—´æŒ‰æƒé‡ç­›é€‰</td></tr><tr><td><strong>é‡‡ç”¨é»˜è®¤æ„é€ </strong></td><td>å¦‚æœä¸Šé¢çš„åå¤„ç†å™¨å’Œ BeanDefiniation éƒ½æ²¡æ‰¾åˆ°æ„é€ ï¼Œé‡‡ç”¨é»˜è®¤æ„é€ ï¼Œå³ä½¿æ˜¯ç§æœ‰çš„</td></tr></tbody></table><h3 id="5-2-ä¾èµ–æ³¨å…¥"><a href="#5-2-ä¾èµ–æ³¨å…¥" class="headerlink" title="5.2 ä¾èµ–æ³¨å…¥"></a>5.2 ä¾èµ–æ³¨å…¥</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td><strong>AutowiredAnnotationBeanPostProcessor</strong>ï¼ˆæ³¨è§£åŒ¹é…ï¼‰</td><td>è¯†åˆ«  <strong>@Autowired</strong> åŠ <strong>@Value</strong> æ ‡æ³¨çš„æˆå‘˜ï¼Œå°è£…ä¸º  InjectionMetadata è¿›è¡Œä¾èµ–æ³¨å…¥</td></tr><tr><td><strong>CommonAnnotationBeanPostProcessor</strong>ï¼ˆæ³¨è§£åŒ¹é…ï¼‰</td><td>è¯†åˆ«  <strong>@Resource</strong> æ ‡æ³¨çš„æˆå‘˜ï¼Œå°è£…ä¸º  InjectionMetadata è¿›è¡Œä¾èµ–æ³¨å…¥</td></tr><tr><td>resolveDependency</td><td>ç”¨æ¥æŸ¥æ‰¾è¦è£…é…çš„å€¼ï¼Œå¯ä»¥è¯†åˆ«ï¼šâ‘  Optionalï¼›â‘¡ ObjectFactory åŠ ObjectProviderï¼›â‘¢ @Lazy æ³¨è§£ï¼›â‘£ @Value æ³¨è§£ï¼ˆ${  }, #{ }, ç±»å‹è½¬æ¢ï¼‰ï¼›â‘¤ é›†åˆç±»å‹ï¼ˆCollectionï¼ŒMapï¼Œæ•°ç»„ç­‰ï¼‰ï¼›â‘¥ æ³›å‹å’Œ  @Qualifierï¼ˆç”¨æ¥åŒºåˆ†ç±»å‹æ­§ä¹‰ï¼‰ï¼›â‘¦ primary  åŠåå­—åŒ¹é…ï¼ˆç”¨æ¥åŒºåˆ†ç±»å‹æ­§ä¹‰ï¼‰</td></tr><tr><td><strong>AUTOWIRE_BY_NAME</strong>ï¼ˆæ ¹æ®åå­—åŒ¹é…ï¼‰</td><td>æ ¹æ®æˆå‘˜åå­—æ‰¾ bean å¯¹è±¡ï¼Œä¿®æ”¹ mbd çš„ propertyValuesï¼Œä¸ä¼šè€ƒè™‘ç®€å•ç±»å‹çš„æˆå‘˜</td></tr><tr><td><strong>AUTOWIRE_BY_TYPE</strong>ï¼ˆæ ¹æ®ç±»å‹åŒ¹é…ï¼‰</td><td>æ ¹æ®æˆå‘˜ç±»å‹æ‰§è¡Œ resolveDependency æ‰¾åˆ°ä¾èµ–æ³¨å…¥çš„å€¼ï¼Œä¿®æ”¹  mbd çš„ propertyValues</td></tr><tr><td><strong>applyPropertyValuesï¼ˆå³xmlä¸­çš„&lt;property name ref|value&#x2F;&gt;,ç²¾ç¡®æŒ‡å®šï¼‰</strong></td><td>æ ¹æ® mbd çš„ propertyValues è¿›è¡Œä¾èµ–æ³¨å…¥ï¼ˆå³xmlä¸­ &#96;&lt;property name ref</td></tr></tbody></table><p>ä¼˜å…ˆçº§ï¼šä¼˜å…ˆçº§æœ€ä½ï¼š@AutowiredåŒ¹é…ï¼›ä¼˜å…ˆçº§æ¬¡ä¹‹ï¼šAUTOWIRE_BY_NAMEï¼›ä¼˜å…ˆçº§æœ€é«˜ï¼šç²¾ç¡®æŒ‡å®š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æµ‹è¯•å¦‚æœå¯¹åŒä¸€å±æ€§è¿›è¡Œçš„ @Autowired æ³¨å…¥ã€AUTOWIRE_BY_NAMEã€ç²¾ç¡®æŒ‡å®šæ³¨å…¥åç§°, ä¼˜å…ˆçº§æ˜¯æ€æ ·çš„</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInjection</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; &#123;</span><br><span class="line">            <span class="comment">// ä¼˜å…ˆçº§æœ€é«˜çš„ï¼šç²¾ç¡®æŒ‡å®šæ³¨å…¥ bean çš„åç§° &lt;property name=&quot;bean3&quot; ref=&quot;bean2&quot;/&gt;</span></span><br><span class="line">            bd.getPropertyValues().add(<span class="string">&quot;bean3&quot;</span>, <span class="keyword">new</span> <span class="title class_">RuntimeBeanReference</span>(<span class="string">&quot;bean2&quot;</span>));</span><br><span class="line">            <span class="comment">// ä¼˜å…ˆçº§æ¬¡ä¹‹çš„ï¼šé€šè¿‡ AUTOWIRE_BY_NAME åŒ¹é…</span></span><br><span class="line">            ((RootBeanDefinition) bd).setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_NAME);</span><br><span class="line">        &#125;);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean2&quot;</span>, Bean2.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean3&quot;</span>, Bean3.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;bean4&quot;</span>, Bean4.class);</span><br><span class="line"></span><br><span class="line">        context.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        MyInterface bean;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä¼˜å…ˆçº§æœ€ä½çš„ï¼š@Autowired åŒ¹é…</span></span><br><span class="line">        <span class="meta">@Autowired</span> <span class="meta">@Qualifier(&quot;bean4&quot;)</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean3</span><span class="params">(MyInterface bean)</span> &#123;</span><br><span class="line">            System.out.println(bean);</span><br><span class="line">            <span class="built_in">this</span>.bean = bean;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean3</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean4</span> <span class="keyword">implements</span> <span class="title class_">MyInterface</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-3-åˆå§‹åŒ–"><a href="#5-3-åˆå§‹åŒ–" class="headerlink" title="5.3 åˆå§‹åŒ–"></a>5.3 åˆå§‹åŒ–</h3><table><thead><tr><th><strong>è¦ç‚¹</strong></th><th><strong>æ€»ç»“</strong></th></tr></thead><tbody><tr><td><strong>å†…ç½® Aware æ¥å£çš„è£…é…</strong></td><td>åŒ…æ‹¬ BeanNameAwareï¼ŒBeanFactoryAware ç­‰</td></tr><tr><td><strong>æ‰©å±• Aware æ¥å£çš„è£…é…</strong></td><td>ç”± ApplicationContextAwareProcessor è§£æï¼Œæ‰§è¡Œæ—¶æœºåœ¨  postProcessBeforeInitialization</td></tr><tr><td><strong>@PostConstruct</strong></td><td>ç”± CommonAnnotationBeanPostProcessor è§£æï¼Œæ‰§è¡Œæ—¶æœºåœ¨ postProcessBeforeInitialization</td></tr><tr><td><strong>InitializingBean</strong></td><td>é€šè¿‡æ¥å£å›è°ƒæ‰§è¡Œåˆå§‹åŒ–</td></tr><tr><td><strong>initMethod</strong></td><td>æ ¹æ® BeanDefinition å¾—åˆ°çš„åˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œåˆå§‹åŒ–ï¼Œå³ <code>&lt;bean init-method&gt;</code>æˆ–@Bean(initMethod)</td></tr><tr><td><strong>åˆ›å»º aop ä»£ç†</strong></td><td>ç”± AnnotationAwareAspectJAutoProxyCreator åˆ›å»ºï¼Œæ‰§è¡Œæ—¶æœºåœ¨postProcessAfterInitialization</td></tr></tbody></table><p>ä¼˜å…ˆçº§ï¼š4-&gt;2-&gt;1-&gt;3</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInitialization</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(CommonAnnotationBeanPostProcessor.class);</span><br><span class="line">        <span class="comment">// &lt;bean init-method=&quot;initMethod&quot;&gt;</span></span><br><span class="line">        context.registerBean(<span class="string">&quot;bean1&quot;</span>, Bean1.class, bd -&gt; bd.setInitMethodName(<span class="string">&quot;initMethod&quot;</span>));</span><br><span class="line">        context.refresh();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span>, BeanFactoryAware &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">            System.out.println(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">initMethod</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="number">3</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">            System.out.println(<span class="number">4</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="5-4-æ³¨å†Œå¯é”€æ¯bean"><a href="#5-4-æ³¨å†Œå¯é”€æ¯bean" class="headerlink" title="5.4 æ³¨å†Œå¯é”€æ¯bean"></a>5.4 æ³¨å†Œå¯é”€æ¯bean</h3><p>åœ¨è¿™ä¸€æ­¥åˆ¤æ–­å¹¶ç™»è®°å¯é”€æ¯ bean</p><ul><li><p>åˆ¤æ–­ä¾æ® </p></li><li><ul><li>å¦‚æœå®ç°äº† DisposableBean æˆ– AutoCloseable æ¥å£ï¼Œåˆ™ä¸ºå¯é”€æ¯ bean</li><li>å¦‚æœè‡ªå®šä¹‰äº† destroyMethodï¼Œåˆ™ä¸ºå¯é”€æ¯ bean</li><li>å¦‚æœé‡‡ç”¨ @Bean  æ²¡æœ‰æŒ‡å®š destroyMethodï¼Œåˆ™é‡‡ç”¨è‡ªåŠ¨æ¨æ–­æ–¹å¼è·å–é”€æ¯æ–¹æ³•åï¼ˆcloseï¼Œshutdownï¼‰ </li><li>å¦‚æœæœ‰ @PreDestroy  æ ‡æ³¨çš„æ–¹æ³•</li></ul></li><li><p>å­˜å‚¨ä½ç½® </p></li><li><ul><li>singleton scope çš„å¯é”€æ¯ bean ä¼šå­˜å‚¨äº beanFactory çš„æˆå‘˜å½“ä¸­</li><li>è‡ªå®šä¹‰ scope çš„å¯é”€æ¯ bean ä¼šå­˜å‚¨äºå¯¹åº”çš„åŸŸå¯¹è±¡å½“ä¸­</li><li>prototype scope ä¸ä¼šå­˜å‚¨ï¼Œéœ€è¦è‡ªå·±æ‰¾åˆ°æ­¤å¯¹è±¡é”€æ¯</li></ul></li><li><p>å­˜å‚¨æ—¶éƒ½ä¼šå°è£…ä¸º DisposableBeanAdapter ç±»å‹å¯¹é”€æ¯æ–¹æ³•çš„è°ƒç”¨è¿›è¡Œé€‚é…</p></li></ul><h2 id="ğŸé˜¶æ®µ6-ç±»å‹è½¬æ¢"><a href="#ğŸé˜¶æ®µ6-ç±»å‹è½¬æ¢" class="headerlink" title="ğŸé˜¶æ®µ6  ç±»å‹è½¬æ¢"></a>ğŸé˜¶æ®µ6  ç±»å‹è½¬æ¢</h2><p>å¦‚æœ getBean çš„ requiredType å‚æ•°ä¸å®é™…å¾—åˆ°çš„å¯¹è±¡ç±»å‹ä¸åŒï¼Œä¼šå°è¯•è¿›è¡Œ<strong>ç±»å‹è½¬æ¢</strong></p><h2 id="ğŸé˜¶æ®µ7-é”€æ¯-bean"><a href="#ğŸé˜¶æ®µ7-é”€æ¯-bean" class="headerlink" title="ğŸé˜¶æ®µ7  é”€æ¯ bean"></a>ğŸé˜¶æ®µ7  é”€æ¯ bean</h2><ul><li><p>é”€æ¯æ—¶æœº</p></li><li><ul><li>singleton bean çš„é”€æ¯åœ¨ ApplicationContext.close æ—¶ï¼Œæ­¤æ—¶ä¼šæ‰¾åˆ°æ‰€æœ‰ DisposableBean çš„åå­—ï¼Œé€ä¸€é”€æ¯</li><li>è‡ªå®šä¹‰ scope bean çš„é”€æ¯åœ¨ä½œç”¨åŸŸå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶</li><li>prototype bean çš„é”€æ¯å¯ä»¥é€šè¿‡è‡ªå·±æ‰‹åŠ¨è°ƒç”¨ AutowireCapableBeanFactory.destroyBean æ–¹æ³•æ‰§è¡Œé”€æ¯</li></ul></li><li><p>åŒä¸€ bean ä¸­ä¸åŒå½¢å¼é”€æ¯æ–¹æ³•çš„è°ƒç”¨æ¬¡åº </p></li><li><ul><li>ä¼˜å…ˆåå¤„ç†å™¨é”€æ¯ï¼Œå³ @PreDestroy  </li><li>å…¶æ¬¡ DisposableBean æ¥å£é”€æ¯</li><li>æœ€å destroyMethod é”€æ¯ï¼ˆåŒ…æ‹¬è‡ªå®šä¹‰åç§°ï¼Œæ¨æ–­åç§°ï¼ŒAutoCloseable æ¥å£ å¤šé€‰ä¸€ï¼‰</li></ul></li></ul>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>IOCåˆå§‹åŒ–æµç¨‹</title>
      <link href="/posts/57880/"/>
      <url>/posts/57880/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸIOCåˆå§‹åŒ–"><a href="#ğŸIOCåˆå§‹åŒ–" class="headerlink" title="ğŸIOCåˆå§‹åŒ–"></a>ğŸIOCåˆå§‹åŒ–</h2><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨Springä¸­ï¼ŒIOCçš„æœ¬è´¨æ˜¯å®¹å™¨å¯¹beançš„ç®¡ç†ï¼ŒIoCå®¹å™¨çš„æ¥å£ç±»æ˜¯ApplicationContextï¼Œå®¹å™¨å¿…é¡»è°ƒç”¨ refresh æ‰èƒ½æ­£å¸¸å·¥ä½œ</p><h3 id="refreshæºç "><a href="#refreshæºç " class="headerlink" title="refreshæºç "></a>refreshæºç </h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">refresh</span><span class="params">()</span> <span class="keyword">throws</span> BeansException, IllegalStateException &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (<span class="built_in">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">        <span class="type">StartupStep</span> <span class="variable">contextRefresh</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.refresh&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">        prepareRefresh();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">        <span class="type">ConfigurableListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> obtainFreshBeanFactory();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">        prepareBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">            postProcessBeanFactory(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="type">StartupStep</span> <span class="variable">beanPostProcess</span> <span class="operator">=</span> <span class="built_in">this</span>.applicationStartup.start(<span class="string">&quot;spring.context.beans.post-process&quot;</span>);</span><br><span class="line">            <span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">            invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">            registerBeanPostProcessors(beanFactory);</span><br><span class="line">            beanPostProcess.end();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize message source for this context.</span></span><br><span class="line">            initMessageSource();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">            initApplicationEventMulticaster();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">            onRefresh();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">            registerListeners();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">            finishBeanFactoryInitialization(beanFactory);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">            finishRefresh();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">            <span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">                logger.warn(<span class="string">&quot;Exception encountered during context initialization - &quot;</span> +</span><br><span class="line">                        <span class="string">&quot;cancelling refresh attempt: &quot;</span> + ex);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">            destroyBeans();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset &#x27;active&#x27; flag.</span></span><br><span class="line">            cancelRefresh(ex);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Propagate exception to caller.</span></span><br><span class="line">            <span class="keyword">throw</span> ex;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">// Reset common introspection caches in Spring&#x27;s core, since we</span></span><br><span class="line">            <span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">            resetCommonCaches();</span><br><span class="line">            contextRefresh.end();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ³•æ€»ç»“"><a href="#æ–¹æ³•æ€»ç»“" class="headerlink" title="æ–¹æ³•æ€»ç»“"></a>æ–¹æ³•æ€»ç»“</h3><p>refreshä¸­ä¸»è¦ä¼šè°ƒ12ä¸ªæ–¹æ³•</p><ol><li>prepareRefreshâ€”â€”åšå¥½å‡†å¤‡å·¥ä½œ</li><li>obtainFreshBeanFactoryâ€”â€”åˆ›å»ºæˆ–è·å–BeanFactory</li><li>prepareBeanFactoryâ€”â€”å‡†å¤‡BeanFactory</li><li>postProcessBeanFactoryâ€”â€”å­ç±»æ‰©å±•BeanFactory</li><li>invokeBeanFactoryPostProcessors â€”â€”åå¤„ç†æ‰©å±•BeanFactory</li><li>registerBeanPostProcessorsâ€”â€”å‡†å¤‡Beanåå¤„ç†å™¨</li><li>initMessageSourceâ€”â€”ä¸ºApplicationContextæä¾›å›½é™…åŒ–åŠŸèƒ½</li><li>initApplicationEventMulticasterâ€”â€”ä¸ºApplicationContextæä¾›äº‹ä»¶å‘å¸ƒå™¨</li><li>onRefreshâ€”â€”ç•™ç»™å­ç±»æ‰©å±•</li><li>registerListenersâ€”â€”ä¸ºApplicationContextå‡†å¤‡ç›‘å¬å™¨</li><li>finishBeanFactoryInitializationâ€”â€”åˆå§‹åŒ–å•ä¾‹Beanï¼Œæ‰§è¡ŒBeanåå¤„ç†å™¨æ‰©å±•</li><li>finishRefreshâ€”â€”å‡†å¤‡ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼Œå‘å¸ƒContextRefreshedäº‹ä»¶</li></ol><p><strong>åŠŸèƒ½åˆ†ç±»</strong></p><p> ã€1ã€‘ ä¸ºå‡†å¤‡ç¯å¢ƒ </p><p> <strong>ã€2 3 4 5 6ã€‘ ä¸ºå‡†å¤‡ BeanFactoryï¼ˆé‡ç‚¹ï¼‰</strong> </p><p> ã€7 8 9 10 12ã€‘ ä¸ºå‡†å¤‡ ApplicationContext </p><p> ã€11ã€‘ ä¸ºåˆå§‹åŒ– BeanFactory ä¸­éå»¶è¿Ÿå•ä¾‹ bean</p><h2 id="ğŸ1-prepareRefresh"><a href="#ğŸ1-prepareRefresh" class="headerlink" title="ğŸ1. prepareRefresh"></a>ğŸ1. prepareRefresh</h2><blockquote><p>è¿™ä¸€æ­¥åˆ›å»ºå’Œå‡†å¤‡äº† Environment å¯¹è±¡ï¼Œå®ƒä½œä¸º ApplicationContext çš„ä¸€ä¸ªæˆå‘˜å˜é‡</p></blockquote><p>Environment å¯¹è±¡çš„ä½œç”¨ä¹‹ä¸€æ˜¯ä¸ºåç»­ <strong>@Value</strong>ï¼Œå€¼æ³¨å…¥æ—¶æä¾›<strong>é”®å€¼</strong> </p><p>Environment åˆ†æˆä¸‰ä¸ªä¸»è¦éƒ¨åˆ†</p><ul><li><ul><li>systemProperties - ä¿å­˜ java ç¯å¢ƒé”®å€¼</li><li>systemEnvironment - ä¿å­˜ç³»ç»Ÿç¯å¢ƒé”®å€¼</li><li>è‡ªå®šä¹‰ PropertySource - ä¿å­˜è‡ªå®šä¹‰é”®å€¼ï¼Œä¾‹å¦‚æ¥è‡ªäº *.properties æ–‡ä»¶çš„é”®å€¼</li></ul></li></ul><img src="/img/57880/refresh.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¦‚ä½•è·å¾—å’Œè§£æ @Value å†…å®¹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestEnvironment</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IOException &#123;</span><br><span class="line">        <span class="comment">// 1) è·å¾— @Value çš„å€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; ä»…è·å– @Value å€¼&quot;</span>);</span><br><span class="line">        <span class="type">QualifierAnnotationAutowireCandidateResolver</span> <span class="variable">resolver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">QualifierAnnotationAutowireCandidateResolver</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">name</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;name&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(name);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2) è§£æ @Value çš„å€¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; è·å– @Value å€¼, å¹¶è§£æ$&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">javaHome</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;javaHome&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(javaHome);</span><br><span class="line">        System.out.println(getEnvironment().resolvePlaceholders(javaHome.toString()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3) è§£æ SpEL è¡¨è¾¾å¼</span></span><br><span class="line">        System.out.println(<span class="string">&quot;=======================&gt; è·å– @Value å€¼, å¹¶è§£æ#&#123;&#125;&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">expression</span> <span class="operator">=</span> resolver.getSuggestedValue(<span class="keyword">new</span> <span class="title class_">DependencyDescriptor</span>(Bean1.class.getDeclaredField(<span class="string">&quot;expression&quot;</span>), <span class="literal">false</span>));</span><br><span class="line">        System.out.println(expression);</span><br><span class="line">        <span class="type">String</span> <span class="variable">v1</span> <span class="operator">=</span> getEnvironment().resolvePlaceholders(expression.toString());</span><br><span class="line">        System.out.println(v1);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">StandardBeanExpressionResolver</span>().evaluate(v1, <span class="keyword">new</span> <span class="title class_">BeanExpressionContext</span>(<span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>(),<span class="literal">null</span>)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Environment <span class="title function_">getEnvironment</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">StandardEnvironment</span> <span class="variable">env</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StandardEnvironment</span>();</span><br><span class="line">        env.getPropertySources().addLast(<span class="keyword">new</span> <span class="title class_">ResourcePropertySource</span>(<span class="string">&quot;jdbc&quot;</span>, <span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;jdbc.properties&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> env;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        <span class="meta">@Value(&quot;hello&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;$&#123;jdbc.username&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String javaHome;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Value(&quot;#&#123;&#x27;class version:&#x27; + &#x27;$&#123;java.class.version&#125;&#x27;&#125;&quot;)</span></span><br><span class="line">        <span class="keyword">private</span> String expression;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ2-obtainFreshBeanFactory"><a href="#ğŸ2-obtainFreshBeanFactory" class="headerlink" title="ğŸ2. obtainFreshBeanFactory"></a>ğŸ2. obtainFreshBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥è·å–ï¼ˆæˆ–åˆ›å»ºï¼‰ BeanFactoryï¼Œå®ƒä¹Ÿæ˜¯ä½œä¸º ApplicationContext çš„ä¸€ä¸ªæˆå‘˜å˜é‡</p></blockquote><p><strong>BeanFactory çš„ä½œç”¨æ˜¯è´Ÿè´£ bean çš„åˆ›å»ºã€ä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ï¼Œbean çš„å„é¡¹ç‰¹å¾ç”± BeanDefinition å®šä¹‰</strong> </p><ul><li><ul><li>BeanDefinition ä½œä¸º bean çš„è®¾è®¡è“å›¾ï¼Œè§„å®šäº† bean çš„ç‰¹å¾ï¼Œå¦‚å•ä¾‹å¤šä¾‹ã€ä¾èµ–å…³ç³»ã€åˆå§‹é”€æ¯æ–¹æ³•ç­‰</li><li>BeanDefinition çš„æ¥æºæœ‰å¤šç§å¤šæ ·ï¼Œå¯ä»¥æ˜¯é€šè¿‡ xml è·å¾—ã€é…ç½®ç±»è·å¾—ã€ç»„ä»¶æ‰«æè·å¾—ï¼Œä¹Ÿå¯ä»¥æ˜¯ç¼–ç¨‹æ·»åŠ </li></ul></li></ul><p>æ‰€æœ‰çš„ BeanDefinition ä¼šå­˜å…¥ BeanFactory ä¸­çš„ <strong>beanDefinitionMap</strong> é›†åˆ</p><img src="/img/57880/refresh2.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¼”ç¤ºå„ç§ BeanDefinition çš„æ¥æº</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanDefinition</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; ä¸€å¼€å§‹&quot;</span>);</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultListableBeanFactory</span>();</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 1) ä» xml è·å– &quot;</span>);</span><br><span class="line">        <span class="type">XmlBeanDefinitionReader</span> <span class="variable">reader1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanDefinitionReader</span>(beanFactory);</span><br><span class="line">        reader1.loadBeanDefinitions(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;bd.xml&quot;</span>));</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames())); </span><br><span class="line">        <span class="comment">//[bean1]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 2) ä»é…ç½®ç±»è·å– &quot;</span>);</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;config1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Config1.class).getBeanDefinition());</span><br><span class="line">    <span class="comment">// è¯†åˆ«å¤„ç†bean</span></span><br><span class="line">        <span class="type">ConfigurationClassPostProcessor</span> <span class="variable">postProcessor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConfigurationClassPostProcessor</span>();</span><br><span class="line">        postProcessor.postProcessBeanDefinitionRegistry(beanFactory);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">    <span class="comment">//[bean1,config1,bean2]</span></span><br><span class="line">        System.out.println(<span class="string">&quot;========================&gt; 3) æ‰«æè·å– &quot;</span>);</span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(beanFactory);</span><br><span class="line">        scanner.scan(<span class="string">&quot;day04.refresh.sub&quot;</span>);</span><br><span class="line">        System.out.println(Arrays.toString(beanFactory.getBeanDefinitionNames()));</span><br><span class="line">        <span class="comment">//[bean1,config1,bean2,bean3,å…¶ä»–å’ŒåŒ…æ‰«æç›¸å…³çš„bean]</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Config1</span> &#123;</span><br><span class="line">        <span class="meta">@Bean</span></span><br><span class="line">        <span class="keyword">public</span> Bean2 <span class="title function_">bean2</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Bean2</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ3-prepareBeanFactory"><a href="#ğŸ3-prepareBeanFactory" class="headerlink" title="ğŸ3. prepareBeanFactory"></a>ğŸ3. prepareBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šè¿›ä¸€æ­¥<strong>å®Œå–„ BeanFactory</strong>ï¼Œä¸ºå®ƒçš„å„é¡¹æˆå‘˜å˜é‡èµ‹å€¼</p></blockquote><p>beanExpressionResolver ç”¨æ¥è§£æ SpELï¼Œå¸¸è§å®ç°ä¸º StandardBeanExpressionResolver</p><p>propertyEditorRegistrars ä¼šæ³¨å†Œç±»å‹è½¬æ¢å™¨ </p><ul><li><ul><li>å®ƒåœ¨è¿™é‡Œä½¿ç”¨äº† ResourceEditorRegistrar å®ç°ç±»</li><li>å¹¶åº”ç”¨ ApplicationContext æä¾›çš„ Environment å®Œæˆ ${ } è§£æ</li></ul></li></ul><p>registerResolvableDependency æ¥æ³¨å†Œ beanFactory ä»¥åŠ ApplicationContextï¼Œè®©å®ƒä»¬ä¹Ÿèƒ½ç”¨äºä¾èµ–æ³¨å…¥</p><p>beanPostProcessors æ˜¯ bean åå¤„ç†å™¨é›†åˆï¼Œä¼šå·¥ä½œåœ¨ bean çš„ç”Ÿå‘½å‘¨æœŸå„ä¸ªé˜¶æ®µï¼Œæ­¤å¤„ä¼šæ·»åŠ ä¸¤ä¸ªï¼š </p><ul><li><ul><li>ApplicationContextAwareProcessor ç”¨æ¥è§£æ Aware æ¥å£</li><li>ApplicationListenerDetector ç”¨æ¥è¯†åˆ«å®¹å™¨ä¸­ ApplicationListener ç±»å‹çš„ bean</li></ul></li></ul><img src="/img/57880/refresh3.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ4-postProcessBeanFactory"><a href="#ğŸ4-postProcessBeanFactory" class="headerlink" title="ğŸ4. postProcessBeanFactory"></a>ğŸ4. postProcessBeanFactory</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç©ºå®ç°ï¼Œç•™ç»™å­ç±»æ‰©å±•</p></blockquote><p>ä¸€èˆ¬ Web ç¯å¢ƒçš„ ApplicationContext éƒ½è¦åˆ©ç”¨å®ƒæ³¨å†Œæ–°çš„ Scopeï¼Œå®Œå–„ Web ä¸‹çš„ BeanFactory</p><p>è¿™é‡Œä½“ç°çš„æ˜¯<strong>æ¨¡æ¿æ–¹æ³•</strong>è®¾è®¡æ¨¡å¼</p><h2 id="ğŸ5-invokeBeanFactoryPostProcessors"><a href="#ğŸ5-invokeBeanFactoryPostProcessors" class="headerlink" title="ğŸ5. invokeBeanFactoryPostProcessors"></a>ğŸ5. invokeBeanFactoryPostProcessors</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šè°ƒç”¨ beanFactory åå¤„ç†å™¨</p></blockquote><p>beanFactory åå¤„ç†å™¨ï¼Œå……å½“ beanFactory çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥ç”¨æ¥<strong>è¡¥å……æˆ–ä¿®æ”¹</strong> BeanDefinition</p><p>å¸¸è§çš„ beanFactory åå¤„ç†å™¨æœ‰ </p><ul><li><ul><li><strong>ConfigurationClassPostProcessor</strong> â€“ è§£æ @Configurationã€@Beanã€@Importã€@PropertySource  ç­‰ </li><li>PropertySourcesPlaceHolderConfigurer â€“ æ›¿æ¢ BeanDefinition ä¸­çš„ ${ }</li><li>MapperScannerConfigurer â€“ è¡¥å…… Mapper æ¥å£å¯¹åº”çš„ BeanDefinition</li></ul></li></ul><img src="/img/57880/refresh4.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ6-registerBeanPostProcessors"><a href="#ğŸ6-registerBeanPostProcessors" class="headerlink" title="ğŸ6. registerBeanPostProcessors"></a>ğŸ6. registerBeanPostProcessors</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç»§ç»­ä» beanFactory ä¸­æ‰¾å‡º bean åå¤„ç†å™¨ï¼Œæ·»åŠ è‡³ beanPostProcessors é›†åˆä¸­</p></blockquote><p>bean åå¤„ç†å™¨ï¼Œå……å½“ bean çš„æ‰©å±•ç‚¹ï¼Œå¯ä»¥å·¥ä½œåœ¨ bean çš„å®ä¾‹åŒ–ã€ä¾èµ–æ³¨å…¥ã€åˆå§‹åŒ–é˜¶æ®µï¼Œå¸¸è§çš„æœ‰ï¼š </p><ul><li><ul><li><strong>Autowired</strong>AnnotationBeanPostProcessor åŠŸèƒ½æœ‰ï¼šè§£æ <strong>@Autowiredï¼Œ@Value</strong>  æ³¨è§£ </li><li>CommonAnnotationBeanPostProcessor åŠŸèƒ½æœ‰ï¼šè§£æ @Resourceï¼Œ@PostConstructï¼Œ@PreDestroy  </li><li>AnnotationAwareAspectJAutoProxyCreator åŠŸèƒ½æœ‰ï¼šä¸ºç¬¦åˆ<strong>åˆ‡ç‚¹çš„ç›®æ ‡</strong> bean è‡ªåŠ¨åˆ›å»ºä»£ç†</li></ul></li></ul><img src="/img/57880/refresh5.png" alt="img" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestBeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        <span class="type">DefaultListableBeanFactory</span> <span class="variable">beanFactory</span> <span class="operator">=</span> context.getDefaultListableBeanFactory();</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean1.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean2&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean2.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;bean3&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Bean3.class).getBeanDefinition());</span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;aspect1&quot;</span>, BeanDefinitionBuilder.genericBeanDefinition(Aspect1.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// è¾“å‡ºï¼šfoo(ä»…è°ƒç”¨fooæ–¹æ³•)</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor1&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AutowiredAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// å¤šè¾“å‡ºï¼š&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot; + bean2</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor2&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(CommonAnnotationBeanPostProcessor.class).getBeanDefinition());</span><br><span class="line">        <span class="comment">// å¤šè¾“å‡ºï¼š&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot; + bean3</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;processor3&quot;</span>,</span><br><span class="line">                                           BeanDefinitionBuilder.genericBeanDefinition(AnnotationAwareAspectJAutoProxyCreator.class).getBeanDefinition());</span><br><span class="line">    <span class="comment">// åœ¨fooå‰å¤šè¾“å‡ºï¼šbefore...</span></span><br><span class="line">        context.refresh();</span><br><span class="line">        beanFactory.getBean(Bean1.class).foo();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean1</span> &#123;</span><br><span class="line">        Bean2 bean2;</span><br><span class="line">        Bean3 bean3;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Autowired</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean2</span><span class="params">(Bean2 bean2)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot;</span> + bean2);</span><br><span class="line">            <span class="built_in">this</span>.bean2 = bean2;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Resource</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBean3</span><span class="params">(Bean3 bean3)</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;å‘ç”Ÿäº†ä¾èµ–æ³¨å…¥...&quot;</span> + bean3);</span><br><span class="line">            <span class="built_in">this</span>.bean3 = bean3;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;foo&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean2</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Bean3</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Aspect</span></span><br><span class="line">        <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Aspect1</span> &#123;</span><br><span class="line">            <span class="meta">@Before(&quot;execution(* foo())&quot;)</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;before...&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ7-initMessageSource"><a href="#ğŸ7-initMessageSource" class="headerlink" title="ğŸ7. initMessageSource"></a>ğŸ7. initMessageSource</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ä¸º ApplicationContext æ·»åŠ  messageSource æˆå‘˜ï¼Œå®ç°<strong>å›½é™…åŒ–</strong>åŠŸèƒ½</p></blockquote><p>å» beanFactory å†…æ‰¾åä¸º messageSource çš„ beanï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æä¾›ç©ºçš„ MessageSource å®ç°</p><img src="/img/57880/refresh6.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ8-initApplicationContextEventMulticaster"><a href="#ğŸ8-initApplicationContextEventMulticaster" class="headerlink" title="ğŸ8. initApplicationContextEventMulticaster"></a>ğŸ8. initApplicationContextEventMulticaster</h2><blockquote><p>è¿™ä¸€æ­¥ä¸º ApplicationContext æ·»åŠ <strong>äº‹ä»¶å¹¿æ’­å™¨</strong>æˆå‘˜ï¼Œå³ applicationContextEventMulticasterï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘å¸ƒäº‹ä»¶ç»™ç›‘å¬å™¨</p></blockquote><p>å» beanFactory æ‰¾åä¸º applicationEventMulticaster çš„ bean ä½œä¸ºäº‹ä»¶å¹¿æ’­å™¨ï¼Œè‹¥æ²¡æœ‰ï¼Œä¼šåˆ›å»ºé»˜è®¤çš„äº‹ä»¶å¹¿æ’­å™¨</p><p>ä¹‹åå°±å¯ä»¥è°ƒç”¨ ApplicationContext.publishEvent(äº‹ä»¶å¯¹è±¡) æ¥å‘å¸ƒäº‹ä»¶</p><img src="/img/57880/refresh7.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ9-onRefresh"><a href="#ğŸ9-onRefresh" class="headerlink" title="ğŸ9. onRefresh"></a>ğŸ9. onRefresh</h2><blockquote><p>è¿™ä¸€æ­¥æ˜¯ç©ºå®ç°ï¼Œç•™ç»™å­ç±»æ‰©å±•</p></blockquote><p>SpringBoot ä¸­çš„å­ç±»åœ¨è¿™é‡Œå‡†å¤‡äº† WebServerï¼Œå³å†…åµŒ web å®¹å™¨(Tomcat)</p><p>ä½“ç°çš„æ˜¯æ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼</p><h2 id="ğŸ10-registerListeners"><a href="#ğŸ10-registerListeners" class="headerlink" title="ğŸ10. registerListeners"></a>ğŸ10. registerListeners</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šä»å¤šç§é€”å¾„æ‰¾åˆ°äº‹ä»¶ç›‘å¬å™¨ï¼Œå¹¶æ·»åŠ è‡³ applicationEventMulticaster</p></blockquote><p>äº‹ä»¶ç›‘å¬å™¨é¡¾åæ€ä¹‰ï¼Œç”¨æ¥æ¥æ”¶äº‹ä»¶å¹¿æ’­å™¨å‘å¸ƒçš„äº‹ä»¶ï¼Œæœ‰å¦‚ä¸‹æ¥æº </p><ul><li><ul><li>äº‹å…ˆç¼–ç¨‹æ·»åŠ çš„</li><li>æ¥è‡ªå®¹å™¨ä¸­çš„ bean</li><li>æ¥è‡ªäº @EventListener  çš„è§£æ</li></ul></li></ul><p>è¦å®ç°äº‹ä»¶ç›‘å¬å™¨ï¼Œåªéœ€è¦å®ç° ApplicationListener æ¥å£ï¼Œé‡å†™å…¶ä¸­ onApplicationEvent(E e) æ–¹æ³•å³å¯</p><img src="/img/57880/refresh8.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ11-finishBeanFactoryInitialization"><a href="#ğŸ11-finishBeanFactoryInitialization" class="headerlink" title="ğŸ11. finishBeanFactoryInitialization"></a>ğŸ11. finishBeanFactoryInitialization</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šå°† beanFactory çš„æˆå‘˜è¡¥å……å®Œæ¯•ï¼Œå¹¶åˆå§‹åŒ–æ‰€æœ‰éå»¶è¿Ÿå•ä¾‹ bean</p></blockquote><p>conversionService ä¹Ÿæ˜¯ä¸€å¥—è½¬æ¢æœºåˆ¶ï¼Œä½œä¸ºå¯¹ PropertyEditor çš„è¡¥å……</p><p>embeddedValueResolvers å³<strong>å†…åµŒå€¼</strong>è§£æå™¨ï¼Œç”¨æ¥è§£æ @Value  ä¸­çš„ ${ }ï¼Œå€Ÿç”¨çš„æ˜¯ Environment çš„åŠŸèƒ½ </p><p>singletonObjects å³å•ä¾‹æ± ï¼Œç¼“å­˜æ‰€æœ‰å•ä¾‹å¯¹è±¡ </p><ul><li><ul><li>å¯¹è±¡çš„åˆ›å»ºéƒ½åˆ†ä¸‰ä¸ªé˜¶æ®µï¼Œæ¯ä¸€é˜¶æ®µéƒ½æœ‰ä¸åŒçš„ bean åå¤„ç†å™¨å‚ä¸è¿›æ¥ï¼Œæ‰©å±•åŠŸèƒ½</li></ul></li></ul><img src="/img/57880/refresh9.png" alt="img" style="zoom:67%;" /><h2 id="ğŸ12-finishRefresh"><a href="#ğŸ12-finishRefresh" class="headerlink" title="ğŸ12. finishRefresh"></a>ğŸ12. finishRefresh</h2><blockquote><p>è¿™ä¸€æ­¥ä¼šä¸º ApplicationContext æ·»åŠ  lifecycleProcessor æˆå‘˜ï¼Œç”¨æ¥æ§åˆ¶å®¹å™¨å†…<strong>éœ€è¦ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>çš„ bean</p></blockquote><p>å¦‚æœå®¹å™¨ä¸­æœ‰åç§°ä¸º lifecycleProcessor çš„ bean å°±ç”¨å®ƒï¼Œå¦åˆ™åˆ›å»ºé»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨</p><p>å‡†å¤‡å¥½ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨ï¼Œå°±å¯ä»¥å®ç° </p><ul><li><ul><li>è°ƒç”¨ context çš„ startï¼Œå³å¯è§¦å‘æ‰€æœ‰å®ç° LifeCycle æ¥å£ bean çš„ start</li><li>è°ƒç”¨ context çš„ stopï¼Œå³å¯è§¦å‘æ‰€æœ‰å®ç° LifeCycle æ¥å£ bean çš„ stop</li></ul></li></ul><p>å‘å¸ƒ ContextRefreshed äº‹ä»¶ï¼Œæ•´ä¸ª refresh æ‰§è¡Œå®Œæˆ</p><img src="/img/57880/refresh10.png" alt="img" style="zoom:67%;" />]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Springå¾ªç¯ä¾èµ–</title>
      <link href="/posts/40377/"/>
      <url>/posts/40377/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ"><a href="#ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ" class="headerlink" title="ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ"></a>ğŸå¾ªç¯ä¾èµ–çš„äº§ç”Ÿ</h2><p>bean çš„åˆ›å»ºè¦éµå¾ªä¸€å®šçš„æ­¥éª¤ï¼Œå¿…é¡»æ˜¯<strong>åˆ›å»ºã€æ³¨å…¥ã€åˆå§‹åŒ–</strong>ä¸‰æ­¥ï¼Œé¡ºåºä¸èƒ½ä¹±ï¼š</p><img src="/img/40377/ReDI1.png" alt="image-20210903085238916.png" style="zoom: 67%;" /><h3 id="set-æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰"><a href="#set-æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰" class="headerlink" title="set æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰"></a>set æ–¹æ³•ï¼ˆåŒ…æ‹¬æˆå‘˜å˜é‡ï¼‰çš„å¾ªç¯ä¾èµ–ï¼ˆå±æ€§ä¾èµ–ï¼‰</h3><p>å¦‚Aä¸­éœ€è¦setBï¼ŒBä¸­éœ€è¦setAï¼Œè¯´æ˜ï¼š</p><img src="/img/40377/ReDI2.png" alt="image-20210903085454603.png" style="zoom: 50%;" /><p>å¯ä»¥åœ¨ã€a åˆ›å»ºã€‘å’Œã€a set æ³¨å…¥ bã€‘ä¹‹é—´åŠ å…¥ b çš„æ•´ä¸ªæµç¨‹æ¥è§£å†³ ï¼Œã€b set æ³¨å…¥ aã€‘ æ—¶å¯ä»¥æˆåŠŸï¼Œå› ä¸ºä¹‹å‰ a çš„å®ä¾‹å·²ç»åˆ›å»ºå®Œæ¯• ï¼Œè¿™æ · a çš„é¡ºåºï¼ŒåŠ b çš„é¡ºåºéƒ½èƒ½å¾—åˆ°ä¿éšœ</p><h3 id="æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–"><a href="#æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–" class="headerlink" title="æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–"></a>æ„é€ æ–¹æ³•çš„å¾ªç¯ä¾èµ–</h3><p>Açš„æ„é€ å‡½æ•°ä¼ å…¥Bï¼ŒBçš„æ„é€ å‡½æ•°ä¼ å…¥Aï¼Œè¯´æ˜ï¼š</p><img src="/img/40377/ReDI3.png" alt="image-20210903085906315.png" style="zoom:50%;" /><h2 id="ğŸè§£å†³setå¾ªç¯ä¾èµ–"><a href="#ğŸè§£å†³setå¾ªç¯ä¾èµ–" class="headerlink" title="ğŸè§£å†³setå¾ªç¯ä¾èµ–"></a>ğŸè§£å†³setå¾ªç¯ä¾èµ–</h2><p>Springæä¾›äº†ä¸‰çº§ç¼“å­˜è§£å†³è¿™ç±»å¾ªç¯ä¾èµ–é—®é¢˜</p><p>ğŸš©æ³¨æ„ï¼šè¿™é‡Œçš„ä¸€çº§äºŒçº§ä¸‰çº§æ¦‚å¿µä¸ä¸€å®šä¸Springç›¸åŒï¼Œé‡è¦çš„æ˜¯ç†è§£æµç¨‹</p><h3 id="ä¸€çº§ç¼“å­˜â€”â€”singletonObjects"><a href="#ä¸€çº§ç¼“å­˜â€”â€”singletonObjects" class="headerlink" title="ä¸€çº§ç¼“å­˜â€”â€”singletonObjects"></a>ä¸€çº§ç¼“å­˜â€”â€”singletonObjects</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; singletonObjects = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;String, Object&gt;(<span class="number">256</span>);</span><br></pre></td></tr></table></figure><p>å·²ç»å®ä¾‹åŒ–å¹¶ä¸”å±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>æˆç†Ÿå¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI4.png" alt="img" style="zoom:67%;" /><p>ä½œç”¨æ˜¯ä¿è¯å•ä¾‹å¯¹è±¡<strong>ä»…è¢«åˆ›å»ºä¸€æ¬¡</strong></p><ul><li>ç¬¬ä¸€æ¬¡èµ° <code>getBean(&quot;a&quot;)</code> æµç¨‹åï¼Œæœ€åä¼šå°†<strong>æˆå“</strong> a æ”¾å…¥ <strong>singletonObjects</strong> ä¸€çº§ç¼“å­˜</li><li>åç»­å†èµ° <code>getBean(&quot;a&quot;)</code> æµç¨‹æ—¶ï¼Œ<strong>å…ˆä»ä¸€çº§ç¼“å­˜ä¸­æ‰¾</strong>ï¼Œè¿™æ—¶å·²ç»æœ‰æˆå“ aï¼Œå°±æ— éœ€å†æ¬¡åˆ›å»º</li></ul><p><strong>ä¸èƒ½è§£å†³setå¾ªç¯ä¾èµ–çš„åŸå› </strong></p><img src="/img/40377/ReDI5.png" alt="img" style="zoom:67%;" /><ul><li>æ— è®ºæ˜¯è·å– bean a è¿˜æ˜¯è·å– bean bï¼Œèµ°çš„æ–¹æ³•éƒ½æ˜¯åŒä¸€ä¸ª getBean æ–¹æ³•ï¼Œå‡è®¾å…ˆèµ° <code>getBean(&quot;a&quot;)</code></li><li>å½“ a çš„å®ä¾‹å¯¹è±¡åˆ›å»ºï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ <code>a.setB()</code> æ—¶ï¼Œéœ€è¦èµ° <code>getBean(&quot;b&quot;)</code> æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 1</li><li>å½“ b çš„å®ä¾‹å¯¹è±¡åˆ›å»ºï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ <code>b.setA()</code> æ—¶ï¼Œåˆå›åˆ°äº† <code>getBean(&quot;a&quot;)</code> çš„æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 2</li><li>ä½†æ­¤æ—¶ singletonObjects ä¸€çº§ç¼“å­˜å†…<strong>æ²¡æœ‰æˆå“</strong>çš„ aï¼Œé™·å…¥äº†æ­»å¾ªç¯</li></ul><h3 id="äºŒçº§ç¼“å­˜â€”â€”singletonFactories"><a href="#äºŒçº§ç¼“å­˜â€”â€”singletonFactories" class="headerlink" title="äºŒçº§ç¼“å­˜â€”â€”singletonFactories"></a>äºŒçº§ç¼“å­˜â€”â€”singletonFactories</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of singleton factories: bean name --&gt; ObjectFactory */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, ObjectFactory&lt;?&gt;&gt; singletonFactories = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, ObjectFactory&lt;?&gt;&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>å•ä¾‹å·¥å‚çš„ç¼“å­˜ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>åŠæˆå“å¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI6.png" alt="img" style="zoom:67%;" /><ul><li>ä¸€çº§ç¼“å­˜ä¸èƒ½è§£å†³setå¾ªç¯ä¾èµ–ï¼Œåˆ™å†å¢åŠ ä¸€ä¸ª <strong>singletonFactories</strong> ç¼“å­˜</li><li>åœ¨ä¾èµ–æ³¨å…¥å‰ï¼Œå³ <code>a.setB()</code> ä»¥åŠ <code>b.setA()</code> å°† a åŠ b çš„<strong>åŠæˆå“å¯¹è±¡</strong>ï¼ˆæœªå®Œæˆä¾èµ–æ³¨å…¥å’Œåˆå§‹åŒ–ï¼‰æ”¾å…¥æ­¤ç¼“å­˜</li><li>æ‰§è¡Œä¾èµ–æ³¨å…¥æ—¶ï¼Œå…ˆçœ‹çœ‹ singletonFactories ç¼“å­˜ä¸­æ˜¯å¦æœ‰<strong>åŠæˆå“çš„å¯¹è±¡</strong>ï¼Œå¦‚æœæœ‰æ‹¿æ¥æ³¨å…¥ï¼Œé¡ºåˆ©èµ°å®Œæµç¨‹</li></ul><p><strong>å¦‚ä½•è§£å†³setå¾ªç¯ä¾èµ–</strong></p><ul><li><code>a = new A()</code> æ‰§è¡Œä¹‹åå°±ä¼šæŠŠè¿™ä¸ªåŠæˆå“çš„ a æ”¾å…¥ <strong>singletonFactories ç¼“å­˜</strong>ï¼Œå³ <code>factories.put(a)</code></li><li>æ¥ä¸‹æ¥æ‰§è¡Œ <code>a.setB()</code>ï¼Œèµ°å…¥ <code>getBean(&quot;b&quot;)</code> æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 3</li><li>è¿™å›å†æ‰§è¡Œåˆ° <code>b.setA()</code> æ—¶ï¼Œéœ€è¦ä¸€ä¸ª a å¯¹è±¡ï¼Œæ­¤æ—¶singletonFactoriesä¸­æœ‰aå¯¹è±¡</li><li><code>factories.get()</code> åœ¨ <strong>singletonFactories  ç¼“å­˜</strong>ä¸­å°±å¯ä»¥æ‰¾åˆ°ï¼Œçº¢è‰²ç®­å¤´ 4 å’Œ 5</li><li>b çš„æµç¨‹èƒ½å¤Ÿé¡ºåˆ©èµ°å®Œï¼Œå°† b æˆå“æ”¾å…¥ singletonObject ä¸€çº§ç¼“å­˜ï¼Œè¿”å›åˆ° a çš„ä¾èµ–æ³¨å…¥æµç¨‹ï¼Œçº¢è‰²ç®­å¤´ 6</li></ul><p><strong>äºŒçº§ç¼“å­˜æ— æ³•æ­£ç¡®å¤„ç†setå¾ªç¯ä¾èµ–å¹¶ä¸”åŒ…å«æœ‰ä»£ç†åˆ›å»ºçš„åœºæ™¯</strong></p><img src="/img/40377/ReDI7.png" alt="img" style="zoom:67%;" /><ul><li>spring é»˜è®¤è¦æ±‚ï¼Œåœ¨ <code>a.init</code> å®Œæˆä¹‹åæ‰èƒ½åˆ›å»ºä»£ç† <code>pa = proxy(a)</code></li><li>ç”±äº a çš„ä»£ç†åˆ›å»ºæ—¶æœºé åï¼Œåœ¨æ‰§è¡Œ <code>factories.put(a)</code> å‘ singletonFactories ä¸­æ”¾å…¥çš„è¿˜æ˜¯<strong>åŸå§‹å¯¹è±¡</strong></li><li>æ¥ä¸‹æ¥ç®­å¤´ 3ã€4ã€5 è¿™å‡ æ­¥ b å¯¹è±¡æ‹¿åˆ°å’Œæ³¨å…¥çš„éƒ½æ˜¯åŸå§‹å¯¹è±¡ï¼Œè€Œä¸æ˜¯ä»£ç†å¯¹è±¡</li></ul><h3 id="ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects"><a href="#ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects" class="headerlink" title="ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects"></a>ä¸‰çº§ç¼“å­˜â€”â€”earlySingletonObjects</h3><p><strong>åº•å±‚ä»£ç </strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** Cache of early singleton objects: bean name --&gt; bean instance */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, Object&gt; earlySingletonObjects = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;(<span class="number">16</span>);</span><br></pre></td></tr></table></figure><p>å·²ç»å®ä¾‹åŒ–ä½†å°šæœªå±æ€§èµ‹å€¼ï¼Œè¿™é‡Œçš„å¯¹è±¡æ˜¯<strong>åŠæˆå“å¯¹è±¡</strong></p><p><strong>ç¤ºä¾‹</strong></p><img src="/img/40377/ReDI8.png" alt="img" style="zoom:67%;" /><p>æ­£å¸¸åˆ†æçš„è¯ï¼Œåªéœ€è¦å°†ä»£ç†çš„åˆ›å»ºæ—¶æœºæ”¾åœ¨ä¾èµ–æ³¨å…¥ä¹‹å‰å³å¯ï¼Œä½† spring ä»ç„¶å¸Œæœ›<strong>ä»£ç†çš„åˆ›å»ºæ—¶æœºåœ¨ init ä¹‹å</strong>ï¼Œåªæœ‰å‡ºç°å¾ªç¯ä¾èµ–æ—¶ï¼Œæ‰ä¼šå°†ä»£ç†çš„åˆ›å»ºæ—¶æœºæå‰ã€‚æ‰€ä»¥è§£å†³æ€è·¯ç¨æ˜¾å¤æ‚ï¼š</p><ul><li>å›¾ä¸­ <code>factories.put(fa)</code> æ”¾å…¥çš„æ—¢ä¸æ˜¯åŸå§‹å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯ä»£ç†å¯¹è±¡è€Œæ˜¯<strong>å·¥å‚å¯¹è±¡ fa</strong></li><li>å½“æ£€æŸ¥å‡ºå‘ç”Ÿ<strong>å¾ªç¯ä¾èµ–æ—¶ï¼Œfa çš„äº§å“å°±æ˜¯ä»£ç† pa</strong>ï¼Œ<strong>æ²¡æœ‰å‘ç”Ÿå¾ªç¯ä¾èµ–ï¼Œfa çš„äº§å“æ˜¯åŸå§‹å¯¹è±¡ a</strong></li><li>å‡è®¾å‡ºç°äº†å¾ªç¯ä¾èµ–ï¼Œæ‹¿åˆ°äº† singletonFactories ä¸­çš„å·¥å‚å¯¹è±¡ï¼Œé€šè¿‡åœ¨ä¾èµ–æ³¨å…¥å‰è·å¾—äº† paï¼Œçº¢è‰²ç®­å¤´ 5</li><li>è¿™å› <code>b.setA()</code> æ³¨å…¥çš„å°±æ˜¯ä»£ç†å¯¹è±¡ï¼Œä¿è¯äº†æ­£ç¡®æ€§ï¼Œçº¢è‰²ç®­å¤´ 7</li><li>è¿˜éœ€è¦æŠŠ pa å­˜å…¥æ–°åŠ çš„ <strong>earlySingletonObjects ç¼“å­˜</strong>ï¼Œçº¢è‰²ç®­å¤´ 6</li><li><code>a.init</code> å®Œæˆåï¼Œ<strong>æ— éœ€äºŒæ¬¡åˆ›å»ºä»£ç†</strong>ï¼ŒearlySingletonObjects å·²ç»ç¼“å­˜paï¼Œè“è‰²ç®­å¤´ 9</li></ul><p>å½“æˆå“å¯¹è±¡äº§ç”Ÿï¼Œæ”¾å…¥ singletonObject åï¼ŒsingletonFactories å’Œ earlySingletonObjects å°±ä¸­çš„å¯¹è±¡å°±æ²¡æœ‰ç”¨å¤„ï¼Œ<strong>æ¸…é™¤å³å¯</strong></p><p>ğŸš©<strong>æ€»ç»“ï¼šä¸€çº§å•ä¾‹ï¼ŒäºŒçº§setï¼Œä¸‰çº§ä»£ç†</strong></p><h2 id="ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–"><a href="#ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–" class="headerlink" title="ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–"></a>ğŸè§£å†³æ„é€ å¾ªç¯ä¾èµ–</h2><blockquote><p>å‰é¢çš„ä¸‰çº§ç¼“å­˜æ–¹æ¡ˆå¹¶ä¸èƒ½è§£å†³æ„é€ å¾ªç¯ä¾èµ–çš„é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿæœ‰åˆ«çš„æ–¹æ¡ˆ</p></blockquote><h3 id="è§£å†³æ€è·¯"><a href="#è§£å†³æ€è·¯" class="headerlink" title="è§£å†³æ€è·¯"></a>è§£å†³æ€è·¯</h3><p>æ€è·¯1</p><ul><li>a æ³¨å…¥ <strong>b çš„ä»£ç†å¯¹è±¡</strong>ï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ a çš„æµç¨‹èµ°é€š</li><li>åç»­éœ€è¦ç”¨åˆ° b çš„çœŸå®å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»£ç†é—´æ¥è®¿é—®</li></ul><img src="/img/40377/ReDI9.png" alt="img" style="zoom:67%;" /><p>æ€è·¯2</p><ul><li>a æ³¨å…¥ <strong>b çš„å·¥å‚å¯¹è±¡</strong>ï¼Œè®© b çš„å®ä¾‹åˆ›å»ºè¢«æ¨è¿Ÿï¼Œè¿™æ ·èƒ½å¤Ÿä¿è¯ a çš„æµç¨‹å…ˆèµ°é€š</li><li>åç»­éœ€è¦ç”¨åˆ° b çš„çœŸå®å¯¹è±¡æ—¶ï¼Œå†é€šè¿‡ ObjectFactory å·¥å‚é—´æ¥è®¿é—®</li></ul><img src="/img/40377/ReDI10.png" alt="img" style="zoom:67%;" /><h3 id="æ–¹æ¡ˆ1"><a href="#æ–¹æ¡ˆ1" class="headerlink" title="æ–¹æ¡ˆ1"></a>æ–¹æ¡ˆ1</h3><p><strong>ç”¨ @Lazy ä¸ºæ„é€ æ–¹æ³•å‚æ•°ç”Ÿæˆä»£ç†ï¼ˆæ€è·¯1ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_1</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> B b;</span><br><span class="line">    <span class="comment">// åˆ›å»ºBçš„ä»£ç†</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(<span class="meta">@Lazy</span> B b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(B b) &#123;&#125;&quot;</span>, b.getClass());</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ2"><a href="#æ–¹æ¡ˆ2" class="headerlink" title="æ–¹æ¡ˆ2"></a>æ–¹æ¡ˆ2</h3><p><strong>ç”¨ ObjectProviderå»¶è¿Ÿä¾èµ–å¯¹è±¡çš„åˆ›å»ºï¼ˆæ€è·¯2ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_2</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> ObjectProvider&lt;B&gt; b;</span><br><span class="line">    <span class="comment">// ObjectProvideræ˜¯ObjectFactoryçš„å­ç±»å‹</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(ObjectProvider&lt;B&gt; b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(&#123;&#125;)&quot;</span>, b);</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">    <span class="comment">// b.getObject()è·å¾—çœŸæ­£çš„b</span></span><br><span class="line">        System.out.println(context.getBean(A.class).b.getObject());</span><br><span class="line">        System.out.println(context.getBean(B.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ3"><a href="#æ–¹æ¡ˆ3" class="headerlink" title="æ–¹æ¡ˆ3"></a>æ–¹æ¡ˆ3</h3><p><strong>ç”¨ Provider æ¥å£è§£å†³ï¼ŒåŸç†ä¸Šä¸ ObjectProvider ä¸€æ ·ï¼ŒProvider æ¥å£æ˜¯ç‹¬ç«‹çš„ jar åŒ…ï¼Œéœ€è¦åŠ å…¥ä¾èµ–ï¼ˆæ€è·¯2ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.inject&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.inject&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">1</span>&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_4</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> Provider&lt;B&gt; b;</span><br><span class="line">    <span class="comment">// å’ŒObjectProviderä¸€æ ·çš„è§£å†³æ–¹æ¡ˆ</span></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(Provider&lt;B&gt; b)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;A(&#123;&#125;&#125;)&quot;</span>, b);</span><br><span class="line">            <span class="built_in">this</span>.b = b;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;B(&#123;&#125;&#125;)&quot;</span>, a);</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@PostConstruct</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">            log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        context.registerBean(<span class="string">&quot;a&quot;</span>, A.class);</span><br><span class="line">        context.registerBean(<span class="string">&quot;b&quot;</span>, B.class);</span><br><span class="line">        AnnotationConfigUtils.registerAnnotationConfigProcessors(context.getDefaultListableBeanFactory());</span><br><span class="line">        context.refresh();</span><br><span class="line">    <span class="comment">// b.get()è·å¾—çœŸæ­£çš„b</span></span><br><span class="line">        System.out.println(context.getBean(A.class).b.get());</span><br><span class="line">        System.out.println(context.getBean(B.class));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ–¹æ¡ˆ4"><a href="#æ–¹æ¡ˆ4" class="headerlink" title="æ–¹æ¡ˆ4"></a>æ–¹æ¡ˆ4</h3><p><strong>ç”¨ @Scope äº§ç”Ÿä»£ç†ï¼ˆæ€è·¯1ï¼‰</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App60_3</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">GenericApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">GenericApplicationContext</span>();</span><br><span class="line">        <span class="comment">// æ‰«æBeanå·¥å‚</span></span><br><span class="line">        <span class="type">ClassPathBeanDefinitionScanner</span> <span class="variable">scanner</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathBeanDefinitionScanner</span>(context.getDefaultListableBeanFactory());</span><br><span class="line">        scanner.scan(<span class="string">&quot;com.itheima.app60.sub&quot;</span>);</span><br><span class="line">        context.refresh();</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component</span> <span class="comment">// é…åˆç»„ä»¶æ‰«æ</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> B b;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">A</span><span class="params">(B b)</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;A(B b) &#123;&#125;&quot;</span>, b.getClass());</span><br><span class="line">        <span class="built_in">this</span>.b = b;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Scope(proxyMode = ScopedProxyMode.TARGET_CLASS)</span> <span class="comment">// äº§ç”ŸBçš„ä»£ç†</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">B</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">log</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">    <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">B</span><span class="params">(A a)</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;B(&#123;&#125;)&quot;</span>, a);</span><br><span class="line">        <span class="built_in">this</span>.a = a;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        log.debug(<span class="string">&quot;init()&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AOPé€šçŸ¥ç±»å‹</title>
      <link href="/posts/39227/"/>
      <url>/posts/39227/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸAOPé€šçŸ¥"><a href="#ğŸAOPé€šçŸ¥" class="headerlink" title="ğŸAOPé€šçŸ¥"></a>ğŸAOPé€šçŸ¥</h2><blockquote><p>AOPé€šçŸ¥<strong>æè¿°äº†æŠ½å–çš„å…±æ€§åŠŸèƒ½</strong>ï¼Œæ ¹æ®å…±æ€§åŠŸèƒ½æŠ½å–çš„ä½ç½®ä¸åŒï¼Œæœ€ç»ˆè¿è¡Œä»£ç æ—¶è¦å°†å…¶åŠ å…¥åˆ°åˆç†çš„ä½ç½®</p></blockquote><p>å…±æœ‰5ç§é€šçŸ¥ç±»å‹:</p><ul><li>å‰ç½®é€šçŸ¥</li><li>åç½®é€šçŸ¥</li><li><strong>ç¯ç»•é€šçŸ¥(é‡ç‚¹)</strong></li><li>è¿”å›åé€šçŸ¥(äº†è§£)</li><li>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥(äº†è§£)</li></ul><p>å›¾ç¤ºï¼š</p><p><img src="/img/39227/AOP1.png" alt="AOP1"></p><p>(1)<code>å‰ç½®é€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œå‰ï¼Œåœ¨ä»£ç 1æˆ–è€…ä»£ç 2æ·»åŠ å†…å®¹</p><p>(2)<code>åç½®é€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œåï¼Œä¸ç®¡æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­æœ‰æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œï¼Œåœ¨ä»£ç 5æ·»åŠ å†…å®¹</p><p>(3)<code>è¿”å›åé€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œåï¼Œåªæœ‰æ–¹æ³•æ­£å¸¸æ‰§è¡Œç»“æŸåæ‰è¿›è¡Œï¼Œåœ¨ä»£ç 3æ·»åŠ å†…å®¹ï¼Œå¦‚æœæ–¹æ³•æ‰§è¡ŒæŠ›å‡ºå¼‚å¸¸ï¼Œè¿”å›åé€šçŸ¥å°†ä¸ä¼šè¢«æ·»åŠ </p><p>(4)<code>æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥</code>ï¼šè¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åï¼Œåªæœ‰æ–¹æ³•æ‰§è¡Œå‡ºå¼‚å¸¸æ‰è¿›è¡Œï¼Œåœ¨ä»£ç 4æ·»åŠ å†…å®¹ï¼Œåªæœ‰æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰ä¼šè¢«æ·»åŠ </p><p>(5)<code>ç¯ç»•é€šçŸ¥</code>ï¼šç¯ç»•é€šçŸ¥åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œå®ƒå¯ä»¥è¿½åŠ åŠŸèƒ½åˆ°æ–¹æ³•æ‰§è¡Œçš„å‰åï¼Œè¿™ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æ–¹å¼ï¼Œå®ƒå¯ä»¥å®ç°å…¶ä»–å››ç§é€šçŸ¥ç±»å‹çš„åŠŸèƒ½</p><h2 id="ğŸä»£ç æ¼”ç¤ºè¯´æ˜"><a href="#ğŸä»£ç æ¼”ç¤ºè¯´æ˜" class="headerlink" title="ğŸä»£ç æ¼”ç¤ºè¯´æ˜"></a>ğŸä»£ç æ¼”ç¤ºè¯´æ˜</h2><p>ä¸ºäº†æ›´å¥½çš„è¯´æ˜å‡ ç§é€šçŸ¥ï¼Œå¼•å…¥ä»£ç ç¤ºä¾‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œæ¼”ç¤ºï¼Œå‡è®¾å…¶ä»–é…ç½®éƒ½å·²ç»æ­£å¸¸</p><p>æ·»åŠ BookDaoå’ŒBookDaoImplç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">select</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select is running ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">100</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ·»åŠ é€šçŸ¥ç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span> <span class="comment">// å£°æ˜åˆ‡é¢</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span> <span class="comment">// åˆ‡å…¥ç‚¹</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ğŸ1-å‰ç½®é€šçŸ¥"><a href="#ğŸ1-å‰ç½®é€šçŸ¥" class="headerlink" title="ğŸ1.å‰ç½®é€šçŸ¥"></a>ğŸ1.å‰ç½®é€šçŸ¥</h2><p>åœ¨beforeæ–¹æ³•ä¸Šæ·»åŠ <code>@Beforeæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="comment">//æ­¤å¤„ä¹Ÿå¯ä»¥å†™æˆ @Before(&quot;MyAdvice.pt()&quot;),ä¸å»ºè®®</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">before advice ...</span><br><span class="line">book dao update ...</span><br></pre></td></tr></table></figure><h2 id="ğŸ2-åç½®é€šçŸ¥"><a href="#ğŸ2-åç½®é€šçŸ¥" class="headerlink" title="ğŸ2.åç½®é€šçŸ¥"></a>ğŸ2.åç½®é€šçŸ¥</h2><p>åœ¨afteræ–¹æ³•ä¸Šæ·»åŠ <code>@Afteræ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@After(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">book dao update ...</span><br><span class="line">after advice ...</span><br></pre></td></tr></table></figure><h2 id="ğŸ3-ç¯ç»•é€šçŸ¥"><a href="#ğŸ3-ç¯ç»•é€šçŸ¥" class="headerlink" title="ğŸ3.ç¯ç»•é€šçŸ¥"></a>ğŸ3.ç¯ç»•é€šçŸ¥</h2><h3 id="åŸºæœ¬ä½¿ç”¨"><a href="#åŸºæœ¬ä½¿ç”¨" class="headerlink" title="åŸºæœ¬ä½¿ç”¨"></a>åŸºæœ¬ä½¿ç”¨</h3><ul><li>åœ¨aroundæ–¹æ³•ä¸Šæ·»åŠ <code>@Aroundæ³¨è§£</code></li><li>å¿…é¡»è¦èƒ½å¯¹åŸå§‹æ“ä½œè¿›è¡Œè°ƒç”¨</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">around</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºå¯¹åŸå§‹æ“ä½œçš„è°ƒç”¨</span></span><br><span class="line">        pjp.proceed();</span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">before advice ...</span><br><span class="line">book dao update ...</span><br><span class="line">after advice ...</span><br></pre></td></tr></table></figure><h3 id="åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†"><a href="#åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†" class="headerlink" title="åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†"></a>åŸå§‹æ–¹æ³•æœ‰è¿”å›å€¼çš„å¤„ç†</h3><p>å¯¹BookDaoä¸­çš„selectæ–¹æ³•æ·»åŠ ç¯ç»•é€šçŸ¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">aroundSelect</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;around before advice ...&quot;</span>);</span><br><span class="line">        <span class="comment">//è¡¨ç¤ºå¯¹åŸå§‹æ“ä½œçš„è°ƒç”¨</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">ret</span> <span class="operator">=</span> pjp.proceed(); <span class="comment">// è¿”å›Objectç±»å‹</span></span><br><span class="line">        System.out.println(<span class="string">&quot;around after advice ...&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>è¿”å›Objectæ˜¯Objectç±»å‹æ›´é€šç”¨</p></li><li><p>åœ¨ç¯ç»•é€šçŸ¥ä¸­æ˜¯å¯ä»¥å¯¹åŸå§‹æ–¹æ³•è¿”å›å€¼è¿›è¡Œä¿®æ”¹çš„</p></li></ul><h3 id="æ³¨æ„äº‹é¡¹"><a href="#æ³¨æ„äº‹é¡¹" class="headerlink" title="æ³¨æ„äº‹é¡¹"></a>æ³¨æ„äº‹é¡¹</h3><ol><li>ç¯ç»•é€šçŸ¥å¿…é¡»ä¾èµ–å½¢å‚ProceedingJoinPointæ‰èƒ½å®ç°å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨ï¼Œè¿›è€Œå®ç°åŸå§‹æ–¹æ³•è°ƒç”¨å‰ååŒæ—¶æ·»åŠ é€šçŸ¥</li><li>é€šçŸ¥ä¸­å¦‚æœæœªä½¿ç”¨ProceedingJoinPointå¯¹åŸå§‹æ–¹æ³•è¿›è¡Œè°ƒç”¨å°†<strong>è·³è¿‡</strong>åŸå§‹æ–¹æ³•çš„æ‰§è¡Œ</li><li>å¯¹åŸå§‹æ–¹æ³•çš„è°ƒç”¨å¯ä»¥ä¸æ¥æ”¶è¿”å›å€¼ï¼Œé€šçŸ¥æ–¹æ³•è®¾ç½®æˆvoidå³å¯ï¼Œå¦‚æœæ¥æ”¶è¿”å›å€¼ï¼Œæœ€å¥½è®¾å®šä¸ºObjectç±»å‹</li><li>åŸå§‹æ–¹æ³•çš„è¿”å›å€¼å¦‚æœæ˜¯voidç±»å‹ï¼Œé€šçŸ¥æ–¹æ³•çš„è¿”å›å€¼ç±»å‹å¯ä»¥è®¾ç½®æˆvoid,ä¹Ÿå¯ä»¥è®¾ç½®æˆObject</li><li>ç”±äºæ— æ³•é¢„çŸ¥åŸå§‹æ–¹æ³•è¿è¡Œåæ˜¯å¦ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œå› æ­¤ç¯ç»•é€šçŸ¥æ–¹æ³•å¿…é¡»è¦å¤„ç†Throwableå¼‚å¸¸</li></ol><h2 id="ğŸ4-è¿”å›åé€šçŸ¥"><a href="#ğŸ4-è¿”å›åé€šçŸ¥" class="headerlink" title="ğŸ4.è¿”å›åé€šçŸ¥"></a>ğŸ4.è¿”å›åé€šçŸ¥</h2><p>åœ¨afterReturningæ–¹æ³•ä¸Šæ·»åŠ <code>@AfterReturningæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterReturning(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterReturning</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterReturning advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book dao select is running ...</span><br><span class="line">afterReturning advice ...</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure><p>åŒºåˆ«ï¼šè¿”å›åé€šçŸ¥æ˜¯éœ€è¦åœ¨åŸå§‹æ–¹æ³•<code>select</code>æ­£å¸¸æ‰§è¡Œåæ‰ä¼šè¢«æ‰§è¡Œï¼Œå¦‚æœ<code>select()</code>æ–¹æ³•æ‰§è¡Œçš„è¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œé‚£ä¹ˆè¿”å›åé€šçŸ¥æ˜¯ä¸ä¼šè¢«æ‰§è¡Œã€‚</p><p>â€‹åç½®é€šçŸ¥æ˜¯ä¸ç®¡åŸå§‹æ–¹æ³•æœ‰æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸éƒ½ä¼šè¢«æ‰§è¡Œã€‚</p><h2 id="ğŸ5-å¼‚å¸¸åé€šçŸ¥"><a href="#ğŸ5-å¼‚å¸¸åé€šçŸ¥" class="headerlink" title="ğŸ5.å¼‚å¸¸åé€šçŸ¥"></a>ğŸ5.å¼‚å¸¸åé€šçŸ¥</h2><p>åœ¨afterThrowingæ–¹æ³•ä¸Šæ·»åŠ <code>@AfterThrowingæ³¨è§£</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(int com.itheima.dao.BookDao.select())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt2</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@AfterThrowing(&quot;pt2()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterThrowing</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;afterThrowing advice ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// select()æ–¹æ³•ä¸­æ·»åŠ ä¸€è¡Œä»£ç int i = 1/0</span></span><br></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">book dao select is running ...</span><br><span class="line">afterThrowing advice ...</span><br><span class="line">Exception in main XXX(å¼‚å¸¸ä»£ç )</span><br></pre></td></tr></table></figure><h2 id="ğŸé€šçŸ¥æ³¨è§£æ€»ç»“"><a href="#ğŸé€šçŸ¥æ³¨è§£æ€»ç»“" class="headerlink" title="ğŸé€šçŸ¥æ³¨è§£æ€»ç»“"></a>ğŸé€šçŸ¥æ³¨è§£æ€»ç»“</h2><h3 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h3><table><thead><tr><th>åç§°</th><th>@Before</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰è¿è¡Œ</td></tr></tbody></table><h3 id="After"><a href="#After" class="headerlink" title="@After"></a>@After</h3><table><thead><tr><th>åç§°</th><th>@After</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•åè¿è¡Œ</td></tr></tbody></table><h3 id="AfterReturning"><a href="#AfterReturning" class="headerlink" title="@AfterReturning"></a>@AfterReturning</h3><table><thead><tr><th>åç§°</th><th>@AfterReturning</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•åæ‰§è¡Œ</td></tr></tbody></table><h3 id="AfterThrowing"><a href="#AfterThrowing" class="headerlink" title="@AfterThrowing"></a>@AfterThrowing</h3><table><thead><tr><th>åç§°</th><th>@AfterThrowing</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•è¿è¡ŒæŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œ</td></tr></tbody></table><h3 id="Around"><a href="#Around" class="headerlink" title="@Around"></a>@Around</h3><table><thead><tr><th>åç§°</th><th>@Around</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰åè¿è¡Œ</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringAOP</title>
      <link href="/posts/19494/"/>
      <url>/posts/19494/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç†è§£AOP"><a href="#ğŸç†è§£AOP" class="headerlink" title="ğŸç†è§£AOP"></a>ğŸç†è§£AOP</h2><h3 id="ä»€ä¹ˆæ˜¯AOPï¼Ÿ"><a href="#ä»€ä¹ˆæ˜¯AOPï¼Ÿ" class="headerlink" title="ä»€ä¹ˆæ˜¯AOPï¼Ÿ"></a>ä»€ä¹ˆæ˜¯AOPï¼Ÿ</h3><blockquote><p>åƒOOP(Object Oriented Programming)é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸€æ ·ï¼Œ<strong>AOP(Aspect Oriented Programming)é¢å‘åˆ‡é¢ç¼–ç¨‹</strong>ï¼Œä¹Ÿæ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼ŒæŒ‡å¯¼å¼€å‘è€…å¦‚ä½•ç»„ç»‡ç¨‹åºç»“æ„</p></blockquote><h3 id="AOPçš„ä½œç”¨"><a href="#AOPçš„ä½œç”¨" class="headerlink" title="AOPçš„ä½œç”¨"></a>AOPçš„ä½œç”¨</h3><blockquote><p>åœ¨ä¸æƒŠåŠ¨åŸå§‹è®¾è®¡çš„åŸºç¡€ä¸Šä¸ºå…¶è¿›è¡Œ<strong>åŠŸèƒ½å¢å¼º</strong></p><p>å®ç°è¿™æ ·çš„åŠŸèƒ½å³<strong>ä»£ç†æ¨¡å¼</strong></p></blockquote><h3 id="AOPçš„æ ¸å¿ƒæ¦‚å¿µ"><a href="#AOPçš„æ ¸å¿ƒæ¦‚å¿µ" class="headerlink" title="AOPçš„æ ¸å¿ƒæ¦‚å¿µ"></a>AOPçš„æ ¸å¿ƒæ¦‚å¿µ</h3><p>ç›´æ¥è§£é‡ŠAOPçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯æ¯”è¾ƒå›°éš¾çš„ï¼Œå…ˆä»ä¸€ä¸ªç®€å•çš„æ¡ˆä¾‹è¯´èµ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//è®°å½•ç¨‹åºå½“å‰æ‰§è¡Œæ‰§è¡Œï¼ˆå¼€å§‹æ—¶é—´ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">startTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//ä¸šåŠ¡æ‰§è¡Œä¸‡æ¬¡</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;<span class="number">10000</span>;i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//è®°å½•ç¨‹åºå½“å‰æ‰§è¡Œæ—¶é—´ï¼ˆç»“æŸæ—¶é—´ï¼‰</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">endTime</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//è®¡ç®—æ—¶é—´å·®</span></span><br><span class="line">        <span class="type">Long</span> <span class="variable">totalTime</span> <span class="operator">=</span> endTime-startTime;</span><br><span class="line">        <span class="comment">//è¾“å‡ºä¿¡æ¯</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰§è¡Œä¸‡æ¬¡æ¶ˆè€—æ—¶é—´ï¼š&quot;</span> + totalTime + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">delete</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao delete ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">select</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao select ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç æ˜¯åœ¨BookDaoImplä¸­å¯¹<code>save</code>æ–¹æ³•ä¸­æœ‰è®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´ã€‚</p><p>ä½†æ˜¯ä»å®¹å™¨ä¸­è·å–bookDaoå¯¹è±¡åï¼Œåˆ†åˆ«æ‰§è¡Œå…¶<code>save</code>,<code>delete</code>,<code>update</code>å’Œ<code>select</code>æ–¹æ³•ï¼Œä¼šæœ‰ä»¥ä¸‹ç»“æœï¼š</p><p><img src="/img/19494/AOP1.png" alt="AOP1"></p><p>å¯¹äºè®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´åªæœ‰saveæ–¹æ³•æœ‰ï¼Œä¸ºä»€ä¹ˆdeleteå’Œupdateæ–¹æ³•ä¹Ÿä¼šæœ‰å‘¢?</p><p>å®é™…ä¸Šè¿™é‡Œå°±æ˜¯ä½¿ç”¨äº†Springçš„AOPï¼Œåœ¨ä¸æƒŠåŠ¨åŸæœ‰è®¾è®¡(ä»£ç )çš„å‰æä¸‹ï¼Œæƒ³ç»™è°æ·»åŠ åŠŸèƒ½å°±ç»™è°æ·»åŠ ï¼Œå³<code>æ— å…¥ä¾µå¼</code></p><p><strong>æ ¸å¿ƒæ¦‚å¿µå¼•å…¥</strong></p><p><img src="/img/19494/AOP2.png" alt="AOP2"></p><p>(1)å¯¹ä¸Šé¢çš„æ¡ˆä¾‹ä¸­BookServiceImplä¸­æœ‰<code>save</code>,<code>update</code>,<code>delete</code>å’Œ<code>select</code>æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•ç§°ä¸º<code>è¿æ¥ç‚¹</code></p><p>(2)åœ¨BookServiceImplçš„å››ä¸ªæ–¹æ³•ä¸­ï¼Œ<code>update</code>å’Œ<code>delete</code>åªæœ‰æ‰“å°æ²¡æœ‰è®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—æ—¶é—´ï¼Œä½†æ˜¯åœ¨è¿è¡Œçš„æ—¶å€™å·²ç»æœ‰è¯¥åŠŸèƒ½ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´<code>update</code>å’Œ<code>delete</code>æ–¹æ³•éƒ½å·²ç»è¢«å¢å¼ºï¼Œæ‰€ä»¥å¯¹äºéœ€è¦å¢å¼ºçš„æ–¹æ³•ç§°ä¸º<code>åˆ‡å…¥ç‚¹</code></p><p>(3)æ‰§è¡ŒBookServiceImplçš„updateå’Œdeleteæ–¹æ³•çš„æ—¶å€™éƒ½è¢«æ·»åŠ äº†ä¸€ä¸ªè®¡ç®—ä¸‡æ¬¡æ‰§è¡Œæ¶ˆè€—æ—¶é—´çš„åŠŸèƒ½ï¼Œå°†è¿™ä¸ªåŠŸèƒ½æŠ½å–åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­ï¼Œæ¢å¥è¯è¯´å°±æ˜¯<strong>å­˜æ”¾å…±æ€§åŠŸèƒ½çš„æ–¹æ³•</strong>ï¼Œç§°ä¸º<code>é€šçŸ¥</code></p><p>(4)é€šçŸ¥æ˜¯è¦å¢å¼ºçš„å†…å®¹ï¼Œä¼šæœ‰å¤šä¸ªï¼Œåˆ‡å…¥ç‚¹æ˜¯éœ€è¦è¢«å¢å¼ºçš„æ–¹æ³•ï¼Œä¹Ÿä¼šæœ‰å¤šä¸ªï¼Œé‚£å“ªä¸ªåˆ‡å…¥ç‚¹éœ€è¦æ·»åŠ å“ªä¸ªé€šçŸ¥ï¼Œå°±éœ€è¦æå‰å°†å®ƒä»¬ä¹‹é—´çš„å…³ç³»æè¿°æ¸…æ¥šï¼Œé‚£ä¹ˆå¯¹äºé€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»æè¿°ï¼Œç§°ä¸º<code>åˆ‡é¢</code></p><p>(5)é€šçŸ¥æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œæ–¹æ³•ä¸èƒ½ç‹¬ç«‹å­˜åœ¨éœ€è¦è¢«å†™åœ¨ä¸€ä¸ªç±»ä¸­ï¼Œè¿™ä¸ªç±»ç§°ä¸º<code>é€šçŸ¥ç±»</code></p><p><strong>æ ¸å¿ƒæ¦‚å¿µæ€»ç»“</strong></p><p>**è¿æ¥ç‚¹(JoinPoint)**ï¼šç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»æ„ä½ç½®ï¼Œç²’åº¦ä¸ºæ‰§è¡Œæ–¹æ³•ã€æŠ›å‡ºå¼‚å¸¸ã€è®¾ç½®å˜é‡ç­‰</p><ul><li>åœ¨SpringAOPä¸­ï¼Œç†è§£ä¸ºæ–¹æ³•çš„æ‰§è¡Œ</li></ul><p>**åˆ‡å…¥ç‚¹(Pointcut)**ï¼šåŒ¹é…è¿æ¥ç‚¹çš„å¼å­</p><ul><li>åœ¨SpringAOPä¸­ï¼Œä¸€ä¸ªåˆ‡å…¥ç‚¹å¯ä»¥æè¿°ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä¹ŸåŒ¹é…å¤šä¸ªæ–¹æ³•<ul><li>ä¸€ä¸ªå…·ä½“çš„æ–¹æ³•:å¦‚com.daoåŒ…ä¸‹çš„BookDaoæ¥å£ä¸­çš„æ— å½¢å‚æ— è¿”å›å€¼çš„saveæ–¹æ³•</li><li>åŒ¹é…å¤šä¸ªæ–¹æ³•:æ‰€æœ‰çš„saveæ–¹æ³•ï¼Œæ‰€æœ‰çš„getå¼€å¤´çš„æ–¹æ³•ï¼Œæ‰€æœ‰ä»¥Daoç»“å°¾çš„æ¥å£ä¸­çš„ä»»æ„æ–¹æ³•ï¼Œæ‰€æœ‰å¸¦æœ‰ä¸€ä¸ªå‚æ•°çš„æ–¹æ³•</li></ul></li><li>è¿æ¥ç‚¹èŒƒå›´è¦æ¯”åˆ‡å…¥ç‚¹èŒƒå›´å¤§ï¼Œæ˜¯åˆ‡å…¥ç‚¹çš„æ–¹æ³•ä¹Ÿä¸€å®šæ˜¯è¿æ¥ç‚¹ï¼Œä½†æ˜¯æ˜¯è¿æ¥ç‚¹çš„æ–¹æ³•å°±ä¸ä¸€å®šè¦è¢«å¢å¼ºï¼Œæ‰€ä»¥å¯èƒ½ä¸æ˜¯åˆ‡å…¥ç‚¹ã€‚</li></ul><p><strong>é€šçŸ¥(Advice)</strong>:åœ¨åˆ‡å…¥ç‚¹å¤„æ‰§è¡Œçš„æ“ä½œï¼Œä¹Ÿå°±æ˜¯å…±æ€§åŠŸèƒ½</p><ul><li>åœ¨SpringAOPä¸­ï¼ŒåŠŸèƒ½æœ€ç»ˆä»¥æ–¹æ³•çš„å½¢å¼å‘ˆç°</li></ul><p><strong>é€šçŸ¥ç±»</strong>ï¼šå®šä¹‰é€šçŸ¥çš„ç±»</p><p><strong>åˆ‡é¢(Aspect)</strong>:æè¿°é€šçŸ¥ä¸åˆ‡å…¥ç‚¹çš„å¯¹åº”å…³ç³»ã€‚</p><h2 id="ğŸAOPæ¡ˆä¾‹"><a href="#ğŸAOPæ¡ˆä¾‹" class="headerlink" title="ğŸAOPæ¡ˆä¾‹"></a>ğŸAOPæ¡ˆä¾‹</h2><h3 id="å‰ç½®è¯´æ˜"><a href="#å‰ç½®è¯´æ˜" class="headerlink" title="å‰ç½®è¯´æ˜"></a>å‰ç½®è¯´æ˜</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookDaoImpl</span> <span class="keyword">implements</span> <span class="title class_">BookDao</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">save</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao save ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;book dao update ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°æœ‰æ¥å£BookDaoå’Œå…¶å®ç°ç±»BookDaoImpl</p><p>ç›®å‰æ‰“å°saveæ–¹æ³•çš„æ—¶å€™ï¼Œå› ä¸ºæ–¹æ³•ä¸­æœ‰æ‰“å°ç³»ç»Ÿæ—¶é—´ï¼Œæ‰€ä»¥è¿è¡Œçš„æ—¶å€™æ˜¯å¯ä»¥çœ‹åˆ°ç³»ç»Ÿæ—¶é—´ï¼Œå¯¹äºupdateæ–¹æ³•æ¥è¯´ï¼Œå°±æ²¡æœ‰è¯¥åŠŸèƒ½ã€‚ä½¿ç”¨SpringAOPçš„æ–¹å¼åœ¨ä¸æ”¹å˜updateæ–¹æ³•çš„å‰æä¸‹è®©å…¶å…·æœ‰æ‰“å°ç³»ç»Ÿæ—¶é—´çš„åŠŸèƒ½ã€‚</p><h3 id="å®ç°æ­¥éª¤"><a href="#å®ç°æ­¥éª¤" class="headerlink" title="å®ç°æ­¥éª¤"></a>å®ç°æ­¥éª¤</h3><p>ä»…è¯´æ˜AOPç›¸å…³çš„é…ç½®ï¼Œé»˜è®¤ä¾èµ–ç­‰å…¨éƒ¨é…ç½®å®Œæ¯•</p><h4 id="1-å®šä¹‰é€šçŸ¥ç±»"><a href="#1-å®šä¹‰é€šçŸ¥ç±»" class="headerlink" title="1.å®šä¹‰é€šçŸ¥ç±»"></a>1.å®šä¹‰é€šçŸ¥ç±»</h4><p>é€šçŸ¥å°±æ˜¯å°†å…±æ€§åŠŸèƒ½æŠ½å–å‡ºæ¥åå½¢æˆçš„æ–¹æ³•ï¼Œè¿™é‡ŒæŒ‡çš„å°±æ˜¯å½“å‰ç³»ç»Ÿæ—¶é—´çš„æ‰“å°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ç±»åå’Œæ–¹æ³•åæ— è¦æ±‚</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-å®šä¹‰åˆ‡å…¥ç‚¹"><a href="#2-å®šä¹‰åˆ‡å…¥ç‚¹" class="headerlink" title="2.å®šä¹‰åˆ‡å…¥ç‚¹"></a>2.å®šä¹‰åˆ‡å…¥ç‚¹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="comment">// è¦å¢å¼ºçš„æ˜¯updateæ–¹æ³•</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ‡å…¥ç‚¹å®šä¹‰ä¾æ‰˜ä¸€ä¸ªä¸å…·æœ‰å®é™…æ„ä¹‰çš„æ–¹æ³•è¿›è¡Œï¼Œå³<strong>æ— å‚æ•°ã€æ— è¿”å›å€¼ã€æ–¹æ³•ä½“æ— å®é™…é€»è¾‘</strong>ã€‚</li><li><strong>åˆ‡å…¥ç‚¹è¡¨è¾¾å¼execution</strong>(@Pointcutä¸­çš„å†…å®¹)æœ‰ä¸“é—¨çš„ç¼–å†™æ ¼å¼</li></ul><h4 id="3-åˆ¶ä½œåˆ‡é¢"><a href="#3-åˆ¶ä½œåˆ‡é¢" class="headerlink" title="3.åˆ¶ä½œåˆ‡é¢"></a>3.åˆ¶ä½œåˆ‡é¢</h4><p>åˆ‡é¢æ˜¯ç”¨æ¥æè¿°é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    <span class="comment">// Beforeæè¿°é€šçŸ¥å’Œåˆ‡å…¥ç‚¹ä¹‹é—´çš„å…³ç³»</span></span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»‘å®šåˆ‡å…¥ç‚¹ä¸é€šçŸ¥å…³ç³»ï¼Œå¹¶æŒ‡å®šé€šçŸ¥æ·»åŠ åˆ°åŸå§‹è¿æ¥ç‚¹çš„å…·ä½“æ‰§è¡Œ<code>ä½ç½®</code></p><p><img src="/img/19494/AOP3.png" alt="AOP3"></p><p>ğŸš©@Beforeç¿»è¯‘è¿‡æ¥æ˜¯ä¹‹å‰ï¼Œä¹Ÿå°±æ˜¯è¯´é€šçŸ¥ä¼šåœ¨åˆ‡å…¥ç‚¹æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼Œé™¤æ­¤ä¹‹å‰è¿˜æœ‰å…¶ä»–å››ç§ç±»å‹ï¼Œè¿™å°±æ˜¯<code>é€šçŸ¥ç±»å‹</code></p><h4 id="4-å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»"><a href="#4-å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»" class="headerlink" title="4.å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»"></a>4.å°†é€šçŸ¥ç±»é…ç»™å®¹å™¨å¹¶æ ‡è¯†å…¶ä¸ºåˆ‡é¢ç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åŠ å…¥ä»¥ä¸‹ä¸¤ä¸ªæ³¨è§£</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAdvice</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(void com.itheima.dao.BookDao.update())&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pt</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before(&quot;pt()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(System.currentTimeMillis());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="5-å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½"><a href="#5-å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½" class="headerlink" title="5.å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½"></a>5.å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.itheima&quot;)</span></span><br><span class="line"><span class="comment">// åŠ å…¥æ­¤æ³¨è§£</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SpringConfig</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="6-è¿è¡ŒAppç±»"><a href="#6-è¿è¡ŒAppç±»" class="headerlink" title="6.è¿è¡ŒAppç±»"></a>6.è¿è¡ŒAppç±»</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(SpringConfig.class);</span><br><span class="line">        <span class="type">BookDao</span> <span class="variable">bookDao</span> <span class="operator">=</span> ctx.getBean(BookDao.class);</span><br><span class="line">        bookDao.update();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰“å°ç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1618998676535</span><br><span class="line">book dao update ...</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨updateæ–¹æ³•å‰åŠ å…¥äº†æ—¶é—´æˆ³ï¼Œæ–¹æ³•å¢å¼ºæˆåŠŸã€‚</p><h2 id="ğŸæ³¨è§£è¯´æ˜"><a href="#ğŸæ³¨è§£è¯´æ˜" class="headerlink" title="ğŸæ³¨è§£è¯´æ˜"></a>ğŸæ³¨è§£è¯´æ˜</h2><h3 id="EnableAspectJAutoProxy"><a href="#EnableAspectJAutoProxy" class="headerlink" title="@EnableAspectJAutoProxy"></a>@EnableAspectJAutoProxy</h3><table><thead><tr><th>åç§°</th><th>@EnableAspectJAutoProxy</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>é…ç½®ç±»æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é…ç½®ç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>å¼€å¯æ³¨è§£æ ¼å¼AOPåŠŸèƒ½</td></tr></tbody></table><h3 id="Aspect"><a href="#Aspect" class="headerlink" title="@Aspect"></a>@Aspect</h3><table><thead><tr><th>åç§°</th><th>@Aspect</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>ç±»æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>åˆ‡é¢ç±»å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰ç±»ä¸ºAOPåˆ‡é¢ç±»</td></tr></tbody></table><h3 id="Pointcut"><a href="#Pointcut" class="headerlink" title="@Pointcut"></a>@Pointcut</h3><table><thead><tr><th>åç§°</th><th>@Pointcut</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>åˆ‡å…¥ç‚¹æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®åˆ‡å…¥ç‚¹æ–¹æ³•</td></tr><tr><td>å±æ€§</td><td>valueï¼ˆé»˜è®¤ï¼‰ï¼šåˆ‡å…¥ç‚¹è¡¨è¾¾å¼</td></tr></tbody></table><h3 id="Before"><a href="#Before" class="headerlink" title="@Before"></a>@Before</h3><table><thead><tr><th>åç§°</th><th>@Before</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>æ–¹æ³•æ³¨è§£</td></tr><tr><td>ä½ç½®</td><td>é€šçŸ¥æ–¹æ³•å®šä¹‰ä¸Šæ–¹</td></tr><tr><td>ä½œç”¨</td><td>è®¾ç½®å½“å‰é€šçŸ¥æ–¹æ³•ä¸åˆ‡å…¥ç‚¹ä¹‹é—´çš„ç»‘å®šå…³ç³»ï¼Œå½“å‰é€šçŸ¥æ–¹æ³•åœ¨åŸå§‹åˆ‡å…¥ç‚¹æ–¹æ³•å‰è¿è¡Œ</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æ³¨è§£æ³¨å…¥æ¯”è¾ƒ</title>
      <link href="/posts/24359/"/>
      <url>/posts/24359/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸ-Autowired"><a href="#ğŸ-Autowired" class="headerlink" title="ğŸ@Autowired"></a>ğŸ@Autowired</h2><h3 id="ä½¿ç”¨æ–¹å¼"><a href="#ä½¿ç”¨æ–¹å¼" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><p><strong>å­—æ®µå±æ€§ä¸Šæ–¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br></pre></td></tr></table></figure><p><strong>setæ–¹æ³•ä¸Šæ–¹</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="keyword">public</span> HelloDao <span class="title function_">getHelloDao</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">return</span> helloDao;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setHelloDao</span><span class="params">(HelloDao helloDao)</span> &#123;</span><br><span class="line"><span class="built_in">this</span>.helloDao = helloDao;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ–¹æ³•å½¢å‚å‰é¢</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">private HelloDao helloDao;</span><br><span class="line">//@Autowired</span><br><span class="line">public HelloServiceImpl(@Autowired HelloDao helloDao) &#123;</span><br><span class="line">this.helloDao = helloDao;</span><br><span class="line">&#125;</span><br><span class="line">// æ„é€ å™¨æ³¨å…¥ä¹Ÿå¯ä¸å†™@Autowiredï¼Œä¹Ÿå¯ä»¥æ³¨å…¥æˆåŠŸã€‚</span><br></pre></td></tr></table></figure><p>ğŸš©å°†@Autowiredå†™åœ¨è¢«æ³¨å…¥çš„æˆå‘˜å˜é‡ä¸Šï¼Œsetteræˆ–è€…æ„é€ å™¨ä¸Šï¼Œå°±ä¸ç”¨åœ¨xmlæ–‡ä»¶ä¸­é…ç½®</p><h3 id="ç±»å‹ç›¸åŒé—®é¢˜"><a href="#ç±»å‹ç›¸åŒé—®é¢˜" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™é»˜è®¤æ ¹æ®<strong>è®¾å®šçš„å±æ€§åç§°</strong>è¿›è¡Œè·å–ã€‚é…åˆ**@Qualifier**ä½¿ç”¨ï¼Œ@Qualifier(â€œXXXâ€) ä¸­çš„ XXæ˜¯ Bean çš„åç§°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;helloWorldDao&quot;)</span></span><br><span class="line"><span class="keyword">private</span> HelloDao helloDao;</span><br><span class="line"><span class="comment">// å‘ç°å¤šä¸ªHelloDao,æ³¨å…¥åç§°ä¸ºhelloWorldDao çš„Beanç»„ä»¶</span></span><br></pre></td></tr></table></figure><h3 id="SpringBootä¸­çš„ä½¿ç”¨"><a href="#SpringBootä¸­çš„ä½¿ç”¨" class="headerlink" title="SpringBootä¸­çš„ä½¿ç”¨"></a>SpringBootä¸­çš„ä½¿ç”¨</h3><p>ä½¿ç”¨@Bean+@Autowiredè¿›è¡Œç»„ä»¶æ³¨å…¥ï¼Œå°†@AutowiredåŠ åˆ°å‚æ•°ä¸Šï¼Œä¹Ÿå¯ä»¥çœç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> Person <span class="title function_">getPerson</span><span class="params">(<span class="meta">@Autowired</span> Car car)</span>&#123;</span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// @Autowiredå¯ä»¥çœç•¥</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Autowiredæ˜¯<strong>Springè‡ªå¸¦</strong>çš„æ³¨è§£ï¼Œé€šè¿‡AutowiredAnnotationBeanPostProcessor ç±»å®ç°çš„ä¾èµ–æ³¨å…¥</p><p>2ã€@Autowiredå¯ä»¥ä½œç”¨åœ¨CONSTRUCTORã€METHODã€PARAMETERã€FIELDã€ANNOTATION_TYPE</p><p>3ã€@Autowiredé»˜è®¤æ˜¯<strong>æ ¹æ®ç±»å‹ï¼ˆbyType ï¼‰</strong>è¿›è¡Œè‡ªåŠ¨è£…é…çš„</p><p>4ã€å¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œéœ€è¦æŒ‡å®šæŒ‰ç…§åç§°ï¼ˆbyName ï¼‰è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ**@Qualifier**</p><h2 id="ğŸ-Resource"><a href="#ğŸ-Resource" class="headerlink" title="ğŸ@Resource"></a>ğŸ@Resource</h2><h3 id="ä½¿ç”¨æ–¹å¼-1"><a href="#ä½¿ç”¨æ–¹å¼-1" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹ç›¸åŒé—®é¢˜-1"><a href="#ç±»å‹ç›¸åŒé—®é¢˜-1" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>é»˜è®¤æ ¹æ®å±æ€§åç§°è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡<strong>name</strong>è¿›è¡ŒæŒ‡å®šè¿›è¡Œæ³¨å…¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SuperMan</span> &#123;</span><br><span class="line">    <span class="meta">@Resource(name = &quot;BMW&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æŒ‰ç…§å±æ€§åç§° car æ³¨å…¥å®¹å™¨ä¸­çš„ç»„ä»¶ã€‚å¦‚æœå®¹å™¨ä¸­BMWè¿˜æœ‰BYDä¸¤ç§ç±»å‹ç»„ä»¶ã€‚æŒ‡å®šåŠ å…¥BMW</span></span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Resourceåœ¨javax.annotationåŒ…ä¸‹</p><p>2ã€@Resourceå¯ä»¥ä½œç”¨TYPEã€FIELDã€METHODä¸Š</p><p>3ã€@Resourceæ˜¯é»˜è®¤æ ¹æ®å±æ€§åç§°è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœæœ‰å¤šä¸ªç±»å‹ä¸€æ ·çš„Beanå€™é€‰è€…ï¼Œåˆ™å¯ä»¥é€šè¿‡nameè¿›è¡ŒæŒ‡å®šè¿›è¡Œæ³¨å…¥</p><h2 id="ğŸ-Inject-äº†è§£"><a href="#ğŸ-Inject-äº†è§£" class="headerlink" title="ğŸ@Inject(äº†è§£)"></a>ğŸ@Inject(äº†è§£)</h2><h3 id="ä½¿ç”¨æ–¹å¼-2"><a href="#ä½¿ç”¨æ–¹å¼-2" class="headerlink" title="ä½¿ç”¨æ–¹å¼"></a>ä½¿ç”¨æ–¹å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure><h3 id="ç±»å‹ç›¸åŒé—®é¢˜-2"><a href="#ç±»å‹ç›¸åŒé—®é¢˜-2" class="headerlink" title="ç±»å‹ç›¸åŒé—®é¢˜"></a>ç±»å‹ç›¸åŒé—®é¢˜</h3><p>é»˜è®¤æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Inject</span></span><br><span class="line"><span class="meta">@Named(&quot;BMW&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Car car;</span><br></pre></td></tr></table></figure><h3 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>1ã€@Injectéœ€è¦å¯¼å…¥javax.inject.Inject jaråŒ…</p><p>2ã€@Injectå¯ä»¥ä½œç”¨CONSTRUCTORã€METHODã€FIELDä¸Š</p><p>3ã€@Injectæ˜¯æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ï¼Œå¦‚æœéœ€è¦æŒ‰åç§°è¿›è¡Œè£…é…ï¼Œåˆ™éœ€è¦é…åˆ@Named</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringIOC</title>
      <link href="/posts/17382/"/>
      <url>/posts/17382/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸç†è§£IOC"><a href="#ğŸç†è§£IOC" class="headerlink" title="ğŸç†è§£IOC"></a>ğŸç†è§£IOC</h2><h3 id="IOCæ¦‚å¿µ"><a href="#IOCæ¦‚å¿µ" class="headerlink" title="IOCæ¦‚å¿µ"></a>IOCæ¦‚å¿µ</h3><blockquote><p>Inversion of Controlï¼Œâ€œæ§åˆ¶åè½¬â€ï¼Œ<strong>æ˜¯ä¸€ç§è®¾è®¡æ€æƒ³</strong>ã€‚</p><p>å°†è®¾è®¡å¥½çš„å¯¹è±¡äº¤ç»™å®¹å™¨æ§åˆ¶ï¼Œè€Œä¸æ˜¯ä¼ ç»Ÿçš„åœ¨å¯¹è±¡å†…éƒ¨ç›´æ¥æ§åˆ¶ã€‚</p></blockquote><p>ä¼ ç»Ÿåº”ç”¨ç¨‹åºæ˜¯ç”±æˆ‘ä»¬è‡ªå·±åœ¨å¯¹è±¡ä¸­ä¸»åŠ¨æ§åˆ¶å»ç›´æ¥è·å–ä¾èµ–å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ­£è½¬ï¼›è€Œåè½¬åˆ™æ˜¯ç”±å®¹å™¨æ¥å¸®å¿™åˆ›å»ºåŠæ³¨å…¥ä¾èµ–å¯¹è±¡ã€‚</p><p><strong>ç¤ºä¾‹ï¼š</strong></p><p>ä¼ ç»Ÿç¨‹åºè®¾è®¡æ˜¯ä¸»åŠ¨å»åˆ›å»ºç›¸å…³å¯¹è±¡ç„¶åå†ç»„åˆèµ·æ¥ï¼š</p><p><img src="/img/17382/spring-framework-ioc-1.png" alt="spring-framework-ioc-1"></p><p>æœ‰äº†IoC&#x2F;DIçš„å®¹å™¨åï¼Œåœ¨å®¢æˆ·ç«¯ç±»ä¸­ä¸å†ä¸»åŠ¨å»åˆ›å»ºè¿™äº›å¯¹è±¡ï¼š</p><p><img src="/img/17382/spring-framework-ioc-2.png" alt="spring-framework-ioc-2"></p><p>ğŸš©<strong>ä¼˜ç‚¹ï¼šæŠŠåˆ›å»ºå’ŒæŸ¥æ‰¾ä¾èµ–å¯¹è±¡çš„æ§åˆ¶æƒäº¤ç»™äº†å®¹å™¨ï¼Œç”±å®¹å™¨è¿›è¡Œæ³¨å…¥ç»„åˆå¯¹è±¡ï¼Œæ‰€ä»¥å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´æ˜¯æ¾æ•£è€¦åˆï¼Œè¿™æ ·ä¹Ÿæ–¹ä¾¿æµ‹è¯•ï¼Œåˆ©äºåŠŸèƒ½å¤ç”¨ï¼Œæ›´é‡è¦çš„æ˜¯ä½¿å¾—ç¨‹åºçš„æ•´ä¸ªä½“ç³»ç»“æ„å˜å¾—éå¸¸çµæ´»</strong>ã€‚</p><h3 id="DIæ¦‚å¿µ"><a href="#DIæ¦‚å¿µ" class="headerlink" title="DIæ¦‚å¿µ"></a>DIæ¦‚å¿µ</h3><blockquote><p>Dependency Injectionï¼Œå³ä¾èµ–æ³¨å…¥ï¼šç»„ä»¶ä¹‹é—´ä¾èµ–å…³ç³»ç”±å®¹å™¨åœ¨è¿è¡ŒæœŸå†³å®šï¼Œå³ç”±å®¹å™¨åŠ¨æ€çš„å°†æŸä¸ªä¾èµ–å…³ç³»æ³¨å…¥åˆ°ç»„ä»¶ä¹‹ä¸­ã€‚</p></blockquote><p>åº”ç”¨ç¨‹åº<strong>ä¾èµ–</strong>äºIoCå®¹å™¨ï¼ŒIoCå®¹å™¨<strong>æ³¨å…¥</strong>åº”ç”¨ç¨‹åºæŸä¸ªå¯¹è±¡ï¼Œåº”ç”¨ç¨‹åºä¾èµ–çš„å¯¹è±¡ã€‚</p><p>ğŸš©<strong>ä¼˜ç‚¹ï¼šåªéœ€è¦é€šè¿‡ç®€å•çš„é…ç½®ï¼Œè€Œæ— éœ€ä»»ä½•ä»£ç å°±å¯æŒ‡å®šç›®æ ‡éœ€è¦çš„èµ„æºï¼Œå®Œæˆè‡ªèº«çš„ä¸šåŠ¡é€»è¾‘ï¼Œè€Œä¸éœ€è¦å…³å¿ƒå…·ä½“çš„èµ„æºæ¥è‡ªä½•å¤„ï¼Œç”±è°å®ç°</strong>ã€‚</p><p>ğŸš©<strong>IoCæ˜¯è®¾è®¡æ€æƒ³ï¼ŒDIæ˜¯å®ç°æ–¹å¼</strong></p><h2 id="ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼"><a href="#ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼"></a>ğŸIOCé…ç½®çš„ä¸‰ç§æ–¹å¼</h2><h3 id="xmlé…ç½®"><a href="#xmlé…ç½®" class="headerlink" title="xmlé…ç½®"></a>xmlé…ç½®</h3><blockquote><p>å°†beançš„ä¿¡æ¯é…ç½®.xmlæ–‡ä»¶é‡Œï¼Œé€šè¿‡SpringåŠ è½½æ–‡ä»¶ä¸ºæˆ‘ä»¬åˆ›å»ºbeanã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>é…ç½®xx.xmlæ–‡ä»¶</li><li>å£°æ˜å‘½åç©ºé—´å’Œé…ç½®bean</li></ol><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼š å¯ä»¥é€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œç»“æ„æ¸…æ™°ï¼Œé€šä¿—æ˜“æ‡‚ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š é…ç½®ç¹çï¼Œä¸æ˜“ç»´æŠ¤ï¼Œæ¯ç‡¥æ— å‘³ï¼Œæ‰©å±•æ€§å·®ã€‚</li></ul><h3 id="Java-é…ç½®"><a href="#Java-é…ç½®" class="headerlink" title="Java é…ç½®"></a>Java é…ç½®</h3><blockquote><p>å°†ç±»çš„åˆ›å»ºäº¤ç»™æˆ‘ä»¬é…ç½®çš„<strong>JavaConfigç±»</strong>æ¥å®Œæˆï¼ŒSpringåªè´Ÿè´£ç»´æŠ¤å’Œç®¡ç†ã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ol><li>åˆ›å»ºä¸€ä¸ªé…ç½®ç±»ï¼Œ æ·»åŠ **@Configurationæ³¨è§£**å£°æ˜ä¸ºé…ç½®ç±»ã€‚</li><li>åˆ›å»ºæ–¹æ³•ï¼Œæ–¹æ³•ä¸ŠåŠ ä¸Š**@bean**ï¼Œè¯¥æ–¹æ³•ç”¨äºåˆ›å»ºå®ä¾‹å¹¶è¿”å›ï¼Œè¯¥å®ä¾‹åˆ›å»ºåä¼šäº¤ç»™springç®¡ç†ï¼Œæ–¹æ³•åå»ºè®®ä¸å®ä¾‹åç›¸åŒï¼ˆé¦–å­—æ¯å°å†™ï¼‰ã€‚æ³¨ï¼šå®ä¾‹ç±»ä¸éœ€è¦åŠ ä»»ä½•æ³¨è§£ã€‚</li></ol><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeansConfig</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userDao&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserDaoImpl <span class="title function_">userDao</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserDaoImpl</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user service</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean(&quot;userService&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> UserServiceImpl <span class="title function_">userService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">UserServiceImpl</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserServiceImpl</span>();</span><br><span class="line">        userService.setUserDao(userDao());</span><br><span class="line">        <span class="keyword">return</span> userService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šé€‚ç”¨äºä»»ä½•åœºæ™¯ï¼Œé…ç½®æ–¹ä¾¿ï¼Œå› ä¸ºæ˜¯çº¯Javaä»£ç ï¼Œæ‰©å±•æ€§é«˜ï¼Œååˆ†çµæ´»ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šç”±äºæ˜¯é‡‡ç”¨Javaç±»çš„æ–¹å¼ï¼Œå£°æ˜ä¸æ˜æ˜¾ï¼Œå¦‚æœå¤§é‡é…ç½®ï¼Œå¯è¯»æ€§æ¯”è¾ƒå·®ã€‚</li></ul><h3 id="æ³¨è§£é…ç½®"><a href="#æ³¨è§£é…ç½®" class="headerlink" title="æ³¨è§£é…ç½®"></a>æ³¨è§£é…ç½®</h3><blockquote><p>é€šè¿‡åœ¨ç±»ä¸ŠåŠ æ³¨è§£çš„æ–¹å¼ï¼Œæ¥å£°æ˜ä¸€ä¸ªç±»äº¤ç»™Springç®¡ç†ï¼ŒSpringä¼šè‡ªåŠ¨æ‰«æå¸¦æœ‰**@Componentï¼Œ@Controllerï¼Œ@Serviceï¼Œ@Repository**è¿™å››ä¸ªæ³¨è§£çš„ç±»ï¼Œç„¶åå¸®æˆ‘ä»¬åˆ›å»ºå¹¶ç®¡ç†ï¼Œå‰ææ˜¯éœ€è¦å…ˆé…ç½®Springçš„æ³¨è§£æ‰«æå™¨ã€‚</p></blockquote><p><strong>æ­¥éª¤ï¼š</strong></p><ul><li>å¯¹ç±»æ·»åŠ @Componentç›¸å…³çš„æ³¨è§£ï¼Œæ¯”å¦‚@Controllerï¼Œ@Serviceï¼Œ@Repositoryã€‚</li><li>è®¾ç½®ComponentScançš„basePackage, æ¯”å¦‚<code>&lt;context:component-scan base-package=&#39;tech.pdai.springframework&#39;&gt;</code>, æˆ–è€…<code>@ComponentScan(&quot;tech.pdai.springframework&quot;)</code>æ³¨è§£ï¼Œæˆ–è€… <code>new AnnotationConfigApplicationContext(&quot;tech.pdai.springframework&quot;)</code>æŒ‡å®šæ‰«æçš„basePackageã€‚</li></ul><p><strong>ä»£ç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä¼˜ç‚¹</strong>ï¼šå¼€å‘ä¾¿æ·ï¼Œé€šä¿—æ˜“æ‡‚ï¼Œæ–¹ä¾¿ç»´æŠ¤ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼šå…·æœ‰å±€é™æ€§ï¼Œå¯¹äºä¸€äº›ç¬¬ä¸‰æ–¹èµ„æºï¼Œæ— æ³•æ·»åŠ æ³¨è§£ã€‚åªèƒ½é‡‡ç”¨XMLæˆ–JavaConfigçš„æ–¹å¼é…ç½®ã€‚</li></ul><h2 id="ğŸDIçš„ä¸‰ç§æ–¹å¼"><a href="#ğŸDIçš„ä¸‰ç§æ–¹å¼" class="headerlink" title="ğŸDIçš„ä¸‰ç§æ–¹å¼"></a>ğŸDIçš„ä¸‰ç§æ–¹å¼</h2><h3 id="setteræ³¨å…¥"><a href="#setteræ³¨å…¥" class="headerlink" title="setteræ³¨å…¥"></a>setteræ³¨å…¥</h3><p><strong>æ­¥éª¤ï¼š</strong></p><ul><li><p>éœ€è¦new UserServiceImpl()åˆ›å»ºå¯¹è±¡, æ‰€ä»¥éœ€è¦é»˜è®¤æ„é€ å‡½æ•°</p></li><li><p>è°ƒç”¨setUserDao()å‡½æ•°æ³¨å…¥userDaoçš„å€¼, æ‰€ä»¥éœ€è¦setUserDao()å‡½æ•°</p></li></ul><p><strong>ä»£ç ï¼š</strong></p><p>åœ¨XMLé…ç½®ä¸­ï¼Œpropertyéƒ½æ˜¯setteræ–¹å¼æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;property name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„serviceç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * set dao.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDao user dao</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUserDao</span><span class="params">(UserDaoImpl userDao)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDao;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ„é€ å‡½æ•°æ³¨å…¥"><a href="#æ„é€ å‡½æ•°æ³¨å…¥" class="headerlink" title="æ„é€ å‡½æ•°æ³¨å…¥"></a>æ„é€ å‡½æ•°æ³¨å…¥</h3><p>XMLé…ç½®ä¸­ï¼Œ<code>&lt;constructor-arg&gt;</code>æ˜¯é€šè¿‡æ„é€ å‡½æ•°å‚æ•°æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="line">&lt;beans xmlns=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span><br><span class="line">       xmlns:xsi=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="line">       xsi:schemaLocation=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span><br><span class="line"><span class="string"> http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span><br><span class="line">    &lt;!-- services --&gt;</span><br><span class="line">    &lt;bean id=<span class="string">&quot;userService&quot;</span> class=<span class="string">&quot;tech.pdai.springframework.service.UserServiceImpl&quot;</span>&gt;</span><br><span class="line">        &lt;constructor-arg name=<span class="string">&quot;userDao&quot;</span> ref=<span class="string">&quot;userDao&quot;</span>/&gt;</span><br><span class="line">        &lt;!-- additional collaborators and configuration <span class="keyword">for</span> <span class="built_in">this</span> bean go here --&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">    &lt;!-- more bean definitions <span class="keyword">for</span> services go here --&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure><p>å¯¹åº”çš„serviceç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * init.</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> userDaoImpl user dao impl</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceImpl</span><span class="params">(UserDaoImpl userDaoImpl)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userDao = userDaoImpl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ ‡ç­¾<code>&lt;constructor-arg&gt;</code>ä¸­</p><ul><li>nameå±æ€§å¯¹åº”çš„å€¼ä¸ºæ„é€ å‡½æ•°ä¸­æ–¹æ³•<strong>å½¢å‚çš„å‚æ•°å</strong>ï¼Œå¿…é¡»è¦ä¿æŒä¸€è‡´ã€‚</li><li>refå±æ€§æŒ‡å‘çš„æ˜¯springçš„IOCå®¹å™¨ä¸­å…¶ä»–beanå¯¹è±¡ã€‚</li></ul><h3 id="æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰"><a href="#æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰" class="headerlink" title="æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰"></a>æ³¨è§£æ³¨å…¥ï¼ˆè‡ªåŠ¨è£…é…ï¼‰</h3><p>@Autowiredæœ€å¸¸ç”¨ï¼Œä¿®é¥°ç¬¦æœ‰ä¸‰ä¸ªå±æ€§ï¼šConstructorï¼ŒbyTypeï¼ŒbyNameã€‚é»˜è®¤æŒ‰ç…§<strong>byType</strong>æ³¨å…¥ã€‚</p><ul><li><strong>constructor</strong>ï¼šé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œè‡ªåŠ¨æ³¨å…¥ï¼Œspringä¼šåŒ¹é…ä¸æ„é€ æ–¹æ³•å‚æ•°ç±»å‹ä¸€è‡´çš„beanè¿›è¡Œæ³¨å…¥ï¼Œå¦‚æœæœ‰ä¸€ä¸ªå¤šå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œä¸€ä¸ªåªæœ‰ä¸€ä¸ªå‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œåœ¨å®¹å™¨ä¸­æŸ¥æ‰¾åˆ°å¤šä¸ªåŒ¹é…å¤šå‚æ•°æ„é€ æ–¹æ³•çš„beanï¼Œé‚£ä¹ˆspringä¼šä¼˜å…ˆå°†beanæ³¨å…¥åˆ°<strong>å¤šå‚æ•°çš„æ„é€ æ–¹æ³•</strong>ä¸­ã€‚</li><li><strong>byName</strong>ï¼šè¢«æ³¨å…¥beançš„idåå¿…é¡»ä¸setæ–¹æ³•<strong>ååŠæˆªåŒ¹é…</strong>ï¼Œå¹¶ä¸”idåç§°çš„ç¬¬ä¸€ä¸ªå•è¯é¦–å­—æ¯å¿…é¡»å°å†™ï¼Œè¿™ä¸€ç‚¹ä¸æ‰‹åŠ¨setæ³¨å…¥æœ‰ç‚¹ä¸åŒã€‚</li><li><strong>byType</strong>ï¼šæŸ¥æ‰¾æ‰€æœ‰çš„setæ–¹æ³•ï¼Œå°†ç¬¦åˆå‚æ•°ç±»å‹çš„beanæ³¨å…¥ã€‚</li></ul><p>ä»£ç ï¼š</p><p>åœ¨Serviceç±»ä¸­ï¼ˆåœ¨å¼€å‘ä¸­æœ€å¸¸è§çš„æƒ…å†µï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * user dao impl.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserDaoImpl userDao;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * find user list.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> user list</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;User&gt; <span class="title function_">findUserList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> userDao.findUserList();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadPoolExecutor</title>
      <link href="/posts/47319/"/>
      <url>/posts/47319/</url>
      
        <content type="html"><![CDATA[<h2 id="ğŸThreadPoolExecutorç®€ä»‹"><a href="#ğŸThreadPoolExecutorç®€ä»‹" class="headerlink" title="ğŸThreadPoolExecutorç®€ä»‹"></a>ğŸThreadPoolExecutorç®€ä»‹</h2><p>å…ˆæ¥çœ‹ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleThreadPool</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">Runnable</span> <span class="variable">worker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WorkerThread</span>(<span class="string">&quot;&quot;</span> + i);</span><br><span class="line">            executor.execute(worker);</span><br><span class="line">          &#125;</span><br><span class="line">        executor.shutdown(); <span class="comment">// This will make the executor accept no new threads and finish all existing threads in the queue</span></span><br><span class="line">        <span class="keyword">while</span> (!executor.isTerminated()) &#123; <span class="comment">// Wait until all threads are finish,and also you can use &quot;executor.awaitTermination();&quot; to wait</span></span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Finished all threads&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šç¨‹åºçš„è¾“å‡ºä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> Start. Command = <span class="number">1</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> Start. Command = <span class="number">3</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> Start. Command = <span class="number">0</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> Start. Command = <span class="number">2</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> Start. Command = <span class="number">4</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> Start. Command = <span class="number">8</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> Start. Command = <span class="number">9</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> Start. Command = <span class="number">7</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> Start. Command = <span class="number">6</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> Start. Command = <span class="number">5</span></span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">2</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">4</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">3</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">5</span> End.</span><br><span class="line">pool-<span class="number">1</span>-thread-<span class="number">1</span> End.</span><br><span class="line">Finished all threads</span><br></pre></td></tr></table></figure><p>ç¨‹åºåˆ›å»ºäº†å›ºå®šå¤§å°ä¸º5ä¸ªå·¥ä½œçº¿ç¨‹çš„çº¿ç¨‹æ± ã€‚ç„¶ååˆ†é…ç»™çº¿ç¨‹æ± 10ä¸ªå·¥ä½œï¼Œå› ä¸ºçº¿ç¨‹æ± å¤§å°ä¸º5ï¼Œå®ƒå°†å¯åŠ¨5ä¸ªå·¥ä½œçº¿ç¨‹å…ˆå¤„ç†5ä¸ªå·¥ä½œï¼Œå…¶ä»–çš„å·¥ä½œåˆ™å¤„äºç­‰å¾…çŠ¶æ€ï¼Œä¸€æ—¦æœ‰å·¥ä½œå®Œæˆï¼Œç©ºé—²ä¸‹æ¥å·¥ä½œçº¿ç¨‹å°±ä¼šæ¡å–ç­‰å¾…é˜Ÿåˆ—é‡Œçš„å…¶ä»–å·¥ä½œè¿›è¡Œæ‰§è¡Œã€‚</p><h2 id="ğŸåŸç†"><a href="#ğŸåŸç†" class="headerlink" title="ğŸåŸç†"></a>ğŸåŸç†</h2><h3 id="1-çº¿ç¨‹æ± çŠ¶æ€"><a href="#1-çº¿ç¨‹æ± çŠ¶æ€" class="headerlink" title="1 çº¿ç¨‹æ± çŠ¶æ€"></a>1 çº¿ç¨‹æ± çŠ¶æ€</h3><p>ThreadPoolExecutor ä½¿ç”¨ int çš„é«˜ 3 ä½æ¥è¡¨ç¤ºçº¿ç¨‹æ± çŠ¶æ€ï¼Œä½ 29 ä½è¡¨ç¤ºçº¿ç¨‹æ•°é‡</p><table><thead><tr><th align="center">åç§°</th><th align="center">é«˜3ä½</th><th align="center">æ˜¯å¦æ¥å—æ–°ä»»åŠ¡</th><th align="center">æ˜¯å¦æ¥å—é˜»å¡é˜Ÿåˆ—ä»»åŠ¡</th><th align="center">å¤‡æ³¨</th></tr></thead><tbody><tr><td align="center">RUNNING</td><td align="center">111</td><td align="center">Y</td><td align="center">Y</td><td align="center"></td></tr><tr><td align="center">SHUTDOWN</td><td align="center">000</td><td align="center">N</td><td align="center">Y</td><td align="center">ä¸ä¼šæ¥æ”¶æ–°ä»»åŠ¡ï¼Œä½†ä¼šå¤„ç†é˜»å¡é˜Ÿåˆ—å‰©ä½™ä»»åŠ¡</td></tr><tr><td align="center">STOP</td><td align="center">001</td><td align="center">N</td><td align="center">N</td><td align="center">ä¼šä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶æŠ›å¼ƒé˜»å¡é˜Ÿåˆ— ä»»åŠ¡</td></tr><tr><td align="center">TIDYING</td><td align="center">010</td><td align="center">-</td><td align="center">-</td><td align="center">ä»»åŠ¡å…¨æ‰§è¡Œå®Œæ¯•ï¼Œæ´»åŠ¨çº¿ç¨‹ä¸º 0 å³å°†è¿›å…¥ ç»ˆç»“</td></tr><tr><td align="center">TERMINATED</td><td align="center">011</td><td align="center">-</td><td align="center">-</td><td align="center"></td></tr></tbody></table><p>è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨ä¸€ä¸ªåŸå­å˜é‡ ctl ä¸­ï¼Œå°†çº¿ç¨‹æ± çŠ¶æ€ä¸çº¿ç¨‹ä¸ªæ•°åˆäºŒä¸ºä¸€ï¼Œå¯ä»¥ç”¨ä¸€æ¬¡ cas åŸå­æ“ä½œè¿›è¡Œèµ‹å€¼</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// c ä¸ºæ—§å€¼ï¼Œ ctlOf è¿”å›ç»“æœä¸ºæ–°å€¼</span></span><br><span class="line">ctl.compareAndSet(c, ctlOf(targetState, workerCountOf(c))));</span><br><span class="line"> <span class="comment">// rs ä¸ºé«˜ 3 ä½ä»£è¡¨çº¿ç¨‹æ± çŠ¶æ€ï¼Œ wc ä¸ºä½ 29 ä½ä»£è¡¨çº¿ç¨‹ä¸ªæ•°ï¼Œctl æ˜¯åˆå¹¶å®ƒä»¬</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">ctlOf</span><span class="params">(<span class="type">int</span> rs, <span class="type">int</span> wc)</span> &#123; <span class="keyword">return</span> rs | wc; &#125;</span><br></pre></td></tr></table></figure><h3 id="2-ä¸ƒå¤§å‚æ•°"><a href="#2-ä¸ƒå¤§å‚æ•°" class="headerlink" title="2 ä¸ƒå¤§å‚æ•°"></a>2 ä¸ƒå¤§å‚æ•°</h3><img src="/img/47319/ThreadPoolExecuter.png" alt="ThreadPoolExecuter" style="zoom:67%;" /><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(<span class="type">int</span> corePoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">int</span> maximumPoolSize,</span></span><br><span class="line"><span class="params">                              <span class="type">long</span> keepAliveTime,</span></span><br><span class="line"><span class="params">                              TimeUnit unit,</span></span><br><span class="line"><span class="params">                              BlockingQueue&lt;Runnable&gt; workQueue,</span></span><br><span class="line"><span class="params">                              RejectedExecutionHandler handler)</span></span><br></pre></td></tr></table></figure><p><code>corePoolSize</code> çº¿ç¨‹æ± ä¸­çš„æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œå½“æäº¤ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œçº¿ç¨‹æ± åˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç›´åˆ°å½“å‰çº¿ç¨‹æ•°ç­‰äºcorePoolSize, å³ä½¿æœ‰å…¶ä»–ç©ºé—²çº¿ç¨‹èƒ½å¤Ÿæ‰§è¡Œæ–°æ¥çš„ä»»åŠ¡, ä¹Ÿä¼šç»§ç»­åˆ›å»ºçº¿ç¨‹ï¼›å¦‚æœå½“å‰çº¿ç¨‹æ•°ä¸ºcorePoolSizeï¼Œç»§ç»­æäº¤çš„ä»»åŠ¡è¢«ä¿å­˜åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…è¢«æ‰§è¡Œï¼›å¦‚æœæ‰§è¡Œäº†çº¿ç¨‹æ± çš„prestartAllCoreThreads()æ–¹æ³•ï¼Œçº¿ç¨‹æ± ä¼šæå‰åˆ›å»ºå¹¶å¯åŠ¨æ‰€æœ‰æ ¸å¿ƒçº¿ç¨‹ã€‚<strong>æ ¸å¿ƒçº¿ç¨‹æ•°ç›®å¯ä»¥ä¸º0</strong></p><p><code>workQueue</code> ç”¨æ¥ä¿å­˜ç­‰å¾…è¢«æ‰§è¡Œçš„ä»»åŠ¡çš„é˜»å¡é˜Ÿåˆ—. åœ¨JDKä¸­æä¾›äº†å¦‚ä¸‹é˜»å¡é˜Ÿåˆ—: </p><p>â€‹<code>ArrayBlockingQueue</code>: åŸºäºæ•°ç»„ç»“æ„çš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼›</p><p>â€‹<code>LinkedBlockingQueue</code>: åŸºäºé“¾è¡¨ç»“æ„çš„é˜»å¡é˜Ÿåˆ—ï¼ŒæŒ‰FIFOæ’åºä»»åŠ¡ï¼Œååé‡é€šå¸¸è¦é«˜äºArrayBlockingQueueï¼›</p><p>â€‹<code>SynchronousQueue</code>: ä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ï¼Œæ¯ä¸ªæ’å…¥æ“ä½œå¿…é¡»ç­‰åˆ°å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ç§»é™¤æ“ä½œï¼Œå¦åˆ™æ’å…¥æ“ä½œä¸€ç›´å¤„äºé˜»å¡çŠ¶æ€ï¼Œååé‡é€šå¸¸è¦é«˜äºLinkedBlockingQueueï¼›</p><p>â€‹<code>PriorityBlockingQueue</code>: å…·æœ‰ä¼˜å…ˆçº§çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ï¼›</p><p><code>maximumPoolSize </code> çº¿ç¨‹æ± ä¸­å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ï¼Œ<strong>æ ¸å¿ƒçº¿ç¨‹+æ•‘æ€¥çº¿ç¨‹</strong>çš„æœ€å¤§æ•°ç›®ã€‚å¦‚æœå½“å‰é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”ç»§ç»­æäº¤ä»»åŠ¡ï¼Œåˆ™åˆ›å»ºæ–°çš„çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œå‰ææ˜¯å½“å‰çº¿ç¨‹æ•°å°äºmaximumPoolSizeï¼›å½“é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œé˜Ÿåˆ—, åˆ™maximumPoolSizeåˆ™ä¸èµ·ä½œç”¨, å› ä¸ºæ— æ³•æäº¤è‡³æ ¸å¿ƒçº¿ç¨‹æ± çš„çº¿ç¨‹ä¼šä¸€ç›´æŒç»­åœ°æ”¾å…¥workQueue.</p><p><code>keepAliveTime </code> çº¿ç¨‹ç©ºé—²æ—¶çš„å­˜æ´»æ—¶é—´ï¼Œå³å½“çº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶ï¼Œè¯¥çº¿ç¨‹ç»§ç»­å­˜æ´»çš„æ—¶é—´ï¼›é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥å‚æ•°åªåœ¨çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶æ‰æœ‰ç”¨, è¶…è¿‡è¿™ä¸ªæ—¶é—´çš„ç©ºé—²çº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼›</p><p><code>unit </code> keepAliveTimeçš„å•ä½</p><p><code>threadFactory </code> åˆ›å»ºçº¿ç¨‹çš„å·¥å‚ï¼Œé€šè¿‡è‡ªå®šä¹‰çš„çº¿ç¨‹å·¥å‚å¯ä»¥ç»™æ¯ä¸ªæ–°å»ºçš„çº¿ç¨‹è®¾ç½®ä¸€ä¸ªå…·æœ‰è¯†åˆ«åº¦çš„çº¿ç¨‹åã€‚é»˜è®¤ä¸ºDefaultThreadFactory</p><p><code>handler </code> çº¿ç¨‹æ± çš„<strong>é¥±å’Œç­–ç•¥</strong>ï¼Œå½“é˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œä¸”æ²¡æœ‰ç©ºé—²çš„å·¥ä½œçº¿ç¨‹ï¼Œå¦‚æœç»§ç»­æäº¤ä»»åŠ¡ï¼Œå¿…é¡»é‡‡å–ä¸€ç§ç­–ç•¥å¤„ç†è¯¥ä»»åŠ¡ï¼Œçº¿ç¨‹æ± æä¾›äº†4ç§ç­–ç•¥:</p><p>â€‹<code>AbortPolicy</code>: ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œé»˜è®¤ç­–ç•¥ï¼›</p><p>â€‹<code>CallerRunsPolicy</code>: ç”¨è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ï¼›</p><p>â€‹<code>DiscardOldestPolicy</code>: ä¸¢å¼ƒé˜»å¡é˜Ÿåˆ—ä¸­é æœ€å‰çš„ä»»åŠ¡ï¼Œå¹¶æ‰§è¡Œå½“å‰ä»»åŠ¡ï¼›</p><p>â€‹<code>DiscardPolicy</code>: ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼›</p><h3 id="3-ExecuteåŸç†"><a href="#3-ExecuteåŸç†" class="headerlink" title="3 ExecuteåŸç†"></a>3 ExecuteåŸç†</h3><p>å½“ä¸€ä¸ªä»»åŠ¡æäº¤è‡³çº¿ç¨‹æ± ä¹‹å:</p><ol><li>çº¿ç¨‹æ± é¦–å…ˆå½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡æ˜¯å¦å°‘äºcorePoolSizeã€‚å¦‚æœæ˜¯ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ã€‚å¦‚æœéƒ½åœ¨æ‰§è¡Œä»»åŠ¡ï¼Œåˆ™è¿›å…¥2.</li><li>åˆ¤æ–­BlockingQueueæ˜¯å¦å·²ç»æ»¡äº†ï¼Œå€˜è‹¥è¿˜æ²¡æœ‰æ»¡ï¼Œåˆ™å°†çº¿ç¨‹æ”¾å…¥BlockingQueueã€‚å¦åˆ™è¿›å…¥3.</li><li>å¦‚æœåˆ›å»ºä¸€ä¸ªæ–°çš„å·¥ä½œçº¿ç¨‹å°†ä½¿å½“å‰è¿è¡Œçš„çº¿ç¨‹æ•°é‡è¶…è¿‡maximumPoolSizeï¼Œåˆ™äº¤ç»™RejectedExecutionHandleræ¥å¤„ç†ä»»åŠ¡ã€‚</li></ol><h2 id="ğŸç±»å‹"><a href="#ğŸç±»å‹" class="headerlink" title="ğŸç±»å‹"></a>ğŸç±»å‹</h2><h3 id="1-newFixedThreadPool"><a href="#1-newFixedThreadPool" class="headerlink" title="1 newFixedThreadPool"></a>1 newFixedThreadPool</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newFixedThreadPool</span><span class="params">(<span class="type">int</span> nThreads)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(nThreads, nThreads,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong></p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•° &#x3D; æœ€å¤§çº¿ç¨‹æ•°ï¼ˆæ²¡æœ‰æ•‘æ€¥çº¿ç¨‹è¢«åˆ›å»ºï¼‰ï¼Œå› æ­¤ä¹Ÿæ— éœ€è¶…æ—¶æ—¶é—´ </li><li>é˜»å¡é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå¯ä»¥æ”¾ä»»æ„æ•°é‡çš„ä»»åŠ¡</li></ul><p><strong>é€‚ç”¨</strong></p><p>ä»»åŠ¡é‡å·²çŸ¥ï¼Œç›¸å¯¹è€—æ—¶çš„ä»»åŠ¡</p><h3 id="2-newSingleThreadExecutor"><a href="#2-newSingleThreadExecutor" class="headerlink" title="2 newSingleThreadExecutor"></a>2 newSingleThreadExecutor</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newSingleThreadExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">FinalizableDelegatedExecutorService</span></span><br><span class="line">        (<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">                                <span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">                                <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong></p><ul><li>è‡ªå·±åˆ›å»ºä¸€ä¸ªå•çº¿ç¨‹ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼Œå¦‚æœä»»åŠ¡æ‰§è¡Œå¤±è´¥è€Œç»ˆæ­¢é‚£ä¹ˆæ²¡æœ‰ä»»ä½•è¡¥æ•‘æªæ–½ï¼Œè€Œçº¿ç¨‹æ± è¿˜ä¼šæ–°å»ºä¸€ ä¸ªçº¿ç¨‹ï¼Œä¿è¯æ± çš„æ­£å¸¸å·¥ä½œ </li><li>Executors.newSingleThreadExecutor() çº¿ç¨‹ä¸ªæ•°å§‹ç»ˆä¸º1ï¼Œä¸èƒ½ä¿®æ”¹</li><li>Executors.newFixedThreadPool(1) åˆå§‹æ—¶ä¸º1ï¼Œä»¥åè¿˜å¯ä»¥ä¿®æ”¹</li></ul><p><strong>é€‚ç”¨</strong></p><p>å¸Œæœ›å¤šä¸ªä»»åŠ¡æ’é˜Ÿæ‰§è¡Œã€‚çº¿ç¨‹æ•°å›ºå®šä¸º 1ï¼Œä»»åŠ¡æ•°å¤šäº 1 æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™å”¯ä¸€çš„çº¿ç¨‹ ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾</p><h3 id="3-newCachedThreadPool"><a href="#3-newCachedThreadPool" class="headerlink" title="3 newCachedThreadPool"></a>3 newCachedThreadPool</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title function_">newCachedThreadPool</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">0</span>, Integer.MAX_VALUE,</span><br><span class="line">                                    <span class="number">60L</span>, TimeUnit.SECONDS,</span><br><span class="line">                                    <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;Runnable&gt;());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç‰¹ç‚¹</strong></p><ul><li>æ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯ 0ï¼Œ æœ€å¤§çº¿ç¨‹æ•°æ˜¯ Integer.MAX_VALUEï¼Œæ•‘æ€¥çº¿ç¨‹çš„ç©ºé—²ç”Ÿå­˜æ—¶é—´æ˜¯ 60sï¼Œæ„å‘³ç€(1)å…¨éƒ¨éƒ½æ˜¯æ•‘æ€¥çº¿ç¨‹ï¼ˆ60s åå¯ä»¥å›æ”¶ï¼‰(2)æ•‘æ€¥çº¿ç¨‹å¯ä»¥æ— é™åˆ›å»º </li><li>é˜Ÿåˆ—é‡‡ç”¨äº† SynchronousQueue å®ç°ç‰¹ç‚¹æ˜¯ï¼Œå®ƒæ²¡æœ‰å®¹é‡ï¼Œæ²¡æœ‰çº¿ç¨‹æ¥å–æ˜¯æ”¾ä¸è¿›å»çš„ï¼ˆä¸€æ‰‹äº¤é’±ã€ä¸€æ‰‹äº¤è´§ï¼‰</li></ul><p><strong>é€‚ç”¨</strong></p><p>ä»»åŠ¡æ•°æ¯”è¾ƒå¯†é›†ï¼Œä½†æ¯ä¸ªä»»åŠ¡æ‰§è¡Œæ—¶é—´è¾ƒçŸ­çš„æƒ…å†µ</p><h3 id="4-newScheduledThreadPool"><a href="#4-newScheduledThreadPool" class="headerlink" title="4 newScheduledThreadPool"></a>4 newScheduledThreadPool</h3><p>ä»»åŠ¡è°ƒåº¦çº¿ç¨‹æ± ä¹‹å‰ï¼Œå¯ä»¥ä½¿ç”¨ java.util.Timer æ¥å®ç°å®šæ—¶åŠŸèƒ½ï¼ŒTimer çš„ä¼˜ç‚¹åœ¨äºç®€å•æ˜“ç”¨ï¼Œä½†ç”±äºæ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ç”±åŒä¸€ä¸ªçº¿ç¨‹æ¥è°ƒåº¦ï¼Œå› æ­¤æ‰€æœ‰ä»»åŠ¡éƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼ŒåŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªä»»åŠ¡åœ¨æ‰§è¡Œï¼Œå‰ä¸€ä¸ªä»»åŠ¡çš„å»¶è¿Ÿæˆ–å¼‚å¸¸éƒ½å°†ä¼šå½±å“åˆ°ä¹‹åçš„ä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ScheduledExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newScheduledThreadPool(<span class="number">2</span>);</span><br><span class="line"> <span class="comment">// æ·»åŠ ä¸¤ä¸ªä»»åŠ¡ï¼Œå¸Œæœ›å®ƒä»¬éƒ½åœ¨ 1s åæ‰§è¡Œ</span></span><br><span class="line">executor.schedule(() -&gt; &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;ä»»åŠ¡1ï¼Œæ‰§è¡Œæ—¶é—´ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"> <span class="keyword">try</span> &#123; Thread.sleep(<span class="number">2000</span>); &#125; <span class="keyword">catch</span> (InterruptedException e) &#123; &#125;</span><br><span class="line"> &#125;, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br><span class="line"> executor.schedule(() -&gt; &#123;</span><br><span class="line"> System.out.println(<span class="string">&quot;ä»»åŠ¡2ï¼Œæ‰§è¡Œæ—¶é—´ï¼š&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>());</span><br><span class="line"> &#125;, <span class="number">1000</span>, TimeUnit.MILLISECONDS);</span><br></pre></td></tr></table></figure><p>è¾“å‡º</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ä»»åŠ¡<span class="number">1</span>ï¼Œæ‰§è¡Œæ—¶é—´ï¼šThu Jan <span class="number">03</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">17</span> CST <span class="number">2019</span> </span><br><span class="line">ä»»åŠ¡<span class="number">2</span>ï¼Œæ‰§è¡Œæ—¶é—´ï¼šThu Jan <span class="number">03</span> <span class="number">12</span>:<span class="number">45</span>:<span class="number">17</span> CST <span class="number">2019</span> </span><br></pre></td></tr></table></figure><p><strong>é€‚ç”¨</strong></p><p>çº¿ç¨‹æ•°å›ºå®šï¼Œä»»åŠ¡æ•°å¤šäºçº¿ç¨‹æ•°æ—¶ï¼Œä¼šæ”¾å…¥æ— ç•Œé˜Ÿåˆ—æ’é˜Ÿã€‚ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿä¸ä¼šè¢«é‡Šæ”¾ã€‚ç”¨æ¥æ‰§è¡Œå»¶è¿Ÿæˆ–åå¤æ‰§è¡Œçš„ä»»åŠ¡</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaä¸­çš„é”</title>
      <link href="/posts/51432/"/>
      <url>/posts/51432/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸæ€»è§ˆ"><a href="#ğŸæ€»è§ˆ" class="headerlink" title="ğŸæ€»è§ˆ"></a>ğŸæ€»è§ˆ</h3><p>Javaä¸­å¾€å¾€æ˜¯æŒ‰ç…§æ˜¯å¦å«æœ‰æŸä¸€ç‰¹æ€§æ¥å®šä¹‰é”ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><img src="/img/51432/java-lock-1.png" alt="java-lock-1" style="zoom: 67%;" /><h3 id="ğŸä¹è§‚é”-VS-æ‚²è§‚é”"><a href="#ğŸä¹è§‚é”-VS-æ‚²è§‚é”" class="headerlink" title="ğŸä¹è§‚é” VS æ‚²è§‚é”"></a>ğŸä¹è§‚é” VS æ‚²è§‚é”</h3><blockquote><p>å¯¹äºåŒä¸€ä¸ªæ•°æ®çš„å¹¶å‘æ“ä½œï¼Œæ‚²è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®çš„æ—¶å€™ä¸€å®šæœ‰åˆ«çš„çº¿ç¨‹æ¥ä¿®æ”¹æ•°æ®ï¼Œå› æ­¤åœ¨è·å–æ•°æ®çš„æ—¶å€™<strong>ä¼šå…ˆåŠ é”</strong>ï¼Œç¡®ä¿æ•°æ®ä¸ä¼šè¢«åˆ«çš„çº¿ç¨‹ä¿®æ”¹ã€‚<strong>synchronizedå…³é”®å­—å’ŒLockçš„å®ç°ç±»</strong>éƒ½æ˜¯æ‚²è§‚é”ã€‚</p><p>è€Œä¹è§‚é”è®¤ä¸ºè‡ªå·±åœ¨ä½¿ç”¨æ•°æ®æ—¶ä¸ä¼šæœ‰åˆ«çš„çº¿ç¨‹ä¿®æ”¹æ•°æ®ï¼Œæ‰€ä»¥<strong>ä¸ä¼šæ·»åŠ é”</strong>ï¼Œåªæ˜¯åœ¨æ›´æ–°æ•°æ®çš„æ—¶å€™å»åˆ¤æ–­ä¹‹å‰æœ‰æ²¡æœ‰åˆ«çš„çº¿ç¨‹æ›´æ–°äº†è¿™ä¸ªæ•°æ®ã€‚å¦‚æœè¿™ä¸ªæ•°æ®æ²¡æœ‰è¢«æ›´æ–°ï¼Œå½“å‰çº¿ç¨‹å°†è‡ªå·±ä¿®æ”¹çš„æ•°æ®æˆåŠŸå†™å…¥ã€‚å¦‚æœæ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œåˆ™æ ¹æ®ä¸åŒçš„å®ç°æ–¹å¼æ‰§è¡Œä¸åŒçš„æ“ä½œï¼ˆä¾‹å¦‚æŠ¥é”™æˆ–è€…è‡ªåŠ¨é‡è¯•ï¼‰ã€‚æœ€å¸¸é‡‡ç”¨çš„æ˜¯<strong>CASç®—æ³•</strong>å®ç°ã€‚</p></blockquote><img src="/img/51432/java-lock-2.png" alt="java-lock-2" style="zoom: 50%;" /><ul><li><strong>æ‚²è§‚é”é€‚åˆå†™æ“ä½œå¤šçš„åœºæ™¯</strong>ï¼Œå…ˆåŠ é”å¯ä»¥ä¿è¯å†™æ“ä½œæ—¶æ•°æ®æ­£ç¡®ã€‚</li><li><strong>ä¹è§‚é”é€‚åˆè¯»æ“ä½œå¤šçš„åœºæ™¯</strong>ï¼Œä¸åŠ é”çš„ç‰¹ç‚¹èƒ½å¤Ÿä½¿å…¶è¯»æ“ä½œçš„æ€§èƒ½å¤§å¹…æå‡ã€‚</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">// ------------------------- æ‚²è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------</span><br><span class="line">// synchronized</span><br><span class="line">public synchronized void testMethod() &#123;</span><br><span class="line">// æ“ä½œåŒæ­¥èµ„æº</span><br><span class="line">&#125;</span><br><span class="line">// ReentrantLock</span><br><span class="line">private ReentrantLock lock = new ReentrantLock(); // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªé”</span><br><span class="line">public void modifyPublicResources() &#123;</span><br><span class="line">lock.lock();</span><br><span class="line">// æ“ä½œåŒæ­¥èµ„æº</span><br><span class="line">lock.unlock();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">// ------------------------- ä¹è§‚é”çš„è°ƒç”¨æ–¹å¼ -------------------------</span><br><span class="line">private AtomicInteger atomicInteger = new AtomicInteger();  // éœ€è¦ä¿è¯å¤šä¸ªçº¿ç¨‹ä½¿ç”¨çš„æ˜¯åŒä¸€ä¸ªAtomicInteger</span><br><span class="line">atomicInteger.incrementAndGet(); //æ‰§è¡Œè‡ªå¢1</span><br></pre></td></tr></table></figure><h3 id="ğŸè‡ªæ—‹é”-VS-éè‡ªæ—‹é”"><a href="#ğŸè‡ªæ—‹é”-VS-éè‡ªæ—‹é”" class="headerlink" title="ğŸè‡ªæ—‹é” VS éè‡ªæ—‹é”"></a>ğŸè‡ªæ—‹é” VS éè‡ªæ—‹é”</h3><p>é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚</p><p>åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹<strong>ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´</strong>ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚</p><blockquote><p>è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œ<strong>è‡ªæ—‹</strong>ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±<strong>å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æº</strong>ï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯<strong>è‡ªæ—‹é”</strong>ã€‚</p></blockquote><img src="/img/51432/java-lock-4.png" alt="java-lock-4" style="zoom:50%;" /><h3 id="ğŸæ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”"><a href="#ğŸæ— é”-VS-åå‘é”-VS-è½»é‡çº§é”-VS-é‡é‡çº§é”" class="headerlink" title="ğŸæ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”"></a>ğŸæ— é” VS åå‘é” VS è½»é‡çº§é” VS é‡é‡çº§é”</h3><p>è¿™å››ç§é”æ˜¯ä¸“é—¨é’ˆå¯¹synchronizedçš„ã€‚</p><p>æ— é” â€“&gt; åå‘é” â€“&gt; è½»é‡çº§é” â€“&gt; é‡é‡çº§é”</p><blockquote><p>åå‘é”é€šè¿‡å¯¹æ¯”Mark Wordè§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…æ‰§è¡ŒCASæ“ä½œã€‚è½»é‡çº§é”é€šè¿‡ç”¨CASæ“ä½œå’Œè‡ªæ—‹æ¥è§£å†³åŠ é”é—®é¢˜ï¼Œé¿å…çº¿ç¨‹é˜»å¡å’Œå”¤é†’è€Œå½±å“æ€§èƒ½ã€‚é‡é‡çº§é”æ˜¯å°†é™¤äº†æ‹¥æœ‰é”çš„çº¿ç¨‹ä»¥å¤–çš„çº¿ç¨‹éƒ½é˜»å¡ã€‚</p></blockquote><h3 id="ğŸå…¬å¹³é”-VS-éå…¬å¹³é”"><a href="#ğŸå…¬å¹³é”-VS-éå…¬å¹³é”" class="headerlink" title="ğŸå…¬å¹³é” VS éå…¬å¹³é”"></a>ğŸå…¬å¹³é” VS éå…¬å¹³é”</h3><blockquote><p>å…¬å¹³é”æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„<strong>ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”</strong>ã€‚</p><p>ä¼˜ç‚¹ï¼šç­‰å¾…é”çš„çº¿ç¨‹ä¸ä¼šé¥¿æ­»ã€‚</p><p>ç¼ºç‚¹ï¼šæ•´ä½“ååæ•ˆç‡ç›¸å¯¹éå…¬å¹³é”è¦ä½ï¼Œç­‰å¾…é˜Ÿåˆ—ä¸­é™¤ç¬¬ä¸€ä¸ªçº¿ç¨‹ä»¥å¤–çš„æ‰€æœ‰çº¿ç¨‹éƒ½ä¼šé˜»å¡ï¼ŒCPUå”¤é†’é˜»å¡çº¿ç¨‹çš„å¼€é”€æ¯”éå…¬å¹³é”å¤§ã€‚</p><hr><p>éå…¬å¹³é”æ˜¯å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œè·å–ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚ä½†å¦‚æœæ­¤æ—¶é”åˆšå¥½å¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å¯ä»¥<strong>æ— éœ€é˜»å¡ç›´æ¥è·å–åˆ°é”</strong>ï¼Œæ‰€ä»¥éå…¬å¹³é”æœ‰å¯èƒ½å‡ºç°åç”³è¯·é”çš„çº¿ç¨‹å…ˆè·å–é”çš„åœºæ™¯ã€‚</p><p>ä¼˜ç‚¹ï¼šå¯ä»¥å‡å°‘å”¤èµ·çº¿ç¨‹çš„å¼€é”€ï¼Œæ•´ä½“çš„ååæ•ˆç‡é«˜ï¼Œå› ä¸ºçº¿ç¨‹æœ‰å‡ ç‡ä¸é˜»å¡ç›´æ¥è·å¾—é”ï¼ŒCPUä¸å¿…å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚</p><p>ç¼ºç‚¹ï¼šå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½ä¼šé¥¿æ­»ï¼Œæˆ–è€…ç­‰å¾ˆä¹…æ‰ä¼šè·å¾—é”ã€‚</p></blockquote><p>ç¤ºä¾‹ï¼š</p><img src="/img/51432/java-lock-7.png" alt="java-lock-7" style="zoom:50%;" /><p>å‡è®¾æœ‰ä¸€å£æ°´äº•ï¼Œæœ‰ç®¡ç†å‘˜çœ‹å®ˆï¼Œç®¡ç†å‘˜æœ‰ä¸€æŠŠé”ï¼Œåªæœ‰æ‹¿åˆ°é”çš„äººæ‰èƒ½å¤Ÿæ‰“æ°´ï¼Œæ‰“å®Œæ°´è¦æŠŠé”è¿˜ç»™ç®¡ç†å‘˜ã€‚æ¯ä¸ªè¿‡æ¥æ‰“æ°´çš„äººéƒ½è¦ç®¡ç†å‘˜çš„å…è®¸å¹¶æ‹¿åˆ°é”ä¹‹åæ‰èƒ½å»æ‰“æ°´ï¼Œå¦‚æœå‰é¢æœ‰äººæ­£åœ¨æ‰“æ°´ï¼Œé‚£ä¹ˆè¿™ä¸ªæƒ³è¦æ‰“æ°´çš„äººå°±å¿…é¡»æ’é˜Ÿã€‚ç®¡ç†å‘˜ä¼šæŸ¥çœ‹ä¸‹ä¸€ä¸ªè¦å»æ‰“æ°´çš„äººæ˜¯ä¸æ˜¯é˜Ÿä¼é‡Œæ’æœ€å‰é¢çš„äººï¼Œå¦‚æœæ˜¯çš„è¯ï¼Œæ‰ä¼šç»™ä½ é”è®©ä½ å»æ‰“æ°´ï¼›å¦‚æœä½ ä¸æ˜¯æ’ç¬¬ä¸€çš„äººï¼Œå°±å¿…é¡»å»é˜Ÿå°¾æ’é˜Ÿï¼Œè¿™å°±æ˜¯å…¬å¹³é”ã€‚</p><img src="/img/51432/java-lock-8.png" alt="java-lock-8" style="zoom:50%;" /><p>å¯¹äºéå…¬å¹³é”ï¼Œç®¡ç†å‘˜å¯¹æ‰“æ°´çš„äººæ²¡æœ‰è¦æ±‚ã€‚å³ä½¿ç­‰å¾…é˜Ÿä¼é‡Œæœ‰æ’é˜Ÿç­‰å¾…çš„äººï¼Œä½†å¦‚æœåœ¨ä¸Šä¸€ä¸ªäººåˆšæ‰“å®Œæ°´æŠŠé”è¿˜ç»™ç®¡ç†å‘˜è€Œä¸”ç®¡ç†å‘˜è¿˜æ²¡æœ‰å…è®¸ç­‰å¾…é˜Ÿä¼é‡Œä¸‹ä¸€ä¸ªäººå»æ‰“æ°´æ—¶ï¼Œåˆšå¥½æ¥äº†ä¸€ä¸ªæ’é˜Ÿçš„äººï¼Œè¿™ä¸ªæ’é˜Ÿçš„äººæ˜¯å¯ä»¥ç›´æ¥ä»ç®¡ç†å‘˜é‚£é‡Œæ‹¿åˆ°é”å»æ‰“æ°´ï¼Œä¸éœ€è¦æ’é˜Ÿï¼ŒåŸæœ¬æ’é˜Ÿç­‰å¾…çš„äººåªèƒ½ç»§ç»­ç­‰å¾…ã€‚</p><h3 id="ğŸå¯é‡å…¥é”-VS-éå¯é‡å…¥é”"><a href="#ğŸå¯é‡å…¥é”-VS-éå¯é‡å…¥é”" class="headerlink" title="ğŸå¯é‡å…¥é” VS éå¯é‡å…¥é”"></a>ğŸå¯é‡å…¥é” VS éå¯é‡å…¥é”</h3><blockquote><p>å¯é‡å…¥é”åˆåé€’å½’é”ï¼Œæ˜¯æŒ‡åœ¨åŒä¸€ä¸ªçº¿ç¨‹åœ¨å¤–å±‚æ–¹æ³•è·å–é”çš„æ—¶å€™ï¼Œå†<strong>è¿›å…¥è¯¥çº¿ç¨‹çš„å†…å±‚æ–¹æ³•ä¼šè‡ªåŠ¨è·å–é”</strong>ï¼ˆå‰æé”å¯¹è±¡å¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œä¸ä¼šå› ä¸ºä¹‹å‰å·²ç»è·å–è¿‡è¿˜æ²¡é‡Šæ”¾è€Œé˜»å¡ã€‚Javaä¸­<strong>ReentrantLockå’Œsynchronized</strong>éƒ½æ˜¯å¯é‡å…¥é”ã€‚</p></blockquote><p>å¯é‡å…¥é”çš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä¸€å®šç¨‹åº¦é¿å…æ­»é”ã€‚</p><p>ä»£ç ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Widget</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•1æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">        doOthers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">doOthers</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ–¹æ³•2æ‰§è¡Œ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è§£é‡Š</span></span><br><span class="line">ç±»ä¸­çš„ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯è¢«å†…ç½®é”<span class="keyword">synchronized</span>ä¿®é¥°çš„ï¼ŒdoSomething()æ–¹æ³•ä¸­è°ƒç”¨doOthers()æ–¹æ³•ã€‚å› ä¸ºå†…ç½®é”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åŒä¸€ä¸ªçº¿ç¨‹åœ¨è°ƒç”¨doOthers()æ—¶å¯ä»¥ç›´æ¥è·å¾—å½“å‰å¯¹è±¡çš„é”ï¼Œè¿›å…¥doOthers()è¿›è¡Œæ“ä½œ</span><br><span class="line">å¦‚æœæ˜¯ä¸€ä¸ªä¸å¯é‡å…¥é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹åœ¨è°ƒç”¨doOthers()ä¹‹å‰éœ€è¦å°†æ‰§è¡ŒdoSomething()æ—¶è·å–å½“å‰å¯¹è±¡çš„é”é‡Šæ”¾æ‰ï¼Œå®é™…ä¸Šè¯¥å¯¹è±¡é”å·²è¢«å½“å‰çº¿ç¨‹æ‰€æŒæœ‰ï¼Œä¸”æ— æ³•é‡Šæ”¾ã€‚æ‰€ä»¥æ­¤æ—¶ä¼šå‡ºç°æ­»é”</span><br></pre></td></tr></table></figure><p>ç¤ºä¾‹ï¼š</p><img src="/img/51432/java-lock-12.png" alt="java-lock-12" style="zoom:50%;" /><p>å‡è®¾æœ‰å¤šä¸ªäººåœ¨æ’é˜Ÿæ‰“æ°´ï¼Œæ­¤æ—¶ç®¡ç†å‘˜å…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„å¤šä¸ªæ°´æ¡¶ç»‘å®šã€‚è¿™ä¸ªäººç”¨å¤šä¸ªæ°´æ¡¶æ‰“æ°´æ—¶ï¼Œç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šå¹¶æ‰“å®Œæ°´ä¹‹åï¼Œç¬¬äºŒä¸ªæ°´æ¡¶ä¹Ÿå¯ä»¥ç›´æ¥å’Œé”ç»‘å®šå¹¶å¼€å§‹æ‰“æ°´ï¼Œæ‰€æœ‰çš„æ°´æ¡¶éƒ½æ‰“å®Œæ°´ä¹‹åæ‰“æ°´äººæ‰ä¼šå°†é”è¿˜ç»™ç®¡ç†å‘˜ã€‚è¿™ä¸ªäººçš„æ‰€æœ‰æ‰“æ°´æµç¨‹éƒ½èƒ½å¤ŸæˆåŠŸæ‰§è¡Œï¼Œåç»­ç­‰å¾…çš„äººä¹Ÿèƒ½å¤Ÿæ‰“åˆ°æ°´ã€‚è¿™å°±æ˜¯å¯é‡å…¥é”ã€‚</p><img src="/img/51432/java-lock-13.png" alt="java-lock-13" style="zoom:50%;" /><p>ä½†å¦‚æœæ˜¯éå¯é‡å…¥é”çš„è¯ï¼Œæ­¤æ—¶ç®¡ç†å‘˜åªå…è®¸é”å’ŒåŒä¸€ä¸ªäººçš„ä¸€ä¸ªæ°´æ¡¶ç»‘å®šã€‚ç¬¬ä¸€ä¸ªæ°´æ¡¶å’Œé”ç»‘å®šæ‰“å®Œæ°´ä¹‹åå¹¶ä¸ä¼šé‡Šæ”¾é”ï¼Œå¯¼è‡´ç¬¬äºŒä¸ªæ°´æ¡¶ä¸èƒ½å’Œé”ç»‘å®šä¹Ÿæ— æ³•æ‰“æ°´ã€‚å½“å‰çº¿ç¨‹å‡ºç°æ­»é”ï¼Œæ•´ä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰çº¿ç¨‹éƒ½æ— æ³•è¢«å”¤é†’ã€‚</p><h3 id="ğŸç‹¬äº«é”-æ’ä»–é”-VS-å…±äº«é”"><a href="#ğŸç‹¬äº«é”-æ’ä»–é”-VS-å…±äº«é”" class="headerlink" title="ğŸç‹¬äº«é”(æ’ä»–é”) VS å…±äº«é”"></a>ğŸç‹¬äº«é”(æ’ä»–é”) VS å…±äº«é”</h3><blockquote><p><strong>ç‹¬äº«é”ä¹Ÿå«æ’ä»–é”</strong>ï¼Œæ˜¯æŒ‡è¯¥é”ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šæ’å®ƒé”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹ä¸èƒ½å†å¯¹AåŠ ä»»ä½•ç±»å‹çš„é”ã€‚è·å¾—æ’å®ƒé”çš„çº¿ç¨‹å³èƒ½è¯»æ•°æ®åˆèƒ½ä¿®æ”¹æ•°æ®ã€‚<strong>JDKä¸­çš„synchronizedå’ŒJUCä¸­Lockçš„å®ç°ç±»å°±æ˜¯äº’æ–¥é”</strong>ã€‚</p><p><strong>å…±äº«é”</strong>æ˜¯æŒ‡è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚å¦‚æœçº¿ç¨‹Tå¯¹æ•°æ®AåŠ ä¸Šå…±äº«é”åï¼Œåˆ™å…¶ä»–çº¿ç¨‹åªèƒ½å¯¹Aå†åŠ å…±äº«é”ï¼Œä¸èƒ½åŠ æ’å®ƒé”ã€‚è·å¾—å…±äº«é”çš„çº¿ç¨‹<strong>åªèƒ½è¯»æ•°æ®ï¼Œä¸èƒ½ä¿®æ”¹æ•°æ®</strong>ã€‚</p></blockquote>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>volatile</title>
      <link href="/posts/27530/"/>
      <url>/posts/27530/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸvolatileç®€ä»‹"><a href="#ğŸvolatileç®€ä»‹" class="headerlink" title="ğŸvolatileç®€ä»‹"></a>ğŸvolatileç®€ä»‹</h3><p>çº¿ç¨‹å®‰å…¨äº§ç”Ÿçš„ä¸‰ä¸ªä¸»è¦çš„é—®é¢˜æ˜¯ï¼šåŸå­æ€§ã€å¯è§æ€§å’Œæœ‰åºæ€§ã€‚volatileå…³é”®å­—å¯ä»¥<strong>è§£å†³å¯è§æ€§å’Œæœ‰åºæ€§</strong>ï¼Œä½†<strong>ä¸èƒ½è§£å†³åŸå­æ€§</strong>ã€‚</p><h3 id="ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰"><a href="#ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰" class="headerlink" title="ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰"></a>ğŸåŸå­æ€§ï¼ˆÃ—ï¼‰</h3><blockquote><p>å¤šçº¿ç¨‹ä¸‹ï¼Œä¸åŒçº¿ç¨‹çš„<strong>æŒ‡ä»¤å‘ç”Ÿäº†äº¤é”™</strong>å¯¼è‡´çš„å…±äº«å˜é‡çš„è¯»å†™æ··ä¹±</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¯”å¦‚å¯¹äºä¸€ä¸ªå‡æ³•æ“ä½œï¼Œæœ‰å¯èƒ½ç”±ä¸‰ä¸ªæŒ‡ä»¤ç»„æˆï¼Œæ“ä½œæ—¶éœ€è¦ä¿è¯ä¸‰æŒ‡ä»¤ä¸€è‡´</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">subtract</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> balance;</span><br><span class="line">    b -= <span class="number">5</span>;</span><br><span class="line">    balance = b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>volatile å¹¶ä¸èƒ½è§£å†³åŸå­æ€§</strong>ï¼Œç”¨æ‚²è§‚é”æˆ–ä¹è§‚é”è§£å†³</p><h3 id="ğŸå¯è§æ€§ï¼ˆâˆšï¼‰"><a href="#ğŸå¯è§æ€§ï¼ˆâˆšï¼‰" class="headerlink" title="ğŸå¯è§æ€§ï¼ˆâˆšï¼‰"></a>ğŸå¯è§æ€§ï¼ˆâˆšï¼‰</h3><blockquote><p>ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ã€æˆ–ç¼“å­˜ä¼˜åŒ–ã€æˆ– CPU æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¯¼è‡´çš„<strong>å¯¹å…±äº«å˜é‡æ‰€åšçš„ä¿®æ”¹å¦å¤–çš„çº¿ç¨‹çœ‹ä¸åˆ°</strong></p></blockquote><p>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿ<strong>é˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–</strong>å‘ç”Ÿï¼Œè®©ä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ForeverLoop</span> &#123;</span><br><span class="line">    <span class="comment">// volatile ä¿®é¥°å…±äº«å˜é‡ï¼Œèƒ½å¤Ÿé˜²æ­¢ç¼–è¯‘å™¨ç­‰ä¼˜åŒ–å‘ç”Ÿ</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">stop</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            stop = <span class="literal">true</span>;</span><br><span class="line">            get().debug(<span class="string">&quot;modify stop to true...&quot;</span>);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, stop);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">200</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            get().debug(<span class="string">&quot;&#123;&#125;&quot;</span>, stop);</span><br><span class="line">        &#125;).start();</span><br><span class="line"></span><br><span class="line">        foo();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// å¦‚æœwhileå¾ªç¯äº†ç‰¹åˆ«å¤šæ¬¡ï¼ˆå‡ ç™¾ä¸‡æ¬¡ï¼‰ï¼Œè¶…è¿‡äº†jitçš„é˜ˆå€¼ï¼Œä¾¿è®¤ä¸ºè¿™ä¸ªæ¡ä»¶ä¸€ç›´ä¸å˜</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚è¿™é‡Œçš„ï¼stopä¸€ç›´è®¤ä¸ºæ˜¯true</span></span><br><span class="line">    <span class="comment">// ç”¨volatileä¿®é¥°stopå¯ä»¥é˜²æ­¢ç¼–è¯‘å™¨ä¼˜åŒ–è¿›è€Œè§£å†³çº¿ç¨‹çš„å¯è§æ€§é—®é¢˜</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">foo</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!stop) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        get().debug(<span class="string">&quot;stopped... c:&#123;&#125;&quot;</span>, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰"><a href="#ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰" class="headerlink" title="ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰"></a>ğŸæœ‰åºæ€§ï¼ˆâˆšï¼‰</h3><blockquote><p>ç”±äºç¼–è¯‘å™¨ä¼˜åŒ–ã€æˆ–ç¼“å­˜ä¼˜åŒ–ã€æˆ– CPU æŒ‡ä»¤é‡æ’åºä¼˜åŒ–å¯¼è‡´æŒ‡ä»¤çš„<strong>å®é™…æ‰§è¡Œé¡ºåºä¸ç¼–å†™é¡ºåºä¸ä¸€è‡´</strong></p></blockquote><p>ç”¨ volatile ä¿®é¥°å…±äº«å˜é‡ä¼šåœ¨è¯»ã€å†™å…±äº«å˜é‡æ—¶åŠ å…¥ä¸åŒçš„<strong>å±éšœ</strong>ï¼Œé˜»æ­¢å…¶ä»–è¯»å†™æ“ä½œè¶Šè¿‡å±éšœï¼Œä»è€Œè¾¾åˆ°<strong>é˜»æ­¢é‡æ’åº</strong>çš„æ•ˆæœ</p><ul><li>volatile <strong>å˜é‡å†™</strong>åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœæ’åˆ° volatile å˜é‡å†™<strong>ä¹‹ä¸‹</strong></li><li>volatile <strong>å˜é‡è¯»</strong>åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœæ’åˆ° volatile å˜é‡è¯»<strong>ä¹‹ä¸Š</strong></li><li>volatile è¯»å†™åŠ å…¥çš„å±éšœåªèƒ½é˜²æ­¢åŒä¸€çº¿ç¨‹å†…çš„æŒ‡ä»¤é‡æ’</li></ul><p>ğŸš©å…³é”®å­—ï¼šä¸Šè¯»ä¸‹å†™</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JCStressTest</span></span><br><span class="line"><span class="meta">@Outcome(id = &#123;&quot;0, 0&quot;, &quot;1, 1&quot;, &quot;0, 1&quot;&#125;, expect = Expect.ACCEPTABLE, desc = &quot;ACCEPTABLE&quot;)</span></span><br><span class="line"><span class="meta">@Outcome(id = &quot;1, 0&quot;, expect = Expect.FORBIDDEN, desc = &quot;FORBIDDEN&quot;)</span></span><br><span class="line"><span class="meta">@State</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Case2</span> &#123;</span><br><span class="line">    <span class="type">int</span> x;</span><br><span class="line">    <span class="keyword">volatile</span> <span class="type">int</span> y;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Actor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor1</span><span class="params">()</span> &#123;</span><br><span class="line">        x = <span class="number">1</span>;</span><br><span class="line">        y = <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// volatileä¿®é¥°çš„y,å†™åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸Šæ–¹å…¶å®ƒå†™æ“ä½œè¶Šè¿‡å±éšœ</span></span><br><span class="line">        <span class="comment">// ^^^^^^^^^^^^^^</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Actor</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">actor2</span><span class="params">(II_Result r)</span> &#123;</span><br><span class="line">        r.r1 = y;</span><br><span class="line">        <span class="comment">// volatileä¿®é¥°çš„y,è¯»åŠ çš„å±éšœæ˜¯é˜»æ­¢ä¸‹æ–¹å…¶å®ƒè¯»æ“ä½œè¶Šè¿‡å±éšœ</span></span><br><span class="line">        <span class="comment">// VVVVVVVVVVVVVV</span></span><br><span class="line">        r.r2 = x;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸåœºæ™¯ç¤ºä¾‹"><a href="#ğŸåœºæ™¯ç¤ºä¾‹" class="headerlink" title="ğŸåœºæ™¯ç¤ºä¾‹"></a>ğŸåœºæ™¯ç¤ºä¾‹</h3><p>å•ä¾‹æ¨¡å¼çš„å®ç°ä¹‹ä¸€ï¼š<strong>æ‡’æ±‰å¼åŒæ£€é”</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">static</span> Singleton instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            syschronized(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>å®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>åˆ†é…å†…å­˜ç©ºé—´</li><li>åˆå§‹åŒ–å¯¹è±¡</li><li>å°†å†…å­˜ç©ºé—´çš„åœ°å€èµ‹å€¼ç»™å¯¹åº”çš„å¼•ç”¨</li></ol><p>ç”±äºæ“ä½œç³»ç»Ÿå¯ä»¥<code>å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åº</code> ï¼Œå¯èƒ½å°†ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡å¼•ç”¨æš´éœ²å‡ºæ¥ã€‚ç»™ç§æœ‰çš„é™æ€å˜é‡åŠ ä¸Švolatileå…³é”®å­—å°±å¯ä»¥é˜²æ­¢æŒ‡ä»¤é‡æ’åº</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JUCæ€»è§ˆ</title>
      <link href="/posts/64049/"/>
      <url>/posts/64049/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸJUCç®€ä»‹"><a href="#ğŸJUCç®€ä»‹" class="headerlink" title="ğŸJUCç®€ä»‹"></a>ğŸJUCç®€ä»‹</h3><blockquote><p><strong>java.util.concurrent</strong> ï¼ˆJUCï¼‰å¹¶å‘ç¼–ç¨‹åŒ…æ˜¯ä¸“é—¨ä¸º Java å¹¶å‘ç¼–ç¨‹è®¾è®¡çš„</p></blockquote><p>JUCåŒ…æä¾›äº†äº”å¤§æ–¹é¢çš„å†…å®¹ï¼š</p><p>é”ï¼ˆlocksï¼‰éƒ¨åˆ†ï¼šæä¾›é€‚åˆå„ç±»åœºåˆçš„é”å·¥å…·ï¼›<br>åŸå­å˜é‡ï¼ˆatomicï¼‰éƒ¨åˆ†ï¼šåŸå­å˜é‡ç±»ç›¸å…³ï¼Œæ˜¯æ„å»ºéé˜»å¡ç®—æ³•çš„åŸºç¡€ï¼›<br>å¹¶å‘æ¡†æ¶ï¼ˆexecutorï¼‰éƒ¨åˆ†ï¼šæä¾›çº¿ç¨‹æ± ç›¸å…³ç±»å‹ï¼›<br>å¹¶å‘å®¹å™¨ï¼ˆcollectionsï¼‰ éƒ¨åˆ†ï¼šæä¾›ä¸€ç³»åˆ—å¹¶å‘å®¹å™¨ç›¸å…³ç±»å‹ï¼›<br>åŒæ­¥å·¥å…·ï¼ˆtoolsï¼‰éƒ¨åˆ†ï¼šæä¾›ç›¸å¯¹ç‹¬ç«‹ï¼Œä¸”åœºæ™¯ä¸°å¯Œçš„å„ç±»åŒæ­¥å·¥å…·ï¼Œå¦‚ä¿¡å·é‡ã€é—­é”ã€æ …æ ç­‰åŠŸèƒ½ï¼›</p><p><img src="/img/64049/java-thread-x-juc-overview.png" alt="java-thread-x-juc-overview"></p><h3 id="ğŸLockæ¡†æ¶å’ŒToolsç±»"><a href="#ğŸLockæ¡†æ¶å’ŒToolsç±»" class="headerlink" title="ğŸLockæ¡†æ¶å’ŒToolsç±»"></a>ğŸLockæ¡†æ¶å’ŒToolsç±»</h3><h4 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-overview-lock.png" alt="java-thread-x-juc-overview-lock"></p><h4 id="æ¥å£-Condition"><a href="#æ¥å£-Condition" class="headerlink" title="æ¥å£: Condition"></a>æ¥å£: Condition</h4><p>Lock æ›¿ä»£äº† <strong>synchronized</strong> æ–¹æ³•å’Œè¯­å¥çš„ä½¿ç”¨ï¼ŒCondition æ›¿ä»£äº† Object ç›‘è§†å™¨æ–¹æ³•(waitã€notify å’Œ notifyAll)çš„ä½¿ç”¨ã€‚å¯ä»¥é€šè¿‡**await(),signal()**æ¥ä¼‘çœ &#x2F;å”¤é†’çº¿ç¨‹ã€‚</p><hr><h4 id="æ¥å£-Lock"><a href="#æ¥å£-Lock" class="headerlink" title="æ¥å£: Lock"></a>æ¥å£: Lock</h4><p>Lockå®ç°æä¾›äº†æ¯”ä½¿ç”¨synchronizedæ–¹æ³•å’Œè¯­å¥å¯è·å¾—çš„<strong>æ›´å¹¿æ³›çš„é”å®šæ“ä½œ</strong>ã€‚æ­¤å®ç°å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³çš„Conditionå¯¹è±¡ã€‚</p><hr><h4 id="æ¥å£-ReadWriteLock"><a href="#æ¥å£-ReadWriteLock" class="headerlink" title="æ¥å£: ReadWriteLock"></a>æ¥å£: ReadWriteLock</h4><p>ç»´æŠ¤äº†<strong>ä¸€å¯¹</strong>ç›¸å…³çš„é”ï¼Œä¸€ä¸ªç”¨äºåªè¯»æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œã€‚åªè¦æ²¡æœ‰ writerï¼Œè¯»å–é”å¯ä»¥ç”±å¤šä¸ª reader çº¿ç¨‹åŒæ—¶ä¿æŒã€‚å†™å…¥é”æ˜¯ç‹¬å çš„ã€‚</p><hr><h4 id="é”å¸¸ç”¨ç±»-LockSupport"><a href="#é”å¸¸ç”¨ç±»-LockSupport" class="headerlink" title="é”å¸¸ç”¨ç±»: LockSupport"></a>é”å¸¸ç”¨ç±»: LockSupport</h4><p>ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„<strong>åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­</strong>ã€‚LockSupportçš„åŠŸèƒ½å’ŒThreadä¸­çš„ Thread.suspend()å’ŒThread.resume()æœ‰ç‚¹ç±»ä¼¼ï¼ŒLockSupportä¸­çš„<strong>park() å’Œ unpark()</strong> çš„ä½œç”¨åˆ†åˆ«æ˜¯é˜»å¡çº¿ç¨‹å’Œè§£é™¤é˜»å¡çº¿ç¨‹ã€‚ä½†æ˜¯park()å’Œunpark()ä¸ä¼šé‡åˆ°Thread.suspend å’Œ Thread.resumeæ‰€å¯èƒ½å¼•å‘çš„æ­»é”é—®é¢˜ã€‚</p><hr><h4 id="ğŸˆé”å¸¸ç”¨ç±»-ReentrantLock"><a href="#ğŸˆé”å¸¸ç”¨ç±»-ReentrantLock" class="headerlink" title="ğŸˆé”å¸¸ç”¨ç±»: ReentrantLock"></a>ğŸˆé”å¸¸ç”¨ç±»: ReentrantLock</h4><p>ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é” Lockï¼Œå®ƒå…·æœ‰ä¸ä½¿ç”¨ <strong>synchronized</strong> æ–¹æ³•å’Œè¯­å¥æ‰€è®¿é—®çš„éšå¼ç›‘è§†å™¨é”ç›¸åŒçš„ä¸€äº›åŸºæœ¬è¡Œä¸ºå’Œè¯­ä¹‰ï¼Œä½†åŠŸèƒ½æ›´å¼ºå¤§ã€‚</p><hr><h4 id="é”å¸¸ç”¨ç±»-ReentrantReadWriteLock"><a href="#é”å¸¸ç”¨ç±»-ReentrantReadWriteLock" class="headerlink" title="é”å¸¸ç”¨ç±»: ReentrantReadWriteLock"></a>é”å¸¸ç”¨ç±»: ReentrantReadWriteLock</h4><p>ReentrantReadWriteLockæ˜¯è¯»å†™é”æ¥å£<strong>ReadWriteLockçš„å®ç°ç±»</strong>ï¼Œå®ƒåŒ…æ‹¬Lockå­ç±»ReadLockå’ŒWriteLockã€‚ReadLockæ˜¯å…±äº«é”ï¼ŒWriteLockæ˜¯ç‹¬å é”ã€‚</p><h3 id="ğŸCollections-å¹¶å‘é›†åˆ"><a href="#ğŸCollections-å¹¶å‘é›†åˆ" class="headerlink" title="ğŸCollections: å¹¶å‘é›†åˆ"></a>ğŸCollections: å¹¶å‘é›†åˆ</h3><h4 id="æ€»è§ˆ-1"><a href="#æ€»è§ˆ-1" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-overview-collections.png" alt="java-thread-x-juc-overview-collections"></p><h4 id="ğŸˆMap-ConcurrentHashMap"><a href="#ğŸˆMap-ConcurrentHashMap" class="headerlink" title="ğŸˆMap: ConcurrentHashMap"></a>ğŸˆMap: ConcurrentHashMap</h4><p>çº¿ç¨‹å®‰å…¨çš„HashMapã€‚ConcurrentHashMapåœ¨JDK 7ä¹‹å‰æ˜¯é€šè¿‡Lockå’Œsegment(åˆ†æ®µé”)å®ç°ï¼ŒJDK 8 ä¹‹åæ”¹ä¸ºCAS+synchronizedæ¥ä¿è¯å¹¶å‘å®‰å…¨ã€‚</p><hr><h4 id="List-CopyOnWriteArrayList"><a href="#List-CopyOnWriteArrayList" class="headerlink" title="List: CopyOnWriteArrayList"></a>List: CopyOnWriteArrayList</h4><p>ArrayList çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼Œå…¶ä¸­æ‰€æœ‰å¯å˜æ“ä½œ(addã€set ç­‰ç­‰)éƒ½æ˜¯é€šè¿‡å¯¹åº•å±‚æ•°ç»„è¿›è¡Œä¸€æ¬¡æ–°çš„å¤åˆ¶æ¥å®ç°çš„ï¼Œå¼€é”€å¤§ã€‚</p><p>1.å½“éå†æ“ä½œçš„æ•°é‡å¤§å¤§è¶…è¿‡å¯å˜æ“ä½œçš„æ•°é‡æ—¶ï¼Œè¿™ç§æ–¹æ³•å¯èƒ½æ¯”å…¶ä»–æ›¿ä»£æ–¹æ³•æ›´æœ‰æ•ˆã€‚</p><p>2.åœ¨ä¸èƒ½æˆ–ä¸æƒ³è¿›è¡ŒåŒæ­¥éå†ï¼Œä½†åˆéœ€è¦ä»å¹¶å‘çº¿ç¨‹ä¸­æ’é™¤å†²çªæ—¶ï¼Œä¹Ÿå¾ˆæœ‰ç”¨</p><h3 id="ğŸAtomic-åŸå­ç±»"><a href="#ğŸAtomic-åŸå­ç±»" class="headerlink" title="ğŸAtomic: åŸå­ç±»"></a>ğŸAtomic: åŸå­ç±»</h3><h4 id="æ€»è§ˆ-2"><a href="#æ€»è§ˆ-2" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p>å…¶åŸºæœ¬çš„ç‰¹æ€§å°±æ˜¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå½“æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œè¿™äº›ç±»çš„å®ä¾‹åŒ…å«çš„æ–¹æ³•æ—¶ï¼Œå…·æœ‰æ’ä»–æ€§ï¼Œå³å½“æŸä¸ªçº¿ç¨‹è¿›å…¥æ–¹æ³•ï¼Œæ‰§è¡Œå…¶ä¸­çš„æŒ‡ä»¤æ—¶ï¼Œä¸ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰“æ–­ï¼Œè€Œåˆ«çš„çº¿ç¨‹å°±åƒè‡ªæ—‹é”ä¸€æ ·ï¼Œä¸€ç›´ç­‰åˆ°è¯¥æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œæ‰ç”±JVMä»ç­‰å¾…é˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªå¦ä¸€ä¸ªçº¿ç¨‹è¿›å…¥ï¼Œè¿™åªæ˜¯ä¸€ç§é€»è¾‘ä¸Šçš„ç†è§£ã€‚å®é™…ä¸Šæ˜¯å€ŸåŠ©ç¡¬ä»¶çš„ç›¸å…³æŒ‡ä»¤æ¥å®ç°çš„ï¼Œä¸ä¼šé˜»å¡çº¿ç¨‹</p><h4 id="AtomicInteger"><a href="#AtomicInteger" class="headerlink" title="AtomicInteger"></a>AtomicInteger</h4><p>ä¹è§‚é”çš„å…¸å‹ä»£è¡¨</p><h3 id="ğŸExecutors-çº¿ç¨‹æ± "><a href="#ğŸExecutors-çº¿ç¨‹æ± " class="headerlink" title="ğŸExecutors: çº¿ç¨‹æ± "></a>ğŸExecutors: çº¿ç¨‹æ± </h3><h4 id="æ€»è§ˆ-3"><a href="#æ€»è§ˆ-3" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h4><p><img src="/img/64049/java-thread-x-juc-executors.png" alt="java-thread-x-juc-executors"></p><h4 id="æ¥å£-Executor"><a href="#æ¥å£-Executor" class="headerlink" title="æ¥å£: Executor"></a>æ¥å£: Executor</h4><p>Executoræ¥å£æä¾›ä¸€ç§å°†ä»»åŠ¡æäº¤ä¸æ¯ä¸ªä»»åŠ¡å°†å¦‚ä½•è¿è¡Œçš„<strong>æœºåˆ¶</strong>(åŒ…æ‹¬çº¿ç¨‹ä½¿ç”¨çš„ç»†èŠ‚ã€è°ƒåº¦ç­‰)åˆ†ç¦»å¼€æ¥çš„æ–¹æ³•ã€‚é€šå¸¸ä½¿ç”¨ Executor è€Œä¸æ˜¯æ˜¾å¼åœ°åˆ›å»ºçº¿ç¨‹ã€‚</p><hr><h4 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a>FutureTask</h4><p>FutureTask ä¸º Future æä¾›äº†åŸºç¡€å®ç°ï¼Œå¦‚è·å–ä»»åŠ¡æ‰§è¡Œç»“æœ(get)å’Œå–æ¶ˆä»»åŠ¡(cancel)ç­‰ã€‚å¦‚æœä»»åŠ¡å°šæœªå®Œæˆï¼Œè·å–ä»»åŠ¡æ‰§è¡Œç»“æœæ—¶å°†ä¼šé˜»å¡ã€‚ä¸€æ—¦æ‰§è¡Œç»“æŸï¼Œä»»åŠ¡å°±ä¸èƒ½è¢«é‡å¯æˆ–å–æ¶ˆ(é™¤éä½¿ç”¨runAndResetæ‰§è¡Œè®¡ç®—)ã€‚FutureTask å¸¸ç”¨æ¥å°è£… Callable å’Œ Runnableï¼Œä¹Ÿå¯ä»¥ä½œä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°çº¿ç¨‹æ± ä¸­æ‰§è¡Œã€‚é™¤äº†ä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç±»ä¹‹å¤–ï¼Œæ­¤ç±»ä¹Ÿæä¾›äº†ä¸€äº›åŠŸèƒ½æ€§å‡½æ•°ä¾›æˆ‘ä»¬åˆ›å»ºè‡ªå®šä¹‰ task ç±»ä½¿ç”¨ã€‚FutureTask çš„çº¿ç¨‹å®‰å…¨ç”±<strong>CAS</strong>æ¥ä¿è¯ã€‚</p><hr><h4 id="ğŸˆThreadPoolExecutor"><a href="#ğŸˆThreadPoolExecutor" class="headerlink" title="ğŸˆThreadPoolExecutor"></a>ğŸˆThreadPoolExecutor</h4><p>ThreadPoolExecutorå®ç°äº†AbstractExecutorServiceæ¥å£ï¼Œä¹Ÿæ˜¯ä¸€ä¸ª ExecutorServiceï¼Œå®ƒä½¿ç”¨å¯èƒ½çš„å‡ ä¸ªæ± çº¿ç¨‹ä¹‹ä¸€æ‰§è¡Œæ¯ä¸ªæäº¤çš„ä»»åŠ¡ï¼Œé€šå¸¸ä½¿ç”¨ Executors å·¥å‚æ–¹æ³•é…ç½®ã€‚ çº¿ç¨‹æ± å¯ä»¥è§£å†³ä¸¤ä¸ªä¸åŒé—®é¢˜: ç”±äºå‡å°‘äº†æ¯ä¸ªä»»åŠ¡è°ƒç”¨çš„å¼€é”€ï¼Œå®ƒä»¬é€šå¸¸å¯ä»¥åœ¨æ‰§è¡Œå¤§é‡å¼‚æ­¥ä»»åŠ¡æ—¶æä¾›å¢å¼ºçš„æ€§èƒ½ï¼Œå¹¶ä¸”è¿˜å¯ä»¥æä¾›ç»‘å®šå’Œç®¡ç†èµ„æº(åŒ…æ‹¬æ‰§è¡Œä»»åŠ¡é›†æ—¶ä½¿ç”¨çš„çº¿ç¨‹)çš„æ–¹æ³•ã€‚æ¯ä¸ª ThreadPoolExecutor è¿˜ç»´æŠ¤ç€ä¸€äº›åŸºæœ¬çš„ç»Ÿè®¡æ•°æ®ï¼Œå¦‚å®Œæˆçš„ä»»åŠ¡æ•°ã€‚</p><hr><h4 id="æ ¸å¿ƒ-ScheduledThreadExecutor"><a href="#æ ¸å¿ƒ-ScheduledThreadExecutor" class="headerlink" title="æ ¸å¿ƒ: ScheduledThreadExecutor"></a>æ ¸å¿ƒ: ScheduledThreadExecutor</h4><p>ScheduledThreadPoolExecutorå®ç°ScheduledExecutorServiceæ¥å£ï¼Œå¯å®‰æ’åœ¨ç»™å®šçš„å»¶è¿Ÿåè¿è¡Œå‘½ä»¤ï¼Œæˆ–è€…å®šæœŸæ‰§è¡Œå‘½ä»¤ã€‚éœ€è¦å¤šä¸ªè¾…åŠ©çº¿ç¨‹æ—¶ï¼Œæˆ–è€…è¦æ±‚ ThreadPoolExecutor å…·æœ‰<strong>é¢å¤–çš„çµæ´»æ€§æˆ–åŠŸèƒ½</strong>æ—¶ã€‚</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹ä½¿ç”¨æ–¹å¼</title>
      <link href="/posts/58290/"/>
      <url>/posts/58290/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸå®ç°Runnableæ¥å£"><a href="#ğŸå®ç°Runnableæ¥å£" class="headerlink" title="ğŸå®ç°Runnableæ¥å£"></a>ğŸå®ç°Runnableæ¥å£</h3><p>éœ€è¦å®ç°run()æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ Thread è°ƒç”¨ <strong>start()</strong> æ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyRunnable</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyRunnable</span>();</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">    thread.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®é™…ä¸Šæ˜¯æŠŠçº¿ç¨‹å’Œä»»åŠ¡åˆ†å¼€äº†</p><h3 id="ğŸå®ç°Callableæ¥å£"><a href="#ğŸå®ç°Callableæ¥å£" class="headerlink" title="ğŸå®ç°Callableæ¥å£"></a>ğŸå®ç°Callableæ¥å£</h3><p>ä¸ Runnable ç›¸æ¯”ï¼ŒCallable å¯ä»¥æœ‰è¿”å›å€¼ï¼Œè¿”å›å€¼é€šè¿‡ FutureTask è¿›è¡Œå°è£…</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">    <span class="type">MyCallable</span> <span class="variable">mc</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>();</span><br><span class="line">    <span class="comment">// åˆ©ç”¨FutureTaskå°è£…è¿”å›å€¼</span></span><br><span class="line">    FutureTask&lt;Integer&gt; ft = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(mc);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(ft);</span><br><span class="line">    thread.start();</span><br><span class="line">    System.out.println(ft.get());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸç»§æ‰¿-Thread-ç±»"><a href="#ğŸç»§æ‰¿-Thread-ç±»" class="headerlink" title="ğŸç»§æ‰¿ Thread ç±»"></a>ğŸç»§æ‰¿ Thread ç±»</h3><p>ä¹Ÿæ˜¯éœ€è¦å®ç° <strong>run()</strong> æ–¹æ³•ï¼Œå› ä¸º Thread ç±»ä¹Ÿå®ç°äº† Runable æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// ...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyThread</span> <span class="variable">mt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">    mt.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>å½“è°ƒç”¨ <strong>start()</strong> æ–¹æ³•å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œè™šæ‹Ÿæœºä¼šå°†è¯¥çº¿ç¨‹æ”¾å…¥<strong>å°±ç»ªé˜Ÿåˆ—</strong>ä¸­ç­‰å¾…è¢«è°ƒåº¦ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«è°ƒåº¦æ—¶ä¼šæ‰§è¡Œè¯¥çº¿ç¨‹çš„ <strong>run()</strong> æ–¹æ³•</p></blockquote><h3 id="ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼"><a href="#ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼" class="headerlink" title="ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼"></a>ğŸå®ç°æ¥å£æ–¹å¼æ¯”è¾ƒç»§æ‰¿æ–¹å¼</h3><p>å®ç°æ¥å£æ›´å¥½:</p><ul><li>Java ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œç»§æ‰¿äº† Thread ç±»å°±æ— æ³•ç»§æ‰¿å…¶å®ƒç±»ï¼Œä½†æ˜¯å¯ä»¥å®ç°å¤šä¸ªæ¥å£</li><li>å®ç°æ¥å£å¯èƒ½åªè¦æ±‚å¯æ‰§è¡Œå°±è¡Œï¼Œç»§æ‰¿æ•´ä¸ª Thread ç±»å¼€é”€è¿‡å¤§</li><li>Runnable æ›´å®¹æ˜“ä¸çº¿ç¨‹æ± ç­‰é«˜çº§ API é…åˆ</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>çº¿ç¨‹çŠ¶æ€</title>
      <link href="/posts/3d00/"/>
      <url>/posts/3d00/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸçº¿ç¨‹6ç§çŠ¶æ€"><a href="#ğŸçº¿ç¨‹6ç§çŠ¶æ€" class="headerlink" title="ğŸçº¿ç¨‹6ç§çŠ¶æ€"></a>ğŸçº¿ç¨‹6ç§çŠ¶æ€</h3><p><img src="/img/3d00/ThreadStatus.png" alt="ThreadStatus"></p><h4 id="1-æ–°å»º-New"><a href="#1-æ–°å»º-New" class="headerlink" title="1 æ–°å»º(New)"></a>1 æ–°å»º(New)</h4><p>â€‹å½“ä¸€ä¸ªçº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºï¼Œä½†è¿˜æœªè°ƒç”¨ <strong>start æ–¹æ³•</strong>æ—¶å¤„äºæ–°å»ºçŠ¶æ€,  æ­¤æ—¶æœªä¸æ“ä½œç³»ç»Ÿåº•å±‚çº¿ç¨‹å…³è”</p><h4 id="2-å¯è¿è¡Œ-Runnable"><a href="#2-å¯è¿è¡Œ-Runnable" class="headerlink" title="2 å¯è¿è¡Œ(Runnable)"></a>2 å¯è¿è¡Œ(Runnable)</h4><p>â€‹è°ƒç”¨äº† start æ–¹æ³•ï¼Œå°±ä¼šç”±æ–°å»ºè¿›å…¥å¯è¿è¡Œ</p><p>â€‹å¯èƒ½æ­£åœ¨è¿è¡Œï¼Œä¹Ÿå¯èƒ½æ­£åœ¨ç­‰å¾… CPU æ—¶é—´ç‰‡ã€‚åŒ…å«äº†æ“ä½œç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ä¸­çš„ <strong>Running å’Œ Ready</strong></p><h4 id="3-æ­»äº¡-Terminated"><a href="#3-æ­»äº¡-Terminated" class="headerlink" title="3 æ­»äº¡(Terminated)"></a>3 æ­»äº¡(Terminated)</h4><p>â€‹å¯ä»¥æ˜¯çº¿ç¨‹ç»“æŸä»»åŠ¡ä¹‹åè‡ªå·±ç»“æŸï¼Œæˆ–è€…äº§ç”Ÿäº†å¼‚å¸¸è€Œç»“æŸ</p><h4 id="4-é˜»å¡-Blocking"><a href="#4-é˜»å¡-Blocking" class="headerlink" title="4 é˜»å¡(Blocking)"></a>4 é˜»å¡(Blocking)</h4><p>â€‹å½“è·å–é”å¤±è´¥åï¼Œç”±å¯è¿è¡Œè¿›å…¥ Monitor çš„é˜»å¡é˜Ÿåˆ—é˜»å¡ï¼Œæ­¤æ—¶ä¸å ç”¨ cpu æ—¶é—´<br>â€‹å½“æŒé”çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œä¼šæŒ‰ç…§ä¸€å®šè§„åˆ™å”¤é†’é˜»å¡é˜Ÿåˆ—ä¸­çš„é˜»å¡çº¿ç¨‹ï¼Œå”¤é†’åçš„çº¿ç¨‹è¿›å…¥å¯è¿è¡ŒçŠ¶æ€</p><h4 id="5-æ— é™æœŸç­‰å¾…-Waiting"><a href="#5-æ— é™æœŸç­‰å¾…-Waiting" class="headerlink" title="5 æ— é™æœŸç­‰å¾…(Waiting)"></a>5 æ— é™æœŸç­‰å¾…(Waiting)</h4><p>â€‹ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œå¦åˆ™ä¸ä¼šè¢«åˆ†é… CPU æ—¶é—´ç‰‡</p><table><thead><tr><th align="center">å¸¸è§è¿›å…¥æ–¹æ³•</th><th align="center">å¸¸è§é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td align="center">æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td align="center">Object.notify() &#x2F; Object.notifyAll()</td></tr><tr><td align="center">æ²¡æœ‰è®¾ç½® Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td align="center">è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr></tbody></table><h4 id="6-é™æœŸç­‰å¾…-Timed-Waiting"><a href="#6-é™æœŸç­‰å¾…-Timed-Waiting" class="headerlink" title="6 é™æœŸç­‰å¾…(Timed Waiting)"></a>6 é™æœŸç­‰å¾…(Timed Waiting)</h4><p>â€‹æ— éœ€ç­‰å¾…å…¶å®ƒçº¿ç¨‹æ˜¾å¼åœ°å”¤é†’ï¼Œåœ¨ä¸€å®šæ—¶é—´ä¹‹åä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨å”¤é†’</p><table><thead><tr><th align="center">å¸¸è§è¿›å…¥æ–¹æ³•</th><th align="center">å¸¸è§é€€å‡ºæ–¹æ³•</th></tr></thead><tbody><tr><td align="center">Thread.sleep() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ</td></tr><tr><td align="center">è®¾ç½®äº† Timeout å‚æ•°çš„ Object.wait() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ &#x2F; Object.notify() &#x2F; Object.notifyAll()</td></tr><tr><td align="center">è®¾ç½®äº† Timeout å‚æ•°çš„ Thread.join() æ–¹æ³•</td><td align="center">æ—¶é—´ç»“æŸ &#x2F; è¢«è°ƒç”¨çš„çº¿ç¨‹æ‰§è¡Œå®Œæ¯•</td></tr></tbody></table><blockquote><p>é˜»å¡å’Œç­‰å¾…çš„åŒºåˆ«ï¼šé˜»å¡æ˜¯è¢«åŠ¨çš„ï¼Œå®ƒæ˜¯åœ¨ç­‰å¾…è·å–ä¸€ä¸ªæ’å®ƒé”ï¼›è€Œç­‰å¾…æ˜¯ä¸»åŠ¨çš„ï¼Œé€šè¿‡è°ƒç”¨ Thread.sleep() å’Œ Object.wait() ç­‰æ–¹æ³•è¿›å…¥</p></blockquote><h3 id="çº¿ç¨‹çŠ¶æ€çš„è½¬æ¢"><a href="#çº¿ç¨‹çŠ¶æ€çš„è½¬æ¢" class="headerlink" title="çº¿ç¨‹çŠ¶æ€çš„è½¬æ¢"></a>çº¿ç¨‹çŠ¶æ€çš„è½¬æ¢</h3><img src="/img/3d00/ThreadStatus2.png" alt="img" style="zoom:67%;" /><p>1.åªæœ‰å°±ç»ªæ€å’Œè¿è¡Œæ€æ˜¯åŒå‘è½¬æ¢ï¼Œå…¶ä½™éƒ½æ˜¯å•å‘</p><p>2.yield()æ˜¯Threadçš„é™æ€æ–¹æ³•ï¼Œä½œç”¨å½“å‰çº¿ç¨‹ï¼Œé‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„CPUèµ„æºï¼Œå°†CPUè®©ç»™ä¼˜å…ˆçº§ä¸ä½äºè‡ªå·±çš„çº¿ç¨‹ç”¨ï¼Œè°ƒç”¨åè¿›å…¥å°±ç»ªçŠ¶æ€</p><p>3.join()ã€sleep()ä¼šè®©å½“å‰çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œwait()ä¼šè®©å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ˆå¯¹OSè€Œè¨€ï¼Œéƒ½æ˜¯é˜»å¡æ€ï¼‰</p><h3 id="ğŸwait-vs-sleep"><a href="#ğŸwait-vs-sleep" class="headerlink" title="ğŸwait vs sleep"></a>ğŸwait vs sleep</h3><h4 id="å…±åŒç‚¹"><a href="#å…±åŒç‚¹" class="headerlink" title="å…±åŒç‚¹"></a>å…±åŒç‚¹</h4><p>â€‹wait() ï¼Œwait(long) å’Œ sleep(long) çš„æ•ˆæœéƒ½æ˜¯è®©å½“å‰çº¿ç¨‹æš‚æ—¶æ”¾å¼ƒ CPU çš„ä½¿ç”¨æƒï¼Œè¿›å…¥<strong>é˜»å¡çŠ¶æ€</strong></p><h4 id="ä¸åŒç‚¹"><a href="#ä¸åŒç‚¹" class="headerlink" title="ä¸åŒç‚¹"></a>ä¸åŒç‚¹</h4><p>â—  æ–¹æ³•å½’å±ä¸åŒ<br>    sleep(long) æ˜¯ <strong>Thread</strong> çš„é™æ€æ–¹æ³•<br>    è€Œ wait()ï¼Œwait(long) éƒ½æ˜¯ <strong>Object</strong> çš„æˆå‘˜æ–¹æ³•ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰<br>â—  é†’æ¥æ—¶æœºä¸åŒ<br>    æ‰§è¡Œ sleep(long) å’Œ wait(long) çš„çº¿ç¨‹éƒ½ä¼šåœ¨ç­‰å¾…ç›¸åº”æ¯«ç§’åé†’æ¥<br>    wait(long) å’Œ wait() è¿˜å¯ä»¥è¢« <strong>notify</strong> å”¤é†’ï¼Œwait() å¦‚æœä¸å”¤é†’å°±ä¸€ç›´ç­‰ä¸‹å»<br>    å®ƒä»¬éƒ½å¯ä»¥è¢«æ‰“æ–­å”¤é†’<br>â—  é”ç‰¹æ€§ä¸åŒï¼ˆé‡ç‚¹ï¼‰<br>    wait æ–¹æ³•çš„è°ƒç”¨å¿…é¡»å…ˆè·å– wait å¯¹è±¡çš„é”ï¼Œè€Œ sleep åˆ™æ— æ­¤é™åˆ¶<br>    wait æ–¹æ³•æ‰§è¡Œåä¼šé‡Šæ”¾å¯¹è±¡é”ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—è¯¥å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½†ä½ ä»¬è¿˜å¯ä»¥ç”¨ï¼‰<br>    è€Œ sleep å¦‚æœåœ¨ synchronized ä»£ç å—ä¸­æ‰§è¡Œï¼Œå¹¶ä¸ä¼šé‡Šæ”¾å¯¹è±¡é”ï¼ˆæˆ‘æ”¾å¼ƒ cpuï¼Œä½ ä»¬ä¹Ÿç”¨ä¸äº†ï¼‰</p><blockquote><p><strong>waitæ‰”æ‰é”ç¡è§‰ï¼ŒsleepæŠ±ç€é”ç¡è§‰</strong></p></blockquote><h3 id="ğŸçº¿ç¨‹é—´çš„åä½œ"><a href="#ğŸçº¿ç¨‹é—´çš„åä½œ" class="headerlink" title="ğŸçº¿ç¨‹é—´çš„åä½œ"></a>ğŸçº¿ç¨‹é—´çš„åä½œ</h3><blockquote><p>å½“å¤šä¸ªçº¿ç¨‹å¯ä»¥ä¸€èµ·å·¥ä½œå»è§£å†³æŸä¸ªé—®é¢˜æ—¶ï¼Œå¦‚æœæŸäº›éƒ¨åˆ†å¿…é¡»åœ¨å…¶å®ƒéƒ¨åˆ†ä¹‹å‰å®Œæˆï¼Œé‚£ä¹ˆå°±éœ€è¦å¯¹çº¿ç¨‹è¿›è¡Œåè°ƒ</p></blockquote><h4 id="join"><a href="#join" class="headerlink" title="join()"></a>join()</h4><p>åœ¨çº¿ç¨‹ä¸­è°ƒç”¨å¦ä¸€ä¸ªçº¿ç¨‹çš„ join() æ–¹æ³•ï¼Œä¼šå°†å½“å‰çº¿ç¨‹æŒ‚èµ·ï¼Œè€Œä¸æ˜¯å¿™ç­‰å¾…ï¼Œç›´åˆ°ç›®æ ‡çº¿ç¨‹ç»“æŸ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">JoinExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;A&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">class</span> <span class="title class_">B</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> A a;</span><br><span class="line"></span><br><span class="line">        B(A a) &#123;</span><br><span class="line">            <span class="built_in">this</span>.a = a;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                a.join();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;B&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">A</span> <span class="variable">a</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">A</span>();</span><br><span class="line">        <span class="type">B</span> <span class="variable">b</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">B</span>(a);</span><br><span class="line">        b.start();</span><br><span class="line">        a.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">A</span><br><span class="line">B</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><p>è™½ç„¶ b çº¿ç¨‹å…ˆå¯åŠ¨ï¼Œä½†æ˜¯å› ä¸ºåœ¨ b çº¿ç¨‹ä¸­è°ƒç”¨äº† a çº¿ç¨‹çš„ <strong>join()</strong> æ–¹æ³•ï¼Œb çº¿ç¨‹ä¼šç­‰å¾… a çº¿ç¨‹ç»“æŸæ‰ç»§ç»­æ‰§è¡Œï¼Œå› æ­¤æœ€åèƒ½å¤Ÿ<strong>ä¿è¯ a çº¿ç¨‹çš„è¾“å‡ºå…ˆäº b çº¿ç¨‹çš„è¾“å‡º</strong></p><h4 id="wait-x2F-notify-x2F-notifyAll"><a href="#wait-x2F-notify-x2F-notifyAll" class="headerlink" title="wait() &#x2F; notify() &#x2F; notifyAll()"></a>wait() &#x2F; notify() &#x2F; notifyAll()</h4><p>è°ƒç”¨ wait() ä½¿å¾—çº¿ç¨‹ç­‰å¾…æŸä¸ªæ¡ä»¶æ»¡è¶³ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…æ—¶ä¼šè¢«æŒ‚èµ·ï¼Œå½“å…¶ä»–çº¿ç¨‹çš„è¿è¡Œä½¿å¾—è¿™ä¸ªæ¡ä»¶æ»¡è¶³æ—¶ï¼Œå…¶å®ƒçº¿ç¨‹ä¼šè°ƒç”¨ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WaitNotifyExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">        notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">    <span class="type">WaitNotifyExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WaitNotifyExample</span>();</span><br><span class="line">    executorService.execute(() -&gt; example.after());</span><br><span class="line">    executorService.execute(() -&gt; example.before());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">before</span><br><span class="line">after</span><br></pre></td></tr></table></figure><p>è§£é‡Šï¼š</p><ul><li>å®ƒä»¬éƒ½å±äº Object çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸å±äº Threadã€‚</li><li>åªèƒ½ç”¨åœ¨åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ä½¿ç”¨ï¼Œå¦åˆ™ä¼šåœ¨è¿è¡Œæ—¶æŠ›å‡º IllegalMonitorStateExeceptionã€‚</li><li>ä½¿ç”¨ wait() æŒ‚èµ·æœŸé—´ï¼Œ<strong>çº¿ç¨‹ä¼šé‡Šæ”¾é”</strong>ã€‚è¿™æ˜¯å› ä¸ºï¼Œå¦‚æœæ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±æ— æ³•è¿›å…¥å¯¹è±¡çš„åŒæ­¥æ–¹æ³•æˆ–è€…åŒæ­¥æ§åˆ¶å—ä¸­ï¼Œé‚£ä¹ˆå°±æ— æ³•æ‰§è¡Œ notify() æˆ–è€… notifyAll() æ¥å”¤é†’æŒ‚èµ·çš„çº¿ç¨‹ï¼Œé€ æˆæ­»é”</li></ul><h4 id="await-x2F-signal-x2F-signalAll"><a href="#await-x2F-signal-x2F-signalAll" class="headerlink" title="await() &#x2F; signal() &#x2F; signalAll()"></a>await() &#x2F; signal() &#x2F; signalAll()</h4><p>java.util.concurrent ç±»åº“ä¸­æä¾›äº† Condition ç±»æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åè°ƒï¼Œå¯ä»¥åœ¨ Condition ä¸Šè°ƒç”¨ await() æ–¹æ³•ä½¿çº¿ç¨‹ç­‰å¾…ï¼Œå…¶å®ƒçº¿ç¨‹è°ƒç”¨ signal() æˆ– signalAll() æ–¹æ³•å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚ç›¸æ¯”äº wait() è¿™ç§ç­‰å¾…æ–¹å¼ï¼Œawait() å¯ä»¥<strong>æŒ‡å®šç­‰å¾…çš„æ¡ä»¶</strong>ï¼Œå› æ­¤æ›´åŠ çµæ´»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AwaitSignalExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ Lock æ¥è·å–ä¸€ä¸ª Condition å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">before</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;before&quot;</span>);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">after</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            condition.await();</span><br><span class="line">            System.out.println(<span class="string">&quot;after&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newCachedThreadPool();</span><br><span class="line">    <span class="type">AwaitSignalExample</span> <span class="variable">example</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AwaitSignalExample</span>();</span><br><span class="line">    executorService.execute(() -&gt; example.after());</span><br><span class="line">    executorService.execute(() -&gt; example.before());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">before</span><br><span class="line">after</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å¿«é€Ÿæ’åº</title>
      <link href="/posts/11306/"/>
      <url>/posts/11306/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸæ–¹æ¡ˆæè¿°"><a href="#ğŸæ–¹æ¡ˆæè¿°" class="headerlink" title="ğŸæ–¹æ¡ˆæè¿°"></a>ğŸæ–¹æ¡ˆæè¿°</h3><blockquote><p>å¿«æ’çš„æ–¹æ¡ˆä¹‹<strong>åŒè¾¹å¾ªç¯å¿«æ’ï¼ˆhoare éœå°”åˆ†åŒºæ–¹æ¡ˆæ”¹ï¼‰</strong></p></blockquote><p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œæ¯ä¸€è¶Ÿèƒ½å¤Ÿç¡®å®šä¸€ä¸ªåŸºå‡†ç‚¹çš„ä½ç½®</p><ol><li>é€‰æ‹©æœ€å·¦å…ƒç´ ä½œä¸ºåŸºå‡†ç‚¹å…ƒç´ </li><li>j æŒ‡é’ˆè´Ÿè´£ä»å³å‘å·¦æ‰¾æ¯”åŸºå‡†ç‚¹å°çš„å…ƒç´ ï¼Œi æŒ‡é’ˆè´Ÿè´£ä»å·¦å‘å³æ‰¾æ¯”åŸºå‡†ç‚¹å¤§çš„å…ƒç´ ï¼Œä¸€æ—¦æ‰¾åˆ°äºŒè€…äº¤æ¢ï¼Œç›´è‡³ iï¼Œj ç›¸äº¤</li><li>æœ€ååŸºå‡†ç‚¹ä¸ iï¼ˆæ­¤æ—¶ i ä¸ j ç›¸ç­‰ï¼‰äº¤æ¢ï¼Œi å³ä¸ºåˆ†åŒºä½ç½®</li></ol><h3 id="ğŸä»£ç å®ç°"><a href="#ğŸä»£ç å®ç°" class="headerlink" title="ğŸä»£ç å®ç°"></a>ğŸä»£ç å®ç°</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¾…åŠ©äº¤æ¢å‡½æ•°</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> array[i];</span><br><span class="line">    array[i] = array[j];</span><br><span class="line">    array[j] = t;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¡®å®šåŸºå‡†ç‚¹ï¼Œè¿”å›åŸºå‡†ç‚¹ç´¢å¼•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">pv</span> <span class="operator">=</span> a[l]; <span class="comment">//åŸºå‡†ç‚¹å…ƒç´ </span></span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> h;</span><br><span class="line">    <span class="keyword">while</span>(i &lt; j)&#123;</span><br><span class="line">        <span class="comment">// j ä»å³æ‰¾å°çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[j] &gt; pv)&#123;</span><br><span class="line">            j -= <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// i ä»å·¦æ‰¾å¤§çš„</span></span><br><span class="line">        <span class="keyword">while</span>(i &lt; j &amp;&amp; a[i] &lt;= pv)&#123;</span><br><span class="line">            i += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// äºŒè€…äº¤æ¢</span></span><br><span class="line">    swap(a,i,j);   </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æœ€ååŸºå‡†ç‚¹ä¸ iï¼ˆæ­¤æ—¶ i ä¸ j ç›¸ç­‰ï¼‰äº¤æ¢ï¼Œi å³ä¸ºåˆ†åŒºä½ç½®</span></span><br><span class="line">    swap(a,l,j);</span><br><span class="line">    <span class="keyword">return</span> j;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ä¸»å‡½æ•°ï¼Œä¸partitionçš„å‚æ•°ç›¸åŒï¼Œå¯å¿«é€Ÿæ‰‹æ’•</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] a,<span class="type">int</span> l,<span class="type">int</span> h)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(l &gt;= h)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> partition(a,l,h);</span><br><span class="line">    quick(a,l,p-<span class="number">1</span>);</span><br><span class="line">    quick(a,p+<span class="number">1</span>,h);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ğŸæ³¨æ„äº‹é¡¹"><a href="#ğŸæ³¨æ„äº‹é¡¹" class="headerlink" title="ğŸæ³¨æ„äº‹é¡¹"></a>ğŸæ³¨æ„äº‹é¡¹</h3><ol><li>åŸºå‡†ç‚¹åœ¨å·¦è¾¹ï¼Œå¹¶ä¸”è¦å…ˆ j å i </li><li>å†…å¾ªç¯ä¸­ä¹Ÿè¦åŠ ä¸Šâ€i&lt;jâ€æ¡ä»¶ï¼Œwhile( **i** **&lt; j** &amp;&amp; a[j] &gt; pv ) jâ€“ </li><li>è¿™é‡Œæ˜¯**&lt;&#x3D;**ï¼Œå› ä¸ºå·¦è¾¹å¼€å§‹ä½ç½®åœ¨åŸºå‡†ç‚¹ä¸Šï¼Œwhile ( <strong>i</strong> <strong>&lt; j</strong> &amp;&amp; a[i] <strong>&lt;&#x3D;</strong> pv ) i++</li></ol>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ç®—æ³• </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Synchronized</title>
      <link href="/posts/49469/"/>
      <url>/posts/49469/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸSynchronizedç®€ä»‹"><a href="#ğŸSynchronizedç®€ä»‹" class="headerlink" title="ğŸSynchronizedç®€ä»‹"></a>ğŸSynchronizedç®€ä»‹</h3><p>Synchronizedå…³é”®å­—æ˜¯ä¸€ç§çº¿ç¨‹äº’æ–¥åŒæ­¥æ–¹æ¡ˆï¼Œæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><p>ä¸€æŠŠé”åªèƒ½åŒæ—¶è¢«ä¸€ä¸ªçº¿ç¨‹è·å–ï¼Œæ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹åªèƒ½ç­‰å¾…ï¼ˆ<strong>æ‚²è§‚é”</strong>ï¼‰</p><p>æ¯ä¸ªå®ä¾‹éƒ½å¯¹åº”æœ‰è‡ªå·±çš„ä¸€æŠŠé”(<strong>this</strong>),ä¸åŒå®ä¾‹ä¹‹é—´äº’ä¸å½±å“ï¼ˆä¾‹å¤–ï¼šé”å¯¹è±¡æ˜¯*.classä»¥åŠsynchronizedä¿®é¥°çš„æ˜¯staticæ–¹æ³•çš„æ—¶å€™ï¼Œæ‰€æœ‰å¯¹è±¡å…¬ç”¨åŒä¸€æŠŠé”ï¼‰</p><p>synchronizedä¿®é¥°çš„æ–¹æ³•ï¼Œ<strong>æ— è®ºæ–¹æ³•æ­£å¸¸æ‰§è¡Œå®Œæ¯•è¿˜æ˜¯æŠ›å‡ºå¼‚å¸¸</strong>ï¼Œéƒ½ä¼šé‡Šæ”¾é”</p><h3 id="ğŸSynchronizedä½¿ç”¨"><a href="#ğŸSynchronizedä½¿ç”¨" class="headerlink" title="ğŸSynchronizedä½¿ç”¨"></a>ğŸSynchronizedä½¿ç”¨</h3><h4 id="å¯¹è±¡é”"><a href="#å¯¹è±¡é”" class="headerlink" title="å¯¹è±¡é”"></a>å¯¹è±¡é”</h4><p>åŒ…æ‹¬åŒæ­¥ä»£ç å—é”(è‡ªå·±æŒ‡å®šé”å¯¹è±¡)å’Œæ–¹æ³•é”(é»˜è®¤é”å¯¹è±¡ä¸ºthis,å½“å‰å®ä¾‹å¯¹è±¡)</p><h5 id="ä»£ç å—å½¢å¼"><a href="#ä»£ç å—å½¢å¼" class="headerlink" title="ä»£ç å—å½¢å¼"></a>ä»£ç å—å½¢å¼</h5><blockquote><p>æ‰‹åŠ¨æŒ‡å®šé”å®šå¯¹è±¡ï¼Œä¹Ÿå¯æ˜¯æ˜¯this,ä¹Ÿå¯ä»¥æ˜¯è‡ªå®šä¹‰çš„é”</p></blockquote><p>é”ä¸ºthisç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// åŒæ­¥ä»£ç å—å½¢å¼â€”â€”é”ä¸ºthis,ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨çš„é”æ˜¯ä¸€æ ·çš„,çº¿ç¨‹1å¿…é¡»è¦ç­‰åˆ°çº¿ç¨‹0é‡Šæ”¾äº†è¯¥é”åï¼Œæ‰èƒ½æ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">synchronized</span> (<span class="built_in">this</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><p>é”ä¸ºè‡ªå®šä¹‰ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="comment">// åˆ›å»º2æŠŠé”</span></span><br><span class="line">    <span class="type">Object</span> <span class="variable">block1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="type">Object</span> <span class="variable">block2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªä»£ç å—ä½¿ç”¨çš„æ˜¯ç¬¬ä¸€æŠŠé”ï¼Œå½“ä»–é‡Šæ”¾åï¼Œåé¢çš„ä»£ç å—ç”±äºä½¿ç”¨çš„æ˜¯ç¬¬äºŒæŠŠé”ï¼Œå› æ­¤å¯ä»¥é©¬ä¸Šæ‰§è¡Œ</span></span><br><span class="line">        <span class="keyword">synchronized</span> (block1) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;block1é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;block1é”,&quot;</span>+Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">synchronized</span> (block2) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;block2é”,æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;block2é”,&quot;</span>+Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line"><span class="comment">// å¯ä»¥çœ‹åˆ°å½“ç¬¬ä¸€ä¸ªçº¿ç¨‹åœ¨æ‰§è¡Œå®Œç¬¬ä¸€æ®µåŒæ­¥ä»£ç å—ä¹‹åï¼Œç¬¬äºŒä¸ªåŒæ­¥ä»£ç å—å¯ä»¥é©¬ä¸Šå¾—åˆ°æ‰§è¡Œï¼Œå› ä¸ºä»–ä»¬ä½¿ç”¨çš„é”ä¸æ˜¯åŒä¸€æŠŠ</span></span><br><span class="line">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">block1é”,Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span>ã€€ã€€</span><br><span class="line">block1é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">block2é”,Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">block1é”,Thread-<span class="number">1</span>ç»“æŸ</span><br><span class="line">block2é”,æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">block2é”,Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h5 id="æ–¹æ³•é”"><a href="#æ–¹æ³•é”" class="headerlink" title="æ–¹æ³•é”"></a>æ–¹æ³•é”</h5><blockquote><p>synchronizedä¿®é¥°æ™®é€šæ–¹æ³•ï¼Œé”å¯¹è±¡é»˜è®¤ä¸ºthis</p></blockquote><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// æ–¹æ³•ä¸ŠåŠ å…³é”®å­—</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h4 id="ç±»é”"><a href="#ç±»é”" class="headerlink" title="ç±»é”"></a>ç±»é”</h4><p>synchronizeä¿®é¥°é™æ€çš„æ–¹æ³•æˆ–æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</p><h5 id="ä¿®é¥°é™æ€æ–¹æ³•"><a href="#ä¿®é¥°é™æ€æ–¹æ³•" class="headerlink" title="ä¿®é¥°é™æ€æ–¹æ³•"></a>ä¿®é¥°é™æ€æ–¹æ³•</h5><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        method();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// synchronizedç”¨åœ¨é™æ€æ–¹æ³•ä¸Šï¼Œé»˜è®¤çš„é”å°±æ˜¯å½“å‰æ‰€åœ¨çš„Classç±»ï¼Œæ‰€ä»¥æ— è®ºæ˜¯å“ªä¸ªçº¿ç¨‹è®¿é—®å®ƒï¼Œéœ€è¦çš„é”éƒ½åªæœ‰ä¸€æŠŠ</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">method</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance1);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance2);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><p>ğŸš©æ³¨æ„ï¼šå’Œä¿®é¥°æ™®é€šæ–¹æ³•çš„åŒºåˆ«ï¼šå¯¹äºæ™®é€šæ–¹æ³•è€Œè¨€æ˜¯æ¯ä¸ªå®ä¾‹æœ‰ä¸€æŠŠé”ï¼Œå¯¹äºé™æ€æ–¹æ³•è€Œè¨€æ˜¯ç±»ä¸Šçš„é”ï¼Œå®ä¾‹çš„çº¿ç¨‹å…±ç”¨</p><h5 id="æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡"><a href="#æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡" class="headerlink" title="æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡"></a>æŒ‡å®šé”å¯¹è±¡ä¸ºClasså¯¹è±¡</h5><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedObjectLock</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line">    <span class="keyword">static</span> <span class="type">SynchronizedObjectLock</span> <span class="variable">instance2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SynchronizedObjectLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰€æœ‰çº¿ç¨‹éœ€è¦çš„é”éƒ½æ˜¯åŒä¸€æŠŠ</span></span><br><span class="line">        <span class="keyword">synchronized</span>(SynchronizedObjectLock.class)&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æˆ‘æ˜¯çº¿ç¨‹&quot;</span> + Thread.currentThread().getName());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;ç»“æŸ&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance1);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(instance2);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¾“å‡ºç»“æœ</span></span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">0</span></span><br><span class="line">Thread-<span class="number">0</span>ç»“æŸ</span><br><span class="line">æˆ‘æ˜¯çº¿ç¨‹Thread-<span class="number">1</span></span><br><span class="line">Thread-<span class="number">1</span>ç»“æŸ</span><br></pre></td></tr></table></figure><h3 id="ğŸSynchronizedä¸Lockçš„åŒºåˆ«"><a href="#ğŸSynchronizedä¸Lockçš„åŒºåˆ«" class="headerlink" title="ğŸSynchronizedä¸Lockçš„åŒºåˆ«"></a>ğŸSynchronizedä¸Lockçš„åŒºåˆ«</h3><p>â— è¯­æ³•å±‚é¢<br>  â—‹ synchronized æ˜¯å…³é”®å­—ï¼Œæºç åœ¨ jvm ä¸­ï¼Œç”¨ c++ è¯­è¨€å®ç°<br>  â—‹ Lock æ˜¯<strong>æ¥å£</strong>ï¼Œæºç ç”± jdk æä¾›ï¼Œç”¨ java è¯­è¨€å®ç°<br>  â—‹ ä½¿ç”¨ synchronized æ—¶ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—é”ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼Œè€Œä½¿ç”¨ Lock æ—¶ï¼Œéœ€è¦æ‰‹åŠ¨è°ƒç”¨ unlock()é‡Šæ”¾é”<br>â— åŠŸèƒ½å±‚é¢<br>  â—‹ äºŒè€…å‡å±äºæ‚²è§‚é”ï¼Œéƒ½å…·å¤‡åŸºæœ¬çš„äº’æ–¥ã€åŒæ­¥ã€é”é‡å…¥åŠŸèƒ½<br>  â—‹ Lock æä¾›äº†è®¸å¤š synchronized ä¸å…·å¤‡çš„åŠŸèƒ½ï¼Œä¾‹å¦‚è·å–ç­‰å¾…çŠ¶æ€ã€å…¬å¹³é”ã€<strong>å¯æ‰“æ–­ã€å¯è¶…æ—¶</strong>ã€å¤šæ¡ä»¶å˜é‡<br>  â—‹ Lock æœ‰é€‚åˆä¸åŒåœºæ™¯çš„å®ç°ï¼Œå¦‚ <strong>ReentrantLock</strong>ï¼Œ ReentrantReadWriteLock<br>â— æ€§èƒ½å±‚é¢<br>  â—‹ åœ¨æ²¡æœ‰ç«äº‰æ—¶ï¼Œsynchronized åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå¦‚åå‘é”ã€è½»é‡çº§é”ï¼Œæ€§èƒ½ä¸èµ–<br>  â—‹ åœ¨ç«äº‰æ¿€çƒˆæ—¶ï¼ŒLock çš„å®ç°é€šå¸¸ä¼šæä¾›æ›´å¥½çš„æ€§èƒ½</p><h3 id="ğŸSynchronizedæ³¨æ„äº‹é¡¹"><a href="#ğŸSynchronizedæ³¨æ„äº‹é¡¹" class="headerlink" title="ğŸSynchronizedæ³¨æ„äº‹é¡¹"></a>ğŸSynchronizedæ³¨æ„äº‹é¡¹</h3><ul><li>é”å¯¹è±¡<strong>ä¸èƒ½ä¸ºç©º</strong>ï¼Œå› ä¸ºé”çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨å¯¹è±¡å¤´é‡Œ</li><li>ä½œç”¨åŸŸä¸å®œè¿‡å¤§ï¼Œå½±å“ç¨‹åºæ‰§è¡Œçš„é€Ÿåº¦ï¼Œæ§åˆ¶èŒƒå›´è¿‡å¤§ï¼Œç¼–å†™ä»£ç ä¹Ÿå®¹æ˜“å‡ºé”™</li><li>é¿å…æ­»é”</li><li>åœ¨èƒ½é€‰æ‹©çš„æƒ…å†µä¸‹ï¼Œæ—¢ä¸è¦ç”¨Lockä¹Ÿä¸è¦ç”¨synchronizedå…³é”®å­—ï¼Œç”¨java.util.concurrentåŒ…ï¼ˆJUCï¼‰ä¸­çš„å„ç§å„æ ·çš„ç±»ï¼Œå¦‚æœä¸ç”¨è¯¥åŒ…ä¸‹çš„ç±»ï¼Œåœ¨æ»¡è¶³ä¸šåŠ¡çš„æƒ…å†µä¸‹ï¼Œå°½é‡ä½¿ç”¨synchronizedå…³é”®å­—</li></ul>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ThreadLocal</title>
      <link href="/posts/19329/"/>
      <url>/posts/19329/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸThreadLocalç®€ä»‹"><a href="#ğŸThreadLocalç®€ä»‹" class="headerlink" title="ğŸThreadLocalç®€ä»‹"></a>ğŸThreadLocalç®€ä»‹</h4><p>ThreadLocalæ˜¯ä¸€ä¸ªå°†åœ¨å¤šçº¿ç¨‹ä¸­ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹åˆ›å»ºå•ç‹¬çš„å˜é‡å‰¯æœ¬çš„ç±»; å½“ä½¿ç”¨ThreadLocalæ¥ç»´æŠ¤å˜é‡æ—¶, ThreadLocalä¼šä¸ºæ¯ä¸ªçº¿ç¨‹åˆ›å»º<strong>å•ç‹¬çš„å˜é‡å‰¯æœ¬</strong>, é¿å…å› å¤šçº¿ç¨‹æ“ä½œå…±äº«å˜é‡è€Œå¯¼è‡´çš„æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µ</p><blockquote><p>å…³é”®è¯ï¼š<strong>çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…±äº«</strong></p></blockquote><h4 id="ğŸThreadLocalç®€å•ç¤ºä¾‹"><a href="#ğŸThreadLocalç®€å•ç¤ºä¾‹" class="headerlink" title="ğŸThreadLocalç®€å•ç¤ºä¾‹"></a>ğŸThreadLocalç®€å•ç¤ºä¾‹</h4><p>ä»¥ç½‘ä¸Šç¤ºä¾‹æœ€å¤šçš„æ•°æ®åº“é“¾æ¥ç®¡ç†ä¸ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestThreadLocal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        test2();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€ä¸ªçº¿ç¨‹å†…è°ƒç”¨, å¾—åˆ°çš„æ˜¯åŒä¸€ä¸ª Connection å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test2</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + (i + <span class="number">1</span>)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¤šä¸ªçº¿ç¨‹è°ƒç”¨, å¾—åˆ°çš„æ˜¯è‡ªå·±çš„ Connection å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test1</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                LoggerUtils.get(<span class="string">&quot;t&quot;</span>).debug(<span class="string">&quot;&#123;&#125;&quot;</span>, Utils.getConnection());</span><br><span class="line">            &#125;, <span class="string">&quot;t&quot;</span> + (i + <span class="number">1</span>)).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Utils</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;Connection&gt; tl = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> Connection <span class="title function_">getConnection</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> tl.get(); <span class="comment">// åˆ°å½“å‰çº¿ç¨‹è·å–èµ„æº</span></span><br><span class="line">            <span class="keyword">if</span> (conn == <span class="literal">null</span>) &#123;</span><br><span class="line">                conn = innerGetConnection(); <span class="comment">// åˆ›å»ºæ–°çš„è¿æ¥å¯¹è±¡</span></span><br><span class="line">                tl.set(conn); <span class="comment">// å°†èµ„æºå­˜å…¥å½“å‰çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> conn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> Connection <span class="title function_">innerGetConnection</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/test?useSSL=false&quot;</span>, <span class="string">&quot;root&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ğŸThreadLocalåŸç†"><a href="#ğŸThreadLocalåŸç†" class="headerlink" title="ğŸThreadLocalåŸç†"></a>ğŸThreadLocalåŸç†</h4><p>æ¯ä¸ªçº¿ç¨‹å†…æœ‰ä¸€ä¸ª ThreadLocalMap ç±»å‹çš„æˆå‘˜å˜é‡ï¼Œç”¨æ¥å­˜å‚¨èµ„æºå¯¹è±¡</p><blockquote><p>åˆå§‹åŒ–ä»£ç </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> T <span class="title function_">setInitialValue</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">T</span> <span class="variable">value</span> <span class="operator">=</span> initialValue();</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè°ƒç”¨æˆ‘ä»¬ä¸Šé¢å†™çš„é‡è½½è¿‡åçš„initialValueæ–¹æ³•, äº§ç”Ÿä¸€ä¸ªConnectionå¯¹è±¡;</li><li>ç»§ç»­æŸ¥çœ‹å½“å‰çº¿ç¨‹çš„threadLocalsæ˜¯ä¸æ˜¯ç©ºçš„, å¦‚æœThreadLocalMapå·²è¢«åˆå§‹åŒ–, é‚£ä¹ˆç›´æ¥å°†äº§ç”Ÿçš„å¯¹è±¡æ·»åŠ åˆ°ThreadLocalMapä¸­, å¦‚æœæ²¡æœ‰åˆå§‹åŒ–, åˆ™åˆ›å»ºå¹¶æ·»åŠ å¯¹è±¡åˆ°å…¶ä¸­;</li></ul><blockquote><p>è°ƒç”¨ <strong>set</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ <strong>ThreadLocal è‡ªå·±ä½œä¸º key</strong>ï¼Œèµ„æºå¯¹è±¡ä½œä¸º valueï¼Œæ”¾å…¥å½“å‰çº¿ç¨‹çš„ ThreadLocalMap é›†åˆä¸­</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>è°ƒç”¨ <strong>get</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (threadLocals != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> threadLocals.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>é¦–å…ˆè·å–å½“å‰çº¿ç¨‹å¯¹è±¡t, ç„¶åä»çº¿ç¨‹tä¸­è·å–åˆ°ThreadLocalMapçš„æˆå‘˜å±æ€§threadLocals</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså·²ç»åˆå§‹åŒ–(å³ä¸ä¸ºnull) å¹¶ä¸”å­˜åœ¨ä»¥å½“å‰ThreadLocalå¯¹è±¡ä¸ºKeyçš„å€¼, åˆ™ç›´æ¥è¿”å›å½“å‰çº¿ç¨‹è¦è·å–çš„å¯¹è±¡(ä¾‹ä¸­ä¸ºConnection);</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså·²ç»åˆå§‹åŒ–(å³ä¸ä¸ºnull)ä½†æ˜¯ä¸å­˜åœ¨ä»¥å½“å‰ThreadLocalå¯¹è±¡ä¸ºKeyçš„çš„å¯¹è±¡, é‚£ä¹ˆé‡æ–°åˆ›å»ºä¸€ä¸ªConnectionå¯¹è±¡, å¹¶ä¸”æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„threadLocals Mapä¸­,å¹¶è¿”å›</li><li>å¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalså±æ€§è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–, åˆ™é‡æ–°åˆ›å»ºä¸€ä¸ªThreadLocalMapå¯¹è±¡, å¹¶ä¸”åˆ›å»ºä¸€ä¸ªConnectionå¯¹è±¡å¹¶æ·»åŠ åˆ°ThreadLocalMapå¯¹è±¡ä¸­å¹¶è¿”å›</li></ul><blockquote><p>è°ƒç”¨ <strong>remove</strong> æ–¹æ³•ï¼Œå°±æ˜¯ä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼</p></blockquote><h4 id="ğŸThreadLocalMapå¯¹è±¡"><a href="#ğŸThreadLocalMapå¯¹è±¡" class="headerlink" title="ğŸThreadLocalMapå¯¹è±¡"></a>ğŸThreadLocalMapå¯¹è±¡</h4><h5 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h5><blockquote><ul><li>æ²¡æœ‰å®ç°Mapæ¥å£;</li><li>æ²¡æœ‰publicçš„æ–¹æ³•, æœ€å¤šæœ‰ä¸€ä¸ªdefaultçš„æ„é€ æ–¹æ³•, å› ä¸ºè¿™ä¸ªThreadLocalMapçš„æ–¹æ³•ä»…ä»…åœ¨ThreadLocalç±»ä¸­è°ƒç”¨, å±äºé™æ€å†…éƒ¨ç±»</li><li>ThreadLocalMapçš„Entryå®ç°ç»§æ‰¿äº†WeakReference&lt;ThreadLocal&lt;?&gt;&gt;ï¼Œå³å¼±å¼•ç”¨</li><li>è¯¥æ–¹æ³•ä»…ä»…ç”¨äº†ä¸€ä¸ªEntryæ•°ç»„æ¥å­˜å‚¨Key, Value; Entryå¹¶ä¸æ˜¯é“¾è¡¨å½¢å¼, è€Œæ˜¯æ¯ä¸ªbucketé‡Œé¢ä»…ä»…æ”¾ä¸€ä¸ªEntry</li></ul></blockquote><p>ä»¥ä¸€ä¸ªç¤ºä¾‹è§£é‡Šï¼š</p><p><img src="/img/19329/ThreadLocalMap1.png" alt="image.png"></p><ul><li>key çš„ hash å€¼ç»Ÿä¸€åˆ†é…</li><li>åˆå§‹å®¹é‡ <strong>16</strong>ï¼Œæ‰©å®¹å› å­ <strong>2&#x2F;3</strong>ï¼Œæ‰©å®¹<strong>å®¹é‡ç¿»å€</strong></li><li>key ç´¢å¼•å†²çªåç”¨<strong>å¼€æ”¾å¯»å€æ³•</strong>è§£å†³å†²çª</li></ul><h5 id="key-è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨"><a href="#key-è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨" class="headerlink" title="key è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨"></a><strong>key è¢«è®¾è®¡ä¸ºå¼±å¼•ç”¨</strong></h5><blockquote><p>å¼±å¼•ç”¨ï¼škeyè¢«é‡Šæ”¾å†…å­˜ï¼Œvalueè¿˜åœ¨</p></blockquote><p>Thread å¯èƒ½éœ€è¦é•¿æ—¶é—´è¿è¡Œï¼ˆå¦‚çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹ï¼‰ï¼Œå¦‚æœ key ä¸å†ä½¿ç”¨ï¼Œéœ€è¦åœ¨å†…å­˜ä¸è¶³ï¼ˆGCï¼Œ<strong>åƒåœ¾å›æ”¶</strong>ï¼‰æ—¶é‡Šæ”¾å…¶å ç”¨çš„å†…å­˜</p><h5 id="ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº"><a href="#ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº" class="headerlink" title="ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº"></a><strong>ThreadLocalMapå†…å­˜é‡Šæ”¾æ—¶æœº</strong></h5><ul><li>è¢«åŠ¨ GC é‡Šæ”¾ key</li></ul><p>â€‹ä»…æ˜¯è®© key çš„å†…å­˜é‡Šæ”¾ï¼Œå…³è” value çš„å†…å­˜å¹¶ä¸ä¼šé‡Šæ”¾</p><ul><li>æ‡’æƒ°è¢«åŠ¨é‡Šæ”¾ value</li></ul><p>â€‹get key æ—¶ï¼Œå‘ç°æ˜¯ null keyï¼Œåˆ™é‡Šæ”¾å…¶ value å†…å­˜</p><p>â€‹getåŸæœ¬ä¸å­˜åœ¨çš„keyï¼Œä¼šåˆ›å»ºä¸€ä¸ªkeyï¼Œè€Œvalueä¸ºnull</p><p><img src="/img/19329/ThreadLocalMap2.png" alt="image.png"></p><p>â€‹set key æ—¶ï¼Œä¼šä½¿ç”¨å¯å‘å¼æ‰«æï¼Œæ¸…é™¤ä¸´è¿‘çš„ null key çš„ value å†…å­˜ï¼Œå¯å‘æ¬¡æ•°ä¸å…ƒç´ ä¸ªæ•°ï¼Œæ˜¯å¦å‘ç° null key æœ‰å…³</p><p><img src="/img/19329/ThreadLocalMap3.png" alt="image.png"></p><p><img src="/img/19329/ThreadLocalMap4.png" alt="image.png"></p><p>â€‹set 8 æ—¶ä¼šå°†ä¸´è¿‘çš„9ã€10å…¨éƒ¨é‡Šæ”¾ï¼Œè€Œ14ç”±äºè·ç¦»è¿œä¸ä¼š</p><ul><li>ä¸»åŠ¨ remove é‡Šæ”¾ keyï¼Œvalue</li></ul><p>â€‹ä¼šåŒæ—¶é‡Šæ”¾ keyï¼Œvalue çš„å†…å­˜ï¼Œä¹Ÿä¼šæ¸…é™¤ä¸´è¿‘çš„ null key çš„ value å†…å­˜</p><p>â€‹æ¨èä½¿ç”¨å®ƒï¼Œå› ä¸ºä¸€èˆ¬ä½¿ç”¨ ThreadLocal æ—¶éƒ½æŠŠå®ƒä½œä¸ºé™æ€å˜é‡ï¼ˆå³å¼ºå¼•ç”¨ï¼‰ï¼Œå› æ­¤æ— æ³•è¢«åŠ¨ä¾é  GC å›æ”¶</p><h4 id="ğŸThreadLocalåº”ç”¨åœºæ™¯"><a href="#ğŸThreadLocalåº”ç”¨åœºæ™¯" class="headerlink" title="ğŸThreadLocalåº”ç”¨åœºæ™¯"></a>ğŸThreadLocalåº”ç”¨åœºæ™¯</h4><ul><li>æ¯ä¸ªçº¿ç¨‹ç»´æŠ¤äº†ä¸€ä¸ªâ€œåºåˆ—å·â€</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SerialNum</span> &#123;</span><br><span class="line">    <span class="comment">// The next serial number to be assigned</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">nextSerialNum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">ThreadLocal</span> <span class="variable">serialNum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>() &#123;</span><br><span class="line">        <span class="keyword">protected</span> <span class="keyword">synchronized</span> Object <span class="title function_">initialValue</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(nextSerialNum++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ((Integer) (serialNum.get())).intValue();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>Sessionçš„ç®¡ç†</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">ThreadLocal</span> <span class="variable">threadSession</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Session <span class="title function_">getSession</span><span class="params">()</span> <span class="keyword">throws</span> InfrastructureException &#123;  </span><br><span class="line">    <span class="type">Session</span> <span class="variable">s</span> <span class="operator">=</span> (Session) threadSession.get();  </span><br><span class="line">    <span class="keyword">try</span> &#123;  </span><br><span class="line">        <span class="keyword">if</span> (s == <span class="literal">null</span>) &#123;  </span><br><span class="line">            s = getSessionFactory().openSession();  </span><br><span class="line">            threadSession.set(s);  </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125; <span class="keyword">catch</span> (HibernateException ex) &#123;  </span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InfrastructureException</span>(ex);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="keyword">return</span> s;  </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure><ul><li>åœ¨çº¿ç¨‹å†…éƒ¨åˆ›å»ºThreadLocal</li></ul><p>â€‹åœ¨å¤šçº¿ç¨‹çš„ç±»(å¦‚ThreadDemoç±»)ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªThreadLocalå¯¹è±¡threadXxxï¼Œç”¨æ¥ä¿å­˜çº¿ç¨‹é—´éœ€è¦éš”ç¦»å¤„ç†çš„å¯¹è±¡xxxã€‚</p><p>â€‹åœ¨ThreadDemoç±»ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªè·å–è¦éš”ç¦»è®¿é—®çš„æ•°æ®çš„æ–¹æ³•getXxx()ï¼Œåœ¨æ–¹æ³•ä¸­åˆ¤æ–­ï¼Œè‹¥ThreadLocalå¯¹è±¡ä¸ºnullæ—¶å€™ï¼Œåº”è¯¥new()ä¸€ä¸ªéš”ç¦»è®¿é—®ç±»å‹çš„å¯¹è±¡ï¼Œå¹¶å¼ºåˆ¶è½¬æ¢ä¸ºè¦åº”ç”¨çš„ç±»å‹ã€‚</p><p>â€‹åœ¨ThreadDemoç±»çš„run()æ–¹æ³•ä¸­ï¼Œé€šè¿‡è°ƒç”¨getXxx()æ–¹æ³•è·å–è¦æ“ä½œçš„æ•°æ®ï¼Œè¿™æ ·å¯ä»¥ä¿è¯æ¯ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªæ•°æ®å¯¹è±¡ï¼Œåœ¨ä»»ä½•æ—¶åˆ»éƒ½æ“ä½œçš„æ˜¯è¿™ä¸ªå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalTest</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span>&#123;</span><br><span class="line">    </span><br><span class="line">    ThreadLocal&lt;Student&gt; StudentThreadLocal = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;Student&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">currentThreadName</span> <span class="operator">=</span> Thread.currentThread().getName();</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is running...&quot;</span>);</span><br><span class="line">        <span class="type">Random</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line">        <span class="type">int</span> <span class="variable">age</span> <span class="operator">=</span> random.nextInt(<span class="number">100</span>);</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is set age: &quot;</span>  + age);</span><br><span class="line">        <span class="type">Student</span> <span class="variable">Student</span> <span class="operator">=</span> getStudent(); <span class="comment">//é€šè¿‡è¿™ä¸ªæ–¹æ³•ï¼Œä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½ç‹¬ç«‹çš„newä¸€ä¸ªStudentå¯¹è±¡ï¼Œæ¯ä¸ªçº¿ç¨‹çš„çš„Studentå¯¹è±¡éƒ½å¯ä»¥è®¾ç½®ä¸åŒçš„å€¼</span></span><br><span class="line">        Student.setAge(age);</span><br><span class="line">        System.out.println(currentThreadName + <span class="string">&quot; is first get age: &quot;</span> + Student.getAge());</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">500</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println( currentThreadName + <span class="string">&quot; is second get age: &quot;</span> + Student.getAge());</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Student <span class="title function_">getStudent</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Student</span> <span class="variable">Student</span> <span class="operator">=</span> StudentThreadLocal.get();</span><br><span class="line">        <span class="keyword">if</span> (<span class="literal">null</span> == Student) &#123;</span><br><span class="line">            Student = <span class="keyword">new</span> <span class="title class_">Student</span>();</span><br><span class="line">            StudentThreadLocal.set(Student);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Student;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocalTest</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocalTest</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(t,<span class="string">&quot;Thread A&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(t,<span class="string">&quot;Thread B&quot;</span>);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setAge</span><span class="params">(<span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Javaå¹¶å‘åŸºç¡€</title>
      <link href="/posts/1954/"/>
      <url>/posts/1954/</url>
      
        <content type="html"><![CDATA[<h3 id="ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š"><a href="#ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š" class="headerlink" title="ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š"></a>ğŸçº¿ç¨‹å¹¶å‘ä¸å®‰å…¨åŸå› ï¼š</h3><h4 id="å¯è§æ€§"><a href="#å¯è§æ€§" class="headerlink" title="å¯è§æ€§"></a>å¯è§æ€§</h4><blockquote><p>å¯è§æ€§ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„ä¿®æ”¹ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°ã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//çº¿ç¨‹1æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">i = <span class="number">10</span>;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//çº¿ç¨‹2æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">j = i;</span><br></pre></td></tr></table></figure><p>å¦‚ä¸Šçº¿ç¨‹1å¯¹å˜é‡iä¿®æ”¹äº†ä¹‹åï¼Œçº¿ç¨‹2æ²¡æœ‰ç«‹å³çœ‹åˆ°çº¿ç¨‹1ä¿®æ”¹çš„å€¼ã€‚</p><h4 id="åŸå­æ€§"><a href="#åŸå­æ€§" class="headerlink" title="åŸå­æ€§"></a>åŸå­æ€§</h4><blockquote><p>åŸå­æ€§ï¼šä¸€ä¸ªæ“ä½œæˆ–è€…å¤šä¸ªæ“ä½œ è¦ä¹ˆå…¨éƒ¨æ‰§è¡Œå¹¶ä¸”æ‰§è¡Œçš„è¿‡ç¨‹ä¸ä¼šè¢«ä»»ä½•å› ç´ æ‰“æ–­ï¼Œè¦ä¹ˆå°±éƒ½ä¸æ‰§è¡Œã€‚</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹1æ‰§è¡Œ</span></span><br><span class="line">i += <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// çº¿ç¨‹2æ‰§è¡Œ</span></span><br><span class="line">i += <span class="number">1</span>;</span><br></pre></td></tr></table></figure><p><code>i += 1</code>éœ€è¦ä¸‰æ¡ CPU æŒ‡ä»¤:</p><ol><li>å°†å˜é‡ i ä»å†…å­˜è¯»å–åˆ° CPUå¯„å­˜å™¨ï¼›</li><li>åœ¨CPUå¯„å­˜å™¨ä¸­æ‰§è¡Œ i + 1 æ“ä½œï¼›</li><li>å°†æœ€åçš„ç»“æœiå†™å…¥å†…å­˜ï¼ˆç¼“å­˜æœºåˆ¶å¯¼è‡´å¯èƒ½å†™å…¥çš„æ˜¯ CPU ç¼“å­˜è€Œä¸æ˜¯å†…å­˜ï¼‰</li></ol><h4 id="æœ‰åºæ€§"><a href="#æœ‰åºæ€§" class="headerlink" title="æœ‰åºæ€§"></a>æœ‰åºæ€§</h4><blockquote><p>æœ‰åºæ€§ï¼šå³ç¨‹åºæ‰§è¡Œçš„é¡ºåºæŒ‰ç…§ä»£ç çš„å…ˆåé¡ºåºæ‰§è¡Œ</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;              </span><br><span class="line"><span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">i = <span class="number">1</span>;                <span class="comment">//è¯­å¥1  </span></span><br><span class="line">flag = <span class="literal">true</span>;          <span class="comment">//è¯­å¥2</span></span><br></pre></td></tr></table></figure><p>ä»ä»£ç é¡ºåºä¸Šçœ‹ï¼Œè¯­å¥1æ˜¯åœ¨è¯­å¥2å‰é¢çš„ï¼Œé‚£ä¹ˆJVMåœ¨çœŸæ­£æ‰§è¡Œè¿™æ®µä»£ç çš„æ—¶å€™ä¼šä¿è¯è¯­å¥1ä¸€å®šä¼šåœ¨è¯­å¥2å‰é¢æ‰§è¡Œå—? </p><p>ä¸ä¸€å®šï¼Œè¿™é‡Œå¯èƒ½ä¼šå‘ç”ŸæŒ‡ä»¤é‡æ’åº.</p><h3 id="ğŸJMM-Javaå†…å­˜æ¨¡å‹-è§£å†³æ–¹æ¡ˆ"><a href="#ğŸJMM-Javaå†…å­˜æ¨¡å‹-è§£å†³æ–¹æ¡ˆ" class="headerlink" title="ğŸJMM(Javaå†…å­˜æ¨¡å‹)è§£å†³æ–¹æ¡ˆ"></a>ğŸJMM(Javaå†…å­˜æ¨¡å‹)è§£å†³æ–¹æ¡ˆ</h3><h4 id="åŸå­æ€§-1"><a href="#åŸå­æ€§-1" class="headerlink" title="åŸå­æ€§"></a><strong>åŸå­æ€§</strong></h4><p>Javaå†…å­˜æ¨¡å‹åªä¿è¯äº†<strong>åŸºæœ¬è¯»å–å’Œèµ‹å€¼</strong>æ˜¯åŸå­æ€§æ“ä½œï¼Œå¦‚æœè¦å®ç°æ›´å¤§èŒƒå›´æ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥é€šè¿‡synchronizedå’ŒLockæ¥å®ç°ã€‚ç”±äºsynchronizedå’ŒLockèƒ½å¤Ÿä¿è¯ä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥ä»£ç å—ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¸å­˜åœ¨åŸå­æ€§é—®é¢˜äº†ï¼Œä»è€Œä¿è¯äº†åŸå­æ€§ã€‚</p><hr><h4 id="å¯è§æ€§-1"><a href="#å¯è§æ€§-1" class="headerlink" title="å¯è§æ€§"></a><strong>å¯è§æ€§</strong></h4><p>å½“ä¸€ä¸ªå…±äº«å˜é‡è¢«<strong>volatile</strong>ä¿®é¥°æ—¶ï¼Œå®ƒä¼šä¿è¯ä¿®æ”¹çš„å€¼ä¼šç«‹å³è¢«æ›´æ–°åˆ°ä¸»å­˜ï¼Œå½“æœ‰å…¶ä»–çº¿ç¨‹éœ€è¦è¯»å–æ—¶ï¼Œå®ƒä¼šå»å†…å­˜ä¸­è¯»å–æ–°å€¼</p><p>å¦å¤–ï¼Œé€šè¿‡synchronizedå’ŒLockä¹Ÿèƒ½å¤Ÿä¿è¯å¯è§æ€§ï¼Œsynchronizedå’ŒLockèƒ½ä¿è¯åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å–é”ç„¶åæ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œå¹¶ä¸”åœ¨é‡Šæ”¾é”ä¹‹å‰ä¼šå°†å¯¹å˜é‡çš„ä¿®æ”¹åˆ·æ–°åˆ°ä¸»å­˜å½“ä¸­ã€‚</p><hr><h4 id="æœ‰åºæ€§-1"><a href="#æœ‰åºæ€§-1" class="headerlink" title="æœ‰åºæ€§"></a><strong>æœ‰åºæ€§</strong></h4><p>ä¹Ÿæ˜¯ä½¿ç”¨volatileå…³é”®å­—ã€synchronizedå’ŒLock</p><h3 id="ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"><a href="#ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•" class="headerlink" title="ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•"></a>ğŸçº¿ç¨‹å®‰å…¨çš„å®ç°æ–¹æ³•</h3><h4 id="1-äº’æ–¥åŒæ­¥"><a href="#1-äº’æ–¥åŒæ­¥" class="headerlink" title="(1)äº’æ–¥åŒæ­¥"></a><strong>(1)äº’æ–¥åŒæ­¥</strong></h4><p>å¯¹å…±äº«æ•°æ®è¿›è¡ŒåŠ é”ï¼š<strong>synchronized å’Œ ReentrantLock</strong></p><p>äº’æ–¥åŒæ­¥æœ€ä¸»è¦çš„é—®é¢˜å°±æ˜¯çº¿ç¨‹é˜»å¡å’Œå”¤é†’æ‰€å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ï¼Œå› æ­¤è¿™ç§åŒæ­¥ä¹Ÿç§°ä¸ºé˜»å¡åŒæ­¥ã€‚</p><h4 id="2-éé˜»å¡åŒæ­¥"><a href="#2-éé˜»å¡åŒæ­¥" class="headerlink" title="(2)éé˜»å¡åŒæ­¥"></a><strong>(2)éé˜»å¡åŒæ­¥</strong></h4><h5 id="ä¸€-CAS"><a href="#ä¸€-CAS" class="headerlink" title="(ä¸€)CAS"></a>(ä¸€)CAS</h5><p>æ¯”è¾ƒå¹¶äº¤æ¢(Compare-and-Swapï¼ŒCAS)ã€‚CAS æŒ‡ä»¤éœ€è¦æœ‰ 3 ä¸ªæ“ä½œæ•°ï¼Œåˆ†åˆ«æ˜¯å†…å­˜åœ°å€ Vã€æ—§çš„é¢„æœŸå€¼ A å’Œæ–°å€¼ Bã€‚</p><p>å½“æ‰§è¡Œæ“ä½œæ—¶ï¼Œ<strong>åªæœ‰å½“ V çš„å€¼ç­‰äº Aï¼Œæ‰å°† V çš„å€¼æ›´æ–°ä¸º B</strong>ã€‚</p><h5 id="äºŒ-AtomicInteger"><a href="#äºŒ-AtomicInteger" class="headerlink" title="(äºŒ)AtomicInteger"></a><strong>(äºŒ)AtomicInteger</strong></h5><p>ä¹è§‚é”ï¼šé€šè¿‡ getIntVolatile(var1, var2) å¾—åˆ°æ—§çš„é¢„æœŸå€¼ï¼Œé€šè¿‡è°ƒç”¨ compareAndSwapInt() æ¥è¿›è¡Œ CAS æ¯”è¾ƒ</p><p><strong>(ä¸‰)ABA</strong></p><p>å¦‚æœä¸€ä¸ªå˜é‡åˆæ¬¡è¯»å–çš„æ—¶å€™æ˜¯ A å€¼ï¼Œå®ƒçš„å€¼è¢«æ”¹æˆäº† Bï¼Œåæ¥åˆè¢«æ”¹å›ä¸º Aï¼Œé‚£ CAS æ“ä½œå°±ä¼šè¯¯è®¤ä¸ºå®ƒä»æ¥æ²¡æœ‰è¢«æ”¹å˜è¿‡ã€‚</p><p>J.U.C åŒ…æä¾›äº†ä¸€ä¸ªå¸¦æœ‰æ ‡è®°çš„åŸå­å¼•ç”¨ç±» AtomicStampedReference æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h4 id="3-æ— åŒæ­¥æ–¹æ¡ˆ"><a href="#3-æ— åŒæ­¥æ–¹æ¡ˆ" class="headerlink" title="(3)æ— åŒæ­¥æ–¹æ¡ˆ"></a><strong>(3)æ— åŒæ­¥æ–¹æ¡ˆ</strong></h4><p>ä¸€ä¸ªæ–¹æ³•æœ¬æ¥å°±ä¸æ¶‰åŠå…±äº«æ•°æ®ï¼Œé‚£å®ƒè‡ªç„¶å°±æ— é¡»ä»»ä½•åŒæ­¥æªæ–½å»ä¿è¯æ­£ç¡®æ€§ã€‚</p><h5 id="ä¸€-æ ˆå°é—­"><a href="#ä¸€-æ ˆå°é—­" class="headerlink" title="(ä¸€)æ ˆå°é—­"></a><strong>(ä¸€)æ ˆå°é—­</strong></h5><p>å¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€ä¸ªæ–¹æ³•çš„å±€éƒ¨å˜é‡æ—¶ï¼Œä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œå› ä¸ºå±€éƒ¨å˜é‡å­˜å‚¨åœ¨è™šæ‹Ÿæœºæ ˆä¸­ï¼Œå±äºçº¿ç¨‹ç§æœ‰ã€‚</p><h5 id="äºŒ-çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local-Storageï¼‰"><a href="#äºŒ-çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread-Local-Storageï¼‰" class="headerlink" title="(äºŒ)çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰"></a><strong>(äºŒ)çº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ˆThread Local Storageï¼‰</strong></h5><p>å…³é”®ï¼š<strong>çº¿ç¨‹é—´éš”ç¦»ï¼Œçº¿ç¨‹å†…å…±äº«</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal.set(<span class="number">1</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(threadLocal.get());</span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal.set(<span class="number">2</span>);</span><br><span class="line">            threadLocal.remove();</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç è¾“å‡ºç»“æœä¸ºï¼š1</p><p>è§£é‡Šï¼šthread1 ä¸­è®¾ç½® threadLocal ä¸º 1ï¼Œè€Œ thread2 è®¾ç½® threadLocal ä¸º 2ã€‚è¿‡äº†ä¸€æ®µæ—¶é—´ä¹‹åï¼Œthread1 è¯»å– threadLocal ä¾ç„¶æ˜¯ 1ï¼Œä¸å— thread2 çš„å½±å“ã€‚</p><p><strong>åŸç†è§£æ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ThreadLocalExample1</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">ThreadLocal</span> <span class="variable">threadLocal2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal1.set(<span class="number">1</span>);</span><br><span class="line">            threadLocal2.set(<span class="number">1</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            threadLocal1.set(<span class="number">2</span>);</span><br><span class="line">            threadLocal2.set(<span class="number">2</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä»£ç çš„ç»“æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.pdai.tech/images/pics/3646544a-cb57-451d-9e03-d3c4f5e4434a.png" alt="image"></p><p>æ¯ä¸ª Thread éƒ½æœ‰ä¸€ä¸ª ThreadLocal.ThreadLocalMap å¯¹è±¡</p><p>Thread ç±»ä¸­å®šä¹‰äº† ThreadLocal.ThreadLocalMap æˆå‘˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* ThreadLocal values pertaining to this thread. This map is maintained</span></span><br><span class="line"><span class="comment"> * by the ThreadLocal class. */</span></span><br><span class="line">ThreadLocal.<span class="type">ThreadLocalMap</span> <span class="variable">threadLocals</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure><p>å½“è°ƒç”¨ä¸€ä¸ª ThreadLocal çš„ set(T value) æ–¹æ³•æ—¶ï¼Œå…ˆå¾—åˆ°å½“å‰çº¿ç¨‹çš„ ThreadLocalMap å¯¹è±¡ï¼Œç„¶åå°† ThreadLocal(è‡ªå·±)-&gt;value é”®å€¼å¯¹æ’å…¥åˆ°è¯¥ Map ä¸­:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">set</span><span class="params">(T value)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>)</span><br><span class="line">        map.set(<span class="built_in">this</span>, value);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        createMap(t, value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨get()æ–¹æ³•æ—¶ï¼ŒThreadLocal è‡ªå·±ä½œä¸º keyï¼Œåˆ°å½“å‰çº¿ç¨‹ä¸­æŸ¥æ‰¾å…³è”çš„èµ„æºå€¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> T <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">    <span class="type">ThreadLocalMap</span> <span class="variable">map</span> <span class="operator">=</span> getMap(t);</span><br><span class="line">    <span class="keyword">if</span> (map != <span class="literal">null</span>) &#123;</span><br><span class="line">        ThreadLocalMap.<span class="type">Entry</span> <span class="variable">e</span> <span class="operator">=</span> map.getEntry(<span class="built_in">this</span>);</span><br><span class="line">        <span class="keyword">if</span> (e != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">            <span class="type">T</span> <span class="variable">result</span> <span class="operator">=</span> (T)e.value;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> setInitialValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨ remove ()æ–¹æ³•ï¼Œä»¥ ThreadLocal è‡ªå·±ä½œä¸º keyï¼Œç§»é™¤å½“å‰çº¿ç¨‹å…³è”çš„èµ„æºå€¼</p>]]></content>
      
      
      <categories>
          
          <category> Javaå¹¶å‘ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Javaå¹¶å‘ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>æœ€é•¿å›æ–‡å­ä¸²</title>
      <link href="/posts/52608/"/>
      <url>/posts/52608/</url>
      
        <content type="html"><![CDATA[<h4 id="ğŸé¢˜ç›®æè¿°"><a href="#ğŸé¢˜ç›®æè¿°" class="headerlink" title="ğŸé¢˜ç›®æè¿°"></a>ğŸé¢˜ç›®æè¿°</h4><p>â€‹ç»™ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„å›æ–‡å­ä¸²ã€‚</p><p>â€‹å¦‚æœå­—ç¬¦ä¸²çš„ååºä¸åŸå§‹å­—ç¬¦ä¸²ç›¸åŒï¼Œåˆ™è¯¥å­—ç¬¦ä¸²ç§°ä¸ºå›æ–‡å­—ç¬¦ä¸²ã€‚</p><h4 id="ğŸæ€è·¯"><a href="#ğŸæ€è·¯" class="headerlink" title="ğŸæ€è·¯"></a>ğŸæ€è·¯</h4><p>ä¸­å¿ƒæ‰©æ•£æ³•ï¼š</p><blockquote><p>é¡¾åæ€ä¹‰ï¼Œå³å¯¹å­—ç¬¦ä¸²sè¿›è¡Œéå†ï¼Œæ¯ä¸ªæˆ–æ¯å¯¹å­—ç¬¦è¿›è¡Œä¸­å¿ƒæ‰©å±•ï¼Œè®°å½•è¿‡ç¨‹ä¸­çš„æœ€å¤§å€¼ã€‚</p><p>æ¯”è¾ƒå›°éš¾çš„åœ°æ–¹åœ¨äºï¼Œå¦‚ä½•å¯¹å¥‡æ•°å’Œå¶æ•°å­—ç¬¦ä¸²è¿›è¡ŒåŒºåˆ†ï¼Ÿå¦‚abbaå’Œabaï¼Œä¸€ä¸ªä»¥ä¸­é—´ä¸¤ä¸ªbä¸ºä¸­å¿ƒï¼Œä¸€ä¸ªä»¥ä¸­é—´ä¸€ä¸ªbä¸ºä¸­å¿ƒã€‚</p><p>æ¯”è¾ƒå·§å¦™çš„æ–¹å¼ä¸ºåŒæŒ‡é’ˆæ–¹æ³•ï¼Œä¹Ÿå³ä¸¤ä¸ªæŒ‡é’ˆåˆ†åˆ«ä¸ºç›¸åŒå’Œç›¸å·®ä¸€ä½è¿›è¡Œæ‰©æ•£ï¼Œè¿”å›å¥‡æ•°å­ä¸²é•¿åº¦å’Œå¶æ•°å­ä¸²é•¿åº¦ï¼Œå†è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦å¤–ï¼Œé¢˜ç›®ä¸ä»…ä»…è¿”å›å­ä¸²çš„é•¿åº¦ï¼Œè¿˜æœ‰å­ä¸²æœ¬èº«ï¼Œæ‰€ä»¥éœ€è¦è®°å½•å­ä¸²çš„å¼€å§‹ç´¢å¼•ï¼Œå³ä»£ç ä¸­çš„beginï¼Œé™¤2çš„æ–¹å¼ç»Ÿä¸€äº†å¥‡æ•°å’Œå¶æ•°çš„æƒ…å†µã€‚</p></blockquote><h4 id="ğŸä»£ç "><a href="#ğŸä»£ç " class="headerlink" title="ğŸä»£ç "></a>ğŸä»£ç </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="comment">// æ‰©å±•çš„è¾…åŠ©å‡½æ•°</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">expand</span><span class="params">(String s,<span class="type">int</span> c1,<span class="type">int</span> c2)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">while</span>(c1&gt;=<span class="number">0</span>&amp;&amp;c2&lt;len&amp;&amp;s.charAt(c1)==s.charAt(c2))&#123;</span><br><span class="line">            c1 -= <span class="number">1</span>;</span><br><span class="line">            c2 += <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> c2-c1-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="keyword">if</span>(len &lt; <span class="number">2</span>) <span class="keyword">return</span> s;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max_len</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="comment">// æœ€ç»ˆè¿”å›å­ä¸²çš„å¼€å§‹ç´¢å¼•</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">begin</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;len-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">odd_len</span> <span class="operator">=</span> expand(s,i,i); <span class="comment">// å¥‡æ•°æ‰©æ•£</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">even_len</span> <span class="operator">=</span> expand(s,i,i+<span class="number">1</span>); <span class="comment">// å¶æ•°æ‰©æ•£</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">cur_len</span> <span class="operator">=</span> Math.max(odd_len,even_len);</span><br><span class="line">            <span class="keyword">if</span>(cur_len &gt; max_len)&#123;</span><br><span class="line">                max_len = cur_len;</span><br><span class="line">                begin = i - (max_len - <span class="number">1</span>)/<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(begin,begin+max_len);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•°æ®ç»“æ„ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
